Chapter 16 

Counting 

16.1  Why Count? 

Are  there  two different  subsets  of  the  ninety  25-digit  numbers  shown  below  that 
have the same sum —for example, maybe the sum of the numbers in the ﬁrst col­
umn is equal to the sum of the numbers in the second column? 

0020480135385502964448038 
5763257331083479647409398 
0489445991866915676240992 
5800949123548989122628663 
1082662032430379651370981 
6042900801199280218026001 
1178480894769706178994993 
6116171789137737896701405 
1253127351683239693851327 
6144868973001582369723512 
1301505129234077811069011 
6247314593851169234746152 
1311567111143866433882194 
6814428944266874963488274 
1470029452721203587686214 
6870852945543886849147881 
1578271047286257499433886 
6914955508120950093732397 
1638243921852176243192354 
6949632451365987152423541 
1763580219131985963102365 
7128211143613619828415650 
1826227795601842231029694 
7173920083651862307925394 
1843971862675102037201420 
7215654874211755676220587 
2396951193722134526177237 
7256932847164391040233050 
2781394568268599801096354 
7332822657075235431620317 
2796605196713610405408019 
7426441829541573444964139 
2931016394761975263190347 
7632198126531809327186321 
2933458058294405155197296 
7712154432211912882310511 
3075514410490975920315348 

3171004832173501394113017 
8247331000042995311646021 
3208234421597368647019265 
8496243997123475922766310 
3437254656355157864869113 
8518399140676002660747477 
3574883393058653923711365 
8543691283470191452333763 
3644909946040480189969149 
8675309258374137092461352 
3790044132737084094417246 
8694321112363996867296665 
3870332127437971355322815 
8772321203608477245851154 
4080505804577801451363100 
8791422161722582546341091 
4167283461025702348124920 
9062628024592126283973285 
4235996831123777788211249 
9137845566925526349897794 
4670939445749439042111220 
9153762966803189291934419 
4815379351865384279613427 
9270880194077636406984249 
4837052948212922604442190 
9324301480722103490379204 
5106389423855018550671530 
9436090832146695147140581 
5142368192004769218069910 
9475308159734538249013238 
5181234096130144084041856 
9492376623917486974923202 
5198267398125617994391348 
9511972558779880288252979 
5317592940316231219758372 
9602413424619187112552264 
5384358126771794128356947 

331 

332 

CHAPTER 16.  COUNTING 

7858918664240262356610010 
8149436716871371161932035 
3111474985252793452860017 
7898156786763212963178679 
3145621587936120118438701 
8147591017037573337848616 
3148901255628881103198549 
5692168374637019617423712 

9631217114906129219461111 
3157693105325111284321993 
5439211712248901995423441 
9908189853102753335981319 
5610379826092838192760458 
9913237476341764299813987 
5632317555465228677676044 
8176063831682536571306791 

Finding  two  subsets  with  the  same  sum  may  seem  like  an  silly  puzzle,  but 
solving problems like this turns out to be useful, for example in ﬁnding good ways 
to ﬁt packages into shipping containers and in decoding secret messages. 
The answer to the question turns out to be “yes.” Of course this would be easy 
to conﬁrm just by showing two subsets with the same sum, but that turns out to be 
kind of hard to do. So before we put a lot of effort into ﬁnding such a pair, it would 
be nice to be sure there were some.  Fortunately,  it is very easy to see why there is 
such a pair —or at least it will be easy once we have developed a few simple rules 
for counting things. 

The Contest to Find Two Sets with the Same Sum 

One  term,  Eric Lehman,  a  6.042  instructor who  contributed  to many parts  of  this 
book,  offered  a  $100  prize  for  being  the  ﬁrst  6.042  student  to  actually  ﬁnd  two 
different  subsets  of  the  above  ninety  25-digit  numbers  that  have  the  same  sum. 
Eric didn’t expect to have to pay off this bet, but he underestimated the ingenuity 
and initiative of 6.042 students. 
One computer science major wrote a program  that cleverly  searched only among 
a reasonably small set of “plausible” sets, sorted them by their sums, and actually 
found  a  couple with  the  same  sum.  He won  the  prize.  A  few  days  later,  a math 
major  ﬁgured  out  how  to  reformulate  the  sum  problem  as  a  “lattice  basis  reduc­
tion” problem;  then he  found a software package  implementing an efﬁcient basis 
reduction  procedure,  and  using  it,  he  very  quickly  found  lots  of  pairs  of  subsets 
with  the  same  sum.  He didn’t win  the prize,  but he  got  a  standing  ovation  from 
the class —staff included. 

Counting seems easy enough: 1, 2, 3, 4, etc. This direct approach works well for 
counting  simple  things —like  your  toes —and may  be  the  only  approach  for  ex­
tremely complicated things with no identiﬁable structure. However, subtler meth­
ods can help you count many things in the vast middle ground, such as: 

•	 The  number  of  different  ways  to  select  a  dozen  doughnuts  when  there  are 
ﬁve varieties available. 

•	 The number of 16-bit numbers with exactly 4 ones. 

16.2.  COUNTING ONE THING BY COUNTING ANOTHER 

333 

Counting is useful in computer science for several reasons: 

•	 Determining the time and storage required to solve a computational problem 
—a  central  objective  in  computer  science —often  comes  down  to  solving  a 
counting problem. 

•	 Counting  is  the  basis  of  probability  theory, which  plays  a  central  role  in  all 
sciences, including computer science. 

•	 Two  remarkable  proof  techniques,  the  “pigeonhole  principle”  and  “combi­
natorial proof,”  rely on  counting.  These  lead  to  a variety of  interesting  and 
useful insights. 

We’re going to present a lot of rules for counting.  These rules are actually the­
orems,  but most  of  them  are  pretty  obvious  anyway,  so we’re  not  going  to  focus 
on proving them. Our objective is to teach you simple counting as a practical skill, 
like integration. 

16.2  Counting One Thing by Counting Another 

How  do  you  count  the  number  of  people  in  a  crowded  room?  You  could  count 
heads,  since  for  each  person  there  is  exactly  one  head.  Alternatively,  you  could 
count ears and divide by two.  Of course, you might have to adjust the calculation 
if  someone  lost  an  ear  in  a pirate  raid  or  someone was born with  three  ears.  The 
point  here  is  that  you  can  often  count  one  thing  by  counting  another,  though  some 
fudge factors may be required. 
In more formal terms, every counting problem comes down to determining the 
size of some set.  The size or cardinality of a ﬁnite set, S , is the number of elements 
in  it and  is denoted  |S |.  In  these  terms, we’re claiming  that we can often ﬁnd  the 
size  of  one  set  by  ﬁnding  the  size  of  a  related  set.  We’ve  already  seen  a  general 
statement of this idea in the Mapping Rule of Lemma 4.8.2. 

16.2.1  The Bijection Rule 
We’ve  already  implicitly  used  the  Bijection  Rule  of  Lemma  3  a  lot.  For  example, 
when we studied Stable Marriage and Bipartite Matching, we assumed the obvious 
fact that if we can pair up all the girls at a dance with all the boys, then there must 
be an equal number of each.  If we needed  to be explicit about using  the Bijection 
Rule,  we  could  say  that  A  was  the  set  of  boys,  B  was  the  set  of  girls,  and  the 
bijection between them was how they were paired. 
The Bijection Rule acts as a magniﬁer of counting ability;  if you ﬁgure out  the 
size of  one  set,  then you  can  immediately determine  the  sizes of many  other  sets 
via bijections.  For example, let’s return to two sets mentioned earlier: 
A = all ways to select a dozen doughnuts when ﬁve varieties are available 
B = all 16-bit sequences with exactly 4 ones 

334 

CHAPTER 16.  COUNTING 

Let’s consider a particular element of set A: 
���� 
�� 
���� 
���� 
���� 
� 
� 
0 0
0 0
0 0 0 0 0 0
0 0
sugar 
glazed 
lemon-ﬁlled 
plain 
chocolate 
We’ve depicted each doughnut with a 0 and left a gap between the different vari­
eties. Thus, the selection above contains two chocolate doughnuts, no lemon-ﬁlled, 
six sugar, two glazed, and two plain. Now let’s put a 1 into each of the four gaps: 
���� 
���� 
� 
���� 
���� 
�� 
� 
0 0
0 0
0 0 0 0 0 0
0 0
sugar 
plain 
glazed 
lemon-ﬁlled 
chocolate 
We’ve just formed a 16-bit number with exactly 4 ones— an element of B ! 
This example suggests a bijection from set A to set B : map a dozen doughnuts 
consisting of: 

1 

1 

1 

1

1

1

1

1

c chocolate, l lemon-ﬁlled, s sugar, g glazed, and p plain 
to the sequence: 
� �� � 
� �� � 
� �� � 
� �� � 
� �� � 
0 . . . 0
0 . . . 0
0 . . . 0
0 . . . 0
0 . . . 0
p 
c 
l 
g
s
The  resulting  sequence  always  has  16  bits  and  exactly  4  ones,  and  thus  is  an 
element  of  B .  Moreover,  the  mapping  is  a  bijection;  every  such  bit  sequence  is 
mapped to by exactly one order of a dozen doughnuts. Therefore, |A| = |B | by the 
Bijection Rule! 
This  demonstrates  the  magnifying  power  of  the  bijection  rule.  We  managed 
to prove  that  two very different sets are actually  the same size— even  though we 
don’t know exactly how big either one is.  But as soon as we ﬁgure out the size of 
one set, we’ll immediately know the size of the other. 
This particular bijection might seem frighteningly ingenious if you’ve not seen 
it  before.  But  you’ll  use  essentially  this  same  argument  over  and  over,  and  soon 
you’ll consider it routine. 

16.2.2  Counting Sequences 
The  Bijection  Rule  lets  us  count  one  thing  by  counting  another.  This  suggests  a 
general  strategy:  get  really  good  at  counting  just  a  few  things  and  then use  bijec­
tions  to  count  everything  else.  This  is  the  strategy we’ll  follow.  In particular, we’ll 
get really good at counting sequences. When we want to determine the size of some 
other set T , we’ll ﬁnd a bijection from T  to a set of sequences S . Then we’ll use our 
super-ninja sequence-counting skills to determine |S |, which immediately gives us 
|T |. We’ll need to hone this idea somewhat as we go along, but that’s pretty much 
the plan! 

16.2.  COUNTING ONE THING BY COUNTING ANOTHER 

335 

16.2.3  The Sum Rule 
Linus allocates his big sister Lucy a quota of 20 crabby days, 40 irritable days, and 
60  generally  surly  days.  On  how  many  days  can  Lucy  be  out-of-sorts  one  way 
or  another?  Let  set  C  be  her  crabby  days,  I  be  her  irritable  days,  and  S  be  the 
generally  surly.  In  these  terms,  the  answer  to  the  question  is  |C ∪ I ∪ S |.  Now 
assuming  that  she  is  permitted  at most  one  bad  quality  each  day,  the  size  of  this 
union of sets is given by the Sum Rule: 
Rule 1 (Sum Rule).  If A1 , A2 , . . . , An  are disjoint sets, then: 
|A1  ∪ A2  ∪ . . . ∪ An | = |A1 | + |A2 | + . . . + |An | 
Thus, according to Linus’ budget, Lucy can be out-of-sorts for: 
|C ∪ I ∪ S | = |C | + |I | + |S |
= 20 + 40 + 60 
= 120 days 

Notice  that  the  Sum  Rule  holds  only  for  a  union  of  disjoint  sets.  Finding  the 
size  of  a union  of  intersecting  sets  is  a more  complicated problem  that we’ll  take 
up later. 

16.2.4  The Product Rule 
The Product Rule gives the size of a product of sets.  Recall that if P1 , P2 , . . . , Pn  are 
sets, then 
P1  × P2  × . . . × Pn 
is the set of all sequences whose ﬁrst term is drawn from P1 , second term is drawn 
from P2  and so forth. 
Rule 2 (Product Rule).  If P1 , P2 , . . . Pn  are sets, then: 
|P1  × P2  × . . . × Pn | = |P1 | · |P2 | · · · |Pn | 
Unlike the sum rule, the product rule does not require the sets P1 , . . . , Pn  to be 
disjoint.  For example, suppose a daily diet consists of a breakfast selected from set 
B , a lunch from set L, and a dinner from set D : 
B = {pancakes, bacon and eggs, bagel, Doritos}

L = {burger and fries, garden salad, Doritos}

D = {macaroni, pizza, frozen burrito, pasta, Doritos}

Then B ×L×D is the set of all possible daily diets. Here are some sample elements:

(pancakes, burger and fries, pizza)

(bacon and eggs, garden salad, pasta)

(Doritos, Doritos, frozen burrito)


336 

CHAPTER 16.  COUNTING 

The Product Rule tells us how many different daily diets are possible: 
|B × L × D | = |B | · |L| · |D |
·
· 
= 4  3  5
= 60 

16.2.5  Putting Rules Together 
Few  counting  problems  can  be  solved with  a  single  rule.  More  often,  a  solution 
is  a  ﬂurry  of  sums,  products,  bijections,  and  other  methods.  Let’s  look  at  some 
examples that bring more than one rule into play. 

Counting Passwords 

The  sum  and  product  rules  together  are  useful  for  solving  problems  involving 
passwords, telephone numbers, and license plates.  For example, on a certain com­
puter  system,  a  valid  password  is  a  sequence  of  between  six  and  eight  symbols. 
The ﬁrst  symbol must be  a  letter  (which  can be  lowercase  or uppercase),  and  the 
remaining symbols must be either letters or digits. How many different passwords 
are possible? 
Let’s  deﬁne  two  sets,  corresponding  to  valid  symbols  in  the  ﬁrst  and  subse­
quent positions in the password. 
F  = {a, b, . . . , z , A, B , . . . , Z }

S  = {a, b, . . . , z , A, B , . . . , Z, 0, 1, . . . , 9}

In these terms, the set of all possible passwords is: 
(F  × S 5 ) ∪ (F  × S 6 ) ∪ (F  × S 7 ) 
Thus, the length-six passwords are in set F × S 5 , the length-seven passwords are in 
F × S 6 , and the length-eight passwords are in F × S 7 .  Since these sets are disjoint, 
we can apply  the Sum Rule and count  the  total number of possible passwords as 
��
��
��
��
��
��
��
��
follows: 
(F  × S 5 ) ∪ (F  × S 6 ) ∪ (F  × S 7 )  =  F  × S 5  +  F  × S 6  +  F  × S 7 
Sum Rule 
= |F | · |S | 5  + |F | · |S | 6  + |F | · |S | 7  Product Rule 
· 
·
·
= 52  625  + 52  626  + 52  627 
≈ 1.8  1014  different passwords 
· 

Subsets of an n-element Set 

How many different subsets of an n-element set X  are there?  For example, the set 
X  = {x1 , x2 , x3 } has eight different subsets: 
{x2}
∅
{x1 }
{x3 } {x1 , x3}
{x2 , x3}

{x1 , x2}
{x1 , x2 , x3 } 

16.2.  COUNTING ONE THING BY COUNTING ANOTHER 

337 

There is a natural bijection from subsets of X to n-bit sequences. Let x1 , x2 , . . . , xn 
be the elements of X . Then a particular subset of X maps to the sequence (b1 , . . . , bn ) 
where  bi  = 1  if  and  only  if  xi  is  in  that  subset.  For  example,  if  n  =  10,  then  the 
subset {x2 , x3 , x5 , x7 , x10} maps to a 10-bit sequence as follows: 
subset:  { 
(
sequence: 

x2 , x3 ,
1,  0, 
1, 

x10  }
) 
1

0, 

x5 ,
1,  0, 

x7 ,
1,  0,  0, 

We  just  used  a  bijection  to  transform  the  original  problem  into  a  question  about 
sequences  —exactly  according  to  plan!  Now  if  we  answer  the  sequence  question, 
then we’ve solved our original problem as well. 
But  how  many  different  n-bit  sequences  are  there?  For  example,  there  are  8 
different 3-bit sequences: 

(0, 1, 1) 
(1, 1, 1) 

(0, 0, 0) 
(0, 0, 1) 
(0, 1, 0) 
(1, 1, 0) 
(1, 0, 1) 
(1, 0, 0) 
Well, we can write the set of all n-bit sequences as a product of sets: 
�� 
� 
� 
{0, 1} × {0, 1} × . . . × {0, 1} = {0, 1} n 
n terms 
Then Product Rule gives the answer: 
|{0, 1} n | = |{0, 1}| n 
= 2n 

This means  that  the number of  subsets of an n-element  set X  is also 2n .  We’ll 
put this answer to use shortly. 

16.2.6  Problems 
Practice Problems 

Problem 16.1. 
How many ways  are  there  to  select  k  out  of  n  books  on  a  shelf  so  that  there  are 
always  at  least  3  unselected  books  between  selected  books?  (Assume  n  is  large 
enough for this to be possible.) 

Class Problems 

Problem 16.2. 
A license plate consists of either: 

•  3 letters followed by 3 digits (standard plate) 

•  5 letters (vanity plate) 

338 

CHAPTER 16.  COUNTING 

•  2 characters – letters or numbers (big shot plate) 

Let L be the set of all possible license plates. 
(a)  Express L in terms of 

A = {A, B , C, . . . , Z } 
D = {0, 1, 2, . . . , 9} 

using unions (∪) and set products (×). 
(b)  Compute |L|, the number of different license plates, using the sum and prod­
uct rules. 

Problem 16.3.  (a)  How  many  of  the  billion  numbers  in  the  range  from  1  to  109 
contain the digit 1? (Hint: How many don’t?) 

(b)  There are 20 books arranged in a row on a shelf. Describe a bijection between 
ways of choosing 6 of  these books so  that no  two adjacent books are selected and 
15-bit strings with exactly 6 ones. 

That is 

Problem 16.4. 
(a)  Let Sn,k  be the possible nonnegative integer solutions to the inequality 
+ xk  ≤ n. 
· · · 
x1  + x2  +
�
� 
Sn,k  ::=  (x1 , x2 , . . . , xk ) ∈ Nk  | (16.1) is true  . 
Describe a bijection between Sn,k  and the set of binary strings with n zeroes and k 
ones. 
(b)  Let Ln,k  be the length k weakly increasing sequences of nonnegative integers 
� 
� 
≤ n. That is 
Ln,k  ::=  (y1 , y2 , . . . , yk ) ∈ Nk  | y1  ≤ y2  ≤  · · · ≤ yk  ≤ n . 
Describe a bijection between Ln,k  and Sn,k . 

(16.1)

Problem 16.5. 
An n-vertex numbered tree is a tree whose vertex set is {1, 2, . . . , n} for some n > 2. 
We deﬁne the code of the numbered tree to be a sequence of n − 2  integers from 1 
to n obtained by the following recursive process: 

16.2.  COUNTING ONE THING BY COUNTING ANOTHER 

339 

If  there  are more  than  two  vertices  left, write  down  the  father  of  the  largest  leafa , 
delete this leaf, and continue this process on the resulting smaller tree. 
If there are only two vertices left, then stop —the code is complete. 

a The necessarily unique node adjacent to a leaf is called its father. 

For  example,  the  codes  of  a  couple  of  numbered  trees  are  shown  in  the  Fig­
ure 16.2. 

Coding Numbered Trees

Tree
Tree

2

3

2

6

5

4

4

5

7

Code

4 3 2

6 5 6 2 2

1

1

3

Image by MIT OpenCourseWare.

Figure 16.1: 

(a)  Describe a procedure for reconstructing a numbered tree from its code. 

(b)  Conclude there is a bijection between the n-vertex numbered trees and {1, . . . , n} n−2 , 
and state how many n-vertex numbered trees there are. 

340 

CHAPTER 16.  COUNTING 

Homework Problems 

Problem 16.6. 
Answer the following questions with a number or a simple formula involving fac­
torials and binomial coefﬁcients. Brieﬂy explain your answers. 
(a)  How many ways are there to order the 26 letters of the alphabet so that no two 
of  the vowels a, e, i, o, u appear consecutively and  the  last  letter  in  the ordering 
is not a vowel? 
Hint: Every vowel appears to the left of a consonant. 

(b)  How many ways are there to order the 26 letters of the alphabet so that there 
are at least two consonants immediately following each vowel? 

(c)  In how many different ways can 2n students be paired up? 

(d)  Two  n-digit  sequences  of  digits  0,1,. . . ,9  are  said  to  be  of  the  same  type  if  the 
digits of one are a permutation of  the digits of  the other.  For n  = 8,  for example, 
the  sequences 03088929 and 00238899 are  the  same  type.  How many  types of 
n-digit integers are there? 

Problem 16.7. 
In  a  standard  52-card  deck,  each  card  has  one  of  thirteen  ranks  in  the  set,  R,  and 
one of four suits in the set, S , where 
R ::= {A, 2, . . . , 10, J, Q, K } , 
S  ::= {♣, ♦, ♥, ♠} . 

A 5-card hand is a set of ﬁve distinct cards from the deck. 
For each part describe a bijection between a set that can easily be counted using 
the Product and Sum Rules of Ch. 16.2, and the set of hands matching the speciﬁ­
cation. Give bijections, not numerical answers. 
For instance, consider the set of 5-card hands containing all 4 suits.  Each such 
hand  must  have  2  cards  of  one  suit.  We  can  describe  a  bijection  between  such 
hands  and  the  set  S  × R2  × R3  where R2  is  the  set  of  two-element  subsets  of R. 
Namely, an element 

(s, {r1 , r2 } , (r3 , r4 , r5 )) ∈ S × R2  × R3 

indicates 
1.  the repeated suit, s ∈ S , 
2.  the set, {r1 , r2 } ∈ R2 , of ranks of the cards of suit, s, and 
3.  the  ranks  (r3 , r4 , r5 ) of  remaining  three  cards,  listed  in  increasing  suit order 
where ♣ � ♦ � ♥ � ♠. 

16.3.  THE PIGEONHOLE PRINCIPLE 

341 

For example, 

(♣, {10, A} , (J, J, 2))  ←→  {A♣, 10♣, J ♦, J ♥, 2♠} . 

(a)  A single pair of the same rank (no 3-of-a-kind, 4-of-a-kind, or second pair). 

(b)  Three or more aces. 

16.3  The Pigeonhole Principle 

Here is an old puzzle: 

A  drawer  in  a  dark  room  contains  red  socks,  green  socks,  and  blue 
socks. How many socks must you withdraw to be sure that you have a 
matching pair? 

For example, picking out three socks is not enough; you might end up with one 
red, one green, and one blue.  The solution relies on the Pigeonhole Principle, which 
is a friendly name for the contrapositive of the injective case 2 of the Mapping Rule 
of Lemma 4.8.2. Let’s write it down: 
If |X | > |Y |, then no total function1  f  : X  → Y  is injective. 

And now rewrite it again to eliminate the word “injective.” 
Rule 3 (Pigeonhole Principle).  If |X | >  |Y |, then for every total function f  : X  →  Y , 
there exist two different elements of X  that are mapped to the same element of Y . 

What  this  abstract  mathematical  statement  has  to  do  with  selecting  footwear 
under  poor  lighting  conditions  is maybe  not  obvious.  However,  let  A  be  the  set 
of socks you pick out, let B  be the set of colors available, and let f  map each sock 
to  its  color.  The Pigeonhole Principle  says  that  if  |A|  >  |B |  = 3,  then at  least  two 
elements of A (that is, at least two socks) must be mapped to the same element of 
B  (that  is,  the  same  color).  For  example,  one  possible  mapping  of  four  socks  to 
three colors is shown below. 

A 

f 

1st sock 

2nd sock 

3rd sock 
4th sock �

�

�
�

B 
red� 
� 
green 
���
�

blue 

1 This Mapping Rule actually applies even if f  is a total injective relation. 

342 

CHAPTER 16.  COUNTING 

Therefore, four socks are enough to ensure a matched pair. 
Not  surprisingly,  the  pigeonhole  principle  is  often  described  in  terms  of  pi­
geons: 

If  there  are  more  pigeons  than  holes  they  occupy,  then  at  least  two  pigeons 
must be in the same hole. 

In  this  case,  the  pigeons  form  set  A,  the  pigeonholes  are  set  B ,  and  f  describes 
which hole each pigeon ﬂies into. 
Mathematicians  have  come  up  with  many  ingenious  applications  for  the  pi­
geonhole principle.  If there were a cookbook procedure for generating such argu­
ments, we’d give it to you. Unfortunately, there isn’t one. One helpful tip, though: 
when you try to solve a problem with the pigeonhole principle, the key is to clearly 
identify three things: 

1.  The set A (the pigeons). 

2.  The set B  (the pigeonholes). 

3.  The function f  (the rule for assigning pigeons to pigeonholes). 

16.3.1  Hairs on Heads 
There are a number of generalizations of the pigeonhole principle.  For example: 
Rule 4 (Generalized Pigeonhole Principle).  If |X | > k · |Y |, then every total function 
→ 
f  : X Y  maps at least k + 1 different elements of X  to the same element of Y .
For example,  if you pick  two people at random, surely  they are extremely un­
likely  to  have  exactly  the  same  number  of  hairs  on  their  heads.  However,  in  the 
remarkable city of Boston, Massachusetts there are actually three people who have 
exactly the same number of hairs! Of course, there are many bald people in Boston, 
and they all have zero hairs. But we’re talking about non-bald people; say a person 
is non-bald if they have at least ten thousand hairs on their head. 
Boston has  about  500,000 non-bald people,  and  the number  of hairs  on  a per­
son’s  head  is  at most  200,000.  Let  A  be  the  set  of  non-bald  people  in  Boston,  let 
B  =  {10, 000, 10, 001, . . . , 200, 000}, and let f  map a person to the number of hairs 
on his or her head.  Since |A| > 2 |B |, the Generalized Pigeonhole Principle implies 
that at  least  three people have  exactly  the  same number of hairs.  We don’t know 
who they are, but we know they exist! 

16.3.2  Subsets with the Same Sum 
We asserted that two different subsets of the ninety 25-digit numbers listed on the 
ﬁrst page have the same sum. This actually follows from the Pigeonhole Principle. 
Let A be the collection of all subsets of the 90 numbers in the list. Now the sum of 
·
any subset of numbers is at most 90 1025 , since there are only 90 numbers and every 

16.3.  THE PIGEONHOLE PRINCIPLE 

343 
� 
� 
· 
25-digit number is less than 1025 . So let B be the set of integers  0, 1, . . . , 90  1025  ,
and let f  map each subset of numbers (in A) to its sum (in B ). 
We proved that an n-element set has 2n  different subsets. Therefore: 
|A| = 290 
≥ 1.237 × 1027 

On the other hand: 

|B | = 90 · 1025  + 1 
≤ 0.901 × 1027 
Both quantities are enormous,  but  |A|  is a bit greater  than  |B |.  This means  that f 
maps at least two elements of A to the same element of B .  In other words, by the 
Pigeonhole Principle, two different subsets must have the same sum! 
Notice  that  this proof  gives no  indication which  two  sets  of numbers have  the 
same sum. This frustrating variety of argument is called a nonconstructive proof. 

Sets with Distinct Subset Sums 

How  can  we  construct  a  set  of  n  positive  integers  such  that  all  its  subsets  have 
distinct sums? One way is to use powers of two: 
{1, 2, 4, 8, 16} 

This approach is so natural that one suspects all other such sets must involve larger 
numbers.  (For example, we could safely replace 16 by 17, but not by 15.)  Remark­
ably, there are examples involving smaller numbers. Here is one: 
{6, 9, 11, 12, 13} 

One  of  the  top mathematicans  of  the Twentieth Century,  Paul Erd ˝os,  conjectured 
in  1931  that  there  are  no  such  sets  involving  signiﬁcantly  smaller  numbers.  More 
precisely, he conjectured that the largest number must be > c2n  for some constant 
c >  0.  He offered $500 to anyone who could prove or disprove his conjecture, but 
the problem remains unsolved. 

16.3.3  Problems 
Class Problems 

Problem 16.8. 
Solve  the  following  problems  using  the  pigeonhole  principle.  For  each  problem, 

344 

CHAPTER 16.  COUNTING 

try  to  identify  the  pigeons,  the  pigeonholes,  and  a  rule  assigning  each  pigeon  to  a 
pigeonhole. 
(a)  Every MIT ID number starts with a 9 (we think).  Suppose that each of the 75 
students  in 6.042  sums  the nine digits of his or her  ID number.  Explain why  two 
people must arrive at the same sum. 

(b)  In  every  set of  100  integers,  there  exist  two whose difference  is  a multiple of 
37. 

√
(c)  For any ﬁve points  inside a unit square  (not on  the boundary),  there are  two 
2. 
points at distance less than 1/
(d)  Show  that  if  n + 1  numbers  are  selected  from  {1, 2, 3, . . . , 2n},  two  must  be 
consecutive, that is, equal to k and k + 1 for some k . 

Homework Problems 

Problem 16.9. 
Pigeon Huntin’ 
· 
(a)  Show that any odd integer x in the range 109  < x <  2  109  containing all ten 
digits 0, 1, . . . , 9 must have consecutive even digits.  Hint:  What can you conclude 
about the parities of the ﬁrst and last digit? 

(b)  Show  that  there are 2 vertices of  equal degree  in any ﬁnite undirected graph 
with n  ≥  2 vertices.  Hint:  Cases  conditioned upon  the existence of a degree zero 
vertex. 

Problem 16.10. 
Show  that  for  any  set  of  201  positive  integers  less  than  300,  there  must  be  two 
whose quotient is a power of three (with no remainder). 

16.4  The Generalized Product Rule 

We realize everyone has been working pretty hard this term, and we’re considering 
awarding  some  prizes  for  truly  exceptional  coursework.  Here  are  some  possible 
categories: 

Best Administrative Critique  We asserted that the quiz was closed-book.  On the 
cover page, one strong candidate for this award wrote, “There is no book.” 

Awkward Question Award  “Okay,  the  left  sock,  right  sock,  and  pants  are  in  an 
antichain, but how— even with assistance— could I put on all three at once?” 

Best Collaboration Statement  Inspired by a student who wrote “I worked alone” 
on Quiz 1. 

16.4.  THE GENERALIZED PRODUCT RULE 

345 

In how many ways can, say, three different prizes be awarded to n people? This 
is easy to answer using our strategy of translating the problem about awards into 
a problem about sequences.  Let P  be  the set of n people  in 6.042.  Then  there  is a 
bijection  from ways of  awarding  the  three prizes  to  the  set P 3  ::= P  × P  × P .  In 
particular, the assignment: 
��
��
“person x wins prize #1, y wins prize #2, and z wins prize #3” 
P 3  =  P|
| 3  =  n3 , so 
maps to the sequence (x, y , z ).  By the Product Rule, we have 
there are n3  ways to award the prizes to a class of n people. 
But what  if  the  three prizes must be awarded  to different  students?  As before, 
we could map the assignment 

“person x wins prize #1, y wins prize #2, and z wins prize #3” 
to the triple (x, y , z ) ∈ P 3 .  But this function is no longer a bijection.  For example, no 
valid  assignment maps  to  the  triple  (Dave,  Dave,  Becky)  because Dave  is  not  al­
� 
� 
lowed to receive two awards. However, there is a bijection from prize assignments 
to the set: 
S  =  (x, y , z ) ∈ P 3  | x, y , and z are different people 
This  reduces  the  original  problem  to  a  problem  of  counting  sequences.  Unfortu­
nately, the Product Rule is of no help in counting sequences of this type because the 
entries depend on one another;  in particular, they must all be different.  However, 
a slightly sharper tool does the trick. 

Rule 5 (Generalized Product Rule).  Let S  be a set of length-k sequences.  If there are: 

•  n1  possible ﬁrst entries, 

•  n2  possible second entries for each ﬁrst entry, 

•  n3  possible third entries for each combination of ﬁrst and second entries, etc. 

then: 

|S | = n1  · n2  · n3  · · · nk 
In  the  awards  example,  S  consists  of  sequences  (x, y , z ).  There  are  n ways  to 
choose x, the recipient of prize #1. For each of these, there are n − 1 ways to choose 
y , the recipient of prize #2, since everyone except for person x is eligible.  For each 
combination of x and y , there are n − 2 ways to choose z , the recipient of prize #3, 
because everyone except for x and y is eligible. Thus, according to the Generalized 
Product Rule, there are 

|S | = n · (n − 1) · (n − 2) 

ways to award the 3 prizes to different people. 

346 

CHAPTER 16.  COUNTING 

16.4.1  Defective Dollars 
A dollar is defective if some digit appears more than once in the 8-digit serial num­
ber.  If  you  check  your wallet,  you’ll  be  sad  to  discover  that  defective  dollars  are 
all-too-common.  In  fact,  how  common  are  nondefective  dollars?  Assuming  that 
the digit portions of  serial numbers all occur equally often, we could answer  this 
question by computing: 

fraction dollars that are nondefective = 

# of serial #’s with all digits different 
total # of serial #’s 
Let’s ﬁrst consider the denominator. Here there are no restrictions; there are are 10 
possible ﬁrst digits, 10 possible second digits, 10 third digits, and so on.  Thus, the 
total number of 8-digit serial numbers is 108  by the Product Rule. 
Next,  let’s  turn  to  the  numerator.  Now  we’re  not  permitted  to  use  any  digit 
twice.  So  there  are  still  10  possible  ﬁrst  digits,  but  only  9  possible  second  digits, 
8 possible third digits, and so forth.  Thus, by the Generalized Product Rule, there 
are 

·
·
·
·
·
·
· 
10  9  8  7  6  5  4  3 = 

10!
2 
= 1, 814, 400 

serial  numbers  with  all  digits  different.  Plugging  these  results  into  the  equation 
above, we ﬁnd: 

fraction dollars that are nondefective = 

1, 814, 400
100, 000, 000 
= 1.8144% 

16.4.2  A Chess Problem 
In  how many different ways  can we place  a pawn  (p),  a  knight  (k),  and  a  bishop 
(b) on a chessboard so that no two pieces share a row or a column? A valid conﬁg­
uration  is  shown below on  the  left,  and  an  invalid  conﬁguration  is  shown on  the 
right. 

k 

b 

p 

valid 

p 

b 

k 

invalid 

16.5.  THE DIVISION RULE 

347 

First, we map this problem about chess pieces to a question about sequences. There 
is a bijection from conﬁgurations to sequences 
(rp , cp , rk , ck , rb , cb ) 
where  rp ,  rk ,  and  rb  are  distinct  rows  and  cp ,  ck ,  and  cb  are  distinct  columns.  In 
particular, rp  is the pawn’s row, cp  is the pawn’s column, rk  is the knight’s row, etc. 
Now we  can  count  the number of  such  sequences using  the Generalized Product 
Rule: 
• rp  is one of 8 rows 
• cp  is one of 8 columns 
• rk  is one of 7 rows (any one but rp ) 
• ck  is one of 7 columns (any one but cp ) 
• rb  is one of 6 rows (any one but rp  or rk ) 
• cb  is one of 6 columns (any one but cp  or ck ) 
·
· 
Thus, the total number of conﬁgurations is (8  7  6)2 .

16.4.3  Permutations 
A permutation of a set S is a sequence that contains every element of S exactly once. 
For example, here are all the permutations of the set {a, b, c}: 
(b, a, c) 
(a, c, b)
(a, b, c)
(b, c, a)
(c, a, b)
(c, b, a) 

How many permutations of an n-element set are there? Well, there are n choices 
for  the  ﬁrst  element.  For  each  of  these,  there  are  n − 1  remaining  choices  for  the 
second  element.  For  every  combination  of  the ﬁrst  two  elements,  there  are n − 2 
ways to choose the third element, and so forth. Thus, there are a total of 
n  (n − 1)  (n − 2) 
· 
· 
· · · 
·
· 
3 2 1 = n!
permutations  of  an  n-element  set.  In  particular,  this  formula  says  that  there  are 
3!  =  6  permuations  of  the  3-element  set  {a, b, c},  which  is  the  number we  found 
above. 
Permutations  will  come  up  again  in  this  course  approximately  1.6  bazillion 
times.  In  fact,  permutations  are  the  reason  why  factorial  comes  up  so  often  and 
� n �n 
why we taught you Stirling’s approximation: 
√
n! ∼
2πn 
e 

16.5  The Division Rule 

Counting ears and dividing by two is a silly way to count the number of people in 
a room, but this approach is representative of a powerful counting principle. 
A k-to-1 function maps exactly k elements of the domain to every element of the 
codomain.  For example, the function mapping each ear to its owner is 2-to-1: 

348 

CHAPTER 16.  COUNTING 

ear 1 

ear 4 

�  person A 
�� �
�
ear 2 
����
��� �
� 
ear 3  �
� �
�
�����
�� ��
� 
ear 5 
� 
ear 6  � 

person C 

person B 

Similarly, the function mapping each ﬁnger to its owner is 10-to-1, and the func­
tion mapping each ﬁnger and toe to its owner is 20-to-1. The general rule is: 
Rule 6 (Division Rule).  If f  : A → B  is k-to-1, then |A| = k · |B |. 
For example, suppose A is the set of ears in the room and B  is the set of people. 
There is a 2-to-1 mapping from ears to people, so by the Division Rule |A| = 2 · |B |
or,  equivalently,  |B |  =  |A| /2,  expressing  what  we  knew  all  along:  the  number 
of  people  is  half  the  number  of  ears.  Unlikely  as  it  may  seem,  many  counting 
problems are made much easier by initially counting every item multiple times and 
then correcting the answer using the Division Rule. Let’s look at some examples. 

16.5.1  Another Chess Problem 
In how many different ways can you place two identical rooks on a chessboard so 
that they do not share a row or column?  A valid conﬁguration is shown below on 
the left, and an invalid conﬁguration is shown on the right. 

r 

r 

r 

invalid 

r 

valid 

Let A be the set of all sequences 

(r1 , c1 , r2 , c2 ) 

where  r1  and  r2  are  distinct  rows  and  c1  and  c2  are  distinct  columns.  Let  B  be 
the set of all valid rook conﬁgurations.  There is a natural function f  from set A to 
set B ; in particular, f  maps the sequence (r1 , c1 , r2 , c2 ) to a conﬁguration with one 
rook in row r1 , column c1  and the other rook in row r2 , column c2 . 

16.5.  THE DIVISION RULE 

349 

But now there’s a snag. Consider the sequences: 

(1, 1, 8, 8) 

and 

(8, 8, 1, 1) 

The ﬁrst sequence maps to a conﬁguration with a rook in the lower-left corner and 
a rook in the upper-right corner. The second sequence maps to a conﬁguration with 
a rook in the upper-right corner and a rook in the lower-left corner. The problem is 
that those are two different ways of describing the same conﬁguration!  In fact, this 
arrangement is shown on the left side in the diagram above. 
More generally, the function f  maps exactly two sequences to every board con­
ﬁguration;  that  is  f  is  a  2-to-1  function.  Thus,  by  the  quotient  rule,  |A|  = 2 · |B |. 
Rearranging terms gives: 

|B | = 

|A
| 
2 
(8 · 7)2 
2 
On the second line, we’ve computed the size of A using the General Product Rule 
just as in the earlier chess problem. 

= 

16.5.2  Knights of the Round Table 
In  how  many  ways  can  King  Arthur  seat  n  different  knights  at  his  round  table? 
Two  seatings  are  considered  equivalent  if  one  can  be  obtained  from  the  other  by 
rotation.  For example, the following two arrangements are equivalent: 
��
��
k3 
k1 
�� 
�� 
k4 
k2 
k1 
k3 

k4 

k2 

Let A be all the permutations of the knights, and let B  be the set of all possible 
seating arrangements at the round table. We can map each permutation in set A to 
a circular seating arrangement in set B  by seating the ﬁrst knight in the permuta­
tion anywhere, putting the second knight to his  left,  the third knight to the  left of 
the second, and so forth all the way around the table.  For example: 
��
k2 
�� 
k4 
k1 

(k2 , k4 , k1 , k3 ) 

−→ 

k3 

350 

CHAPTER 16.  COUNTING 

This mapping is actually an n-to-1 function from A to B , since all n cyclic shifts of 
the original sequence map to the same seating arrangement.  In the example, n = 4 
different sequences map to the same seating arrangement: 
(k2 , k4 , k1 , k3 )  ��k2 
−→  ��k4
(k4 , k1 , k3 , k2 ) 
k3 
(k1 , k3 , k2 , k4 ) 
(k3 , k2 , k4 , k1 ) 
k1 

Therefore, by the division rule, the number of circular seating arrangements is: 
|A
| 
|B | = 
n 
n! = 
n 
= (n − 1)! 
Note that |A| = n! since there are n! permutations of n knights. 

16.5.3  Problems 
Class Problems 

Problem 16.11. 
Your  6.006  tutorial  has  12  students,  who  are  supposed  to  break  up  into  4  groups 
of 3  students  each.  Your TA has observed  that  the  students waste  too much  time 
trying  to  form  balanced  groups,  so  he  decided  to  pre-assign  students  to  groups 
and email the group assignments to his students. 
(a)  Your TA has a list of the 12 students in front of him, so he divides the list into 
consecutive groups of 3.  For example, if the list is ABCDEFGHIJKL, the TA would 
deﬁne a sequence of four groups to be ({A, B , C } , {D , E , F } , {G, H, I } , {J, K, L}). 
This way of forming groups deﬁnes a mapping from a list of twelve students to a 
sequence of four groups. This is a k-to-1 mapping for what k? 

(b)  A group assignment  speciﬁes which  students are  in  the  same group,  but not 
any order in which the groups should be listed.  If we map a sequence of 4 groups, 
({A, B , C } , {D , E , F } , {G, H, I } , {J, K, L}), 

into a group assignment 
{{A, B , C } , {D , E , F } , {G, H, I } , {J, K, L}} , 

this mapping is j -to-1 for what j ? 

16.5.  THE DIVISION RULE 

351 

(c)  How many group assignments are possible? 

(d)  In how many ways can 3n students be broken up into n groups of 3? 

Problem 16.12. 
A pizza house is having a promotional sale. Their commercial reads: 

We offer 9 different  toppings  for your pizza!  Buy 3  large pizzas at  the 
regular price, and you can get each one with as many different toppings 
as you wish, absolutely free. That’s 22, 369, 621 different ways to choose 
your pizzas! 

The  ad  writer  was  a  former  Harvard  student  who  had  evaluated  the  formula 
(29 )3 /3! on his calculator and gotten close to 22, 369, 621. Unfortunately, (29 )3/3! is 
obviously not an integer, so clearly something is wrong. What mistaken reasoning 
might have  led  the ad writer  to  this  formula?  Explain how  to ﬁx  the mistake and 
get a correct formula. 

Problem 16.13. 
Answer the following quesions using the Generalized Product Rule. 
(a)  Next week, I’m going to get really ﬁt! On day 1, I’ll exercise for 5 minutes. On 
each subsequent day, I’ll exercise 0, 1, 2, or 3 minutes more than the previous day. 
For example, the number of minutes that I exercise on the seven days of next week 
might be 5, 6, 9, 9, 9, 11, 12. How many such sequences are possible? 

(b)  An  r-permutation  of  a  set  is  a  sequence  of  r  distinct  elements  of  that  set.  For 
example, here are all the 2-permutations of {a, b, c, d}: 

(a, b)
(b, a)
(c, a)
(d, a)

(a, c)
(b, c)
(c, b)
(d, b)

(a, d) 
(b, d) 
(c, d) 
(d, c) 

How  many  r-permutations  of  an  n-element  set  are  there?  Express  your  answer 
using factorial notation. 
(c)  How many n× n matrices are there with distinct entries drawn from {1, . . . , p}, 
where p ≥ n2 ? 

Exam Problems 

Problem 16.14. 
Suppose  that  two  identical  52-card decks  are mixed  together.  Write  a  simple  for­
mula for the number of 104-card double-deck mixes that are possible. 

352 

CHAPTER 16.  COUNTING 

16.6  Counting Subsets 

How many  k-element  subsets  of  an n-element  set  are  there?  This question  arises 
all the time in various guises: 

•	 In how many ways can I select 5 books from my collection of 100 to bring on 
vacation? 

•	 How many different 13-card Bridge hands can be dealt from a 52-card deck? 

•	 In how many ways can I select 5 toppings for my pizza if there are 14 avail­
able toppings? 
�  � 
This number comes up so often that there is a special notation for it: 
n 
�  � 
::=  the number of k-element subsets of an n-element set. 
k 
n
is  read  “n  choose  k .”  Now we  can  immediately  express 
The  expression 
k 
�
� 
the answers to all three questions above: 
100 
� � 
•	 I can select 5 books from 100 in 
5 
52 
� � 
•  There are 
13 
14 
•  There are 
5 

different 5-topping pizzas, if 14 toppings are available. 

ways.

different Bridge hands. 

16.6.1  The Subset Rule 
We  can  derive  a  simple  formula  for  the  n-choose-k  number  using  the  Division 
Rule.  We  do  this  by  mapping  any  permutation  of  an  n-element  set  {a1 , . . . , an}
into  a  k-element  subset  simply  by  taking  the ﬁrst  k  elements  of  the permutation. 
That is, the permutation a1a2  . . . an  will map to the set {a1 , a2 , . . . , ak }. 
Notice  that  any  other  permutation  with  the  same  ﬁrst  k  elements  a1 , . . . , ak 
in  any  order  and  the  same  remaining  elements  n  −  k  elements  in  any  order  will 
also map to this set.  What’s more, a permutation can only map to {a1 , a2 , . . . , ak }
if  its  ﬁrst  k  elements  are  the  elements  a1 , . . . , ak  in  some  order.  Since  there  are 
k !  possible  permutations  of  the  ﬁrst  k  elements  and  (n − k)!  permutations  of  the 
remaining  elements,  we  conclude  from  the  Product  Rule  that  exactly  k !(n −  k)! 
permutations  of  the  n-element  set  map  to  the  the  particular  subset,  S .  In  other 
words, the mapping from permutations to k-element subsets is k !(n − k)!-to-1. 
� � 
But we know there are n! permutations of an n-element set, so by the Division 
Rule, we conclude that 
n 
n! = k !(n − k)! 
k 

16.7.  SEQUENCES WITH REPETITIONS 

353 

which proves: 
Rule 7 (Subset Rule).  The number, 

�  � 
n 
, 
k 

of k-element subsets of an n-element set is 

n! 
. 
k ! (n − k)! 
Notice that this works even for 0-element subsets: n!/0!n! = 1. Here we use the 
fact  that  0!  is  a  product  of  0  terms, which  by  convention  equals  1.  (A  sum  of  zero 
terms equals 0.) 

16.6.2  Bit Sequences 
How many n-bit sequences contain exactly k ones? We’ve already seen the straight­
forward  bijection  between  subsets  of  an  n-element  set  and  n-bit  sequences.  For 
example, here  is a 3-element subset of {x1 , x2 , . . . , x8 } and the associated 8-bit se­
quence: 
}
{
,  x
, 
x
x
5 
4
1
1
1
0,  0,
1
( 
) 
,  0,  0,  0 
,
,
Notice  that  this  sequence  has  exactly  3  ones,  each  corresponding  to  an  element 
of  the  3-element  subset.  More  generally,  the  n-bit  sequences  corresponding  to  a 
�  � 
k-element subset will have exactly k ones.  So by the Bijection Rule, 
n
. 
k 

The number of n-bit sequences with exactly k ones is 

16.7  Sequences with Repetitions 

16.7.1  Sequences of Subsets 
Choosing  a  k-element  subset  of  an  n-element  set  is  the  same  as  splitting  the  set 
into a pair of subsets:  the ﬁrst subset of size k and the second subset consisting of 
the remaining n − k  elements.  So the Subset Rule can be understood as a rule for 
counting the number of such splits into pairs of subsets. 
We  can  generalize  this  to  splits  into more  than  two  subsets.  Namely,  let A  be 
an  n-element  set  and  k1 , k2 , . . . , km  be  nonnegative  integers  whose  sum  is  n. A 
(k1 , k2 , . . . , km )-split of A is a sequence 

(A1 , A2 , . . . , Am ) 
where the Ai  are pairwise disjoint2  subsets of A and |Ai | = ki  for i = 1, . . . , m. 
2 That is Ai  ∩ Aj  =  ∅ whenever i  �=  j .  Another way to say this is that no element appears in more 
than one of the Ai ’s. 

354 

CHAPTER 16.  COUNTING 

The  same  reasoning used  to explain  the Subset Rule extends directly  to a  rule 
for counting the number of splits into subsets of given sizes. 
� 
� 
Rule 8 (Subset Split Rule).  The number of (k1 , k2 , . . . , km )-splits of an n-element set is 
n! 
n
::= 
· · · 
km !
k1 ! k2 ! 
k1 , . . . , km 
The proof  of  this Rule  is  essentially  the  same  as  for  the  Subset Rule.  Namely, 
we map any permutation a1a2  . . . an  of an n-element set, A, into a (k1 , k2 , . . . , km )­
split by letting the 1st subset in the split be the ﬁrst k1  elements of the permutation, 
the  2nd  subset of  the  split be  the next  k2  elements,  . . . ,  and  the mth  subset of  the 
· · · 
split be the ﬁnal km  elements of the permutation. This map is a k1 ! k2 ! 
km !-to-1
from  the  n!  permutations  to  the  (k1 , k2 , . . . , km )-splits  of  A,  and  the  Subset  Split 
Rule now follows from the Division Rule. 

16.7.2  The Bookkeeper Rule 
We can also generalize our count of n-bit sequences with k-ones to counting length 
n  sequences of  letters over  an  alphabet with more  than  two  letters.  For  example, 
how many sequences can be formed by permuting the letters in the 10-letter word 
BOOKKEEPER? 
Notice that there are 1 B, 2 O’s, 2 K’s, 3 E’s, 1 P, and 1 R in BOOKKEEPER. This 
leads  to  a  straightforward bijection between permutations of BOOKKEEPER  and 
(1,2,2,3,1,1)-splits of {1, . . . , n}. Namely, map a permutation to the sequence of sets 
of positions where each of the different letters occur. 
For example,  in  the permutation BOOKKEEPER  itself,  the B  is  in  the 1st posi­
tion,  the O’s occur  in  the 2nd and 3rd positions, K’s  in 4th and 5th,  the E’s  in  the 
6th, 7th and 9th, P in the 8th, and R is in the 10th position, so BOOKKEEPER maps 
to 
({1} , {2, 3} , {4, 5} , {6, 7, 9} , {8} , {10}). 
From this bijection and the Subset Split Rule, we conclude that the number of ways 
to rearrange the letters in the word BOOKKEEPER is: 
���� 
total letters 
���� ���� ���� ���� ���� ���� 
10! 
1!
1!
1!
3!
2!
2!
B’s  O’s  K’s  E’s 
P’s  R’s 
This example generalizes directly to an exceptionally useful counting principle 
which we will call the 
Rule 9 (Bookkeeper Rule).  Let l1 , . . . , lm  be distinct elements. The number of sequences 
with k1  occurrences of l1 , and k2  occurrences of l2 , . . . , and km  occurrences of lm  is 
(k1  + k2  + . . . + km )! 
k1 ! k2 !  . . .  km ! 

16.7.  SEQUENCES WITH REPETITIONS 

355 

Example.  20-Mile Walks. 
I’m planning a 20-mile walk, which should  include 5 northward miles, 5 east­
ward miles, 5 southward miles, and 5 westward miles. How many different walks 
are possible? 
There  is a bijection between such walks and sequences with 5 N’s, 5 E’s, 5 S’s, 
and 5 W’s. By the Bookkeeper Rule, the number of such sequences is: 

20! 
5!4 

16.7.3  A Word about Words 

Someday you might refer to the Subset Split Rule or the Bookkeeper Rule in front 
of a roomful of colleagues and discover that they’re all staring back at you blankly. 
This is not because they’re dumb, but rather because we made up the name “Book­
keeper  Rule”.  However,  the  rule  is  excellent  and  the  name  is  apt,  so we  suggest 
that you play through:  “You know?  The Bookkeeper Rule?  Don’t you guys know 
anything???” 
The Bookkeeper Rule  is sometimes called  the “formula  for permutations with 
indistinguishable  objects.”  The  size  k  subsets  of  an  n-element  set  are  sometimes 
called k-combinations. Other similar-sounding descriptions are “combinations with 
repetition, permutations with repetition, r-permutations, permutations with indis­
tinguishable  objects,”  and  so  on.  However,  the  counting  rules we’ve  taught  you 
are  sufﬁcient  to  solve all  these  sorts of problems without knowing  this  jargon,  so 
we won’t burden you with it. 

16.7.4  Problems 

Class Problems 

Problem 16.15. 
The Tao  of BOOKKEEPER: we  seek  enlightenment  through  contemplation  of  the 
word BOOKKEEP ER. 
(a)  In how many ways can you arrange the letters in the word P OKE ? 

(b)  In how many ways can you arrange the letters in the word BO1O2K ? Observe 
that we have subscripted the O’s to make them distinct symbols. 

(c)  Suppose  we  map  arrangements  of  the  letters  in  BO1O2K  to  arrangements 
of  the  letters  in  BOOK  by  erasing  the  subscripts.  Indicate with  arrows  how  the 
arrangements on the left are mapped to the arrangements on the right. 

356 

CHAPTER 16.  COUNTING 

O2BO1K

KO2BO1

O1BO2K 
KO1BO2 
BO1O2K 
BO2O1K

. . .


BOOK 
OBOK 
KOBO 
. . . 

(d)  What kind of mapping is this, young grasshopper? 

(e)  In light of the Division Rule, how many arrangements are there of BOOK ? 

(f)  Very good, young master! How many arrangements are there of the letters in 
KE1E2P E3R? 

(g)  Suppose  we  map  each  arrangement  of  KE1E2P E3R  to  an  arrangement  of 
KEEP ER by erasing subscripts. List all the different arrangements of KE1E2P E3R 
that are mapped to REP EEK  in this way. 

(h)  What kind of mapping is this? 

(i)  So how many arrangements are there of the letters in KEEP ER? 

(j)  Now you are ready to face the BOOKKEEPER! 
How many arrangements of BO1O2K1K2E1E2P E3R are there? 

(k)  How many arrangements of BOOK1K2E1E2P E3R are there? 

(l)  How many arrangements of BOOKKE1E2P E3R are there? 

(m)  How many arrangements of BOOKKEEP ER are there? 

Remember well what you have learned:  subscripts on, subscripts off.

This is the Tao of Bookkeeper.


(n)  How many arrangements of V OODOODOLL are there? 

(o)  How  many  length  52  sequences  of  digits  contain  exactly  17  two’s,  23  ﬁves, 
and 12 nines? 

16.8  Magic Trick 

There is a Magician and an Assistant.  The Assistant goes into the audience with a 
deck of 52 cards while the Magician looks away.3 

3  There are 52 cards in a standard deck. Each card has a suit and a rank. There are four suits: 
♦( diamonds) 
♣( clubs) 
♥( hearts) 
♠( spades) 

16.8.  MAGIC TRICK 

357 

Five audience members each select one card from the deck.  The Assistant then 
gathers up the ﬁve cards and holds up four of them so the Magician can see them. 
The  Magician  concentrates  for  a  short  time  and  then  correctly  names  the  secret, 
ﬁfth card! 
Since we  don’t  really  believe  the Magician  can  read minds,  we  know  the As­
sistant  has  somehow  communicated  the  secret  card  to  the  Magician.  Since  real 
Magicians  and  Assistants  are  not  to  be  trusted,  we  can  expect  that  the  Assistant 
would  illegitimately  signal  the  Magician  with  coded  phrases  or  body  language, 
but they don’t have to cheat in this way.  In fact, the Magician and Assistant could 
be  kept  out  of  sight  of  each  other  while  some  audience  member  holds  up  the  4 
cards designated by the Assistant for the Magician to see. 
Of  course,  without  cheating,  there  is  still  an  obvious  way  the  Assistant  can 
communicate  to  the Magician:  he  can  choose  any  of  the  4!  =  24  permutations  of 
the 4 cards as the order in which to hold up the cards.  However,  this alone won’t 
quite work:  there are 48 cards remaining in the deck, so the Assistant doesn’t have 
enough  choices  of  orders  to  indicate  exactly  what  the  secret  card  is  (though  he 
could narrow it down to two cards). 

16.8.1  The Secret 

The method  the Assistant  can  use  to  communicate  the  ﬁfth  card  exactly  is  a  nice 
application of what we know about counting and matching. 
The Assistant really has another legitimate way to communicate: he can choose 
which of the ﬁve cards to keep hidden. Of course, it’s not clear how the Magician could 
determine which of these ﬁve possibilities the Assistant selected by looking at the 
four visible cards, but there is a way, as we’ll now explain. 
The problem facing the Magician and Assistant is actually a bipartite matching 
problem.  Put all  the  sets of 5  cards  in a  collection, X ,  on  the  left.  And put all  the 
sequences of 4 distinct cards in a collection, Y , on the right.  These are the two sets 
of  vertices  in  the  bipartite  graph.  There  is  an  edge  between  a  set  of  5  cards  and 
a  sequence  of  4  if  every  card  in  the  sequence  is  also  in  the  set.  In  other words,  if 
the  audience  selects  a  set  of  cards,  then  the  Assistant  must  reveal  a  sequence  of 
cards that is adjacent in the bipartite graph.  Some edges are shown in the diagram 
below. 

And there are 13 ranks, listed here from lowest to highest: 

Jack  Queen  King 
Ace 
A ,  2 ,  3 ,  4 ,  5 ,  6 ,  7 ,  8 ,  9 , J ,  Q , K 

Thus, for example, 8♥ is the 8 of hearts and A♠ is the ace of spades. 

358 

CHAPTER 16.  COUNTING 

X  = 
all sets of 
5 cards 

• 
• 
• 
• 
{8♥, K♠, Q♠, 2♦, 6♦} 
• 
• 
{8♥, K♠, Q♠, 9♣, 6♦} 
• 

• 
Y  = all 
• 
sequences of 4 
distinct cards 
• 
(8♥, K♠, Q♠, 2♦) 
�������� 
����������� 
(K♠, 8♥, Q♠, 2♦)
������������� 
���� 
(K♠, 8♥, 6♦, Q♠)
�������� 
��������� 
• 
• 
• 

For example, 

{8♥, K♠, Q♠, 2♦, 6♦} 
(16.2) 
is  an  element  of  X  on  the  left.  If  the  audience  selects  this  set  of  5  cards,  then 
there  are  many  different  4-card  sequences  on  the  right  in  set  Y  that  the  Assis­
tant  could  choose  to  reveal,  including  (8♥, K♠, Q♠, 2♦),  (K♠, 8♥, Q♠, 2♦),  and 
(K♠, 8♥, 6♦, Q♠). 
What the Magician and his Assistant need to perform the trick is a matching for 
the X vertices.  If they agree in advance on some matching, then when the audience 
selects a set of 5 cards, the Assistant reveals the matching sequence of 4 cards. The 
Magician  uses  the  reverse  of  the matching  to  ﬁnd  the  audience’s  chosen  set  of  5 
cards, and so he can name the one not already revealed. 
For example, suppose the Assistant and Magician agree on a matching contain­
ing the two bold edges in the diagram above.  If the audience selects the set 
{8♥, K♠, Q♠, 9♣, 6♦} , 

(16.3) 

then the Assistant reveals the corresponding sequence 
(K♠, 8♥, 6♦, Q♠). 

(16.4) 

Using  the matching,  the Magician  sees  that  the  hand  (16.3)  is matched  to  the  se­
quence  (16.4),  so  he  can  name  the  one  card  in  the  corresponding  set  not  already 
revealed, namely, the 9♣.  Notice that the fact that the sets are matched, that is, that 
different  sets  are  paired  with  distinct  sequences,  is  essential.  For  example,  if  the 
audience  picked  the  previous  hand  (16.2),  it  would  be  possible  for  the  Assistant 
to  reveal  the  same  sequence  (16.4),  but  he  better  not  do  that:  if  he  did,  then  the 
Magician would have no way to tell if the remaining card was the 9♣ or the 2♦. 
So how can we be sure the needed matching can be found?  The reason  is that 
· 
each  vertex  on  the  left  has  degree  5  4!  =  120,  since  there  are  ﬁve ways  to  select
the  card  kept  secret  and  there  are  4!  permutations  of  the  remaining  4  cards.  In 
addition, each vertex on the right has degree 48, since there are 48 possibilities for 
the ﬁfth card.  So this graph is degree-constrained according to Deﬁnition 10.6.5, and 
therefore satisﬁes Hall’s matching condition. 

16.8.  MAGIC TRICK 

359 

In fact, this reasoning show that the Magician could still pull off the trick if 120 
cards were  left  instead of 48,  that  is,  the  trick would work with a deck as  large as 
124 different cards —without any magic! 

16.8.2  The Real Secret 
� � 
But  wait  a  minute!  It’s  all  very  well  in  principle  to  have  the  Magician  and  his 
Assistant agree on a matching, but how are they supposed to remember a matching 
with  5  = 2, 598, 960  edges?  For  the  trick  to work  in  practice,  there  has  to  be  a 
52
way to match hands and card sequences mentally and on the ﬂy. 
We’ll describe one approach. As a running example, suppose that the audience 
selects: 
10♥  9♦  3♥  Q♠  J ♦ 
•	 The Assistant picks out two cards of the same suit.  In the example, the assis­
tant might choose the 3♥ and 10♥. 
•	 The Assistant locates the ranks of these two cards on the cycle shown below: 

K

A 

2 

Q	

J	

10	

9

3 

4 

5 

6 

8

7 

For any two distinct ranks on this cycle, one is always between 1 and 6 hops 
clockwise  from  the other.  For example,  the 3♥  is 6 hops clockwise  from  the 
10♥. 
•	 The more counterclockwise of these two cards is revealed ﬁrst, and the other 
becomes  the  secret  card.  Thus,  in our example,  the 10♥ would be  revealed, 
and the 3♥ would be the secret card. Therefore: 
–	 The suit of the secret card is the same as the suit of the ﬁrst card revealed. 
–	 The rank of the secret card is between 1 and 6 hops clockwise from the 
rank of the ﬁrst card revealed. 

•	 All that remains is to communicate a number between 1 and 6. The Magician 
and  Assistant  agree  beforehand  on  an  ordering  of  all  the  cards  in  the  deck 
from smallest to largest such as: 
A♣ A♦ A♥ A♠ 2♣ 2♦ 2♥ 2♠ 

K♥ K♠ 

. . . 

360 

CHAPTER 16.  COUNTING 

The order in which the last three cards are revealed communicates the num­
ber according to the following scheme: 

)  = 1 
( 
small,  medium, 
large 
large,  medium  )  = 2 
( 
small, 
(  medium, 
)  = 3 
small, 
large 
(  medium, 
)  = 4 
large, 
small 
small,  medium  )  = 5 
( 
large, 
( 
)  = 6 
large,  medium, 
small 

In  the  example,  the Assistant wants  to  send  6  and  so  reveals  the  remaining 
three cards in large, medium, small order. Here is the complete sequence that 
the Magician sees: 
10♥  Q♠  J ♦  9♦ 
•	 The Magician  starts with  the  ﬁrst  card,  10♥,  and  hops  6  ranks  clockwise  to 
reach 3♥, which is the secret card! 
So  that’s  how  the  trick  can  work  with  a  standard  deck  of  52  cards.  On  the 
other hand, Hall’s Theorem implies that the Magician and Assistant can in principle 
perform the trick with a deck of up to 124 cards.  It turns out that there is a method 
which  they could actually  learn  to use with a reasonable amount of practice  for a 
124 card deck (see The Best Card Trick by Michael Kleber). 

16.8.3  Same Trick with Four Cards? 
Suppose  that  the  audience  selects  only  four  cards  and  the  Assistant  reveals  a  se­
quence of three to the Magician. Can the Magician determine the fourth card? 
Let X  be all  the sets of  four cards  that  the audience might select,  and  let Y  be 
� �52 
all the sequences of three cards that the Assistant might reveal. Now, on one hand, 
we have 
4 
by the Subset Rule. On the other hand, we have 
|Y | = 52 · 51 · 50 = 132, 600 
by the Generalized Product Rule.  Thus, by the Pigeonhole Principle, the Assistant 
� 
� 
must reveal the same sequence of three cards for at least 
270, 725  = 3 
132, 600 

= 270, 725 

|X | = 

different  four-card  hands.  This  is  bad  news  for  the  Magician:  if  he  sees  that  se­
quence of three, then there are at least three possibilities for the fourth card which 
he cannot distinguish.  So there is no legitimate way for the Assistant to communi­
cate exactly what the fourth card is! 

16.8.  MAGIC TRICK 

16.8.4  Problems 
Class Problems 

361 

Problem 16.16.  (a)  Show that the Magician could not pull off the trick with a deck 
larger than 124 cards. 
Hint:  Compare the number of 5-card hands in an n-card deck with the number of 
4-card sequences. 

(b)  Show that, in principle, the Magician could pull off the Card Trick with a deck 
of 124 cards. 
Hint: Hall’s Theorem and degree-constrained (10.6.5) graphs. 

Problem 16.17. 
The Magician can determine the 5th card in a poker hand when his Assisant reveals 
the other 4  cards.  Describe a  similar method  for determining 2 hidden  cards  in a 
hand of 9 cards when your Assisant reveals the other 7 cards. 

Homework Problems 

Problem 16.18. 
Section 16.8.3 explained why it is not possible to perform a four-card variant of the 
hidden-card magic trick with one card hidden. But the Magician and her Assistant 
are determined to ﬁnd a way to make a trick like this work. They decide to change 
the  rules  slightly:  instead of  the Assistant  lining up  the  three unhidden  cards  for 
the Magician to see, he will line up all four cards with one card face down and the 
other three visible. We’ll call this the face-down four-card trick. 
For  example,  suppose  the  audience members  had  selected  the  cards  9♥,  10♦, 
A♣,  5♣.  Then  the  Assistant  could  choose  to  arrange  the  4  cards  in  any  order  so 
long as one is face down and the others are visible. Two possibilities are: 

A♣ 

? 

10♦ 

5♣ 

? 

5♣ 

9♥ 

10♦ 

(a)  Explain why there must be a bipartite matching which will in theory allow the 
Magician and Assistant to perform the face-down four-card trick. 

(b)  There is actually a simple way to perform the face-down four-card trick. 

362 

CHAPTER 16.  COUNTING 

Case 1.  there are two cards with the same suit: Say there are two ♠ cards. The Assistant 
proceeds as in the original card trick:  he puts one of the ♠ cards face up as the ﬁrst 
card. He will place the second ♠ card face down. He then uses a permutation of the 
face down card and the remaining two face up cards to code the offset of the face 
down card from the ﬁrst card. 
Case 2.  all four cards have different suits: Assign numbers 0, 1, 2, 3 to the four suits in 
some agreed upon way. The Assistant computes, s, the sum modulo 4 of the ranks 
of the four cards, and chooses the card with suit s to be placed face down as the ﬁrst 
card.  He then uses a permutation of the remaining three face-up cards to code the 
rank of the face down card.a 
a This elegant method was devised in Fall ’09 by student Katie E Everett. 

Explain  how  in Case  2.  the Magician  can determine  the  face down  card  from  the 
cards the Assistant shows her. 

(c)  Explain how any method for performing the face-down four-card trick can be 
adapted  to  perform  the  regular  (5-card  hand,  show  4  cards) with  a  52-card  deck 
consisting of the usual 52 cards along with a 53rd card call the joker. 

16.9  Counting Practice: Poker Hands 

Five-Card  Draw  is  a  card  game  in  which  each  player  is  initially  dealt  a  hand, a 
subset  of  5  cards.  (Then  the  game  gets  complicated,  but  let’s  not  worry  about 
that.) The number of different hands in Five-Card Draw is the number of 5-element 
� � 
subsets of a 52-element set, which is 52 choose 5: 
52
5 

total # of hands = 

= 2, 598, 960

Let’s get some counting practice by working out the number of hands with various 
special properties. 

16.9.1  Hands with a Four-of-a-Kind 
A  Four-of-a-Kind  is  a  set  of  four  cards  with  the  same  rank.  How  many  different 
hands contain a Four-of-a-Kind? Here are a couple examples: 
{  8♠,  8♦, Q♥,  8♥,  8♣ }
{  A♣,  2♣,  2♥,  2♦,  2♠ } 

As usual, the ﬁrst step is to map this question to a sequence-counting problem.  A 
hand with a Four-of-a-Kind is completely described by a sequence specifying: 

16.9.  COUNTING PRACTICE: POKER HANDS 

363 

1.  The rank of the four cards. 

2.  The rank of the extra card. 

3.  The suit of the extra card. 

Thus, there is a bijection between hands with a Four-of-a-Kind and sequences con­
sisting of two distinct ranks followed by a suit. For example, the three hands above 
are associated with the following sequences: 
} 
(8, Q, ♥)
↔ { 
8♠,  8♦,  8♥,  8♣, Q♥
↔ {  2♣,  2♥,  2♦,  2♠, A♣ } 
(2, A, ♣) 

Now we need only count the sequences. There are 13 ways to choose the ﬁrst rank, 
12 ways  to  choose  the  second  rank,  and  4 ways  to  choose  the  suit.  Thus,  by  the 
·
· 
Generalized Product Rule, there are 13  12  4 = 624 hands with a Four-of-a-Kind. 
This means that only 1 hand in about 4165 has a Four-of-a-Kind; not surprisingly, 
this is considered a very good poker hand! 

16.9.2  Hands with a Full House 
A Full House is a hand with three cards of one rank and two cards of another rank. 
Here are some examples: 
{  2♠,  2♣,  2♦, J ♣, J ♦ }
{  5♦,  5♣,  5♥,  7♥,  7♣ } 

Again,  we  shift  to  a  problem  about  sequences.  There  is  a  bijection  between  Full 
Houses and sequences specifying: 
� � 
1.  The rank of the triple, which can be chosen in 13 ways. 
4  ways. 
2.  The suits of the triple, which can be selected in  3
� � 
3.  The rank of the pair, which can be chosen in 12 ways. 
4  ways. 
4.  The suits of the pair, which can be selected in  2
The example hands correspond to sequences as shown below: 
(2, {♠, ♣, ♦} , J, {♣, ♦})  ↔ {  2♠,  2♣,  2♦, J ♣, J ♦ }
(5, {♦, ♣, ♥} , 7, {♥, ♣})  ↔ {  5♦,  5♣,  5♥,  7♥,  7♣ } 
� � 
� � 
By the Generalized Product Rule, the number of Full Houses is: 
4
4
· 
· 
13 
3 
2 

12

·

We’re on a roll— but we’re about to hit a speedbump. 

364 

CHAPTER 16.  COUNTING 

16.9.3  Hands with Two Pairs 
How  many  hands  have  Two  Pairs;  that  is,  two  cards  of  one  rank,  two  cards  of 
another rank, and one card of a third rank? Here are examples: 
{  3♦,  3♠, Q♦, Q♥, A♣ }
{  9♥,  9♦,  5♥, 
5♣, K♠ } 
Each hand with Two Pairs is described by a sequence consisting of: 
� � 
1.  The rank of the ﬁrst pair, which can be chosen in 13 ways. 
2.  The suits of the ﬁrst pair, which can be selected  4
2 ways. 
� � 
3.  The rank of the second pair, which can be chosen in 12 ways. 
4.  The suits of the second pair, which can be selected in  4
2 ways. 
� � 
5.  The rank of the extra card, which can be chosen in 11 ways. 
1 = 4 ways. 
6.  The suit of the extra card, which can be selected in  4
� � 
� � 
Thus, it might appear that the number of hands with Two Pairs is: 
4
4
· 
· 
· 
·
·
11 4
12 
13 
2 
2 

{  3♦,  3♠, Q♦, Q♥, A♣ } 

Wrong answer!  The problem is that there is not a bijection from such sequences to 
hands with Two Pairs. This is actually a 2-to-1 mapping. For example, here are the 
pairs of sequences that map to the hands given above: 
(3, {♦, ♠} , Q, {♦, ♥} , A, ♣)  � 
� 
(Q, {♦, ♥} , 3, {♦, ♠} , A, ♣) 
(9, {♥, ♦} , 5, {♥, ♣} , K, ♠)  �  {  9♥,  9♦,  5♥, 
(5, {♥, ♣} , 9, {♥, ♦} , K, ♠)  � 
The problem is that nothing distinguishes the ﬁrst pair from the second.  A pair of 
5’s and a pair of 9’s  is  the same as a pair of 9’s and a pair of 5’s.  We avoided  this 
difﬁculty  in  counting Full Houses because,  for  example,  a pair  of  6’s  and  a  triple 
of kings is different from a pair of kings and a triple of 6’s. 
We  ran  into  precisely  this  difﬁculty  last  time,  when  we  went  from  counting 
arrangements of different pieces on a chessboard to counting arrangements of two 
identical rooks. The solution then was to apply the Division Rule, and we can do the 
same here.  In  this  case,  the Division  rule  says  there are  twice as many  sequences 
� � 
� � 
as hands, so the number of hands with Two Pairs is actually: 
2 · 11  4·
· 
· 
· 
12
4
4
2
2 

5♣, K♠ }

13

16.9.  COUNTING PRACTICE: POKER HANDS 

365 

Another Approach 

The preceding example was disturbing! One could easily overlook the fact that the 
mapping was  2-to-1  on  an  exam,  fail  the  course,  and  turn  to  a  life  of  crime.  You 
can make the world a safer place in two ways: 
→
1.  Whenever you use a mapping f  : A
B  to translate one counting problem 
to  another,  check  that  the  same  number  elements  in  A  are mapped  to  each 
element in B .  If k elements of A map to each of element of B , then apply the 
Division Rule using the constant k . 

2.  As an extra check, try solving the same problem in a different way. Multiple 
approaches  are  often  available—  and  all  had  better  give  the  same  answer! 
(Sometimes  different  approaches  give  answers  that  look  different,  but  turn 
out to be the same after some algebra.) 
We already used  the ﬁrst method;  let’s  try  the  second.  There  is a bijection be­
� �  � � � � 
tween hands with two pairs and sequences that specify: 
13
1.  The ranks of the two pairs, which can be chosen in  2  ways. 
4  ways. 
2.  The suits of the lower-rank pair, which can be selected in  2
3.  The suits of the higher-rank pair, which can be selected in  4
2  ways. 
� � 
4.  The rank of the extra card, which can be chosen in 11 ways. 
1  = 4 ways. 
5.  The suit of the extra card, which can be selected in  4
For example, the following sequences and hands correspond: 
({3, Q} , {♦, ♠} , {♦, ♥} , A, ♣)  ↔ {  3♦,  3♠, Q♦, Q♥, A♣ }
({9, 5} , {♥, ♣} , {♥, ♦} , K, ♠)  ↔ {  9♥,  9♦,  5♥, 
5♣, K♠ } 
� �  � �  � � 
Thus, the number of hands with two pairs is: 
13 
4 
4 
· 
· 
·
2 
2 
2 

· 
11  4

This is the same answer we got before, though in a slightly different form. 

16.9.4  Hands with Every Suit 
How many hands contain at least one card from every suit? Here is an example of 
such a hand: 
{  7♦, K♣,  3♦, A♥,  2♠ } 
Each such hand is described by a sequence that speciﬁes: 

1.  The  ranks of  the diamond,  the  club,  the heart,  and  the  spade, which  can be 
·
·
· 
selected in 13  13  13  13 = 134  ways.

366 

CHAPTER 16.  COUNTING 

2.  The suit of the extra card, which can be selected in 4 ways. 

3.  The rank of the extra card, which can be selected in 12 ways. 

For example, the hand above is described by the sequence: 
(7, K, A, 2, ♦, 3)  ↔ {  7♦, K♣, A♥,  2♠,  3♦ } 

Are  there other  sequences  that  correspond  to  the  same hand?  There  is one more! 
We  could  equally  well  regard  either  the  3♦  or  the  7♦  as  the  extra  card,  so  this 
is  actually  a  2-to-1  mapping.  Here  are  the  two  sequences  corresponding  to  the 
example hand: 
(7, K, A, 2, ♦, 3)  �  {  7♦, K♣, A♥,  2♠,  3♦ }
(3, K, A, 2, ♦, 7)  � 

Therefore, the number of hands with every suit is: 
·
· 
134  4  12
2 

16.9.5  Problems 
Class Problems 

Problem 16.19. 
Solve the following counting problems by deﬁning an appropriate mapping (bijec­
tive or k-to-1) between a set whose size you know and the set in question. 
(a)  How many different ways are  there  to select a dozen donuts  if  four varieties 
are available? 

(b)  In  how  many  ways  can  Mr.  and  Mrs.  Grumperson  distribute  13  identical 
pieces of coal to their two —no, three! —children for Christmas? 

(c)  How many solutions over the nonnegative integers are there to the inequality: 

x1  + x2  + . . . + x10 

≤ 

100

(d)  We want to count step-by-step paths between points in the plane with integer 
coordinates. Ony two kinds of step are allowed:  a right-step which increments the 
x coordinate, and an up-step which increments the y coordinate. 

(i)  How many paths are there from (0, 0) to (20, 30)? 
(ii)  How  many  paths  are  there  from  (0, 0)  to  (20, 30)  that  go  through  the  point 
(10, 10)? 

16.9.  COUNTING PRACTICE: POKER HANDS 

367 

(iii)  How many paths are there from (0, 0) to (20, 30) that do not go through either 
of the points (10, 10) and (15, 20)?

Hint: Let P  be the set of paths from (0, 0) to (20, 30), N1  be the paths in P  that

go through (10, 10) and N2  be the paths in P  that go through (15, 20).


Problem 16.20. 
Solve the following counting problems.  Deﬁne an appropriate mapping (bijective 
or k-to-1) between a set whose size you know and the set in question. 
(a)  An  independent  living  group  is  hosting  nine  new  candidates  for  member­
ship.  Each candidate must be assigned a task:  1 must wash pots, 2 must clean the 
kitchen,  3 must  clean  the  bathrooms,  1 must  clean  the  common  area,  and  2 must 
serve dinner.  Write  a multinomial  coefﬁcient  for  the  number  of ways  this  can  be 
done. 

(b)  Write  a multinomial  coefﬁcient  for  the  number  of  nonnegative  integer  solu­
tions for the equation: 

x1  + x2  + x3  + x4  + x5  = 8.	

(16.5) 

(c)  How  many  nonnegative  integers  less  than  1,000,000  have  exactly  one  digit 
equal to 9 and have a sum of digits equal to 17? 

Exam Problems 

Problem 16.21. 
Here are the solutions to the next 10 problem parts, in no particular order. 
� 
� 
� 
� 
� 
� 
n − 1 + m 
n − 1 + m
n + m
n 
m	
m

n! 
(n − m)! 

n 
m 

m

n

2mn 

(a)	 How many solutions over the natural numbers are there to the inequality 
· · · 
+ xn  ≤ m?
x1  + x2  +

(b)	 How many length m words can be formed from an n-letter alphabet, if no 
letter is used more than once? 

(c)	 How  many  length  m  words  can  be  formed  from  an  n-letter  alphabet,  if 
letters can be reused? 

368 

CHAPTER 16.  COUNTING 

(d)	 How many  binary  relations  are  there  from  set A  to  set B  when  |A|  =  m 
and |B | = n? 

|
|

(e)	 How  many  injections  are  there  from  set  A  to  set  B ,  where  A =  m  and

|B | = n ≥ m? 

(f)	 How many ways are  there  to place a  total of m distinguishable balls  into

n  distinguishable  urns,  with  some  urns  possibly  empty  or  with  several

balls?


(g)	 How many ways are there to place a total of m indistinguishable balls into

n  distinguishable  urns,  with  some  urns  possibly  empty  or  with  several

balls?


(h)	 How many ways are  there  to put a  total of m distinguishable balls  into n

distinguishable urns with at most one ball in each urn?


16.10  Inclusion-Exclusion 

How  big  is  a  union  of  sets?  For  example,  suppose  there  are  60 math majors,  200 
EECS majors, and 40 physics majors.  How many students are there in these three 
departments? Let M  be the set of math majors, E be the set of EECS majors, and P 
be the set of physics majors.  In these terms, we’re asking for |M  ∪ E ∪ P |. 
The Sum Rule says that the size of union of disjoint sets is the sum of their sizes: 
|M  ∪ E ∪ P | = |M | + |E | + |P | 

(if M , E , and P  are disjoint) 

However, the sets M , E , and P  might not be disjoint.  For example, there might be 
a  student majoring  in  both math  and  physics.  Such  a  student would  be  counted 
twice  on  the  right  side  of  this  equation,  once  as  an  element  of M  and  once  as  an 
element of P . Worse, there might be a triple-major4  counted three times on the right 
side! 
Our last counting rule determines the size of a union of sets that are not neces­
sarily disjoint.  Before we  state  the  rule,  let’s  build  some  intuition  by  considering 
some easier special cases: unions of just two or three sets. 

16.10.1  Union of Two Sets 
For  two  sets, S1  and S2 ,  the  Inclusion-Exclusion Rule  is  that  the  size of  their union 
is: 
|S1  ∪ S2 | = |S1 | + |S2 | − |S1  ∩ S2 |	
4 . . . though not at MIT anymore. 

(16.6) 

16.10.  INCLUSION-EXCLUSION 

369 

Intuitively, each element of S1  is accounted for in the ﬁrst term, and each element 
of S2  is accounted for in the second term.  Elements in both S1  and S2  are counted 
twice—  once  in  the  ﬁrst  term  and  once  in  the  second.  This  double-counting  is 
corrected by the ﬁnal term. 
We can capture this double-counting idea in a precise way by decomposing the 
union  of  S1  and  S2  into  three  disjoint  sets,  the  elements  in  each  set  but  not  the 
other, and the elements in both: 
S1  ∪ S2  = (S1  − S2 ) ∪ (S2  − S1 ) ∪ (S1  ∩ S2 ). 
Similarly,  we  can  decompose  each  of  S1  and  S2  into  the  elements  exclusively  in 
each set and the elements in both: 
S1  = (S1  − S2 ) ∪ (S1  ∩ S2 ), 
S2  = (S2  − S1 ) ∪ (S1  ∩ S2 ). 
Now we have from (16.8) and (16.9) 
|S1 | + |S2 | = (|S1  − S2 | + |S1  ∩ S2 |) + (|S2  − S1 | + |S1  ∩ S2 |) 
= |S1  − S2 | + |S2  − S1 | + 2 |S1  ∩ S2 | , 
(16.10) 
which  shows  the  double-counting  of  S1  ∩ S2  in  the  sum.  On  the  other  hand, we 
have from (16.7) 

(16.8) 
(16.9) 

(16.7) 

|S1  ∪ S2 | = |S1  − S2 | + |S2  − S1 | + |S1  ∩ S2 | . 
Subtracting (16.11) from (16.10), we get 
(|S1 | + |S2 |) − |S1  ∪ S2 | = |S1  ∩ S2 | 

(16.11) 

which proves (16.6). 

16.10.2  Union of Three Sets 
So how many students are there in the math, EECS, and physics departments?  In 
other words, what is |M  ∪ E ∪ P | if: 
|M | = 60 
|E | = 200 
|P | = 40 

The size of a union of three sets is given by a more complicated Inclusion-Exclusion 
formula: 

|S1  ∪ S2  ∪ S3 | = |S1 | + |S2 | + |S3 | 
− |S1  ∩ S2 | − |S1  ∩ S3 | − |S2  ∩ S3 |
+ |S1  ∩ S2  ∩ S3 | 

370 

CHAPTER 16.  COUNTING 

Remarkably, the expression on the right accounts for each element in the union of 
S1 , S2 , and S3  exactly once.  For example, suppose that x is an element of all three 
sets. Then x is counted three times (by the |S1 |, |S2 |, and |S3 | terms), subtracted off 
three times (by the |S1  ∩ S2 |, |S1  ∩ S3 |, and |S2  ∩ S3 | terms), and then counted once 
more (by the |S1  ∩ S2  ∩ S3 | term). The net effect is that x is counted just once. 
So we can’t answer the original question without knowing the sizes of the var­
ious intersections. Let’s suppose that there are: 

4  math - EECS double majors 
3  math - physics double majors 
11  EECS - physics double majors 
triple majors 
2 
Then  |M  ∩ E |  = 4 + 2,  |M  ∩ P |  = 3 + 2,  |E ∩ P |  =  11 + 2,  and  |M  ∩ E ∩ P |  = 2. 
Plugging all this into the formula gives: 
|M  ∪ E ∪ P | = |M | + |E | + |P | − |M  ∩ E | − |M  ∩ P | − |E ∩ P | + |M  ∩ E ∩ P |
= 60 + 200 + 40 − 6 − 5 − 13 + 2 
= 278 

Sequences with 42, 04, or 60 
In how many permutations of the set {0, 1, 2, . . . , 9} do either 4 and 2, 0 and 4, or 6 
and 0 appear consecutively?  For example, none of these pairs appears in: 

(7, 2, 9, 5, 4, 1, 3, 8, 0, 6) 

The  06  at  the  end  doesn’t  count;  we  need  60.  On  the  other  hand,  both  04  and  60 
appear consecutively in this permutation: 

(7, 2, 5, 6, 0, 4, 3, 8, 1, 9) 

Let  P42  be  the  set  of  all  permutations  in  which  42  appears;  deﬁne  P60  and  P04 
similarly.  Thus,  for example,  the permutation above  is contained  in both P60  and 
P04 .  In these terms, we’re looking for the size of the set P42  ∪ P04  ∪ P60 . 
First, we must determine  the  sizes of  the  individual  sets,  such as P60 .  We  can 
use a trick:  group the 6 and 0 together as a single symbol.  Then there is a natural 
bijection between permutations of  {0, 1, 2, . . . 9}  containing  6  and  0  consecutively 
and permutations of: 
{60, 1, 2, 3, 4, 5, 7, 8, 9} 
For example, the following two sequences correspond: 
↔ 
(7, 2, 5, 60, 4, 3, 8, 1, 9)
(7, 2, 5, 6, 0, 4, 3, 8, 1, 9) 
There  are  9!  permutations  of  the  set  containing  60,  so  |P60 |  =  9!  by  the  Bijection 
Rule.  Similarly, |P04 | = |P42 | = 9! as well. 

16.10.  INCLUSION-EXCLUSION 

371 

Next, we must determine the sizes of the two-way intersections, such as P42  ∩
P60 .  Using  the grouping  trick  again,  there  is  a bijection with permutations of  the 
set: 
{42, 60, 1, 3, 5, 7, 8, 9} 
Thus, |P42  ∩ P60 | = 8!.  Similarly, |P60  ∩ P04 | = 8! by a bijection with the set: 
{604, 1, 2, 3, 5, 7, 8, 9} 
And |P42  ∩ P04 | = 8! as well by a similar argument. Finally, note that |P60  ∩ P04  ∩ P42 | = 
7! by a bijection with the set: 

{6042, 1, 3, 5, 7, 8, 9} 

Plugging all this into the formula gives: 
|P42  ∪ P04  ∪ P60 | = 9! + 9! + 9! − 8! − 8! − 8! + 7! 

16.10.3  Union of n Sets 
The size of a union of n sets is given by the following rule. 

Rule 10 (Inclusion-Exclusion). 
|S1  ∪ S2  ∪ · · · ∪ Sn | 
the sum of the sizes of the individual sets 
the sizes of all two-way intersections 
the sizes of all three-way intersections 
the sizes of all four-way intersections 
the sizes of all ﬁve-way intersections, etc. 

minus 
plus 
minus 
plus 

=

The  formulas  for unions of  two and  three sets are special cases of  this general 
rule. 
This way  of  expressing  Inclusion-Exclusion  is  easy  to  understand  and  nearly 
as  precise  as  expressing  it  in mathematical  symbols,  but we’ll  need  the  symbolic 
version below, so let’s work on deciphering it now. 
We already have a standard notation for the sum of sizes of the individual sets, 
� 
namely, 
n |Si | . 
i=1 
A “two-way  intersection”  is a set of the form Si  ∩ Sj  for i  =�
j .  We regard Sj  ∩ Si 
as the same two-way intersection as Si  ∩ Sj , so we can assume that i < j . Now we 
� 
can express the sum of the sizes of the two-way intersections as 
|Si  ∩ Sj |
1≤i<j≤n 

.

372 

CHAPTER 16.  COUNTING 

� 
Similarly, the sum of the sizes of the three-way intersections is 
|Si  ∩ Sj  ∩ Sk |
1≤i<j<k≤n 

.

These  sums  have  alternating  signs  in  the  Inclusion-Exclusion  formula,  with  the 
sum  of  the  k-way  intersections  getting  the  sign  (−1)k−1 .  This  ﬁnally  leads  to  a 
symbolic version of the rule: 
����� 
����� 
�  � 
n
 
Rule (Inclusion-Exclusion). 
n
|Si |
= 
Si 
i=1 
i=1 
−
|Si  ∩ Sj |
�  ����� 
1≤i<j≤n 
|Si  ∩ Sj  ∩ Sk | + · · · 
����� 
+ 
� 
1≤i<j<k≤n

n

+ (−1)n−1 
Si  . 
i=1 
16.10.4  Computing Euler ’s Function 
We will now use Inclusion-Exclusion to calculate Euler ’s function, φ(n). By deﬁni­
tion, φ(n) is the number of nonnegative integers less than a positive integer n that 
are relatively prime to n. But the set, S , of nonnegative integers less than n that are 
not relatively prime to n will be easier to count. 
· · · 
e1 
Suppose  the  prime  factorization  of  n  is  p1 
em  for  distinct  primes  pi .  This
pm
means that the integers in S  are precisely the nonnegative integers less than n that 
are  divisible  by  at  least  one  of  the  pi ’s.  So,  letting  Ci  be  the  set  of  nonnegative 
m
 
integers less than n that are divisible by pi , we have 
Ci . 
i=1 

S  = 

We’ll  be  able  to  ﬁnd  the  size  of  this  union  using  Inclusion-Exclusion  because 
the  intersections  of  the  Ci ’s  are  easy  to  count.  For  example,  C1  ∩ C2  ∩ C3  is  the 
set of nonnegative  integers  less  than n  that  are divisible by  each of  p1 ,  p2  and  p3 . 
But since the pi ’s are distinct primes, being divisible by each of these primes is that 
same as being divisible by their product. Now observe that if r is a positive divisor 
of n,  then exactly n/r  nonnegative  integers  less  than n are divisible by r , namely, 
0, r, 2r, . . . , ((n/r) − 1)r .  So exactly n/p1p2p3  nonnegative  integers  less  than n are 
divisible by all three primes p1 , p2 , p3 .  In other words, 
n

|C1  ∩ C2  ∩ C3 | = 
.

p1p2p3 

373 

|S | 

= 

= 

16.10.  INCLUSION-EXCLUSION 
So reasoning this way about all the intersections among the Ci ’s and applying 
����� 
����� � 
m
 
Inclusion-Exclusion, we get 
����� 
����� 
Ci 
� 
� 
� 
i=1 
m
m
|Ci  ∩ Cj |
|
Ci | − 
|Ci  ∩ Cj  ∩ Ck | − · · · + (−1)m−1 
+
Ci 
� 
� 
� 
1≤i<j≤m 
1≤i<j<k≤m 
i=1 
i=1 
m
n 
n 
− 
⎞ 
⎛
=
+ 
� 
� 
� 
pipj 
pi 
1≤i<j≤m 
1≤i<j<k≤m 
⎠
= n ⎝
i=1 
m
1 
1 
1
− 
+ 
pipj 
pi 
pipj pk 
1≤i<j≤m 
1≤i<j<k≤m 
i=1 
⎛
But φ(n) = n − |S
| by deﬁnition, so 
� 
� 
� 
φ(n) = n ⎝1 − 
m
1 
− 
+ 
� 
� 
m� 
pi 
1≤i<j≤m 
1≤i<j<k≤m 
i=1 
1 − 
= n 
. 
i=1 

n 
− · · · + (−1)m−1 
p1p2  · · · pn

1
+ (−1)m 
+ · · · 
p1p2  · · · pn

1
pipj pk 

− · · · + (−1)m−1

1 
p1p2  · · · pn

⎞ 
⎠

(16.12)

n
pipj pk 

1 
pipj 

1
pi

� 
� 
Notice that in case n = pk  for some prime, p, then (16.12) simpliﬁes to 
1 
φ(p k ) = p k  1 − 
p 

= p  − p 
k−1
k

as claimed in chapter 14. 
Quick Question: Why does equation (16.12) imply that 

φ(ab) = φ(a)φ(b) 

for relatively prime integers a, b > 1, as claimed in Theorem 14.7.1.(a)? 

16.10.5  Problems 
Practice Problems 

Problem 16.22. 
The  working  days  in  the  next  year  can  be  numbered  1,  2,  3,  . . . ,  300.  I’d  like  to 
avoid as many as possible. 

•  On even-numbered days, I’ll say I’m sick. 

•  On days that are a multiple of 3, I’ll say I was stuck in trafﬁc. 

374	

CHAPTER 16.  COUNTING 

•	 On days that are a multiple of 5, I’ll refuse to come out from under the blan­
kets. 

In total, how many work days will I avoid in the coming year? 

Class Problems 

Problem 16.23. 
A  certain  company  wants  to  have  security  for  their  computer  systems.  So  they 
have given everyone a name and password.  A length 10 word containing each of 
the characters: 

a, d, e, f, i, l, o, p, r, s, 

is  called  a  cword.  A password will be  a  cword which does not  contain  any of  the 
subwords ”fails”, ”failed”, or ”drop”. 
For example, the following two words are passwords: 

adeﬁloprs, srpolifeda, 

but the following three cwords are not: 

adropeﬂis, failedrops, dropefails. 

(a)  How many cwords contain the subword “drop”? 

(b)  How many cwords contain both “drop” and “fails”? 

(c)  Use the Inclusion-Exclusion Principle to ﬁnd a simple formula for the number 
of passwords. 

Homework Problems 

Problem 16.24. 
How  many  paths  are  there  from  point  (0, 0)  to  (50, 50)  if  every  step  increments 
one coordinate and leaves the other unchanged?  How many are there when there 
are  impassable  boulders  sitting  at  points  (10, 11)  and  (21, 20)?  (You  do  not  have 
to  calculate  the  number  explicitly;  your  answer  may  be  an  expression  involving 
binomial coefﬁcients.) 
Hint:  Count  the number of paths going  through  (10, 11),  the number  through 
(21, 20), and use Inclusion-Exclusion. 

Problem 16.25. 
A  derangement  is  a  permutation  (x1 , x2 , . . . , xn )  of  the  set  {1, 2, . . . , n}  such  that 
xi  =�
i  for all  i.  For example,  (2, 3, 4, 5, 1)  is a derangement, but (2, 1, 3, 5, 4)  is not 
because  3  appears  in  the  third position.  The  objective  of  this problem  is  to  count 
derangements. 

16.10.  INCLUSION-EXCLUSION 

375 

It  turns  out  to  be  easier  to  start  by  counting  the permutations  that  are  not de­
rangements.  Let Si  be  the  set  of  all permutations  (x1 , x2 , . . . , xn )  that  are  not de­
n
 
rangements because xi  = i.  So the set of non-derangements is 
Si . 
i=1 

(a)  What is |Si |? 
(b)  What is |Si  ∩ Sj | where i =�
j ? 
(c)  What is |Si1  ∩ Si2  ∩ · · · ∩ Sik | where i1 , i2 , . . . , ik  are all distinct? 
(d)  Use the inclusion-exclusion formula to express the number of non-derangements 
in terms of sizes of possible intersections of the sets S1 , . . . , Sn . 
(e)  How many terms in the expression in part (d) have the form |Si1  ∩ Si2  ∩ · · · ∩ Sik |? 
�
�
(f)  Combine  your  answers  to  the  preceding  parts  to  prove  the  number  of  non-
derangements is: 
1 
1 
1
1
n!
3! 
2! 
1! 
n! 
� 
Conclude that the number of derangements is 
n! 1 − 

− · · · ± 

+ · · · ± 

− 

+ 

.
� 
1 
. 
n! 

1
1! 

+ 

1
2! 

− 

1 
3! 

(g)  As n goes to inﬁnity, the number of derangements approaches a constant frac­
tion of all permutations. What is that constant? Hint: 

e x  = 1 + x + 

x2 
2! 

+ 

x3 
3! 

+ · · · 

Problem 16.26. 
How many of  the numbers 2, . . . , n are prime?  The  Inclusion-Exclusion Principle 
offers a useful way  to calculate  the answer when n  is  large.  Actually, we will use 
Inclusion-Exclusion  to  count  the  number  of  composite  (nonprime)  integers  from  2 
to n.  Subtracting this from n − 1 gives the number of primes. 
Let Cn  be  the  set of  composites  from 2  to n,  and  let Am  be  the  set of numbers 
in the range m + 1, . . . , n that are divisible by m. Notice that by deﬁnition, Am  = ∅
n−1
 
for m ≥ n.  So 
i=2 

Cn  = 
(a)  Verify that if m | k , then Am  ⊇ Ak . 

(16.13) 

Ai . 

376 

CHAPTER 16.  COUNTING 

(16.14) 


 
(b)  Explain why the right hand side of (16.13) equals 
Ap . 
primes p≤√
n 
(c)  Explain why |Am | = �n/m� − 1 for m ≥ 2. 
(d)  Consider any two relatively prime numbers p, q ≤ n. What is the one number 
in (Ap  ∩ Aq ) − Ap q ? 
·
������ 
������ 
(e)  Let P  be a ﬁnite set of at least two primes. Give a simple formula for 
� 
Ap  . 
p∈P 
(f)  Use  the  Inclusion-Exclusion  principle  to  obtain  a  formula  for  |C150 |  in  terms 
the sizes of intersections among the sets A2 , A3 , A5 , A7 , A11 .  (Omit the intersections 
that are empty; for example, any intersection of more than three of these sets must 
be empty.) 

(g)  Use this formula to ﬁnd the number of primes up to 150. 

16.11  Binomial Theorem 

Counting  gives  insight  into  one  of  the  basic  theorems  of  algebra.  A  binomial  is  a 
sum of two terms, such as a + b. Now consider its 4th power, (a + b)4 . 
If we multiply out this 4th power expression completely, we get 

(a + b)4  = 

aaaa  +  aaab  +  aaba  +  aabb 
+  abaa  +  abab  +  abba  +  abbb 
+  baaa  +  baab  +  baba  +  babb 
+  bbaa  +  bbab  +  bbba  +  bbbb 
Notice  that  there  is  one  term  for  every  sequence  of  a’s  and  b’s.  So  there  are  24 
�  � 
terms, and the number of terms with k copies of b and n − k copies of a is: 
n! 
n 
k ! (n − k)! 
k 
�  � 
by the Bookkeeper Rule. Now let’s group equivalent terms, such as aaab = aaba = 
� � 
� � 
� � 
� � 
� � 
abaa = baaa. Then the coefﬁcient of an−k bk  is  n
k  .  So for n = 4, this means: 
4
4
4
4
4
· 
· 
· 
· 
· 
a 0 b4 
a 1 b3  + 
a 2 b2  + 
a 3 b1  + 
4 b0  + 
a
0 
1
2
3
4 

= 

(a + b)4  = 

In general, this reasoning gives the Binomial Theorem: 

16.11.  BINOMIAL THEOREM 

377 

Theorem 16.11.1 (Binomial Theorem).  For all n ∈ N and a, b ∈ R: 
n � � 
� 
a n−k bk 
n
k 
k=0 

(a + b)n  = 

�  � 
n
k 

is often called a “binomial coefﬁcient”  in honor of  its ap­

The expression 
pearance here. 
This reasoning about binomials extends nicely to multinomials, which are sums 
of two or more terms.  For example, suppose we wanted the coefﬁcient of 

bo2k2 e 3 pr 

in the expansion of (b + o + k + e + p + r)10 . Each term in this expansion is a product 
of 10 variables where each variable is one of b, o, k , e, p, or r .  Now, the coefﬁcient 
of bo2k2 e3pr is the number of those terms with exactly 1 b, 2 o’s, 2 k ’s, 3 e’s, 1 p, and 
1 r . And the number of such terms is precisely the number of rearrangments of the 
� 
� 
word BOOKKEEPER: 
10 
1, 2, 2, 3, 1, 1 

10! 
.
1! 2! 2! 3! 1! 1! 

= 

The  expression  on  the  left  is  called  a  “multinomial  coefﬁcient.”  This  reasoning 
extends to a general theorem. 
Deﬁnition 16.11.2.  For n, k1 , . . . , km  ∈ naturals, such that k1  + k2  +
� 
� 
deﬁne the multinomial coefﬁcient 
n! 
n
::= 
. 
k1 ! k2 !  . . . km ! 
k1 , k2 , . . . , km 
� � 
� 
Theorem 16.11.3 (Multinomial Theorem).  For all n ∈ N and z1 , . . . zm  ∈ R: 
n 
2  · · ·  m 
z k1 z k2 
z km
1
k1 , k2 , . . . , km 
k1 ,...,km∈N 
···
k1 + +km =n

(z1  + z2  + · · · + zm

· · · 
+ km  = n,

)n  = 

You’ll be better off  remembering  the  reasoning behind  the Multinomial Theo­
rem rather than this ugly formal statement. 

16.11.1  Problems 
Practice Problems 

Problem 16.27. 
Find the coefﬁcients of x10 y5  in (19x + 4y)15 

378 

CHAPTER 16.  COUNTING 

Class Problems 

Problem 16.28. 
Find the coefﬁcients of 
(a)  x5  in (1 + x)11 

(b)  x8 y9  in (3x + 2y)17 

(c)  a6 b6  in (a2  + b3 )5 

Problem 16.29.  (a)  Use the Multinomial Theorem 16.11.3 to prove that 
· · · 
+ xn )p  ≡ x1 
· · · 
p  + x2 
p  +
p 
+ xn
(x1  + x2  +
� 
� 
for all primes p.  (Do not prove it using Fermat’s “little” Theorem. The point of this 
problem is to offer an independent proof of Fermat’s theorem.) 
p
Hint:  Explain why  k1 ,k2
is  divisible  by  p  if  all  the  ki ’s  are  positive  integers 
,...,kn 
less than p. 
(b)  Explain how (16.15) immediately proves Fermat’s Little Theorem 14.6.4: np−1  ≡
1  (mod  p) when n is not a multiple of p. 

(mod  p) 

(16.15)

Homework Problems 

Problem 16.30. 
The  degree  sequence  of  a  simple  graph  is  the  weakly  decreasing  sequence  of  de­
grees  of  its  vertices.  For  example,  the  degree  sequence  for  the  5-vertex  num­
bered  tree  pictured  in  the  Figure  16.2  is  (2, 2, 2, 1, 1)  and  for  the  7-vertex  tree  it 
is (3, 3, 2, 1, 1, 1, 1). 
We’re interested in counting how many numbered trees there are with a given 
degree sequence. We’ll do this using the bijection deﬁned in Problem 16.5 between 
n-vertex numbered trees and length n−2 code words whose characters are integers 
between 1 and n. 
The  occurrence  number  for  a  character  in  a  word  is  the  number  of  times  that 
the  character  occurs  in  the  word.  For  example,  in  the  word  65622,  the  occur­
rence number for 6 is two, and the occurrence number for 5 is one.  The occurrence 
sequence  of  a  word  is  the  weakly  decreasing  sequence  of  occurrence  numbers  of 
characters  in  the word.  The occurrence sequence  for  this word  is  (2, 2, 1) because 
it has two occurrences of each of the characters 6 and 2, and one occurrence of 5. 
(a)  There is simple relationship between the degree sequence of an n-vertex num­
bered tree and the occurrence sequence of its code.  Describe this relationship and 
explain  why  it  holds.  Conclude  that  counting  n-vertex  numbered  trees  with  a 
given  degree  sequence  is  the  same  as  counting  the  number  of  length  n − 2  code 
words with a given occurrence sequence. 
Hint: How many times does a vertex of degree, d, occur in the code? 

16.11.  BINOMIAL THEOREM 

379 

Coding Numbered Trees

Tree
Tree

2

3

2

6

5

4

4

5

7

Code

4 3 2

6 5 6 2 2

1

1

3

Image by MIT OpenCourseWare.

Figure 16.2: 

For  simplicity,  let’s  focus  on  counting  9-vertex  numbered  trees  with  a  given 
degree sequence.  By part  (a),  this  is  the same as counting  the number of  length 7 
code words with a given occurrence sequence. 
Any length 7 code word has a pattern, which is another length 7 word over the 
alphabet a,b,c,d,e,f,g that has the same occurrence sequence. 
(b)  How many length 7 patterns are there with three occurrences of a, two occur­
rences of b, and one occurrence of c and d? 
(c)  How many ways are there to assign occurrence numbers to integers 1, 2, . . . , 9 
so  that  a  code  word  with  those  occurrence  numbers  would  have  the  occurrence 
sequence 3, 2, 1, 1, 0, 0, 0, 0, 0? 
In general,  to ﬁnd  the pattern  of  a  code word,  list  its  characters  in decreasing  or­
der  by  number  of  occurrences,  and  list  characters  with  the  same  number  of  occur­
rences  in  decreasing  order.  Then  replace  successive  characters  in  the  list  by  suc­
cessive  letters  a,b,c,d,e,f,g.  The  code word  2468751,  for  example,  has  the 
pattern fecabdg, which  is obtained by replacing  its characters 8,7,6,5,4,2,1 
by a,b,c,d,e,f,g, respectively. The code word 2449249 has pattern caabcab, 
which is obtained by replacing its characters 4,9,2 by a,b,c, respectively. 

380 

CHAPTER 16.  COUNTING 

(d)  What length 7 code word has three occurrences of 7, two occurrences of 8, one 
occurrence each of 2 and 9, and pattern abacbad? 

(e)  Explain  why  the  number  of  9-vertex  numbered  trees  with  degree  sequence 
(4, 3, 2, 2, 1, 1, 1, 1, 1) is the product of the answers to parts (b) and (c). 

16.12  Combinatorial Proof 

Suppose you have n different T-shirts, but only want to keep k . You could equally 
well select the k  shirts you want to keep or select the complementary set of n − k 
shirts  you  want  to  throw  out.  Thus,  the  number  of  ways  to  select  k  shirts  from 
� � � 
� 
among n must be equal to the number of ways to select n − k shirts from among n. 
Therefore: 
n 
n
= 
n − k 
k
This is easy to prove algebraically, since both sides are equal to: 

n!

k ! (n − k)!


But we didn’t really have to resort to algebra; we just used counting principles. 
Hmm. 

16.12.1  Boxing 
Jay, famed 6.042 TA, has decided to try out for the US Olympic boxing team. After 
all, he’s watched all of the Rocky movies and spent hours in front of a mirror sneer­
ing,  “Yo,  you wanna  piece  a’ me?!”  Jay  ﬁgures  that  n  people  (including  himself) 
are competing for spots on the team and only k will be selected. As part of maneu­
vering for a spot on the team, he needs to work out how many different teams are 
possible. There are two cases to consider: 
•	 Jay is selected for the team, and his k − 1 teammates are selected from among 
the other n−1 competitors. The number of different teams that can be formed 
� 
� 
in this way is: 
n − 1 
k − 1 

•	 Jay  is  not  selected  for  the  team,  and  all  k  team  members  are  selected  from 
among the other n − 1 competitors. The number of teams that can be formed 
� 
� 
this way is: 
n − 1 
k 

16.12.  COMBINATORIAL PROOF 

381 

All  teams  of  the  ﬁrst  type  contain  Jay,  and  no  team  of  the  second  type  does; 
therefore, the two sets of teams are disjoint. Thus, by the Sum Rule, the total num­
� 
�  � 
� 
ber of possible Olympic boxing teams is: 
n − 1 
n − 1
+ 
k − 1 
k

Jeremy,  equally-famed  6.042  TA,  thinks  Jay  isn’t  so  tough  and  so  he might  as 
well also try out. He reasons that n people (including himself) are trying out for k 
�  � 
spots. Thus, the number of ways to select the team is simply: 
n 
k 
Jeremy  and  Jay  each  correctly  counted  the  number  of  possible  boxing  teams; 
� 
�  �  � 
�  � 
thus, their answers must be equal.  So we know: 
n − 1
n − 1
n
+ 
= 
k − 1 
k
k
This  is  called Pascal’s  Identity.  And we  proved  it without  any  algebra!  Instead, we 
relied purely on counting techniques. 

16.12.2  Finding a Combinatorial Proof 
A combinatorial proof  is an argument that establishes an algebraic fact by relying on 
counting principles. Many such proofs follow the same basic outline: 

1.  Deﬁne a set S . 
2.  Show that |S | = n by counting one way. 
3.  Show that |S | = m by counting another way. 
4.  Conclude that n = m. 

� 
� � 
� 
In the preceding example, S was the set of all possible Olympic boxing teams.  Jay 
computed 
n − 1 
n − 1 
+ 
k − 1
k 
�  � 
by counting one way, and Jeremy computed 
n 
k 

|S | = 

|S | = 

by counting another. Equating these two expressions gave Pascal’s Identity. 
More typically,  the set S  is deﬁned  in terms of simple sequences or sets rather 
than an elaborate story. Here is less colorful example of a combinatorial argument. 

382 

Theorem 16.12.1. 

CHAPTER 16.  COUNTING 
� � �
3n 
= 
n 

� �� 
n�  n 
2n 
n − r
r
r=0 
Proof.  We give  a  combinatorial proof.  Let S  be  all n-card hands  that  can be dealt 
from a deck containing n red cards (numbered 1, . . . , n) and 2n black cards (num­
� � 
bered 1, . . . , 2n).  First, note that every 3n-element set has 
3n 
|S | = 
n 
n-element subsets. 
�  �� 
� 
From another perspective, the number of hands with exactly r red cards is 
2n 
n 
� 
�  � 
� 
n − r 
r
since  there  are  n
2−n
r  ways  to  choose  the  r  red  cards  and  n
r  ways  to  choose  the 
n − r black cards.  Since the number of red cards can be anywhere from 0 to n, the 
n � �� 
�
�  n 
total number of n-card hands is: 
2n 
|S | = 
n − r 
r
r=0 
Equating these two expressions for |S | proves the theorem. 
� 
Combinatorial proofs  are  almost magical.  Theorem  16.12.1  looks pretty  scary, 
but we proved it without any algebraic manipulations at all. The key to construct­
� � 
ing a combinatorial proof is choosing the set S properly, which can be tricky. Gen­
erally, the simpler side of the equation should provide some guidance.  For exam­
n  , which suggests choosing S  to be all 
ple,  the  right  side of Theorem 16.12.1  is  3
n
n-element subsets of some 3n-element set. 

16.12.3  Problems 
Class Problems 

Problem 16.31. 
� 
�
According to the Multinomial theorem, (w + x + y + z )n  can be expressed as a sum 
of terms of the form 
n 
r1  r2  r3  r4
w x y z . 
r1 , r2 , r3 , r4 
(a)  How many terms are there in the sum? 
�
�
� 
(b)  The sum of these multinomial coefﬁcients has an easily expressed value. What 
is it? 
n 
r1 , r2 , r3 , r4 
r1+r2 +r3+r4=n, 
ri∈N 

(16.16) 

=? 

16.12.  COMBINATORIAL PROOF 

383 

Hint:  How many  terms are  there when (w + x + y + z )n  is expressed as a sum of 
monomials in w, x, y , z before terms with like powers of these variables are collected 
together under a single coefﬁcient? 

Homework Problems 

Problem 16.32. 
� �� �  � �� 
� 
Prove the following identity by algebraic manipulation and by giving a combina­
torial argument: 
n − k 
r 
n
n
= 
r − k 
k 
k
r
n � ��  n  = 2n . 
Problem 16.33.  (a)  Find a combinatorial (not algebraic) proof that 
i 
i=0 
(b)  Below is a combinatorial proof of an equation. What is the equation? 

Proof.  Stinky Peterson owns n newts,  t  toads,  and s  slugs.  Conveniently,  he  lives 
in  a  dorm  with  n +  t + s  other  students.  (The  students  are  distinguishable,  but 
creatures  of  the  same  variety  are  not  distinguishable.)  Stinky  wants  to  put  one 
creature in each neighbor ’s bed.  Let W  be the set of all ways in which this can be 
done. 
On one hand, he could ﬁrst determine who gets  the slugs.  Then, he could decide 
who among his remaining neighbors has earned a toad.  Therefore, |W | is equal to 
the expression on the left. 
On the other hand, Stinky could ﬁrst decide which people deserve newts and slugs 
and then, from among those, determine who truly merits a newt.  This shows that 
|W | is equal to the expression on the right. 
Since both expressions are equal to |W |, they must be equal to each other. 

� 

(Combinatorial  proofs  are  real  proofs.  They  are  not  only  rigorous,  but  also  con­
vey an intuitive understanding that a purely algebraic argument might not reveal. 
However, combinatorial proofs are usually less colorful than this one.) 

Problem 16.34. 
According to the Multinomial Theorem 16.11.3, (x1+x2+...+xk )n  can be expressed 
as a sum of terms of the form � 
� 
n 
2  ...x rk 
1  x r2 
x r1 
k  . 
r1 , r2 , ..., rk 

384 

CHAPTER 16.  COUNTING 

(a)  How many terms are there in the sum? 
� 
� 
� 
(b)  The sum of these multinomial coefﬁcients has an easily expressed value: 
n 
r1 , r2 ,  ...,  rk 
r1+r2+...+rk =n, 
ri∈N 

= kn 

(16.17) 

Give a combinatorial proof of this identity.

Hint: How many terms are there when (x1  + x2  + ... + xk )n  is expressed as a sum

of monomials  in  xi  before  terms with  like  powers  of  these  variables  are  collected

together under a single coefﬁcient?


Problem 16.35. 
Give combinatorial proofs of  the  identities below.  Use  the  following structure  for 
each  proof.  First,  deﬁne  an  appropriate  set  S .  Next,  show  that  the  left  side  of 
the  equation  counts  the  number  of  elements  in  S .  Then  show  that,  from  another 
perspective,  the  right  side  of  the  equation  also  counts  the  number  of  elements  in 
set S . Conclude that the left side must be equal to the right, since both are equal to 
|S
|. 
� � 
n � � � 
�
2n  �  n
(a)
n 
· 
= 
n − k 
k 
n
r �
� � 
�
k=0 
�  n + i
n + r + 1 
= 
r 
i
i=0 

(b) 

Hint:  consider a set of binary strings that could be counted using the right side of 
the equation, then try partitioning them into subsets countable by the elements of 
the sum on the left. 

MIT OpenCourseWare
http://ocw.mit.edu 

6.042J / 18.062J Mathematics for Computer Science 
Spring 2010 

For information about citing these materials or our Terms of Use, visit: http://ocw.mit.edu/terms . 


A  User  Interface  Source  Codes 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  6 . 1 1 1  FPGA  L a b k i t  −−  ADV7185  V i d e o  D e c o d e r  C o n f i g u r a t i o n  I n i t

/ /

/ /  C r e a t e d :

/ /  A u t h o r  :  Na than  I c k e s

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  R e g i s t e r  0

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


4 ’ h0 

‘ d e f i n e  INPUT  SELECT 
/ /  0 :  CVBS  on  AIN1  ( c o m p o s i t e  v i d e o 
i n ) 
/ /  7 :  Y on  AIN2 ,  C on  AIN5  ( s−v i d e o 
i n ) 
/ /  ( T h e s e  a r e  t h e  o n l y  c o n f i g u r a t i o n s  s u p p o r t e d  by  t h e  6 . 1 1 1  l a b k i t  h a r d w a r e ) 
‘ d e f i n e  INPUT MODE 
4 ’ h0 
/ /  0 :  A u t o d e t e c t :  NTSC  o r  PAL  ( BGHID )  ,  w/ o  p e d e s t a l 
/ /  1 :  A u t o d e t e c t :  NTSC  o r  PAL  ( BGHID )  ,  w/ p e d e s t a l 
/ /  2 :  A u t o d e t e c t :  NTSC  o r  PAL  ( N )  ,  w/ o  p e d e s t a l 
/ /  3 :  A u t o d e t e c t :  NTSC  o r  PAL  ( N )  ,  w/ p e d e s t a l 
/ /  4 :  NTSC  w/ o  p e d e s t a l 
/ /  5 :  NTSC  w/ p e d e s t a l 
/ /  6 :  NTSC  4 . 4 3  w/ o  p e d e s t a l 
/ /  7 :  NTSC  4 . 4 3  w/ p e d e s t a l 
/ /  8 :  PAL  BGHID  w/ o  p e d e s t a l 
/ /  9 :  PAL  N  w/ p e d e s t a l 
/ /  A :  PAL  M  w/ o  p e d e s t a l 
/ /  B :  PAL  M  w/ p e d e s t a l 
/ /  C :  PAL  c o m b i n a t i o n  N 
/ /  D :  PAL  c o m b i n a t i o n  N  w/ p e d e s t a l 
/ /  E−F :  [ No t  v a l i d  ] 

‘ d e f i n e  ADV7185  REGISTER  0  { ‘ INPUT MODE , 

‘ INPUT  SELECT} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  1 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  VIDEO QUALITY 
/ /  0 :  B r o a d c a s t  q u a l i t y 
/ /  1 :  TV  q u a l i t y 
/ /  2 :  VCR  q u a l i t y 
/ /  3 :  S u r v e i l l a n c e  q u a l i t y 
‘ d e f i n e  SQUARE PIXEL  IN MODE 
/ /  0 :  No rma l  mode 
/ /  1 :  S q u a r e  p i x e l  mode 
‘ d e f i n e  DIFFERENTIAL INPUT 

2 ’ h0 

1 ’ b0 

1 ’ b0 

1 

/ /  0 :  S i n g l e −e n d e d  i n p u t s

/ /  1 :  D i f f e r e n t i a l 
i n p u t s

‘ d e f i n e  FOUR TIMES SAMPLING 
/ /  0 :  S t a n d a r d  s a m p l i n g  r a t e 
/ /  1 :  4 x  s a m p l i n g  r a t e  ( NTSC  o n l y ) 
‘ d e f i n e  BETACAM 
/ /  0 :  S t a n d a r d  v i d e o 
i n p u t 
/ /  1 :  B e ta cam  v i d e o  i n p u t 
‘ d e f i n e  AUTOMATIC STARTUP ENABLE 
i n p u t  t r i g g e r s  r e a c q u i r e

/ /  0 :  Chang e  o f 
/ /  1 :  Chang e  o f 
i n p u t  d o e s  n o t  t r i g g e r  r e a c q u i r e


1 ’ b0 

1 ’ b0 

1 ’ b1 

‘ d e f i n e  ADV7185  REGISTER  1  { ‘AUTOMATIC STARTUP ENABLE,  1  ’ b0 , 
‘ BETACAM, 
‘ DIFFERENTIAL INPUT , 
‘FOUR TIMES SAMPLING , 
‘ VIDEO QUALITY} 
‘ SQUARE  PIXEL  IN MODE , 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  2 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  Y PEAKING FILTER 
s−v i d e o  =  9 . 2 5 dB 
/ /  0 :  C o m p o s i t e  =  4 . 5 dB , 
s−v i d e o  =  9 . 2 5 dB 
/ /  1 :  C o m p o s i t e  =  4 . 5 dB , 
/ /  2 :  C o m p o s i t e  =  4 . 5 dB , 
s−v i d e o  =  5 . 7 5 dB 
/ /  3 :  C o m p o s i t e  =  1 . 2 5 dB ,  s−v i d e o  =  3 . 3 dB 
/ /  4 :  C o m p o s i t e  =  0 . 0 dB , 
s−v i d e o  =  0 . 0 dB 
/ /  5 :  C o m p o s i t e  =  − 1 . 2 5dB ,  s−v i d e o  =  − 3 . 0dB 
/ /  6 :  C o m p o s i t e  =  − 1 . 7 5dB ,  s−v i d e o  =  − 8 . 0dB 
/ /  7 :  C o m p o s i t e  =  − 3 . 0 dB , 
s−v i d e o  =  − 8 . 0dB 
‘ d e f i n e  CORING 
/ /  0 :  No  c o r i n g 
/ /  1 :  T r u n c a t e 
/ /  2 :  T r u n c a t e 
/ /  3 :  T r u n c a t e 

i f  Y  <  b l a c k+8 
i f  Y  <  b l a c k +16 
i f  Y  <  b l a c k +32 

3 ’ h4 

2 ’ h0 

‘ d e f i n e  ADV7185  REGISTER  2  { 3 ’ b 0 0 0 , 

‘ CORING , 

‘ Y PEAKING FILTER} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  3 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  INTERFACE SELECT 
/ /  0 :  P h i l i p s −c o m p a t i b l e 
/ /  1 :  B r o k t r e e  API  A−c o m p a t i b l e 
/ /  2 :  B r o k t r e e  API  B−c o m p a t i b l e 
/ /  3 :  [ No t  v a l i d ] 
‘ d e f i n e  OUTPUT FORMAT 
/ /  0 :  1 0 − b i t  @  LLC ,  4 : 2 : 2  CCIR656 
/ /  1 :  2 0 − b i t  @  LLC ,  4 : 2 : 2  CCIR656 
/ /  2 :  1 6 − b i t  @  LLC ,  4 : 2 : 2  CCIR656 
/ /  3 :  8 − b i t  @  LLC ,  4 : 2 : 2  CCIR656 

2 ’ h0 

4 ’ h0 

2 

/ /  4 :  1 2 − b i t  @  LLC ,  4 : 1 : 1

/ /  5 −F :  [ No t  v a l i d  ]

/ /  ( N o t e  t h a t  t h e  6 . 1 1 1  l a b k i t  h a r d w a r e  p r o v i d e s  o n l y  a  1 0 − b i t 
/ /  t h e  ADV7185 . )

‘ d e f i n e  TRISTATE OUTPUT DRIVERS 
/ /  0 :  D r i v e r s  t r i s t a t e d  when  ˜OE  i s  h i g h 
/ /  1 :  D r i v e r s  a l w a y s  t r i s t a t e d 
‘ d e f i n e  VBI ENABLE 
/ /  0 :  D e c o d e 
l i n e s  d u r i n g  v e r t i c a l  b l a n k i n g 
/ /  1 :  D e c o d e  o n l y  a c t i v e  v i d e o  r e g i o n s 

1 ’ b0 
i n t e r v a l 

1 ’ b0 

i n t e r f a c e  t o


‘ d e f i n e  ADV7185  REGISTER  3  { ‘ VBI ENABLE , 
‘ TRISTATE OUTPUT DRIVERS , 
‘ INTERFACE SELECT} 

‘ OUTPUT FORMAT, 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  4 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  OUTPUT DATA RANGE 
1 ’ b0 
/ /  0 :  Ou tpu t  v a l u e s  r e s t r i c t e d  t o  CCIR−c o m p l i a n t  r a n g e 
/ /  1 :  U s e  f u l l  o u t p u t  r a n g e 
‘ d e f i n e  BT656 TYPE 
/ /  0 :  BT656−3−c o m p a t i b l e 
/ /  1 :  BT656−4−c o m p a t i b l e 

1 ’ b0 

‘ d e f i n e  ADV7185  REGISTER  4  { ‘ BT656  TYPE ,  3 ’ b 0 0 0 ,  3 ’ b 1 1 0 , 

‘ OUTPUT DATA RANGE} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  5 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

4 ’ b 0 0 0 0 
‘ d e f i n e  GENERAL PURPOSE OUTPUTS 
‘ d e f i n e  GPO  0  1  ENABLE 
1 ’ b0 
/ /  0 :  G e n e r a l  p u r p o s e  o u t p u t s  0  and  1  t r i s t a t e d 
/ /  1 :  G e n e r a l  p u r p o s e  o u t p u t s  0  and  1  e n a b l e d 
‘ d e f i n e  GPO  2  3  ENABLE 
1 ’ b0 
/ /  0 :  G e n e r a l  p u r p o s e  o u t p u t s  2  and  3  t r i s t a t e d 
/ /  1 :  G e n e r a l  p u r p o s e  o u t p u t s  2  and  3  e n a b l e d 
‘ d e f i n e  BLANK CHROMA  IN VBI 
1 ’ b1 
/ /  0 :  Chroma  d e c o d e d  and  o u t p u t  d u r i n g  v e r t i c a l  b l a n k i n g 
/ /  1 :  Chroma  b l a n k e d  d u r i n g  v e r t i c a l  b l a n k i n g 
‘ d e f i n e  HLOCK ENABLE 
/ /  0 :  GPO  0 
i s  a  g e n e r a l  p u r p o s e  o u t p u t 
/ /  1 :  GPO  0  s h o w s  HLOCK  s t a t u s 

1 ’ b0 

‘ GPO  2 3 ENABLE , 
‘ BLANK CHROMA IN VBI , 
‘ d e f i n e  ADV7185  REGISTER  5  { ‘HLOCK ENABLE , 
‘ GPO  0  1  ENABLE , 
‘ GENERAL PURPOSE OUTPUTS} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  7 

3 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  FIFO FLAG MARGIN 
5 ’ h 1 0 
l o c a t i o n s  w h e r e  FIFO  a l m o s t − f u l l  and  a l m o s t −empty  f l a g s  a r e  s e t 
/ /  S e t s  t h e 
‘ d e f i n e  FIFO RESET 
1 ’ b0 
/ /  0 :  No rma l  o p e r a t i o n 
/ /  1 :  R e s e t  FIFO .  T h i s  b i t 
‘ d e f i n e  AUTOMATIC FIFO RESET 
/ /  0 :  No  a u t o m a t i c  r e s e t 
/ /  1 :  FIFO  i s  a u t m a t i c a l l y  r e s e t  a t  t h e  e n d  o f  e a c h  v i d e o 
‘ d e f i n e  FIFO  FLAG  SELF  TIME 
1 ’ b1 
/ /  0 :  FIFO  f l a g s  a r e  s y n c h r o n i z e d  t o  CLKIN 
/ /  1 :  FIFO  f l a g s  a r e  s y n c h r o n i z e d  t o 
i n t e r n a l  2 7MHz  c l o c k 

i s  a u t o m a t i c a l l y  c l e a r e d 
1 ’ b0 

f i e l d 

‘ d e f i n e  ADV7185  REGISTER  7  { ‘ FIFO  FLAG  SELF  TIME , 
‘ AUTOMATIC FIFO RESET , 
‘ FIFO FLAG MARGIN} 
‘ FIFO  RESET , 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  8 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  INPUT CONTRAST ADJUST 

8 ’ h 8 0 

‘ d e f i n e  ADV7185  REGISTER  8  { ‘ INPUT CONTRAST ADJUST} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  9 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  INPUT SATURATION ADJUST 

8 ’ h8C 

‘ d e f i n e  ADV7185  REGISTER  9  { ‘ INPUT SATURATION ADJUST} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  A 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  INPUT BRIGHTNESS ADJUST 

8 ’ h 0 0 

‘ d e f i n e  ADV7185  REGISTER  A  { ‘ INPUT BRIGHTNESS ADJUST} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  B 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  INPUT HUE ADJUST 

8 ’ h 0 0 

‘ d e f i n e  ADV7185  REGISTER  B  { ‘ INPUT HUE ADJUST} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  C 

4 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  DEFAULT VALUE ENABLE 
/ /  0 :  U s e  p r o g r amm ed  Y ,  Cr ,  and  Cb  v a l u e s 
/ /  1 :  U s e  d e f a u l t  v a l u e s 
‘ d e f i n e  DEFAULT VALUE AUTOMATIC ENABLE 
/ /  0 :  U s e  p r o g r amm ed  Y ,  Cr ,  and  Cb  v a l u e s 
/ /  1 :  U s e  d e f a u l t  v a l u e s 
i f 
l o c k 
i s 
l o s t 
‘ d e f i n e  DEFAULT Y VALUE 
/ /  D e f a u l t  Y  v a l u e 

1 ’ b0 

1 ’ b0 

6 ’ h0C 

‘ d e f i n e  ADV7185  REGISTER  C  { ‘ DEFAULT Y VALUE , 
‘ DEFAULT VALUE AUTOMATIC ENABLE , 
‘DEFAULT VALUE ENABLE} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  D 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  DEFAULT CR VALUE 
4 ’ h8 
f o u r  b i t s  o f  d e f a u l t  Cr  v a l u e 
/ /  Mo s t− s i g n i f i c a n t 
‘ d e f i n e  DEFAULT CB VALUE 
4 ’ h8 
/ /  Mo s t− s i g n i f i c a n t 
f o u r  b i t s  o f  d e f a u l t  Cb  v a l u e 

‘ d e f i n e  ADV7185  REGISTER  D  { ‘ DEFAULT CB VALUE , 

‘ DEFAULT CR VALUE} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  E 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  TEMPORAL DECIMATION ENABLE 
/ /  0 :  D i s a b l e 
/ /  1 :  E n a b l e 
‘ d e f i n e  TEMPORAL DECIMATION CONTROL 
/ /  0 :  S u p r e s s  f r a m e s  ,  s t a r t  w i t h  e v e n 
f i e l d 
/ /  1 :  S u p r e s s  f r a m e s  ,  s t a r t  w i t h  odd  f i e l d 
/ /  2 :  S u p r e s s  e v e n 
f i e l d s  o n l y 
/ /  3 :  S u p r e s s  odd  f i e l d s  o n l y 
‘ d e f i n e  TEMPORAL DECIMATION RATE 
/ /  0 −F :  Number  o f 
f i e l d s / f r a m e s  t o  s k i p 

1 ’ b0 

2 ’ h0 

4 ’ h0 

‘ d e f i n e  ADV7185  REGISTER  E  { 1 ’ b0 , 
‘ TEMPORAL DECIMATION RATE, 
‘TEMPORAL DECIMATION CONTROL, 
‘TEMPORAL DECIMATION ENABLE} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  F 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  POWER SAVE CONTROL 
/ /  0 :  F u l l  o p e r a t i o n 
/ /  1 :  CVBS  o n l y 

2 ’ h0 

5 

1 ’ b0 

1 ’ b0 

1 ’ b0 

p r i o r i t y 

/ /  2 :  D i g i t a l  o n l y

/ /  3 :  P ow e r  s a v e  mode

‘ d e f i n e  POWER DOWN SOURCE PRIORITY 
/ /  0 :  Power−down  p i n  h a s  p r i o r i t y 
/ /  1 :  Power−down  c o n t r o l  b i t  h a s 
‘ d e f i n e  POWER DOWN REFERENCE 
i s 
/ /  0 :  R e f e r e n c e 
f u n c t i o n a l 
/ /  1 :  R e f e r e n c e 
i s  p o w e r e d  down 
‘ d e f i n e  POWER DOWN LLC GENERATOR 
i s 
/ /  0 :  LLC  g e n e r a t o r 
f u n c t i o n a l 
/ /  1 :  LLC  g e n e r a t o r 
i s  p o w e r e d  down 
‘ d e f i n e  POWER DOWN CHIP 
/ /  0 :  C h i p 
i s 
f u n c t i o n a l 
/ /  1 :  I n p u t  p a d s  d i s a b l e d  and  c l o c k s  s t o p p e d 
‘ d e f i n e  TIMING REACQUIRE 
/ /  0 :  No rma l  o p e r a t i o n 
/ /  1 :  R e a c q u i r e  v i d e o  s i g n a l  ( b i t  w i l l  a u t o m a t i c a l l y  r e s e t ) 
‘ d e f i n e  RESET CHIP 
1 ’ b0 
/ /  0 :  No rma l  o p e r a t i o n 
/ /  1 :  R e s e t  d i g i t a l  c o r e  and  I2C 

1 ’ b0 

1 ’ b0 

i n t e r f a c e  ( b i t  w i l l  a u t o m a t i c a l l y  r e s e t ) 

‘ d e f i n e  ADV7185 REGISTER F  { ‘ RESET  CHIP , 
‘ POWER DOWN CHIP, 
‘ TIMING REACQUIRE , 
‘ POWER DOWN REFERENCE, 
‘POWER DOWN LLC GENERATOR, 
‘POWER DOWN SOURCE PRIORITY, 
‘ POWER SAVE CONTROL} 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  R e g i s t e r  3 3 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

‘ d e f i n e  PEAK WHITE UPDATE 
l i n e 
/ /  0 :  U p d a t e  g a i n  o n c e  p e r 
/ /  1 :  U p d a t e  g a i n  o n c e  p e r 
f i e l d 
‘ d e f i n e  AVERAGE  BIRIGHTNESS  LINES 
/ /  0 :  U s e 
l i n e s  3 3  t o  3 1 0 
/ /  1 :  U s e 
l i n e s  3 3  t o  2 7 0 
‘ d e f i n e  MAXIMUM IRE 
/ /  0 :  PAL :  1 3 3  ,  NTSC :  1 2 2 
/ /  1 :  PAL :  1 2 5  ,  NTSC :  1 1 5 
/ /  2 :  PAL :  1 2 0  ,  NTSC :  1 1 0 
/ /  3 :  PAL :  1 1 5  ,  NTSC :  1 0 5 
/ /  4 :  PAL :  1 1 0  ,  NTSC :  1 0 0 
/ /  5 :  PAL :  1 0 5  ,  NTSC :  1 0 0 
/ /  6 − 7 :  PAL :  1 0 0  ,  NTSC :  1 0 0 
‘ d e f i n e  COLOR KILL 
/ /  0 :  D i s a b l e  c o l o r  k i l l 
/ /  1 :  E n a b l e  c o l o r  k i l l 

1 ’ b1 

1 ’ b1 

3 ’ h0 

1 ’ b1 

‘ d e f i n e  ADV7185  REGISTER  33  { 1 ’ b1 , 
‘ MAXIMUM IRE , 
‘ COLOR KILL ,  1 ’ b1 , 
‘ AVERAGE BIRIGHTNESS LINES , 
‘PEAK WHITE UPDATE} 

6 

‘ d e f i n e  ADV7185  REGISTER  10 
‘ d e f i n e  ADV7185  REGISTER  11 
‘ d e f i n e  ADV7185  REGISTER  12 
‘ d e f i n e  ADV7185  REGISTER  13 
‘ d e f i n e  ADV7185  REGISTER  14 
‘ d e f i n e  ADV7185  REGISTER  15 
‘ d e f i n e  ADV7185  REGISTER  16 
‘ d e f i n e  ADV7185  REGISTER  17 
‘ d e f i n e  ADV7185  REGISTER  18 
‘ d e f i n e  ADV7185  REGISTER  19 
‘ d e f i n e  ADV7185 REGISTER  1A 
‘ d e f i n e  ADV7185  REGISTER  1B 
‘ d e f i n e  ADV7185  REGISTER  1C 
‘ d e f i n e  ADV7185 REGISTER  1D 
‘ d e f i n e  ADV7185  REGISTER  1E 
‘ d e f i n e  ADV7185  REGISTER  1F 
‘ d e f i n e  ADV7185  REGISTER  20 
‘ d e f i n e  ADV7185  REGISTER  21 
‘ d e f i n e  ADV7185  REGISTER  22 
‘ d e f i n e  ADV7185  REGISTER  23 
‘ d e f i n e  ADV7185  REGISTER  24 
‘ d e f i n e  ADV7185  REGISTER  25 
‘ d e f i n e  ADV7185  REGISTER  26 
‘ d e f i n e  ADV7185  REGISTER  27 
‘ d e f i n e  ADV7185  REGISTER  28 
‘ d e f i n e  ADV7185  REGISTER  29 
‘ d e f i n e  ADV7185 REGISTER  2A 
‘ d e f i n e  ADV7185  REGISTER  2B 
‘ d e f i n e  ADV7185  REGISTER  2C 
‘ d e f i n e  ADV7185 REGISTER  2D 
‘ d e f i n e  ADV7185  REGISTER  2E 
‘ d e f i n e  ADV7185  REGISTER  2F 
‘ d e f i n e  ADV7185  REGISTER  30 
‘ d e f i n e  ADV7185  REGISTER  31 
‘ d e f i n e  ADV7185  REGISTER  32 
‘ d e f i n e  ADV7185  REGISTER  34 
‘ d e f i n e  ADV7185  REGISTER  35 
‘ d e f i n e  ADV7185  REGISTER  36 
‘ d e f i n e  ADV7185  REGISTER  37 
‘ d e f i n e  ADV7185  REGISTER  38 
‘ d e f i n e  ADV7185  REGISTER  39 
‘ d e f i n e  ADV7185 REGISTER  3A 
‘ d e f i n e  ADV7185  REGISTER  3B 

8 ’ h 0 0 
8 ’ h 0 0 
8 ’ h 0 0 
8 ’ h 4 5 
8 ’ h 1 8 
8 ’ h 6 0 
8 ’ h 0 0 
8 ’ h 0 1 
8 ’ h 0 0 
8 ’ h 1 0 
8 ’ h 1 0 
8 ’ hF0 
8 ’ h 1 6 
8 ’ h 0 1 
8 ’ h 0 0 
8 ’ h3D 
8 ’ hD0 
8 ’ h 0 9 
8 ’ h8C 
8 ’ hE2 
8 ’ h1F 
8 ’ h 0 7 
8 ’ hC2 
8 ’ h 5 8 
8 ’ h3C 
8 ’ h 0 0 
8 ’ h 0 0 
8 ’ hA0 
8 ’ hCE 
8 ’ hF0 
8 ’ h 0 0 
8 ’ hF0 
8 ’ h 0 0 
8 ’ h 7 0 
8 ’ h 0 0 
8 ’ h0F 
8 ’ h 0 1 
8 ’ h 0 0 
8 ’ h 0 0 
8 ’ h 0 0 
8 ’ h 0 0 
8 ’ h 0 0 
8 ’ h 0 0 

‘ d e f i n e  ADV7185  REGISTER  44 
‘ d e f i n e  ADV7185  REGISTER  45 

8 ’ h 4 1 
8 ’ hBB 

‘ d e f i n e  ADV7185  REGISTER  F1 
‘ d e f i n e  ADV7185  REGISTER  F2 

8 ’ hEF 
8 ’ h 8 0 

7 

m o d u l e  a d v 7 1 8 5 i n i t  ( r e s e t  ,  c l o c k  2 7 m h z  ,  s o u r c e  ,  t v  i n  r e s e t  b , 
t v  i n  i 2 c  c l o c k  ,  t v  i n  i 2 c  d a t a  ) ; 

i n p u t  r e s e t  ; 
i n p u t  c l o c k  2 7 m h z  ;

i n  r e s e t  b  ;  / /  R e s e t  s i g n a l  t o  ADV7185

o u t p u t  t v

i n  i 2 c  c l o c k  ;  / /  I2C  c l o c k  o u t p u t  t o  ADV7185

o u t p u t  t v

o u t p u t  t v

i n  i 2 c  d a t a  ;  / /  I2C  d a t a 
l i n e  t o  ADV7185

i n p u t  s o u r c e ;  / /  0 :  c o m p o s i t e  ,  1 :  s−v i d e o


i n i t i a l  b e g i n 
$ d i s p l a y ( ” ADV7185  I n i t i a l i z a t i o n  v a l u e s : ” ) ; 
0 x%X ” ,  ‘ ADV7185  REGISTER  0 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  0 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  1 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  1 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  2 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  2 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  3 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  3 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  4 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  4 : 
$ d i s p l a y ( ”  R e g i s t e r  5 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  5 ) ; 
0 x%X ” ,  ‘ ADV7185  REGISTER  7 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  7 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  8 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  8 : 
0 x%X ” ,  ‘ ADV7185  REGISTER  9 ) ; 
$ d i s p l a y ( ”  R e g i s t e r  9 : 
$ d i s p l a y ( ”  R e g i s t e r  A : 
0 x%X ”  ,  ‘ ADV7185  REGISTER  A ) ; 
0 x%X ”  ,  ‘ ADV7185  REGISTER  B ) ; 
$ d i s p l a y ( ”  R e g i s t e r  B : 
0 x%X ”  ,  ‘ ADV7185  REGISTER  C ) ; 
$ d i s p l a y ( ”  R e g i s t e r  C : 
0 x%X ”  ,  ‘ ADV7185  REGISTER  D ) ; 
$ d i s p l a y ( ”  R e g i s t e r  D : 
$ d i s p l a y ( ”  R e g i s t e r  E : 
0 x%X ”  ,  ‘ ADV7185  REGISTER  E ) ; 
0 x%X ”  ,  ‘ ADV7185 REGISTER F ) ; 
$ d i s p l a y ( ”  R e g i s t e r  F : 
$ d i s p l a y ( ”  R e g i s t e r  3 3 :  0 x%X ” ,  ‘ ADV7185  REGISTER  33 ) ; 

e n d


/ /

/ /  G e n e r a t e  a  1MHz  f o r  t h e  I2C  d r i v e r  (  r e s u l t i n g  I2C  c l o c k  r a t e 
/ /


i s  2 5 0 kHz )


r e g 
[ 7 : 0 ]  c l k
 d i v  c o u n t  ,  r e s e t  c o u n t  ;

r e g  c l o c k
 s l o w ;

w i r e  r e s e t
 s l o w  ; 

i n i t i a l 
b e g i n 
c l k  d i v  c o u n t  <=  8 ’ h 0 0 ; 
/ /  s y n t h e s i s  a t t r i b u t e 
c l o c k  s l o w  <=  1 ’ b0 ;

/ /  s y n t h e s i s  a t t r i b u t e 

e n d


i n i t  o f  c l k  d i v  c o u n t 

i s  ” 0 0 ” ; 

i n i t  o f  c l o c k  s l o w 

i s  ” 0 ” ;


a l w a y s  @( p o s e d g e  c l o c k  2 7 m h z )

i f  (  c l k  d i v  c o u n t  ==  2 6 )

b e g i n

c l o c k
 s l o w  <=  ˜ c l o c k  s l o w  ;

c l k  d i v  c o u n t  <=  0 ;


8 

e n d

e l s e

c l k
 d i v  c o u n t  <=  c l k  d i v  c o u n t + 1 ; 

a l w a y s  @( p o s e d g e  c l o c k  2 7 m h z ) 
i f  ( r e s e t )

r e s e t
 c o u n t  < =  1 0 0 ; 
e l s e

r e s e t  c o u n t  <=  ( r e s e t  c o u n t = = 0 )  ?  0  :  r e s e t  c o u n t  − 1 ;


a s s i g n  r e s e t  s l o w  =  r e s e t  c o u n t  ! =  0 ; 

/ / 
/ /  I2C  d r i v e r 
/ / 

r e g 
l o a d ; 
r e g 
[ 7 : 0 ]  d a t a ; 
i d l e  ; 
w i r e  a c k  , 

i 2 c 

i 2 c ( . r e s e t ( r e s e t  s l o w ) ,  . c l o c k 4 x ( c l o c k  s l o w ) ,  . d a t a ( d a t a ) ,  . l o a d ( l o a d ) , 
. a c k ( a c k ) ,  . i d l e ( i d l e ) ,  . s c l ( t v  i n  i 2 c  c l o c k  ) ,

. s d a ( t v

i n  i 2 c  d a t a  ) ) ; 

/ /

/ /  S t a t e  m a c h i n e

/ /


[ 7 : 0 ]  s t a t e ;

r e g 
i n  r e s e t  b ; 
r e g  t v

r e g  o l d  s o u r c e  ; 

a l w a y s  @( p o s e d g e  c l o c k  s l o w )

i f  ( r e s e t  s l o w )

b e g i n

s t a t e  <=  0 ;

l o a d  <=  0 ;

t v  i n  r e s e t  b  <=  0 ;

o l d  s o u r c e  <=  0 ;


e n d

e l s e

c a s e  (  s t a t e )

8 ’ h 0 0 :

b e g i n

/ /  A s s e r t  r e s e t

l o a d  <=  1 ’ b0 ;

t v  i n  r e s e t  b  <=  1 ’ b0 ;

i f  ( ! a c k )

s t a t e  <=  s t a t e + 1 ;


e n d

8 ’ h 0 1 :


9 

s t a t e  <=  s t a t e + 1 ; 
8 ’ h 0 2 : 
b e g i n

/ /  R e l e a s e  r e s e t

t v  i n  r e s e t  b  <=  1 ’ b1 ;

s t a t e  <=  s t a t e + 1 ;

e n d 

8 ’ h 0 3 : 
b e g i n

/ /  S e n d  ADV7185  a d d r e s s

d a t a  <=  8 ’ h8A ;

l o a d  <=  1 ’ b1 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 0 4 : 
b e g i n

/ /  S e n d  s u b a d d r e s s  o f 
d a t a  <=  8 ’ h 0 0 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

f i r s t  r e g i s t e r


e n d 
8 ’ h 0 5 : 
b e g i n 
/ /  W r i t e  t o  r e g i s t e r  0 
d a t a  <=  ‘ADV7185  REGISTER  0  | { 5  ’ h0 0 ,  { 3 { s o u r c e } } } ; 
i f  ( a c k ) 
s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 0 6 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  1

d a t a  <=  ‘ADV7185  REGISTER  1 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 0 7 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  2

d a t a  <=  ‘ADV7185  REGISTER  2 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 0 8 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  3

d a t a  <=  ‘ADV7185  REGISTER  3 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 0 9 : 

10 

b e g i n

/ /  W r i t e  t o  r e g i s t e r  4

d a t a  <=  ‘ADV7185  REGISTER  4 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h0A : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  5

d a t a  <=  ‘ADV7185  REGISTER  5 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h0B : 
b e g i n 
/ /  W r i t e  t o  r e g i s t e r  6 
d a t a  <=  8 ’ h 0 0 ;  / /  R e s e r v e d  r e g i s t e r  ,  w r i t e  a l l  z e r o s 
i f  ( a c k ) 
s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h0C : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  7

d a t a  <=  ‘ADV7185  REGISTER  7 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h0D : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  8

d a t a  <=  ‘ADV7185  REGISTER  8 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h0E : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  9

d a t a  <=  ‘ADV7185  REGISTER  9 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ;


e n d

8 ’ h0F :  b e g i n 
/ /  W r i t e  t o  r e g i s t e r  A 
d a t a  <=  ‘ADV7185  REGISTER  A ; 
i f  ( a c k ) 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 0 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  B

d a t a  <=  ‘ADV7185  REGISTER  B ;


11 

i f  ( a c k ) 
s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 1 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  C

d a t a  <=  ‘ADV7185  REGISTER  C ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 2 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  D

d a t a  <=  ‘ADV7185  REGISTER  D ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 3 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  E

d a t a  <=  ‘ADV7185  REGISTER  E ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 4 : 
b e g i n

/ /  W r i t e  t o  r e g i s t e r  F

d a t a  <=  ‘ADV7185 REGISTER F ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 5 : 
b e g i n 
/ /  Wa it  f o r  I2C  t r a n s m i t t e r  t o 
l o a d  <=  1 ’ b0 ; 
i f  ( i d l e ) 
s t a t e  <=  s t a t e + 1 ; 

f i n i s h 

e n d 
8 ’ h 1 6 : 
b e g i n

/ /  W r i t e  a d d r e s s

d a t a  <=  8 ’ h8A ;

l o a d  <=  1 ’ b1 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 7 : 
b e g i n

d a t a  <=  8 ’ h 3 3 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

12 

e n d 
8 ’ h 1 8 : 
b e g i n 
d a t a  <=  ‘ADV7185  REGISTER  33 ; 
i f  ( a c k ) 
s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 1 9 : 
b e g i n

l o a d  <=  1 ’ b0 ;

i f  ( i d l e )

s t a t e  <=  s t a t e + 1 ;


e n d


8 ’ h1A :  b e g i n 
d a t a  <=  8 ’ h8A ; 
l o a d  <=  1 ’ b1 ; 
i f  ( a c k ) 
s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h1B : 
b e g i n

d a t a  <=  8 ’ h 3 3 ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h1C : 
b e g i n

l o a d  <=  1 ’ b0 ;

i f  ( i d l e )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h1D : 
b e g i n

l o a d  <=  1 ’ b1 ;

d a t a  <=  8 ’ h8B ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h1E : 
b e g i n

d a t a  <=  8 ’hFF ;

i f  ( a c k )

s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h1F : 
b e g i n

l o a d  <=  1 ’ b0 ;

i f  ( i d l e )

s t a t e  <=  s t a t e + 1 ;


e n d


13 

8 ’ h 2 0 : 
b e g i n

/ /  I d l e

i f  ( o l d
 s o u r c e  ! =  s o u r c e  )  s t a t e  <=  s t a t e + 1 ; 
o l d  s o u r c e  <=  s o u r c e  ;


e n d

8 ’ h 2 1 :  b e g i n

/ /  S e n d  ADV7185  a d d r e s s

d a t a  <=  8 ’ h8A ;

l o a d  <=  1 ’ b1 ;

i f  ( a c k )  s t a t e  <=  s t a t e + 1 ;


e n d 
8 ’ h 2 2 :  b e g i n 
/ /  S e n d  s u b a d d r e s s  o f  r e g i s t e r  0 
d a t a  <=  8 ’ h 0 0 ; 
i f  ( a c k )  s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 2 3 :  b e g i n 
/ /  W r i t e  t o  r e g i s t e r  0 
d a t a  <=  ‘ADV7185  REGISTER  0  | { 5  ’ h0 0 ,  { 3 { s o u r c e } } } ; 
i f  ( a c k )  s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 2 4 :  b e g i n 
/ /  Wa it  f o r  I2C  t r a n s m i t t e r  t o 
l o a d  <=  1 ’ b0 ; 
i f  (  i d l e  )  s t a t e  <=  8 ’ h 2 0 ; 

f i n i s h 

e n d

e n d c a s e


e n dm o d u l e 

/ /  i 2 c  m o d u l e  f o r  u s e  w i t h  t h e  ADV7185 

m o d u l e 

i 2 c  (  r e s e t  ,  c l o c k 4 x  ,  d a t a  , 

l o a d  , 

i d l e  ,  a c k  ,  s c l  ,  s d a ) ; 

i n p u t  r e s e t  ;

i n p u t  c l o c k 4 x  ;

i n p u t 
[ 7 : 0 ]  d a t a ;

i n p u t 
l o a d ;

o u t p u t  a c k ;

o u t p u t 
i d l e  ;

o u t p u t  s c l  ;

o u t p u t  s d a ;


l d a t a ;

i d l e  ;


r e g 
[ 7 : 0 ] 
r e g  a c k  , 
r e g  s c l  ;

r e g  s d a i  ;


r e g 

[ 7 : 0 ]  s t a t e ; 

14 

a s s i g n  s d a  =  s d a i  ?  1 ’ bZ  :  1 ’ b0 ; 

a l w a y s  @( p o s e d g e  c l o c k 4 x ) 
i f  ( r e s e t ) 
b e g i n

s t a t e  <=  0 ;

a c k  <=  0 ;


i d l e


e n d

e l s e

c a s e  (  s t a t e )

8 ’ h 0 0 :  / / 
b e g i n 
s c l  <=  1 ’ b1 ; 
s d a i  <=  1 ’ b1 ; 
a c k  <=  1 ’ b0 ; 
i d l e  <=  1 ’ b1 ; 
i f  ( l o a d ) 
b e g i n 
l d a t a  <=  d a t a ; 
a c k  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 

e n d


e n d

8 ’ h 0 1 :  / /  S t a r t

b e g i n 
a c k  <=  1 ’ b0 ; 
i d l e  <=  1 ’ b0 ; 
s d a i  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 

e n d

8 ’ h 0 2 :

b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 0 3 :  / /  S e n d  b i t  7 
b e g i n 
a c k  <=  1 ’ b0 ; 
s d a i  <=  l d a t a  [ 7 ] ; 
s t a t e  <=  s t a t e + 1 ; 

e n d

8 ’ h 0 4 :

b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 0 5 : 
b e g i n 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 0 6 : 

15 

b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 0 7 : 
b e g i n 
s d a i  <=  l d a t a  [ 6 ] ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 0 8 : 
b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 0 9 : 
b e g i n 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h0A : 
b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h0B : 
b e g i n 
s d a i  <=  l d a t a  [ 5 ] ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h0C : 
b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h0D : 
b e g i n 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h0E : 
b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h0F : 
b e g i n 
s d a i  <=  l d a t a  [ 4 ] ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 0 : 
b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 

16 

e n d 
8 ’ h 1 1 : 
b e g i n 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 2 : 
b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 3 : 
b e g i n 
s d a i  <=  l d a t a  [ 3 ] ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 4 : 
b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 5 : 
b e g i n 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 6 : 
b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 7 : 
b e g i n 
s d a i  <=  l d a t a  [ 2 ] ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 8 : 
b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h 1 9 : 
b e g i n 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h1A : 
b e g i n 
s c l  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 
8 ’ h1B : 
b e g i n 
s d a i  <=  l d a t a  [ 1 ] ; 

17 

<=  s t a t e + 1 ; 

<=  s t a t e + 1 ; 

b1 ; 
s t a t e + 1 ; 

s t a t e 
e n d 
8 ’ h1C : 
b e g i n 
s c l 
<=  1 ’ b1 ; 
<=  s t a t e + 1 ; 
s t a t e 
e n d 
8 ’ h1D : 
b e g i n 
s t a t e 
e n d 
8 ’ h1E : 
b e g i n 
s c l 
<=  1 ’ b0 ; 
<=  s t a t e + 1 ; 
s t a t e 
e n d 
8 ’ h1F : 
b e g i n 
s d a i  <=  l d a t a  [ 0 ] ; 
s t a t e 
<= 
s t a t e + 1 ; 
e n d 
8 ’ h 2 0 : 
b e g i n 
<=  1 ’
s c l 
s t a t e 
<= 
e n d 
8 ’ h 2 1 : 
b e g i n 
s t a t e 
e n d 
8 ’ h 2 2 : 
b e g i n 
<=  1 ’
s c l 
s t a t e 
<= 
e n d 
8 ’ h 2 3 :  / /  A c k n o w l e d g e  b i t 
b e g i n 
s t a t e 
e n d 
8 ’ h 2 4 : 
b e g i n 
<=  1 ’
s c l 
s t a t e 
<= 
e n d 
8 ’ h 2 5 : 
b e g i n 
s t a t e 
e n d 
8 ’ h 2 6 : 
b e g i n 
s c l 

b0 ; 
s t a t e + 1 ; 

b1 ; 
s t a t e + 1 ; 

<= 

s t a t e + 1 ; 

<= 

s t a t e + 1 ; 

<= 

s t a t e + 1 ; 

<=  1 ’

b0 ; 

18 

i f  ( l o a d ) 
b e g i n 
l d a t a  <=  d a t a ; 
a c k  <=  1 ’ b1 ; 
s t a t e  <=  3 ; 
e n d 
e l s e 
s t a t e  <=  s t a t e + 1 ; 

e n d 
8 ’ h 2 7 : 
b e g i n 
s d a i  <=  1 ’ b0 ; 
s t a t e  <=  s t a t e + 1 ; 

e n d

8 ’ h 2 8 :

b e g i n 
s c l  <=  1 ’ b1 ; 
s t a t e  <=  s t a t e + 1 ; 

e n d

8 ’ h 2 9 :

b e g i n 
s d a i  <=  1 ’ b1 ; 
s t a t e  <=  0 ; 

e n d

e n d c a s e


e n dm o d u l e 

19 

/ /

z b t
 6 1 1 1 . v 
/ /  F i l e  : 
/ /  D a t e : 
27−Nov−05 
/ /  A u t h o r  :  I  .  Chuang 
/ / 
t h e  MIT  6 . 1 1 1  l a b k i t  ,  w h i c h  d o e s  n o t  h i d e  t h e 
/ /  S i m p l e  ZBT  d r i v e r 
f o r 
ZBT  f r om  t h e  u s e r  .  The  ZBT  m em o r i e s  h a v e 
/ /  p i p e l i n e  d e l a y s  o f  t h e 
r e a d  and  w r i t e  ,  and  a l s o  n e e d  e x t r a − l o n g  d a t a  h o l d 
/ /  two  c y c l e 
l a t e n c i e s  on 
/ /  t i m e s  a r o u n d  t h e  c l o c k 
p o s i t i v e  e d g e  t o  wo r k  r e l i a b l y  . 
/ / 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  I k e  ’ s  s i m p l e  ZBT  RAM  d r i v e r 
f o r  t h e  MIT  6 . 1 1 1  l a b k i t

/ /

/ /  Da ta  f o r  w r i t e s  c a n  b e  p r e s e n t e d  and  c l o c k e d 
/ /  w r i t i n g  t o  RAM  w i l l  h a p p e n  two  c y c l e s 
l a t e r  .

/ /

/ /  Read  r e q u e s t s  a r e  p r o c e s s e d  i m m e d i a t e l y  ,  b u t  t h e  r e a d  d a t a 
/ /  u n t i l  two  c y c l e s  a f t e r  t h e 
i n t i a l  r e q u e s t .

/ /

/ /  A  c l o c k  e n a b l e  s i g n a l 

i t  e n a b l e s  t h e  RAM  c l o c k  when  h i g h .


i s  p r o v i d e d  ; 

i n 

i m m e d i a t e l y ;  t h e  a c t u a l


i s  n o t  a v a i l a b l e


m o d u l e  z b t
 6 1 1 1 ( c l k  ,  c e n  ,  we ,  a d d r  ,  w r i t e  d a t a  ,  r e a d  d a t a  , 
r a m  c l k  ,  r am  w e  b  ,  r a m  a d d r e s s  ,  r am  d a t a  ,  r a m  c e n  b ) ; 

i n p u t  c l k  ;

i n p u t  c e n ;

i n p u t  we ;

[ 1 8 : 0 ]  a d d r ;

i n p u t 
[ 3 5 : 0 ]  w r i t e  d a t a ;

i n p u t 
[ 3 5 : 0 ]  r e a d  d a t a  ; 
o u t p u t 
r a m  c l k ; 
o u t p u t 
o u t p u t 
r am  w e  b ; 
[ 1 8 : 0 ]  r a m  a d d r e s s ; 
o u t p u t 
i n o u t 
[ 3 5 : 0 ] 
r a m  d a t a ; 
r a m  c e n  b ; 
o u t p u t 

c l o c k 
/ /  s y s t e m 
e n a b l e  f o r  g a t i n g  ZBT  c y c l e s 
/ /  c l o c k 
e n a b l e  (  a c t i v e  HIGH ) 
/ /  w r i t e 
/ /  memory 
a d d r e s s 
/ /  d a t a  t o  w r i t e 
/ /  d a t a  r e a d  f r om 
memory 
t o  ram  c l o c k 
l i n e 
/ /  p h y s i c a l 
t o  ram  w e  b 
l i n e 
/ /  p h y s i c a l 
t o  ram  a d d r e s s 
l i n e 
/ /  p h y s i c a l 
/ /  p h y s i c a l 
l i n e 
t o  ram  d a t a 
t o  ram  c l o c k  e n a b l e 
l i n e 
/ /  p h y s i c a l 

/ /  c l o c k  e n a b l e  ( s h o u l d  b e  s y n c h r o n o u s  and  o n e 
r a m  c e n  b  =  ˜ c e n ; 
w i r e 

c y c l e  h i g h  a t  a  t i m e ) 

/ /  c r e a t e  d e l a y e d  r am  w e  s i g n a l  :  n o t e  t h e  d e l a y 
i s  by  two  c y c l e s  ! 
/ /  i e  we  p r e s e n t  t h e  d a t a  t o  b e  w r i t t e n  two  c y c l e s  a f t e r  we  i s  r a i s e d 
/ /  t h i s  m ean s  t h e  b u s 
i s  t r i − s t a t e d  two  c y c l e s  a f t e r  we  i s  r a i s e d  . 

r e g 

[ 1 : 0 ] 

w e  d e l a y ; 

a l w a y s  @( p o s e d g e  c l k ) 
w e  d e l a y  <=  c e n  ?  { w e  d e l a y [ 0 ]  , we } 

:  w e  d e l a y ; 

/ /  c r e a t e  two− s t a g e  p i p e l i n e 

f o r  w r i t e  d a t a 

20 

w r i t e  d a t a  o l d 1  ;

[ 3 5 : 0 ] 
r e g 
r e g 
w r i t e
 d a t a  o l d 2  ;

[ 3 5 : 0 ] 
a l w a y s  @( p o s e d g e  c l k )

( c e n )

i f	
{ w r i t e
 d a t a  o l d 2  ,  w r i t e  d a t a  o l d 1 }  <=  { w r i t e  d a t a  o l d 1  ,  w r i t e  d a t a } ; 

/ /  w i r e  t o  ZBT  RAM  s i g n a l s 

r am  w e  b  = ˜ we ; 
a s s i g n 
r a m  c l k  =  ˜ c l k  ; 
/ /  RAM  i s  n o t  happy  w i t h  o u r  d a t a  h o l d 
a s s i g n 
i t s  c l k  e d g e s  e q u a l  FPGA’ s 
/ /  t i m e s 
i f 
f a l l i n g  e d g e s 
/ /  s o  we  c l o c k 
i t  on  t h e 
l e t  d a t a  s t a b i l i z e 
/ /  and  t h u s 
l o n g e r 
r a m  a d d r e s s  =  a d d r ; 
a s s i g n 

a s s i g n 
a s s i g n 

r a m  d a t a  =  w e  d e l a y [ 1 ]  ?  w r i t e  d a t a  o l d 2  :  { 3 6 { 1 ’ bZ } } ; 
r e a d  d a t a  =  r a m  d a t a ; 

e n dm o d u l e  / /  z b t  6 1 1 1 

21 

/ / 
n t s c 2 z b t  . v 
/ /  F i l e  : 
/ /  D a t e : 
27−Nov−05 
/ /  A u t h o r  :  I  .  Chuang 
/ / 
/ /  E x amp l e  f o r  MIT  6 . 1 1 1  l a b k i t  s h o w i n g  how  t o  p r e p a r e  NTSC  d a t a 
/ /  ( f r om  J a v i e r  ’ s  d e c o d e r )  t o  b e  l o a d e d 
i n t o  t h e  ZBT RAM  f o r  v i d e o 
/ /  d i s p l a y . 
/ / 
/ / M o d i f i e d  s o  t h a t  2  s e t s  o f  1 8  b i t  d a t a  c o r r e s p o n d i n g  t o  2  p i x e l s 
/ /  a r e  w r i t t e n  d u r i n g  e a c h  w r i t e 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  P r e p a r e  d a t a  and  a d d r e s s  v a l u e s  t o 
f i l l  ZBT  memory  w i t h  NTSC  d a t a 

m o d u l e  n t s c  t o  z b t ( c l k ,  v c l k ,  f v h ,  dv ,  d i n ,  n t s c  a d d r  ,  n t s c  d a t a  ,  n t s c  w e  ) ; 

i n p u t 
i n p u t 
i n p u t 
i n p u t 
i n p u t 

[ 2 : 0 ] 

[ 2 9 : 0 ] 

c l k  ; 
v c l k  ; 
f v h ;

dv ;

d i n ;


/ /  s y s t e m  c l o c k

/ /  v i d e o  c l o c k  f r om  c am e r a


o u t p u t 
o u t p u t 
o u t p u t 

[ 1 8 : 0 ]  n t s c
 a d d r  ;

[ 3 5 : 0 ]  n t s c
 d a t a  ; 
n t s c  w e  ; 

/ /  w r i t e  e n a b l e  f o r  NTSC  d a t a 

p a r a m e t e r 
p a r a m e t e r 

COL START  =  1 0 ’ d0 ; 
ROW START  =  1 0 ’ d0 ; 

/ /  h e r e  p u t  t h e  l u m i n a n c e  d a t a  f r om  t h e  n t s c  d e c o d e r 
/ /  t h i s 
i s 
f o r  1 0 2 4  x  7 6 8  XGA  d i s p l a y 

i n t o  t h e  ram 

[ 9 : 0 ] 
[ 9 : 0 ] 
[ 1 7 : 0 ] 

r e g 
r e g 
r e g 
r e g 
r e g 
r e g 
r e g 
r e g 

w i r e 
w i r e 
w i r e 

c o l  =  0 ; 
r ow  =  0 ; 
v d a t a  =  0 ; 
vwe ; 
o l d  d v  ; 
o l d  f r a m e  ; 
o l d  v  ; 
e v e n  o d d ; 

/ /  f r a m e s  a r e  e v e n  /  odd  i n t e r l a c e d 

/ /  d e c o d e 

i n t e r l a c e d  f r a m e  t o  t h i s  w i r e 

f r a m e  =  f v h [ 2 ] ; 
f r a m e  e d g e  =  f r a m e  &  ˜ o l d  f r a m e  ; 
v  e d g e  =  ! f v h [ 2 ]  &  ! f v h [ 1 ]  &  o l d  v 

; 

a l w a y s  @  ( p o s e d g e  v c l k )  / / LLC1  i s  r e f e r e n c e 
b e g i n 
o l d  d v  <=  dv ; 
vwe  <=  dv  & &  ! f v h [ 2 ]  &  ˜ o l d  d v ;  / / 
o l d  f r a m e  <=  f r a m e ; 

i f  d a t a  v a l i d  ,  w r i t e 

i t 

22 

o l d  v  =  f v h [ 1 ] ;

e v e n  o d d  =  f r a m e  e d g e  ?  ˜ e v e n  o d d 

:  e v e n  o d d ;


i f  ( ! f v h [ 2 ] ) 
b e g i n 
c o l  <=  f v h [ 0 ]  ?  COL START  : 
( ! f v h [ 2 ]  & &  dv  &&  ( c o l  <  6 4 0+COL START ) )  ?  c o l  +  1  :  c o l ; 
r ow  <= v  e d g e  ?  ROW START  : 
( ! f v h [ 2 ]  & &  f v h [ 0 ]  & &  ( r ow  <  4 8 0+ROW START ) )  ?  r ow  +  1  :  r ow ; 
v d a t a  <=  ( dv  & &  ! f v h [ 2 ] )  ?  { d i n [ 2 9 : 2 2 ]  , d i n [ 1 9 : 1 5 ]  , d i n [ 9 : 5 ] } 
:  v d a t a ; 

e n d


e n d


/ /  s y n c h r o n i z e  w i t h  s y s t e m  c l o c k 

r e g 
r e g 
r e g 
r e g 
r e g 

[ 9 : 0 ]  x [ 1 : 0 ] ; 
[ 9 : 0 ]  y [ 1 : 0 ] ; 
[ 1 7 : 0 ]  d a t a [ 1 : 0 ] ; 
we [ 1 : 0 ] ; 
e o [ 1 : 0 ] ; 

a l w a y s  @( p o s e d g e  c l k ) 
b e g i n

{ x [ 1 ]  , x [ 0 ] }  < =  { x [ 0 ]  ,  c o l } ;

{ y [ 1 ]  , y [ 0 ] }  < =  { y [ 0 ]  , r ow } ;

{ d a t a [ 1 ]  , d a t a [ 0 ] }  < =  { d a t a [ 0 ]  , v d a t a } ;

{we [ 1 ]  , we [ 0 ] }  < =  { we [ 0 ]  , vwe } ;

{ e o [ 1 ]  , e o [ 0 ] }  < =  { e o [ 0 ] , e v e n  o d d } ;

e n d 

/ /  e d g e  d e t e c t i o n  on  w r i t e  e n a b l e  s i g n a l 

r e g  o l d  w e ; 
w i r e  w e  e d g e  =  we [ 1 ]  &  ˜ o l d  w e ; 
a l w a y s  @( p o s e d g e  c l k )  o l d  w e  <=  we [ 1 ] ; 

/ /  s h i f t  e a c h  s e t  o f  f o u r  b y t e s 

i n t o  a  l a r g e  r e g i s t e r 

f o r  t h e  ZBT 

r e g 
[ 3 5 : 0 ]  myda ta ; 
a l w a y s  @( p o s e d g e  c l k ) 
i f  ( w e  e d g e ) 
myda ta  <=  {  myda ta [ 1 7 : 0 ] ,  d a t a [ 1 ]  } ; 

/ /  c om p u t e  a d d r e s s  t o  s t o r e  d a t a  i n 

w i r e 

[ 1 8 : 0 ]  myaddr  =  { y [ 1 ] [ 8 : 0 ] , 1  ’ b0 ,  x [ 1 ] [ 9 : 1 ] } ; 

/ /  u p d a t e  t h e  o u t p u t  a d d r e s s  and  d a t a  o n l y  when  f o u r  b y t e s  r e a d y 

r e g 

[ 1 8 : 0 ] 

n t s c  a d d r  ; 

23 

[ 3 5 : 0 ] 

r e g 
w i r e 

n t s c  d a t a  ; 
n t s c  w e  =  w e  e d g e  &  ( x [ 1 ] [ 0 ] = = 1 ’ b0 ) ; 

a l w a y s  @( p o s e d g e  c l k ) 
i f  (  n t s c  w e ) 
b e g i n 
n t s c  a d d r  <=  myaddr ; 
n t s c  d a t a  <=  myda ta ; 
e n d 

e n dm o d u l e  / /  n t s c  t o  z b t 

/ /  n o rm a l  and  e x p a n d e d  mod e s 

24 

f i l e  c o n t a i n s  t h e  n t s c
 d e c o d e  m o d u l e s


/ /

n t s c
 d e c o d e  . v

/ /  F i l e  : 
/ /  D a t e : 
31−Oct−05

/ /  A u t h o r :  J .  C a s t r o  ( MIT  6 . 1 1 1 ,  f a l l  2 0 0 5 )

/ /

/ /  T h i s 
/ /

/ /  T h i s  m o d u l e  ( w/ ADV 7 1 8 5 i n i t ) 
i s  u s e d  t o  g r a b  i n p u t  NTSC  v i d e o  d a t a  f r om  t h e  RCA

/ /  p h o n o  j a c k  on  t h e  r i g h t  hand  s i d e  o f  t h e  6 . 1 1 1  l a b k i t  ( c o n n e c t

/ /  t h e  c am e r a  t o  t h e  LOWER  j a c k  ) .

/ /

/ /  M o d i f i e d  s o  t h a t  v 
l o w  d u r i n g  t h e  e n t i r e  odd  f i e l d

i s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  NTSC  d e c o d e  −  16 − b i t  CCIR656  d e c o d e r

/ /  By  J a v i e r  C a s t r o

/ /  T h i s  m o d u l e  t a k e s  a  s t r e a m  o f  LLC  d a t a  f r om  t h e  a d v 7 1 8 5

/ /  NTSC/PAL  v i d e o  d e c o d e r  and  g e n e r a t e s  t h e  c o r r e s p o n d i n g  p i x e l s  ,

i n  YCrCb  f o r m a t .

/ /  t h a t  a r e  e n c o d e d  w i t h i n  t h e  s t r e a m  , 

/ /  Make  s u r e  t h a t  t h e  a d v 7 1 8 5 

i s  s e t  t o  r u n  i n  1 6 − b i t  LLC2  mode . 

m o d u l e  n t s c  d e c o d e ( c l k  ,  r e s e t  ,  t v  i n  y c r c b  ,  y c r c b  ,  f  ,  v ,  h ,  d a t a  v a l i d  ) ; 

/ /  c l k  − 
l i n e − l o c k e d  c l o c k  ( i n  t h i s  c a s e  ,  LLC1  w h i c h  r u n s  a t  2 7Mhz )

/ /  r e s e t  −  s y s t e m  r e s e t

i n  y c r c b  −  10 − b i t 
i n p u t  f r om  c h i p  .  s h o u l d  map  t o  p i n s 
/ /  t v

/ /  y c r c b  −  2 4  b i t 
l u m i n a n c e  and  c h r o m i n a n c e  ( 8  b i t s  e a c h )

/ /  f  − 
f i e l d  :  1 
i n d i c a t e s  an  e v e n  f i e l d  ,  0  an  odd  f i e l d

/ /  v  −  v e r t i c a l  s y n c  :  1  m ean s  v e r t i c a l  s y n c

/ /  h  −  h o r i z o n t a l  s y n c  :  1  m ean s  h o r i z o n t a l  s y n c


[ 1 9 : 1 0 ]


i n p u t  −  s h o u l d  b e  P [ 1 9 : 1 0 ]


i n p u t  c l k  ;

i n p u t  r e s e t  ;

i n p u t 
[ 9 : 0 ]  t v

i n  y c r c b  ;  / /  m o d i f i e d  f o r  1 0  b i t 
[ 2 9 : 0 ]  y c r c b ;

o u t p u t 
f  ;

o u t p u t 
v ;

o u t p u t 
o u t p u t 
h ;

d a t a
 v a l i d ;

o u t p u t 
/ /  o u t p u t 
[ 4 : 0 ]  s t a t e ;


p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

SYNC  1  =  0 ;

SYNC  2  =  1 ;

SYNC  3  =  2 ;

S A V  f 1  c b 0  =  3 ;

S A V  f 1  y 0  =  4 ;

S A V
 f 1  c r 1  = 5 ;

S A V  f 1  y 1  =  6 ;

EAV  f1  =  7 ;

SAV  VB I  f 1  =  8 ;


25 

p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

EAV  VB I  f1  =  9 ; 
S A V  f 2  c b 0  =  1 0 ; 
S A V  f 2  y 0  =  1 1 ; 
S A V  f 2  c r 1  = 1 2 ; 
S A V  f 2  y 1  =  1 3 ; 
EAV  f2  =  1 4 ; 
SAV  VB I  f 2  =  1 5 ; 
EAV  VB I  f2  =  1 6 ; 

/ /  I n  t h e  s t a r t  s t a t e  ,  t h e  m o d u l e  d o e s n  ’ t  know  w h e r e 
/ /  i n  t h e  s e q u e n c e  o f  p i x e l s  , 
i t 
i s 
l o o k i n g  . 

/ /  Once  we  d e t e r m i n e  w h e r e  t o  s t a r t  ,  t h e  FSM  g o e s  t h r o u g h  a  n o rm a l 
/ /  s e q u e n c e  o f  SAV  p r o c e s s  Y C r C b  EAV . . .  r e p e a t 

/ /  The  d a t a  s t r e a m  l o o k s  a s  f o l l o w s 
/ /  SAV  FF | SAV  00 | SAV  00 | SAV XY  | Cb0 | Y0 | C r 1 | Y1 | Cb2 | Y  | . . . | EAV  s e q u e n c e 
/ /  T h e r e  a r e  two  t h i n g s  we  n e e d  t o  do : 
/ / 
1 .  F i n d  t h e  two  SAV  b l o c k s  ( s t a n d s  f o r  S t a r t  A c t i v e  V i d e o  p e r h a p s ? ) 
2 .  D e c o d e  t h e  s u b s e q u e n t  d a t a 
/ / 

r e g 
r e g 
r e g 
r e g 

[ 4 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 

c u r r e n t  s t a t e  =  5 ’ h 0 0 ; 
y  =  1 0 ’ h 0 0 0 ; 
/ /  l u m i n a n c e 
c r  =  1 0 ’ h 0 0 0 ;  / /  c h r o m i n a n c e 
c b  =  1 0 ’ h 0 0 0 ;  / /  mo r e  c h r o m i n a n c e 

a s s i g n 

s t a t e  =  c u r r e n t  s t a t e  ; 

a l w a y s  @  ( p o s e d g e  c l k ) 
b e g i n 
i f  ( r e s e t ) 
b e g i n 

e n d 
e l s e 
b e g i n 
/ /  t h e s e  s t a t e s  don ’ t  do  much  e x c e p t  a l l o w  u s  t o  know  w h e r e  we  a r e 
i n  t h e  s t r e a m . 
/ /  w h e n e v e r  t h e  s y n c h r o n i z a t i o n  c o d e 
i s  s e e n  ,  g o  b a c k  t o  t h e  s y n c  s t a t e  b e f o r e 
/ /  t r a n s i t i o n i n g  t o  t h e  new  s t a t e 
c a s e  ( c u r r e n t  s t a t e ) 
SYNC  1 :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 0 0 0 )  ?  SYNC  2  :  SYNC  1 ; 
SYNC  2 :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 0 0 0 )  ?  SYNC  3  :  SYNC  1 ; 
SYNC  3 :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 2 0 0 )  ?  S A V  f 1  c b 0 
: 
( t v  i n  y c r c b  ==  1 0 ’ h 2 7 4 )  ?  EAV  f1  : 
( t v  i n  y c r c b  ==  1 0 ’ h 2 a c )  ?  SAV  VB I  f 1  : 
( t v  i n  y c r c b  ==  1 0 ’ h 2 d 8 )  ?  EAV  VB I  f1  : 
( t v  i n  y c r c b  ==  1 0 ’ h 3 1 c )  ?  S A V  f 2  c b 0 
: 
( t v  i n  y c r c b  ==  1 0 ’ h 3 6 8 )  ?  EAV  f2  : 

26 

( t v  i n  y c r c b  ==  1 0 ’ h 3 b 0 )  ?  SAV  VB I  f 2  : 
( t v  i n  y c r c b  ==  1 0 ’ h 3 c 4 )	 ?  EAV  VB I  f2  :  SYNC  1 ; 

S A V  f 1  c b 0  :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f  )  ?  SYNC  1  :  S A V  f 1  y 0 ; 
S A V  f 1  y 0 :  c u r r e n t  s t a t e  <= ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f )  ?  SYNC  1  :  S A V  f 1  c r 1 ; 
S A V  f 1  c r 1  :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f  )  ?  SYNC  1  :  S A V  f 1  y 1 ; 
S A V  f 1  y 1 :  c u r r e n t  s t a t e  <= ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f )  ?  SYNC  1  :  S A V  f 1  c b 0 ; 

S A V  f 2  c b 0  :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f  )  ?  SYNC  1  :  S A V  f 2  y 0 ; 
S A V  f 2  y 0 :  c u r r e n t  s t a t e  <= ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f )  ?  SYNC  1  :  S A V  f 2  c r 1 ; 
S A V  f 2  c r 1  :  c u r r e n t  s t a t e  <=  ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f  )  ?  SYNC  1  :  S A V  f 2  y 1 ; 
S A V  f 2  y 1 :  c u r r e n t  s t a t e  <= ( t v  i n  y c r c b  ==  1 0 ’ h 3 f f )  ?  SYNC  1  :  S A V  f 2  c b 0 ; 

/ /  T h e s e  s t a t e s  a r e  h e r e 
i n  t h e  e v e n t  t h a t  we  wan t  t o  c o v e r  t h e s e  s i g n a l s 
/ /  i n  t h e  f u t u r e  .  F o r  now ,  t h e y  j u s t  s e n d  t h e  s t a t e  m a c h i n e  b a c k  t o  SYNC  1 
EAV  f1 :  c u r r e n t  s t a t e  <=  SYNC  1 ;

SAV  VB I  f 1 :  c u r r e n t
 s t a t e  <=  SYNC  1 ;

EAV  VB I  f1 :  c u r r e n t
 s t a t e  <=  SYNC  1 ;

EAV  f2 :  c u r r e n t
 s t a t e  <=  SYNC  1 ;

SAV  VB I  f 2 :  c u r r e n t
 s t a t e  <=  SYNC  1 ;

EAV  VB I  f2 :  c u r r e n t
 s t a t e  <=  SYNC  1 ; 

e n d c a s e


e n d

e n d  / /  a l w a y s  @  ( p o s e d g e  c l k )


/ /  i m p l e m e n t  o u r  d e c o d i n g  m e c h a n i sm 

w i r e  y  e n a b l e  ; 
w i r e  c r  e n a b l e  ; 
w i r e  c b  e n a b l e  ; 

i s  c om i n g	
/ /  i f  y 
i n  ,  e n a b l e  t h e  r e g i s t e r 
/ /  l i k e w i s e 
f o r  c r  and  c b 
a s s i g n  y  e n a b l e  =	 ( c u r r e n t  s t a t e  ==  S A V  f 1  y 0  )  | | 
( c u r r e n t  s t a t e  ==  S A V  f 1  y 1  )  | |

( c u r r e n t
 s t a t e  ==  S A V  f 2  y 0  )  | |

( c u r r e n t
 s t a t e  ==  S A V  f 2  y 1 ) ; 
a s s i g n  c r  e n a b l e  =  ( c u r r e n t  s t a t e  ==  S A V  f 1  c r 1  )  | | 
( c u r r e n t  s t a t e  ==  S A V  f 2  c r 1 ) ; 
a s s i g n  c b  e n a b l e  =  ( c u r r e n t  s t a t e  ==  S A V  f 1  c b 0  )  | | 
( c u r r e n t  s t a t e  ==  S A V  f 2  c b 0 ) ; 

/ /  f  ,  v ,  and  h  o n l y  g o  h i g h  when  a c t i v e

a s s i g n  { v , h }  =  ( c u r r e n t  s t a t e  ==  SYNC  3 )  ?  t v  i n  y c r c b [ 7 : 6 ]  :  2 ’ b 0 0 ;


i s  v a l i d  when  we  h a v e  a l l  t h r e e  v a l u e s :  y ,  c r ,  c b 
/ /  d a t a 
a s s i g n  d a t a  v a l i d  =  y  e n a b l e  ; 
a s s i g n  y c r c b  =  { y , c r  , c b } ; 

r e g 

f  = 0 ; 

27 

a l w a y s  @  ( p o s e d g e  c l k )

b e g i n

y  <= y
 e n a b l e  ?  t v  i n  y c r c b 
:  y ;

c r  <=  c r
 e n a b l e  ?  t v  i n  y c r c b 
:  c r ;

c b  <=  c b
 e n a b l e  ?  t v  i n  y c r c b 
:  c b ; 
f  <= ( c u r r e n t  s t a t e  ==  SYNC  3 )  ?  t v  i n  y c r c b [ 8 ]  : 
e n d 

f ; 

e n dm o d u l e 

28 

/ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ 
∗ ∗ 
∗ ∗  Modu l e :  y c r c b 2 r g b 
∗ ∗ 
∗  C o n v e r t  y c r c b  t o  r g b  c o l o r  s p a c e 
∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ / 

m o d u l e  YCrCb2RGB  (  R ,  G ,  B ,  c l k  ,  r s t  ,  Y ,  Cr ,  Cb  ) ; 

o u t p u t 

[ 7 : 0 ]  R ,  G ,  B ; 

i n p u t 
i n p u t 

[ 9 : 0 ] 

c l k  ,  r s t  ;

Y ,  Cr ,  Cb ;


w i r e 
r e g 
r e g 
r e g 

[ 7 : 0 ] 
[ 2 0 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 

R , G , B ;

R
 i n t , G  i n t , B  i n t , X  i n t , A  i n t , B 1  i n t , B 2  i n t , C  i n t ;

c o n s t 1  , c o n s t 2  , c o n s t 3  , c o n s t 4  , c o n s t 5 ;

Y  r e g  ,  C r
 r e g ,  C b  r e g ; 

/ / r e g i s t e r i n g  c o n s t a n t s

a l w a y s  @  ( p o s e d g e  c l k )

b e g i n

c o n s t 1  =  1 0 ’ b  0 1 0 0 1 0 1 0 1 0 ;  / / 1 . 1 6 4  =  0 1 . 0 0 1 0 1 0 1 0

c o n s t 2  =  1 0 ’ b  0 1 1 0 0 1 1 0 0 0 ;  / / 1 . 5 9 6  =  0 1 . 1 0 0 1 1 0 0 0

c o n s t 3  =  1 0 ’ b  0 0 1 1 0 1 0 0 0 0 ;  / / 0 . 8 1 3  =  0 0 . 1 1 0 1 0 0 0 0

c o n s t 4  =  1 0 ’ b  0 0 0 1 1 0 0 1 0 0 ;  / / 0 . 3 9 2  =  0 0 . 0 1 1 0 0 1 0 0

c o n s t 5  =  1 0 ’ b  1 0 0 0 0 0 0 1 0 0 ;  / / 2 . 0 1 7  =  1 0 . 0 0 0 0 0 1 0 0

e n d 

a l w a y s  @  ( p o s e d g e  c l k  o r  p o s e d g e  r s t )

i f  ( r s t )

b e g i n

Y  r e g  < =  0 ;  C r  r e g  < =  0 ;  C b  r e g  <=  0 ;


e n d

e l s e

b e g i n

Y  r e g  <= Y ;  C r
 r e g  <=  Cr ;  C b  r e g  <=  Cb ;


e n d


a l w a y s  @  ( p o s e d g e  c l k  o r  p o s e d g e  r s t ) 
i f  ( r s t ) 
b e g i n 
A  i n t  < =  0 ;  B 1  i n t  < =  0 ;  B 2  i n t  < =  0 ;  C  i n t  < =  0 ;  X  i n t  <=  0 ; 
e n d 
e l s e 
b e g i n

X  i n t  <=  ( c o n s t 1  ∗  ( Y  r e g  − 
A

i n t  <=  ( c o n s t 2  ∗  ( C r  r e g  − 
B 1  i n t  <=  ( c o n s t 3  ∗  ( C r
 r e g  − 
B 2

i n t  <=  ( c o n s t 4  ∗  ( C b  r e g  − 
C  i n t  <=  ( c o n s t 5  ∗  ( C b  r e g  − 

’ d 6 4 ) )  ;

’ d 5 1 2 ) ) ;

’ d 5 1 2 ) ) ;

’ d 5 1 2 ) ) ;

’ d 5 1 2 ) ) ;


29 

e n d 

a l w a y s  @  ( p o s e d g e  c l k  o r  p o s e d g e  r s t )

i f  ( r s t )

b e g i n

R  i n t  < =  0 ;  G  i n t  < =  0 ;  B  i n t  <=  0 ;


e n d

e l s e

b e g i n

R

G

B


e n d


i n t  <= X  i n t  + A  i n t ;

i n t  <= X  i n t  −  B 1  i n t  −  B 2  i n t ;

i n t  <= X  i n t  + C  i n t ;


/ ∗ 
l i m i t  o u t p u t  t o  0  −  4 0 9 5 ,  < 0  e q u a l s  0  and  > 4 0 9 5  e q u a l s  4 0 9 5  ∗ /

a s s i g n  R  =  ( R  i n t [ 2 0 ] )  ?  0  :  ( R  i n t [ 1 9 : 1 8 ]  = =  2 ’ b0 )  ?  R  i n t [ 1 7 : 1 0 ]  :  8 ’ b 1 1 1 1 1 1 1 1 ;

i n t [ 1 7 : 1 0 ]  :  8 ’ b 1 1 1 1 1 1 1 1 ;

a s s i g n  G  =  ( G  i n t [ 2 0 ] )  ?  0  :  ( G  i n t [ 1 9 : 1 8 ]  = =  2 ’ b0 )  ?  G

a s s i g n  B  =  ( B  i n t [ 2 0 ] )  ?  0  :  ( B  i n t [ 1 9 : 1 8 ]  = =  2 ’ b0 )  ?  B

i n t [ 1 7 : 1 0 ]  :  8 ’ b 1 1 1 1 1 1 1 1 ; 

e n dm o d u l e 

30 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
l i n e 
/ /  p a r a m e t e r i z e d  d e l a y 

m o d u l e  d e l a yN ( c l k , i n , o u t ) ; 
i n p u t  c l k  ; 
i n p u t 
i n  ; 
o u t p u t  o u t ; 

p a r a m e t e r  NDELAY  =  3 ; 

[ NDELAY− 1 : 0 ]  s h i f t r e g  ; 
r e g 
w i r e 
o u t  =  s h i f t r e g  [NDELAY− 1 ] ; 

a l w a y s  @( p o s e d g e  c l k )

s h i f t r e g  <=  { s h i f t r e g  [NDELAY− 2 : 0 ] , i n } ;


e n dm o d u l e  / /  d e l a yN 

31 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  g e n e r a t e  d i s p l a y  p i x e l s  f r om  r e a d i n g  t h e  ZBT  ram

/ /  E a ch  d a t a  h a s  2  1 8  b i t  p a c k a g e  c o r r e s p o n d i n g  t o  2  p i x e l s  .


m o d u l e  v r a m
 d i s p l a y ( r e s e t , c l k , h c o u n t , v c o u n t , v r  p i x e l , 
v r am  a d d r  , v r a m  r e a d  d a t a ) ; 

i n p u t  r e s e t  ,  c l k  ;

i n p u t 
[ 9 : 0 ]  h c o u n t ;

[ 9 : 0 ]  v c o u n t ;

i n p u t 
[ 1 7 : 0 ]  v r
 p i x e l  ;

o u t p u t 
[ 1 8 : 0 ]  v r a m
 a d d r ;

o u t p u t 
i n p u t 
[ 3 5 : 0 ] 
v r a m
 r e a d  d a t a ; 

w i r e 
w i r e 
w i r e 

[ 9 : 0 ] 
[ 9 : 0 ] 
[ 1 8 : 0 ] 

v s h i f t  =  v c o u n t  +  2 1 ;

h s h i f t  =  h c o u n t  +  1 4 ;

v r a m  a d d r  =  { v s h i f t  [ 9 : 1 ]  , 1  ’ b0 ,  h s h i f t  [ 9 : 1 ] } ;


w i r e 
r e g 
r e g 
r e g 

[ 1 7 : 0 ] 
[ 3 5 : 0 ] 
[ 3 5 : 0 ] 

h c 4  =  h c o u n t [ 0 ] ;

v r
 p i x e l  ;

v r
 d a t a  l a t c h e d ;

l a s t
 v r  d a t a  ; 

a l w a y s  @( p o s e d g e  c l k )

b e g i n

v r
 d a t a  l a t c h e d  <=  ( h c 4 )  ?  v r a m  r e a d  d a t a 
: 
l a s t  v r  d a t a  <=  ( h c 4 )  ?  v r  d a t a  l a t c h e d 

:  v r  d a t a  l a t c h e d ; 
l a s t  v r  d a t a  ;


e n d


a l w a y s  @ ( ∗  )

b e g i n

c a s e  ( h c 4 )

:  v r
 p i x e l  <=  l a s t  v r  d a t a  [ 1 7 : 0 ] ;

1 ’ d1 
1 ’ d0 
:  v r
 p i x e l  <=  l a s t  v r  d a t a  [ 3 5 : 1 8 ] ; 
e n d c a s e 
e n d 
e n dm o d u l e  / /  v r a m  d i s p l a y 

32 

f o r  two 
/ / m o d u l e  s e a r c h e s 
/ / t h e s e  two  c l um p s  s h o u l d 

c l um p s  o f  b r i g h t 
c o r r e s p o n d  t o  t h e 

l i g h t s 
l e f t  and  r i g h t  h a n d s  o f  t h e  u s e r 

h c o u n t  ,  v a l i d c o l o r  ,  v c e n l  ,  h c e n l  ,  v c e n r  ,  h c e n r  ) ; 

m o d u l e  f i n d l i g h t s ( c l k  ,  r e s e t  ,  v c o u n t  , 
i n p u t  c l k  ,  r e s e t  ; 
[ 9 : 0 ]  v c o u n t  ,  h c o u n t ; 
i n p u t 
i n p u t 
v a l i d c o l o r  ; 
[ 9 : 0 ]  v c e n l  ,  h c e n l ; 
o u t p u t 
o u t p u t 
[ 9 : 0 ]  v c e n r  ,  h c e n r  ; 

r e g 
r e g 

[ 9 : 0 ] 
[ 9 : 0 ] 

v c e n l  , 
v c e n r  , 

h c e n l ; 
h c e n r  ; 

r e g 
r e g 
r e g 

w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 

w i r e 

r e g 
r e g 
r e g 

w i r e 
w i r e 
w i r e 
w i r e 
w i r e 

[ 9 : 0 ] 
[ 9 : 0 ] 

v c e n 1  ,  h c e n 1 ; 
vup1 , vdown1 , h l e f t 1  , h r i g h t 1 ; 
o n e v a l i d ; 

vup1 ; 
up1  =  v c o u n t  < 
>  vdown1 ; 
down1  =  v c o u n t 
<  h l e f t 1  ; 
l e f t 1  =  h c o u n t 
h c o u n t 
r i g h t 1  = 
>  h r i g h t 1 ; 
v d i s t 1  = 
vdown1  −  vup1 ; 
h r i g h t 1  −  h l e f t 1  ; 
h d i s t 1  = 
=  vup1  +  { 0 , v d i s t 1  [ 9 : 1 ] } ; 
t em p v c e n 1 
=  h l e f t 1  +  { 0 , h d i s t 1  [ 9 : 1 ] } ; 
t em p h c e n 1 
=  ( h c o u n t>=t em p h c e n 1 )  ? 
t e m p d i s t 1 
( h c o u n t  −  t em p h c e n 1 )  :  ( t em p h c e n 1  −  h c o u n t ) ; 
c a n t b e o n e  =  ( ( t e m p d i s t 1  > = 1 0 )  | |  ( ( v c o u n t  −  t em p v c e n 1 ) > = 1 0 ) ) ; 

[ 9 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 

[ 9 : 0 ] 
[ 9 : 0 ] 

v c e n 2  ,  h c e n 2 ;

vup2 , vdown2 , h l e f t 2  , h r i g h t 2 ;

t w o v a l i d ;


up2  = 
v c o u n t  <  vup2 ; 
=  v c o u n t  >  vdown2 ; 
down2 
=  h c o u n t  <  h l e f t 2  ; 
l e f t 2 
h c o u n t  >  h r i g h t 2 ; 
= 
r i g h t 2 
= 
v d i s t 2 
vdown2  −  vup2 ; 

[ 9 : 0 ] 

w i r e 
w i r e 
w i r e 
w i r e 

[ 9 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 
[ 9 : 0 ] 

w i r e 

h r i g h t 2  −  h l e f t 2  ; 
h d i s t 2 
= 
=  vup2  +  { 0 , v d i s t 2  [ 9 : 1 ] } ; 
t em p v c e n 2 
=  h l e f t 2  +  { 0 , h d i s t 2  [ 9 : 1 ] } ; 
t em p h c e n 2 
=  ( h c o u n t>=t em p h c e n 2 )  ? 
t e m p d i s t 2 
( h c o u n t  −  t em p h c e n 2 )  :  ( t em p h c e n 2  −  h c o u n t ) ; 
c a n t b e t w o  =  ( ( t e m p d i s t 2  > = 1 0 )  | |  ( ( v c o u n t  −  t em p v c e n 2 ) > = 1 0 ) ) ; 

r e g 

[ 5 : 0 ] 

v a l i d h i s t ; 

w i r e 

v a l i d p i x e l  =  ( ( ( h c o u n t > 9 )  &&  ( h c o u n t < 6 2 8 ) )  && 
( ( v c o u n t >= 2 0 0 )  &&  ( v c o u n t < = 4 7 9 ) ) ) ; 

33 

w i r e 

w i r e 

n e w f r am e  =  ( ( v c o u n t == 5 2 4 )  &&  ( h c o u n t == 7 9 9 ) ) ; 

o n e i s l e f t  =  ( t em p h c e n 1  <  t em p h c e n 2 ) ; 

a l w a y s  @  ( p o s e d g e  c l k ) 
b e g i n 
i f  ( r e s e t ) 
b e g i n

v c e n 1  <=  0 ;

h c e n 1  <=  0 ;

vup1  <=  1 0 ’ d 4 7 9 ;

vdown1  <=  1 0 ’ d0 ;

h l e f t 1  <=  1 0 ’ d 6 3 9 ;

h r i g h t 1  <=  1 0 ’ d0 ;

o n e v a l i d  <=  0 ; 

v c e n 2  <=  0 ;

h c e n 2  <=  0 ;

vup2  <=  1 0 ’ d 4 7 9 ;

vdown2  <=  1 0 ’ d0 ;

h l e f t 2  <=  1 0 ’ d 6 3 9 ;

h r i g h t 2  <=  1 0 ’ d0 ;

t w o v a l i d  <=  0 ;


v a l i d h i s t  <=  4 ’ d0 ;


e n d

e l s e

b e g i n 
v a l i d h i s t  <=  { v a l i d h i s t [ 4 : 0 ]  ,  v a l i d c o l o r  } ; 
i f  ( & ( v a l i d h i s t )  &  v a l i d p i x e l )  b e g i n 
( ! o n e v a l i d )  b e g i n 
i f	
o n e v a l i d  <=  1 ;

:  vup1 ;

vup1  <=  up1  ?  v c o u n t 
vdown1  <=  down1  ?  v c o u n t 
:  vdown1 ;

h l e f t 1  <=  l e f t 1  ?  h c o u n t − 4  :  h l e f t 1  ;

h r i g h t 1  <=  r i g h t 1  ?  h c o u n t − 4  :  h r i g h t 1 ;


e n d

e l s e  b e g i n

i f  ( c a n t b e o n e  )  b e g i n

( !  t w o v a l i d 
|  ( t w o v a l i d  &  ! c a n t b e t w o ) )  b e g i n 
i f	
t w o v a l i d  <=  1 ; 
vup2  <=  up2  ?  v c o u n t 
:  vup2 ; 
vdown2  <=  down2  ?  v c o u n t 
:  vdown2 ; 
h l e f t 2  <=  l e f t 2  ?  h c o u n t − 4  :  h l e f t 2  ; 
h r i g h t 2  <=  r i g h t 2  ?  h c o u n t − 4  :  h r i g h t 2 ; 

e n d


e n d

e l s e  b e g i n

o n e v a l i d  <=  1 ;

:  vup1 ;

vup1  <=  up1  ?  v c o u n t 
vdown1  <=  down1  ?  v c o u n t 
:  vdown1 ;


34 

h l e f t 1  <=  l e f t 1  ?  h c o u n t − 4  :  h l e f t 1  ; 
h r i g h t 1  <=  r i g h t 1  ?  h c o u n t − 4  :  h r i g h t 1 ; 
e n d 
e n d 
e n d 

i f  ( n e w f r am e )  b e g i n

v c e n 1  <=  0 ;

h c e n 1  <=  0 ;

vup1  <=  1 0 ’ d 4 7 9 ;

vdown1  <=  1 0 ’ d0 ;

h l e f t 1  <=  1 0 ’ d 6 3 9 ;

h r i g h t 1  <=  1 0 ’ d0 ;

o n e v a l i d  <=  0 ; 

v c e n 2  <=  0 ;

h c e n 2  <=  0 ;

vup2  <=  1 0 ’ d 4 7 9 ;

vdown2  <=  1 0 ’ d0 ;

h l e f t 2  <=  1 0 ’ d 6 3 9 ;

h r i g h t 2  <=  1 0 ’ d0 ;

t w o v a l i d  <= 0 ;


v a l i d h i s t  <=  4 ’ d0 ; 

v c e n l  <= 
h c e n l  <= 

v c e n r  <= 
h c e n r  <= 

:  t em p v c e n 2 ; 
o n e i s l e f t  ?  t em p v c e n 1 
o n e i s l e f t  ?  t em p h c e n 1  :  t em p h c e n 2 ; 

o n e i s l e f t  ?  t em p v c e n 2 
:  t em p v c e n 1 ; 
o n e i s l e f t  ?  t em p h c e n 2  :  t em p h c e n 1 ; 

e n d 
e n d 

e n d 
e n dm o d u l e 

35 

/ / p a s s e s  t h e  x  v a l u e  o f  t h e  hand  p o s i t i o n s 
/ / and  p a s s e s  c om p u t e s  a  b i n a r y  up / down  y  p o s i t i o n 

m o d u l e  s e n d g l o v e h e i g h t ( g l i  x  ,  g l i  y  ,  g r i  x  ,  g r i  y  ,  g l o  x  ,  g l o  y  ,  g r o  x  ,  g r o  y  ) ; 
i n p u t 
[ 9 : 0 ]  g l i  x  ,  g l i  y  ,  g r i  x  ,  g r i  y ;

[ 9 : 0 ]  g l o
 x  ,  g r o  x ;

o u t p u t 
o u t p u t 
g l o
 y  ,  g r o  y ;


[ 9 : 0 ] 

w i r e 
w i r e 

g l o
 x  ,  g r o  x ;

g l o
 y  ,  g r o  y ;


p a r a m e t e r  UPDOWNBOUNDARY  =  1 0 ’ d 3 5 0 ;


a s s i g n 
a s s i g n 

a s s i g n 
a s s i g n 

e n dm o d u l e 

g l o
 x  =  g l i  x ;

g r o
 x  =  g r i  x ;


g l o
 y  =  ( g l i  y <UPDOWNBOUNDARY ) ;

g r o
 y  =  ( g r i  y <UPDOWNBOUNDARY ) ; 

36 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  E n g i n e e r :  Uzoma  A .  O r j i

/ /  D e s c r i p t i o n  :  C o u n t e r  t a k e s  an  i n p u t  c l o c k  and  s e n d  a  p u l s e  on  e n d c o u n t

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


m o d u l e  c o u n t e r ( c l k  , r e s e t  , e n a b l e ) ; 
i n p u t  c l k  ,  r e s e t  ; 
o u t p u t  e n a b l e ; 

r e g 
r e g 

e n a b l e ;

[ 2 5 : 0 ]  c o u n t ;


p a r a m e t e r 

e n d c o u n t  =  3 3 7 4 9 9 9 ; 

a l w a y s  @  ( p o s e d g e  c l k )

b e g i n

i f	

(  r e s e t  )  b e g i n

c o u n t  <=  2 6 ’ d0 ;

e n a b l e <=1 ’b0 ;

e n d 
i f  ( c o u n t==e n d c o u n t )  b e g i n

e l s e 
c o u n t <=26 ’d0 ;

e n a b l e <=1 ’b1 ;

e n d 
e l s e  b e g i n

c o u n t<=c o u n t + 1 ;

e n a b l e <=1 ’b0 ;

e n d 
e n d 
e n dm o d u l e 

37 

/ / c o n t r o l l e r  t h a t 

i n p u t s  t h e  s e r i a l  d a t a  f r om  t h e  ADC  and  c om p u t e s  t h e  8 b i t  s i g n a l 

m o d u l e  s e r i a l 2 p a r a l l e l ( c l k ,  p c l k ,  r e s e t ,  d a t a i n ,  RFS ,  CONVST,  d a t a o u t ,  v a l i d ) ; 
i n p u t  c l k  ,  p c l k  ; 
i n p u t  r e s e t  ; 
i n p u t  d a t a i n ; 
i n p u t  RFS ; 
i n p u t  CONVST ; 
o u t p u t 
[ 7 : 0 ]  d a t a o u t ; 
v a l i d  ; 
o u t p u t 

r e g 
[ 1 : 0 ] 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

r e g 
r e g 
r e g 

[ 7 : 0 ] 

s t a t e ;

IDLE  =  0 ;

WAITFORRFS  =  1 ;

GETDATA  =  2 ;

DATAVALID  =  3 ;


v a l i d  ;

o l d s t a t e  ;

d a t a o u t  ,  d a t a t em p ;


a l w a y s  @  ( n e g e d g e  c l k )

b e g i n


i f	

(  r e s e t  )  b e g i n

d a t a t em p  <=  8 ’ b0 ;

s t a t e  <=  IDLE ;


e n d

e l s e  b e g i n

c a s e  (  s t a t e )

IDLE :

i f  ( ! CONVST)

s t a t e  <= WAITFORRFS ;

e l s e

s t a t e  <=  IDLE ;

WAITFORRFS :

( ! RFS )  b e g i n 
i f	
d a t a t em p  <=  { d a t a t em p [ 6 : 0 ]  , d a t a i n } ; 
s t a t e  <= GETDATA ; 

e n d

e l s e

s t a t e  <= WAITFORRFS ;

GETDATA :

i f  ( RFS )  b e g i n

s t a t e  <= DATAVALID ;


e n d

e l s e  b e g i n

d a t a t em p  <=  { d a t a t em p [ 6 : 0 ]  , d a t a i n } ;

s t a t e  <= GETDATA ;


e n d

DATAVALID :


38 

s t a t e  <=  IDLE ;

e n d c a s e


e n d


e n d


a l w a y s  @  ( p o s e d g e  p c l k )

b e g i n

o l d s t a t e  <=  s t a t e  ;

v a l i d  <= 0 ;

i f  ( ( s t a t e  == DATAVALID)  & &  ( o l d s t a t e !=DATAVALID ) )  b e g i n

v a l i d  <=  1 ; 
d a t a o u t <=  d a t a t em p ; 
e n d 
e n d 
e n dm o d u l e 

39 

/ / s e n d p u n c h  a v e r a g e s  f o u r  s a m p l e s  f r om  t h e  ADC  and  c om p u t e s  t h e  maximum  p u n c h  d u r i n g 
i n t e r v a l  .  I t  o u t p u t s  t h e  2 b i t  p u n c h l e v e l 
/ / t h e 

m o d u l e  s e n d p u n c h ( c l k  ,  r e f r e s h  ,  d a t a i n  ,  v a l i d i n  ,  p u n c h l e v e l  ) ; 
i n p u t  c l k  ; 
i n p u t  r e f r e s h  ; 
[ 7 : 0 ]  d a t a i n ; 
i n p u t 
i n p u t 
v a l i d i n  ; 

o u t p u t 

[ 1 : 0 ]  p u n c h l e v e l  ; 

w i r e 

[ 1 : 0 ] 

p u n c h l e v e l  ; 

r e g 
r e g 

[ 7 : 0 ] 
[ 2 : 0 ] 

da tama x ;

num ;


r e g 

[ 9 : 0 ] 

tempsum ; 

r e g 

w i r e 

w i r e 

o l d v a l i d i n  ; 

v a l i d e d g e  =  ( v a l i d i n  &  ! o l d v a l i d i n  ) ; 

u p d a t e  =  ( tempsum [ 9 : 2 ] > da tama x ) ; 

p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

HARDPUNCH  =  8 ’ b 1 1 1 1 1 0 0 0 ;

MEDPUNCH  =  8 ’ b 1 1 1 0 1 1 0 0 ;

SOFTPUNCH  =  8 ’ b 1 1 0 1 0 0 0 0 ;


w i r e 
w i r e 
w i r e 

a s s i g n 

h a r d  =  ( da tama x>=HARDPUNCH) ;

med  =  ( da tama x>=MEDPUNCH) ;

s o f t  =  ( da tama x>=SOFTPUNCH ) ;


p u n c h l e v e l  =	 h a r d  ?  2 ’ b 1 1  :

med  ?  2 ’ b 1 0  :

s o f t  ?  2 ’ b 0 1  :  2 ’ b 0 0 ;


a l w a y s  @  ( n e g e d g e  c l k )

b e g i n


i f	

(  r e f r e s h  )  b e g i n

num  <=  3 ’ b0 ;

da tama x  <=  8 ’ b0 ;

tempsum  <=  1 0 ’ b0 ;


e n d

e l s e  b e g i n

( num==3 ’ b 1 0 0 )  b e g i n

i f	
num  <=  3 ’ b0 ;

da tama x  <=  u p d a t e  ?  tempsum [ 9 : 2 ]  :  da tama x ;

tempsum  <=  1 0 ’ b0 ;


e n d

e l s e 

i f  ( v a l i d e d g e )  b e g i n


40 

num  <=  num  +  1 ; 
tempsum  <=  tempsum  +  d a t a i n ; 
e n d 
e l s e  b e g i n 
num  <=  num ; 
tempsum  <=  tempsum ; 
e n d 
e n d 

e n d 

a l w a y s  @  ( p o s e d g e  c l k ) 
o l d v a l i d i n  <=  v a l i d i n  ; 

e n dm o d u l e 

41 

i n t e r f a c e 
l e v e l  m o d u l e  f o r  t h e  u s e r 
i s  t h e  t o p 
/ / p u n c h d e t e c t o r 
/ / i t  c o n t r o l s  t h e  CONVST  t h a t  s t a r t s  a  c o n v e r s i o n  f o r  t h e  ADC 
/ / i t  a l s o  c o n t r o l s  t h e  r e f r e s h  b i t  t h a t  c l e a r s  t h e  s e n d p u n c h  m o d u l e 
/ /  i t  o u t p u t s  t h e  p o s i t i o n s  o f  t h e  h a n d s  and  t h e  p u n c h l e v e l s 

m o d u l e  p u n c h d e t e c t o r  ( c l o c k  2 7 m h z  ,  p c l k  ,  s c l k  ,  r e s e t  ,  CONVST,  d a t a i n l  ,  RFSl ,  d a t a i n r  ,  RFSr 
,
g l i  x  ,  g l i  y  ,  g r i  x  ,  g r i  y , 
g l o  x  ,  g l o  y  ,  g r o  x  ,  g r o  y  ,  p u n c h l e v e l l  ,  p u n c h l e v e l r  ) ; 

i n p u t  c l o c k  2 7 m h z  ,  p c l k  ,  r e s e t  ;

i n p u t  d a t a i n l  ,  RFS l ;

i n p u t  d a t a i n r  ,  RFSr ;

[ 9 : 0 ]  g l i
 x  ,  g l i  y  ,  g r i  x  ,  g r i  y ; 
i n p u t 

o u t p u t 
o u t p u t 
o u t p u t 
o u t p u t 

s c l k  ,  CONVST ;

[ 9 : 0 ]  g l o
 x  ,  g r o  x ;

g l o
 y  ,  g r o  y ;

[ 1 : 0 ]  p u n c h l e v e l l  ,  p u n c h l e v e l r ;


r e g 
c l k c o u n t ;

[ 3 : 0 ] 
a l w a y s  @  ( p o s e d g e  c l o c k
 2 7 m h z )

c l k c o u n t  <=  c l k c o u n t  +  1 ;


BUFG  p i x e l  c l o c k  b u f  ( . I ( c l k c o u n t [ 2 ] ) ,  . O( s c l k ) ) ;

/ / s c l k 
i s  3 . 3 7 5  MHz


w i r e 
s t a r t p u l s e  ;

c o u n t e r  c o u n t ( s c l k , r e s e t , s t a r t p u l s e ) ;

c o u n t . e n d c o u n t  = 
d e f p a r a m 
w i r e 
CONVST  =  ˜ s t a r t p u l s e ;


9 0 0 ;


[ 7 : 0 ] 

[ 7 : 0 ] 

w i r e 
w i r e 
w i r e 
w i r e 

d a t a o u t l  ;

v a l i d l  ;

d a t a o u t r ;

v a l i d r  ;


s e r i a l 2 p a r a l l e l  s 2 p l ( s c l k ,  p c l k ,  r e s e t  ,  d a t a i n l ,  RFSl ,  CONVST,  d a t a o u t l ,  v a l i d l ) ; 
s e r i a l 2 p a r a l l e l  s 2 p r ( s c l k  ,  p c l k  ,  r e s e t  ,  d a t a i n r  ,  RFSr ,  CONVST,  d a t a o u t r  ,  v a l i d r ) ; 

[ 9 : 0 ] 

w i r e 
w i r e 

g l o  x  ,  g r o  x ;

g l o
 y  ,  g r o  y ; 

s e n d g l o v e h e i g h t  s g h ( g l i  x  ,  g l i  y  ,  g r i  x  ,  g r i  y  ,  g l o  x  ,  g l o  y  ,  g r o  x  ,  g r o  y  ) ; 

w i r e 
r e f r e s h  ;

c o u n t e r  r e f r e s h e r ( p c l k  ,  r e s e t  ,  r e f r e s h  ) ;

d e f p a r a m  r e f r e s h e r . e n d c o u n t  = 
4 2 0 0 0 0 0 ;


w i r e 

[ 1 : 0 ] 

p u n c h l e v e l l  ,  p u n c h l e v e l r ; 

s e n d p u n c h  s p l ( p c l k  ,  r e f r e s h  ,  d a t a o u t l  ,  v a l i d l  ,  p u n c h l e v e l l ) ; 

42 

s e n d p u n c h  s p r ( p c l k  ,  r e f r e s h  ,  d a t a o u t r  ,  v a l i d r  ,  p u n c h l e v e l r ) ; 

e n dm o d u l e 

43


B  Control  Unit  Source  Codes 

c o n t r o l u n i t 

1 3 : 4 5 : 2 9  0 3 / 1 9 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  :  M a j o r  FSM  f o r  Pong  game  t h a t  a l s o  s t o r e s  t h e  b a l l  ’ s  p o s i t i o n 
and  v e l o c i t y  ,  t h e  p a d d l e  ’ s  p o s i t i o n  ,  and  g r a v i t y  w e l l  ’ s  p o s i t i o n  and 
/ / 
/ / 
p u l s e 
i n f o r m a t i o n  . 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e  c o n t r o l u n i t ( c l k  ,  r e s e t  ,  s t a r t  , 
p l x ,  p l y ,  p l p , 
p r x ,  p r y ,  p r p , 

p l a y e r  l  h a n d  x  ,  p l a y e r  l  h a n d  y  ,  p l a y e r  l  h a n d  p u n c h  ,

p l a y e r
 r  h a n d  x  ,  p l a y e r  r  h a n d  y  ,  p l a y e r  r  h a n d  p u n c h  , 

o p p o n e n t  h e a d  x , 
o p p o n e n t  p i c t u r e  , 

p l a y e r  l i f e  ,  o p p o n e n t  l i f e  ,

p l a y e r
 e n e r g y  ,  o p p o n e n t  e n e r g y  ,

t i m e

l e f t  ,  mode ,  r o u n d  ,  g am e  t y p e  ,  s t a t e  , 

i n d e x  i n  , 
e n a b l e  i n  ,

d a t a  i n  , 
i n d e x
 o u t  ,  d a t a  o u t  ,  e n a b l e  o u t

) ;


/ / i n p u t s  and  o u t p u t s 
i n p u t  c l k  ,  r e s e t  ,  s t a r t  ; 
i n p u t  [ 9 : 0 ]  p l x  ,  p r x ; 
i n p u t 
p l y  ,  p r y ; 
i n p u t  [ 1 : 0 ]  p l p  ,  p r p ; 

o u t p u t [ 9 : 0 ]  p l a y e r  l  h a n d  x  ,  p l a y e r  r  h a n d  x ; 
o u t p u t 
p l a y e r  l  h a n d  y  ,  p l a y e r  r  h a n d  y ; 
o u t p u t  [ 1 : 0 ]  p l a y e r  l  h a n d  p u n c h  ,  p l a y e r  r  h a n d  p u n c h  ; 

44 

o u t p u t  [ 9 : 0 ]  o p p o n e n t  h e a d  x ; 
o u t p u t  [ 4 : 0 ]  o p p o n e n t  p i c t u r e  , 
p l a y e r  l i f e  ,  o p p o n e n t  l i f e  ,  p l a y e r  e n e r g y  ,  o p p o n e n t  e n e r g y ; 
o u t p u t [ 7 : 0 ]  t i m e  l e f t  ; 
o u t p u t [ 1 : 0 ]  mode ,  r o u n d ,  g a m e  t y p e ; 
o u t p u t [ 2 : 0 ]  s t a t e ; 

i n p u t  [ 2 : 0 ] 
i n d e x  i n  ; 
i n p u t  [ 9 : 0 ]  d a t a  i n  ; 
i n p u t  e n a b l e  i n  ; 
i n d e x  o u t  ; 
o u t p u t [ 2 : 0 ] 
o u t p u t [ 9 : 0 ]  d a t a  o u t ; 
o u t p u t  e n a b l e  o u t ; 

/ / M a j o r  FSM  d a t a

r e g [ 9 : 0 ]  p l a y e r  l  h a n d  x  ,  p l a y e r  r  h a n d  x  ,  o p p o n e n t  l  h a n d  x  ,  o p p o n e n t  r  h a n d  x ;

r e g 
p l a y e r  l  h a n d  y  ,  p l a y e r  r  h a n d  y  ,  o p p o n e n t  l  h a n d  y  ,  o p p o n e n t  r  h a n d  y  ;

r e g [ 1 : 0 ]  p l a y e r  l  h a n d
 p u n c h  ,  p l a y e r  r  h a n d  p u n c h 
, o p p o n e n t  l  h a n d  p u n c h  ,  o p p o n e n t  r  h a n d  p u n c h  ; 
r e g [ 9 : 0 ]  p l a y e r  h e a d  x  ,  o p p o n e n t  h e a d  x ; 
r e g [ 4 : 0 ]  p l a y e r  p i c t u r e  ,  o p p o n e n t  p i c t u r e  , 
p l a y e r  l i f e  ,  o p p o n e n t  l i f e  ,  p l a y e r  e n e r g y  ,  o p p o n e n t  e n e r g y ; 
r e g [ 7 : 0 ]  t i m e  l e f t  ; 
r e g  e n d r o u n d ; 

r e g [ 9 : 0 ]  o l x  ,  o r x ;

r e g 
o l y  ,  o r y ;

r e g [ 1 : 0 ]  o l p ,  o r p ;


r e g [ 1 : 0 ]  mode ,  r o u n d ;

r e g [ 1 : 0 ]  g a m e  t y p e ;

r e g [ 2 : 0 ]  s t a t e ;

r e g  [ 5 : 0 ]  e n e r g y p u l s e  ;


/ / o u t p u t s  f r om  m i n o r  FSMS

w i r e  [ 9 : 0 ]  t i t l e

l  h a n d  x  ,  t i t l e  r  h a n d  x ; 
w i r e 
t i t l e  l  h a n d  y  ,  t i t l e  r  h a n d  y ; 
w i r e  [ 1 : 0 ]  n e x t  m o d e  ,  n e x t  g a m e  t y p e ; 

w i r e  [ 9 : 0 ]  o l x  i n  ,  o r x  i n  ; 
w i r e 
o l y  i n  ,  o r y  i n  ; 
w i r e [ 1 : 0 ]  o l p  i n  ,  o r p  i n ; 

w i r e [ 9 : 0 ]  o l x  a i  ,  o r x  a i ; 
w i r e 
o l y  a i  ,  o r y  a i  ; 
w i r e [ 1 : 0 ]  o l p  a i  ,  o r p  a i ; 

w i r e  [ 9 : 0 ]  p l x  i n  ,  p r x  i n  ,  o h x  i n ; 
w i r e 
p l y  i n  ,  p r y  i n  ; 
w i r e  [ 4 : 0 ]  o p i c  i n  ,  p l b  i n  ,  o l b  i n  ,  p e b  i n  ,  o e b  i n  ; 
w i r e  [ 7 : 0 ]  t i m e  l e f t  i n  ; 

45 

w i r e  [ 1 : 0 ]  p l p  i n  ,  p r p  i n  ; 
w i r e  e n d r o u n d  i n ; 

w i r e  [ 7 : 0 ]  n e x t  t i m e  l e f t  ; 
w i r e  [ 9 : 0 ]  n e x t  p l a y e r  l  h a n d  x  ,  n e x t  p l a y e r  r  h a n d  x  ,  n e x t  p l a y e r  h e a d  x ; 
n e x t  p l a y e r  l  h a n d  y  ,  n e x t  p l a y e r  r  h a n d  y ; 
w i r e 
w i r e  [ 1 : 0 ]  n e x t  p l a y e r  l  h a n d  p u n c h  ,  n e x t  p l a y e r  r  h a n d  p u n c h  ; 
w i r e  [ 4 : 0 ]  n e x t  p l a y e r  p i c t u r e  ,  n e x t  o p p o n e n t  l i f e  ,  n e x t  p l a y e r  e n e r g y  ; 
w i r e  [ 9 : 0 ]  n e x t  o p p o n e n t  l  h a n d  x  ,  n e x t  o p p o n e n t  r  h a n d  x  ,  n e x t  o p p o n e n t  h e a d  x ; 
w i r e 
n e x t  o p p o n e n t  l  h a n d  y  ,  n e x t  o p p o n e n t  r  h a n d  y ; 
w i r e  [ 1 : 0 ]  n e x t  o p p o n e n t  l  h a n d  p u n c h  ,  n e x t  o p p o n e n t  r  h a n d  p u n c h ; 
w i r e  [ 4 : 0 ]  n e x t  o p p o n e n t  p i c t u r e  ,  n e x t  p l a y e r  l i f e  ,  n e x t  o p p o n e n t  e n e r g y ; 

w i r e [ 1 : 0 ]  p s t a t e ,  o s t a t e ; 

w i r e  [ 2 : 0 ] 

i n d e x  i n  , 
i n d e x  i n  e  , 
i n d e x  o u t  g d ; 
w i r e  [ 9 : 0 ]  d a t a  i n  ,  d a t a  o u t  ,  d a t a  o u t  u  ,  d a t a  o u t  d ; 
w i r e  e n a b l e  i n  ,  e n a b l e  o u t  ,  e n a b l e  o u t  u  ,  e n a b l e  o u t  d ; 
w i r e  v a l i d  u  ,  v a l i d  d ; 

i n d e x  o u t  , 

i n d e x  o u t  s u  , 

i n d e x  o u t  s d  , 

i n d e x  o u t  g u  , 

/ / game  mod e s

p a r a m e t e r  TITLE  =  2 ’ d0 ;

p a r a m e t e r  ROUND  =  2 ’ d1 ;

p a r a m e t e r  REST 
=  2 ’ d2 ;

p a r a m e t e r  GAMEOVER=  2 ’ d3 ;


/ / game  t y p e s

p a r a m e t e r  ONEPLAYER 
p a r a m e t e r  TWOPLAYERM 
p a r a m e t e r  TWOPLAYERS 

=  2 ’ d0 ;

=  2 ’ d1 ;

=  2 ’ d2 ;


/ / game  s t a t e s

p a r a m e t e r  IDLE 
p a r a m e t e r  STARTGETDATA  =  3 ’ d1 ;

p a r a m e t e r  WAITGETDATA  =  3 ’ d2 ;

p a r a m e t e r  STARTCOMPUTE  =  3 ’ d3 ;

p a r a m e t e r  WAITCOMPUTE  =  3 ’ d4 ;

p a r a m e t e r  STARTSENDDATA  =  3 ’ d5 ;

p a r a m e t e r  WAITSENDDATA  =  3 ’ d6 ;


=  3 ’ d0 ;


a s s i g n 

i n d e x
 o u t [ 2 : 0 ]  =  ( g a m e  t y p e  == TWOPLAYERM )  ?

( e n a b l e
 o u t  ?  i n d e x  o u t  s d  [ 2 : 0 ]  : 
i n d e x  o u t  g u  [ 2 : 0 ] )  :

i n d e x  o u t  g d  [ 2 : 0 ] ) ; 
( e n a b l e
 o u t  ?  i n d e x  o u t  s u  [ 2 : 0 ]  : 
a s s i g n  d a t a  o u t [ 9 : 0 ]  =  ( g a m e  t y p e  == TWOPLAYERM )  ?  d a t a  o u t  d [ 9 : 0 ]  :  d a t a  o u t  u  [ 9 : 0 ] ; 
a s s i g n  e n a b l e  o u t  =  ( g a m e  t y p e  == TWOPLAYERM)  ?

( s t a t e==WAITSENDDATA  ?  e n a b l e  o u t  d 
:  1  ’ b0 )  :

( e n a b l e

1 ’ b0 
:  e n a b l e  o u t  u  ) ; 
s t a t e !=WAITSENDDATA? 
i n 
| | 
i n d e x  i n  e  =  e n a b l e  i n  ?  i n d e x  i n 
/ / a s s i g n 
:  3 ’ d0 ; 
a s s i g n 
i n d e x  i n  e  =  e n a b l e  o u t 
| |  ˜ e n a b l e  i n  ?  3 ’ d0 

i n d e x  i n ; 

: 

46 

/ / M a j o r / M i n o r  FSM  c o n t r o l s 
r e g  t i t l e f s m  s t a r t  ; 
w i r e  t i t l e f s m  b u s y  ; 

r e g  g e t u s e r d a t a  s t a r t  ,  s e n d u s e r d a t a  s t a r t  ; 
w i r e  g e t u s e r d a t a  b u s y  ,  s e n d u s e r d a t a  b u s y ; 

r e g  t l f s m  s t a r t  ,  p f s m  s t a r t  ,  o f s m  s t a r t ; 
w i r e  t l f s m  b u s y  ,  p f s m  b u s y  ,  o f s m  b u s y ; 

r e g  g e t d i s p d a t a  s t a r t  ,  s e n d d i s p d a t a  s t a r t  ; 
w i r e  g e t d i s p d a t a  b u s y  ,  s e n d d i s p d a t a  b u s y  ; 

r e g  p  k n o c k o u t s ; 
r e g  o  k n o c k o u t s  ; 

r e g  a i  s t a r t  ; 
w i r e  a i  b u s y  ; 

/ / i n t e r f i g h t e r  c o n n e c t i o n s 
w i r e  [ 6 : 0 ]  p l a y e r  s t a l l  i n c  ,  o p p o n e n t  s t a l l  i n c  ; 
w i r e  [ 1 : 0 ]  p l a y e r  h i t  ,  o p p o n e n t  h i t  ; 

/ / f i g h t e r  t o  a i 
w i r e  [ 6 : 0 ]  p l a y e r  s t a l l  ,  o p p o n e n t  s t a l l  ; 

/ / d a t a  b u s  c o mm u n i c a t i o n 
/ / c o mm u n i c a t i o n  comm ( d a t a  b u s  ,  g am e  t y p e  , 
a c k  o u t  ,  e n a b l e  i n  ,

/ / i n d e x  i n  , 
d a t a  i n  , 
/ / i n d e x
 o u t  ,  d a t a  o u t  ,  a c k  i n  , 
e n a b l e  o u t ) ; 

/ / M i n o r  FSMs 
t i t l e f s m  t i t l e ( c l k  ,  r e s e t  ,  t i t l e f s m  s t a r t  ,  t i t l e f s m  b u s y  ,

p l x ,  p r x ,  p l y ,  p r y ,  p l p ,  p r p ,

t i t l e

l  h a n d  x  ,  t i t l e  r  h a n d  x  ,  t i t l e  l  h a n d  y  ,  t i t l e  r  h a n d  y , 
n e x t  m o d e  ,  n e x t  g a m e  t y p e ) ; 

t i m e l e f t f s m  t l ( c l k  ,  r e s e t  ,  t l f s m  s t a r t  ,  t l f s m  b u s y  ,  t i m e  l e f t  ,  n e x t  t i m e  l e f t  ) ; 

p l a y e r ( c l k  ,  r e s e t  ,  p f s m  s t a r t  ,  p f s m  b u s y  ,

f i g h t e r f s m 
p l x ,  p r x ,  p l y ,  p r y ,  p l p ,  p r p ,

p l a y e r
 e n e r g y  , 
p l a y e r  s t a l l  i n c  ,  p l a y e r  h i t  ,

o p p o n e n t
 r  h a n d  y  ,  o s t a t e  ,  o p p o n e n t  h e a d  x  ,  o p p o n e n t  l i f e  , 

n e x t  p l a y e r  l  h a n d  x  ,  n e x t  p l a y e r  r  h a n d  x ,

n e x t
 p l a y e r  l  h a n d  y  ,  n e x t  p l a y e r  r  h a n d  y ,

n e x t
 p l a y e r  l  h a n d  p u n c h  ,  n e x t  p l a y e r  r  h a n d  p u n c h  ,  n e x t  p l a y e r  h e a d  x , 
n e x t  p l a y e r  p i c t u r e  ,  n e x t  o p p o n e n t  l i f e  ,  n e x t  p l a y e r  e n e r g y  , 
o p p o n e n t  s t a l l  i n c  , o p p o n e n t  h i t  ,

p s t a t e  ,  p l a y e r
 s t a l l  ) ; 

47 

o p p o n e n t ( c l k  ,  r e s e t  ,  o f s m  s t a r t  ,  o f s m  b u s y  ,

f i g h t e r f s m 
o l x ,  o r x ,  o l y ,  o r y ,  o l p ,  o r p ,

o p p o n e n t
 e n e r g y  ,  o p p o n e n t  s t a l l  i n c  ,  o p p o n e n t  h i t  , 
p l a y e r  r  h a n d  y  ,  p s t a t e  ,  p l a y e r  h e a d  x  ,  p l a y e r  l i f e  , 

n e x t  o p p o n e n t  l  h a n d  x  ,  n e x t  o p p o n e n t  r  h a n d  x ,

n e x t
 o p p o n e n t  l  h a n d  y  ,  n e x t  o p p o n e n t  r  h a n d  y ,

n e x t
 o p p o n e n t  l  h a n d  p u n c h  ,  n e x t  o p p o n e n t  r  h a n d  p u n c h  , 
n e x t  o p p o n e n t  h e a d  x ,

n e x t
 o p p o n e n t  p i c t u r e  ,  n e x t  p l a y e r  l i f e  ,  n e x t  o p p o n e n t  e n e r g y  , 
p l a y e r  s t a l l  i n c  ,

p l a y e r
 h i t  , 
o s t a t e  ,  o p p o n e n t  s t a l l  ) ; 

a i  a i f i g h t e r ( c l k  ,  r e s e t  ,  a i  s t a r t  ,  a i  b u s y  , 
o p p o n e n t  s t a l l  ,  p l a y e r  h e a d  x  ,  p l a y e r  l  h a n d  x  ,  p l a y e r  r  h a n d  x , 
o l x  a i  ,  o r x  a i ,  o l y  a i  ,  o r y  a i ,  o l p  a i  ,  o r p  a i  ) ; 

/ / w i r e  s c l k  ;

/ / r e g [ 3 : 0 ]  c l k c o u n t ;

/ / a l w a y s  @  ( p o s e d g e  c l k )

/ / 
c l k c o u n t  <=  c l k c o u n t  +  1 ;

/ /BUFG  p i x e l
 c l o c k  b u f  ( . I ( c l k c o u n t [ 2 ] ) ,  . O( s c l k ) ) ; 
/ / / / c l k 
i s  3 . 3 7 5  MHz 

g e t u s e r d a t a  gud ( c l k  ,  r e s e t  ,  g e t u s e r d a t a  s t a r t  ,  g e t u s e r d a t a  b u s y  , 
i n d e x  i n  e  ,  d a t a  i n  ,  e n a b l e  i n  , 
i n d e x  o u t  g u  , 
o l x  i n  ,  o r x  i n ,  o l y  i n  ,  o r y  i n ,  o l p  i n  ,  o r p  i n  ,  v a l i d  u  ) ; 

s e n d u s e r d a t a  s u d ( c l k  ,  r e s e t  ,  s e n d u s e r d a t a  s t a r t  ,  s e n d u s e r d a t a  b u s y  , 
i n d e x  o u t  s u  ,  d a t a  o u t  u  ,  e n a b l e  o u t  u  , 
i n d e x  i n  , 
p l x ,  p r x ,  p l y ,  p r y ,  p l p ,  p r p ) ; 

s e n d d i s p d a t a  s d d ( c l k  ,  r e s e t  ,  s e n d d i s p d a t a  s t a r t  ,  s e n d d i s p d a t a  b u s y  , 
i n d e x  o u t  s d  ,  d a t a  o u t  d  ,  e n a b l e  o u t  d  , 
i n d e x  i n  , 
o p p o n e n t  l  h a n d  x  ,  o p p o n e n t  r  h a n d  x  ,  o p p o n e n t  l  h a n d  y , 
o p p o n e n t  r  h a n d  y ,

p l a y e r
 h e a d  x  ,  p l a y e r  p i c t u r e  ,  t i m e  l e f t  , 
o p p o n e n t  l i f e  ,  p l a y e r  l i f e  ,  o p p o n e n t  e n e r g y  ,  p l a y e r  e n e r g y  , 
o p p o n e n t  l  h a n d  p u n c h  ,  o p p o n e n t  r  h a n d  p u n c h  ,  e n d r o u n d ) ; 

g e t d i s p d a t a  gdd ( c l k  ,  r e s e t  ,  g e t d i s p d a t a  s t a r t  ,  g e t d i s p d a t a  b u s y  , 
i n d e x  i n  e  ,  d a t a  i n  ,  e n a b l e  i n  , 
i n d e x  o u t  g d  ,

p l x

i n  ,  p r x  i n ,  p l y  i n  ,  p r y  i n ,  o h x  i n  ,  o p i c  i n  , 
t i m e  l e f t  i n  ,  p l b  i n ,  o l b  i n  ,  p e b  i n ,  o e b  i n ,  p l p  i n ,  p r p  i n  , 
e n d r o u n d  i n  , v a l i d  d  ) ; 

a l w a y s  @( p o s e d g e  c l k )  b e g i n 
t l f s m  s t a r t  <=  0 ;

<=  0 ; 
p f s m
 s t a r t 
o f s m  s t a r t 
<=  0 ; 

48 

<=  0 ; 
<=  0 ; 

<=  3 1 ; 

<=  3 1 ; 

<=  3 1 ; 

<=  3 1 ; 

<=  0 ; 
a i  s t a r t 
g e t u s e r d a t a  s t a r t  <=  0 ; 
s e n d u s e r d a t a  s t a r t  <=  0 ; 
g e t d i s p d a t a  s t a r t  <=  0 ; 
s e n d d i s p d a t a  s t a r t  <=  0 ; 
i f  ( r e s e t  )  b e g i n 
t i m e  l e f t  <=  1 8 0 ; 
s t a t e 
<= IDLE ; 
mode 
<= TITLE ; 
r o u n d  <= 0 ; 
p l a y e r  p i c t u r e 
o p p o n e n t  p i c t u r e 
p l a y e r  l i f e 
o p p o n e n t  l i f e 
p l a y e r  e n e r g y 
o p p o n e n t  e n e r g y 
e n e r g y p u l s e  <=  0 ; 

o l x <=300 ; 
o r x <=340 ; 
o l y <=1; 
o r y <=1; 
o l p <=0; 
o r p <=0; 

o p p o n e n t  l  h a n d  x <=300 ; 
o p p o n e n t  r  h a n d  x <=1; 
o p p o n e n t  l  h a n d  y <=340 ; 
o p p o n e n t  r  h a n d  y <=1; 
o p p o n e n t  l  h a n d  p u n c h <=0; 
o p p o n e n t  r  h a n d  p u n c h <=0; 
p l a y e r  h e a d  x <=0; 
o p p o n e n t  h e a d  x <=0; 

e n d r o u n d <=0; 

p  k n o c k o u t s <=0; 
o  k n o c k o u t s <=0; 

e n d  e l s e  b e g i n 
c a s e  ( mode ) 
TITLE :  b e g i n 
c a s e  (  s t a t e ) 
IDLE : 
i f  ( s t a r t  )  b e g i n 
t i t l e f s m  s t a r t 
s t a t e  <= STARTGETDATA; 
e n d  e l s e  b e g i n 
s t a t e  <=  IDLE ; 
e n d 
STARTGETDATA: b e g i n 

<=  1 ; 

49 

i f  ( ˜ t i t l e f s m  b u s y  )  b e g i n

t i t l e f s m  s t a r t  <=  1 ;

s t a t e  <= STARTGETDATA;

e n d  e l s e  b e g i n 
s t a t e  <= WAITGETDATA ; 
e n d 

e n d 
WAITGETDATA : 
b e g i n 
i f  ( t i t l e f s m  b u s y  )  b e g i n

s t a t e  <= WAITGETDATA ;

e n d  e l s e  b e g i n

l  h a n d  x 
p l a y e r

p l a y e r  r  h a n d  x 

p l a y e r  l  h a n d  y 
p l a y e r  r  h a n d  y 

<=  t i t l e  l  h a n d  x ; 
<=  t i t l e  r  h a n d  x ; 

<=  t i t l e  l  h a n d  y ; 
<=  t i t l e  r  h a n d  y ; 

mode 
g a m e  t y p e 

<=  n e x t  m o d e ;

<=  n e x t
 g a m e  t y p e ; 

r o u n d <=1; 
p l a y e r  l  h a n d  p u n c h 
p l a y e r
 r  h a n d  p u n c h 
p l a y e r
 h e a d  x 
p l a y e r  p i c t u r e 
p l a y e r  e n e r g y 
p l a y e r  l i f e 

o l x  < =  3 0 0 ;

o r x  < =  3 4 0 ;

o l y  <=  1 ;

o r y  <=  1 ;

o l p  <=  0 ;

o r p  <=  0 ;


o p p o n e n t  l  h a n d  x 
o p p o n e n t  r  h a n d  x 
o p p o n e n t  l  h a n d  y 
o p p o n e n t
 r  h a n d  y 
o p p o n e n t
 l  h a n d  p u n c h 
o p p o n e n t
 r  h a n d  p u n c h 
o p p o n e n t  h e a d
 x 
o p p o n e n t  p i c t u r e 
o p p o n e n t  e n e r g y 
o p p o n e n t  l i f e 

t i m e  l e f t  <=180 ; 

<=  0 ;

<=  0 ;


<=  3 2 0 ; 
<=  0 ; 
<=  3 1 ; 

<=  3 1 ; 

<=  0 ;

<=  0 ;


<=  3 0 0 ; 
<=  3 4 0 ; 
<=  1 ;

<=  1 ;


<=  3 2 0 ; 
<=  0 ; 
<=  3 1 ; 

<=  3 1 ; 

/ ∗  i f  ( n e x t  g a m e  t y p e==TWOPLAYERM )  b e g i n

g e t u s e r d a t a  s t a r t  <=  1 ;

s t a t e <=STARTGETDATA;


50 

i f ( n e x t  g a m e  t y p e==TWOPLAYERS )  b e g i n 
e n d  e l s e 
s e n d u s e r d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA; 
e n d  e l s e ∗ / 

s t a t e  <=  IDLE ; 
/ / i n i t  <=1; 

e n d


e n d

d e f a u l t  :  s t a t e <=IDLE ;

e n d c a s e 
e n d 
ROUND :  b e g i n 
i f  ( r o u n d ==0 )  b e g i n 
mode<=GAMEOVER; 
e n d  e l s e 
i f  ( e n d r o u n d )  b e g i n

mode <=REST ;

r o u n d  <=  r o u n d  +  1 ;

l e f t  <=  3 0 ;

t i m e

e n d r o u n d  <=  0 ;

e n d  e l s e

c a s e  ( g a m e  t y p e )

TWOPLAYERS : b e g i n

/ / p a s s  t h r o u g h  p u n c h  d a t a

c a s e  (  s t a t e )

IDLE : 
i f  ( s t a r t  )  b e g i n 
s e n d u s e r d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA; 
e n d  e l s e  b e g i n 
s t a t e  <=  IDLE ; 
e n d 
STARTSENDDATA :  b e g i n 
i f  ( ˜ s e n d u s e r d a t a  b u s y )  b e g i n 
/ / i f ( ˜ e n a b l e  i n ) 
s e n d u s e r d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA; 
e n d  e l s e  b e g i n 
s t a t e  <= WAITSENDDATA ; 
e n d 
e n d 
WAITSENDDATA :  b e g i n 
i f  ( e n a b l e  i n  )  b e g i n 
g e t d i s p d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTGETDATA; 
e n d  e l s e 
i f ( s e n d u s e r d a t a  b u s y )  b e g i n 
s t a t e  <= WAITSENDDATA ; 
e n d  e l s e  b e g i n 
g e t d i s p d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTGETDATA; 

e n d


e n d


51 

STARTGETDATA :  b e g i n 
i f  ( ˜ g e t d i s p d a t a  b u s y  )  b e g i n

g e t d i s p d a t a  s t a r t  <=  1 ;

s t a t e  <= STARTGETDATA;

e n d  e l s e  b e g i n

s t a t e  <= WAITGETDATA ;


e n d


i n != 0 

e n d

WAITGETDATA :  b e g i n

i f  ( g e t d i s p d a t a  b u s y  )  b e g i n

s t a t e  <= WAITGETDATA ;

e n d  e l s e  b e g i n

i f ( v a l i d  d  &&  p l x  i n  != 0  &&  p r x

&&  p l x  i n  <  p r x  i n  )  b e g i n 
p l a y e r  l  h a n d  x  <=  p l x  i n  ; 
p l a y e r  r  h a n d  x  <=  p r x  i n  ; 
p l a y e r  l  h a n d  y  <=  p l y  i n  ; 
p l a y e r  r  h a n d  y  <=  p r y  i n  ; 
p l a y e r  l  h a n d  p u n c h  <=  p l p  i n  ; 
p l a y e r  r  h a n d  p u n c h  <=  p r p  i n  ; 
o p p o n e n t  h e a d  x  <=  o h x  i n ; 
o p p o n e n t  p i c t u r e <=  o p i c  i n  ; 
<=  t i m e  l e f t  i n  ; 
t i m e  l e f t 
p l a y e r  l i f e 
<=  p l b  i n  ; 
<=  o l b  i n  ;

o p p o n e n t  l i f e 
<=  p e b  i n  ;

p l a y e r
 e n e r g y 
i n  ;

o p p o n e n t  e n e r g y  <=  o e b

e n d r o u n d 
<=  e n d r o u n d

e n d 
s e n d u s e r d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA; 
/ / s t a t e  <=  IDLE ; 
/ / s l a v e  n e v e r  g o e s 

i n ; 

i d l e 

e n d


e n d

d e f a u l t  :  b e g i n

i f  ( e n a b l e  i n  &&  s t a t e !=WAITGETDATA && 
s t a t e !=STARTGETDATA)  b e g i n 
g e t d i s p d a t a  s t a r t  <=  1 ; 
s t a t e <=STARTGETDATA; 
e n d  e l s e  b e g i n

s e n d u s e r d a t a
 s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA;


e n d

/ / s t a t e <=IDLE ;

e n d 
e n d c a s e 
e n d 
d e f a u l t  :  b e g i n 
c a s e  (  s t a t e ) 

/ / f o r  two  p l a y e r  m  o r  s i n g l e  p l a y e r 

52 

IDLE : 
i f  ( s t a r t  )  b e g i n 
i f  ( g a m e  t y p e  == ONEPLAYER) 
a i  s t a r t  <=  1 ; 
e l s e  g e t u s e r d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTGETDATA; 
e n d  e l s e  b e g i n 
s t a t e  <=  IDLE ; 
e n d 
STARTGETDATA :  b e g i n 
i f ( ( g a m e  t y p e  == TWOPLAYERM && ˜ g e t u s e r d a t a  b u s y ) 
(  g a m e  t y p e  == ONEPLAYER  &&  ˜ a i  b u s y  ) )  b e g i n 
| | 

i f  ( g a m e  t y p e  == ONEPLAYER)

a i  s t a r t  <=  1 ;

e l s e  g e t u s e r d a t a
 s t a r t  <=  1 ; 

s t a t e  <= STARTGETDATA; 
e n d  e l s e  b e g i n 
s t a t e  <= WAITGETDATA ; 
e n d 
e n d 
WAITGETDATA :  b e g i n 
/ / f o r c e s  c o n t i n u e 
i f  a n o t h e r  s t a r t  p u l s e  o c c u r s 
i f  ( (  ( g a m e  t y p e  == TWOPLAYERM &&  g e t u s e r d a t a  b u s y ) 
(  g a m e  t y p e  == ONEPLAYER  &&  a i  b u s y ) )

| | 
/ ∗  &&  ˜ s t a r t ∗  / )  b e g i n

s t a t e  <= WAITGETDATA ;

e n d  e l s e  b e g i n

i f ( g a m e  t y p e  == ONEPLAYER && ˜ a i
 b u s y )  b e g i n 
o l x  <=  o l x  a i  ;

o r x  <=  o r x
 a i  ; 
o l y  <=  o l y  a i  ;

o r y  <=  o r y
 a i  ; 
o l p  <=  o l p  a i  ;

o r p  <=  o r p
 a i  ; 
i f ( g a m e  t y p e  == TWOPLAYERM 
e n d  e l s e 
&&  ˜ g e t u s e r d a t a  b u s y  )  b e g i n 
i f  ( v a l i d  u  )  b e g i n 
/ /  &&  o l x  i n != 0  &&  o r x  i n !=0  && 
/ / 
o l x  i n  <  o r x  i n  )  b e g i n 
o l x  <=  o l x  i n  ;

i n  ; 
o r x  <=  o r x

o l y  <=  o l y  i n  ;

o r y  <=  o r y

i n  ; 
o l p  <=  o l p  i n  ;

o r p  <=  o r p

i n  ;


e n d

e n d  e l s e  b e g i n

/ ∗  o l x  < =  3 0 0 ;

o r x  < =  3 4 0 ;


53 

o l y	 <=  1 ;


o l p  <=  0 ; 
o r p  < =  0 ; ∗ /


e n d


o r y  <=  1 ;


t l f s m  s t a r t  <=  1 ;

p f s m
 s t a r t  <=  1 ; 
o f s m  s t a r t  <=  1 ;

e n e r g y p u l s e  <=  e n e r g y p u l s e  +  1 ;

s t a t e  <= STARTCOMPUTE ;

e n d 
e n d 
STARTCOMPUTE : b e g i n 
/ / s t a r t  m i n o r  FSM’ s  and  r e p e a t  u n t i l  a l l  h a v e  s t a r t e d 
/ / and  h a v e  r e p o r t e d  t h a t  t h e y  a r e  b u s y  (  i n  c o m p u t a t i o n ) 
i f ( ˜ t l f s m  b u s y 
| |  ˜  p f s m  b u s y 
| |  ˜  o f s m  b u s y )  b e g i n 
t l f s m  s t a r t  <=  1 ;

p f s m
 s t a r t  <=  1 ; 
o f s m  s t a r t  <=  1 ; 
s t a t e  <= STARTCOMPUTE ; 
e n d  e l s e  b e g i n 
s t a t e  <= WAITCOMPUTE; 
e n d 
e n d 
WAITCOMPUTE: b e g i n 
/ / w a i t  u n t i l  a l l  m i n o r  FSM’ s  h a v e  f i n i s h e d 
/ /  c a l c u l a t i n g  t h e i r  n e x t  v a l u e s 
i f ( t l f s m  b u s y 
| |  p f s m  b u s y 
| |  o f s m  b u s y )  b e g i n 
s t a t e  <= WAITCOMPUTE; 
e n d  e l s e  b e g i n  / /  i f 
f i n i s h e d  u p d a t e  n e x t  v a l u e s

/ /  and  w a i t  u n t i l  n e x t  c o m p u t a t i o n

l e f t  <=  n e x t  t i m e  l e f t  ; 
t i m e


p l a y e r  l  h a n d  x 
<=  n e x t  p l a y e r  l  h a n d  x ; 
<=  n e x t  p l a y e r  r  h a n d  x ; 
p l a y e r  r  h a n d  x 
<=  n e x t  p l a y e r  l  h a n d  y ; 
p l a y e r  l  h a n d  y 
p l a y e r  r  h a n d  y 
<=  n e x t  p l a y e r  r  h a n d  y ; 
p l a y e r  l  h a n d  p u n c h  <=  n e x t  p l a y e r  l  h a n d  p u n c h  ; 
<=  n e x t  p l a y e r  r  h a n d  p u n c h  ; 
p l a y e r  r  h a n d  p u n c h 
p l a y e r  h e a d  x 
<=  6 4 0  −  n e x t  p l a y e r  h e a d  x ; 
p l a y e r  p i c t u r e <=  n e x t  p l a y e r  p i c t u r e  ;

p l a y e r
 e n e r g y  <=

n e x t  p l a y e r  e n e r g y  +  & ( e n e r g y p u l s e )  > =  3 1  ?

3 1  :  n e x t
 p l a y e r  e n e r g y  +  & ( e n e r g y p u l s e  ) ; 
p l a y e r  l i f e  <=  n e x t  p l a y e r  l i f e  ; 

o p p o n e n t  l  h a n d  x 
o p p o n e n t  r  h a n d  x 
o p p o n e n t  l  h a n d  y 
o p p o n e n t  r  h a n d  y 

<=  n e x t  o p p o n e n t  l  h a n d  x ; 
<=  n e x t  o p p o n e n t  r  h a n d  x ; 
<=  n e x t  o p p o n e n t  l  h a n d  y ; 
<=  n e x t  o p p o n e n t  r  h a n d  y ; 

54 

o p p o n e n t  l  h a n d  p u n c h <=  n e x t  o p p o n e n t  l  h a n d  p u n c h  ; 
o p p o n e n t  r  h a n d  p u n c h <=  n e x t  o p p o n e n t  r  h a n d  p u n c h ; 
o p p o n e n t  h e a d  x <=  6 4 0  −  n e x t  o p p o n e n t  h e a d  x ; 
o p p o n e n t  p i c t u r e 
<=  n e x t  o p p o n e n t  p i c t u r e ; 
o p p o n e n t	 e n e r g y  <= 
( n e x t  o p p o n e n t  e n e r g y  +  & ( e n e r g y p u l s e ) )  > =  3 1  ? 
3 1  :  n e x t  o p p o n e n t  e n e r g y  +  & ( e n e r g y p u l s e  ) ; 
o p p o n e n t  l i f e 
<=  n e x t  o p p o n e n t  l i f e  ; 

i f  ( t i m e  l e f t = = 0  | | 
o p p o n e n t  l i f e  <	 n e x t  o p p o n e n t  l i f e 
| | 
o p p o n e n t  l i f e  <	 n e x t  o p p o n e n t  l i f e  )  b e g i n 
i f  ( p l a y e r  l i f e  <  n e x t  p l a y e r  l i f e ) 
p  k n o c k o u t s <=p  k n o c k o u t s + 1 ; 
i f  ( o p p o n e n t  l i f e  <  n e x t  o p p o n e n t  l i f e ) 
o  k n o c k o u t s<=o  k n o c k o u t s + 1 ; 
e n d r o u n d <=1; 
e n d 

i f  ( g a m e  t y p e==ONEPLAYER) 
s t a t e <=IDLE ; 
e l s e  b e g i n 
s e n d d i s p d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA; 
e n d 
e n d 
e n d 
STARTSENDDATA :  b e g i n 
i f  ( ˜ s e n d d i s p d a t a  b u s y )  b e g i n 
s e n d d i s p d a t a  s t a r t  <=  1 ; 
s t a t e  <= STARTSENDDATA; 
e n d  e l s e  b e g i n 
s t a t e  <= WAITSENDDATA ; 
e n d 
e n d 
WAITSENDDATA :  b e g i n 
/ ∗  i f  (  s t a r t  )  b e g i n 
s e n d d i s p d a t a  s t a r t  <=  1 ; 
e n d  e l s e ∗ /  i f  ( s e n d d i s p d a t a  b u s y / ∗  &&  ˜ s t a r t ∗ / ) 
b e g i n 
s t a t e  <= WAITSENDDATA ; 
e n d  e l s e  b e g i n 
s t a t e  <=  IDLE ; 
e n d 

e n d 
d e f a u l t  :  s t a t e <=IDLE ; 
e n d c a s e 
e n d 
e n d c a s e 

e n d 
REST :  b e g i n 

55 

c a s e ( s t a t e ) 
IDLE :  b e g i n 
i f  ( s t a r t  )  b e g i n 
t l f s m  s t a r t  <=  1 ;

s t a t e  <= STARTCOMPUTE ;

e n d  e l s e  b e g i n

s t a t e  <=  IDLE ;


e n d


e n d

STARTCOMPUTE : b e g i n

i f ( ˜ t l f s m  b u s y )  b e g i n

t l f s m  s t a r t  <=  1 ;

s t a t e  <= STARTCOMPUTE ;

e n d  e l s e  b e g i n


s t a t e  <= WAITCOMPUTE;


e n d


e n d


WAITCOMPUTE: b e g i n

l e f t  <=  n e x t  t i m e  l e f t  ;

t i m e

p l a y e r

l  h a n d  p u n c h 
p l a y e r
 r  h a n d  p u n c h 
p l a y e r
 h e a d  x 
p l a y e r  p i c t u r e 
p l a y e r  e n e r g y 
p l a y e r  l i f e 

<=  0 ;

<=  0 ;


<=  3 2 0 ; 

<=  3 1 ; 

<=  0 ; 
<=  3 1 ; 

o l x  < =  3 0 0 ;

o r x  < =  3 4 0 ;

o l y  <=  1 ;

o r y  <=  1 ;

o l p  <=  0 ;

o r p  <=  0 ;


o p p o n e n t  l  h a n d  x 
o p p o n e n t  r  h a n d  x 
o p p o n e n t  l  h a n d  y 
o p p o n e n t  r  h a n d  y 
o p p o n e n t  l  h a n d  p u n c h  <=  0 ;

o p p o n e n t
 r  h a n d  p u n c h  <=  0 ;

o p p o n e n t  h e a d
 x 
o p p o n e n t  p i c t u r e 
o p p o n e n t  e n e r g y 
o p p o n e n t  l i f e 

<=  3 0 0 ; 
<=  3 4 0 ; 
<=  1 ; 
<=  1 ; 

<=  3 2 0 ; 
<=  0 ; 
<=  3 1 ; 

<=  3 1 ; 

i f  ( t i m e  l e f t == 0 | | n e x t  t i m e  l e f t ==0 )  b e g i n 
mode<=ROUND ;

t i m e


l e f t  <=180 ;


e n d

s t a t e <=IDLE ;

e n d 

56 

d e f a u l t  :  s t a t e <=IDLE ; 
e n d c a s e 

e n d 
GAMEOVER :  b e g i n 
/ / d o n e 
e n d 
e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

57 

1 7 : 4 4 : 0 5  0 4 / 2 3 / 0 6


f i g h t e r f s m


‘ t i m e s c a l e  1 n s  /  1 p s

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  Company :

/ /  E n g i n e e r :

/ /

/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name :

/ /  Modu l e  Name : 
/ /  P r o j e c t  Name :

/ /  T a r g e t  D e v i c e  :

/ /  T o o l  v e r s i o n s  :

/ /  D e s c r i p t i o n  :

/ /

/ /  D e p e n d e n c i e s  :

/ /

/ /  R e v i s i o n :

/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d

/ /  A d d i t i o n a l  Comments :

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

m o d u l e  f i g h t e r f s m ( c l k  ,  r e s e t  ,  s t a r t  ,  b u s y ,

l  h a n d  x ,  r  h a n d  x , 
l  h a n d  y ,  r  h a n d  y , 
e n e r g y  ,  s t a l l  i n c  ,  h i t ,

o p  h a n d  y ,  o p
 s t a t e  ,  o p  h e a d  x ,  o p  l i f e  , 

l  h a n d  p u n c h  ,  r  h a n d  p u n c h  , 

n e x t  l  h a n d  x  ,  n e x t  r  h a n d  x  ,  n e x t  l  h a n d  y  ,  n e x t  r  h a n d  y , 
n e x t  l  h a n d  p u n c h  ,  n e x t  r  h a n d  p u n c h  ,  n e x t  h e a d  x ,

p i c t u r e  ,  n e x t
 o p  l i f e  ,  n e x t  e n e r g y  ,  o p  s t a l l  i n c  ,  o p  h i t  , 
s t a t e  ,  s t a l l  ) ; 

i n p u t  c l k  ,  r e s e t  ,  s t a r t  ; 
l  h a n d  x ,  r  h a n d  x ,  o p  h e a d  x ; 
i n p u t  [ 9 : 0 ] 
l  h a n d  y ,  r  h a n d  y  ,  o p  h a n d  y ; 
i n p u t 
i n p u t  [ 1 : 0 ] 
l  h a n d  p u n c h  ,  r  h a n d  p u n c h ; 
i n p u t  [ 4 : 0 ]  e n e r g y ; 
i n p u t [ 1 : 0 ]  o p  s t a t e ; 
i n p u t  [ 4 : 0 ]  o p  l i f e  ; 
i n p u t  [ 6 : 0 ]  s t a l l  i n c  ; 
i n p u t [ 1 : 0 ]  h i t ; 

o u t p u t  b u s y ; 
n e x t  l  h a n d  x  ,  n e x t  r  h a n d  x  ,  n e x t  h e a d  x ; 
o u t p u t [ 9 : 0 ] 
n e x t  l  h a n d  y  ,  n e x t  r  h a n d  y ; 
o u t p u t 
o u t p u t [ 1 : 0 ] 
n e x t  l  h a n d  p u n c h  ,  n e x t  r  h a n d  p u n c h  ; 
o u t p u t [ 4 : 0 ]  p i c t u r e  ,  n e x t  o p  l i f e  ,  n e x t  e n e r g y  ; 
o u t p u t [ 1 : 0 ]  s t a t e ; 
o u t p u t [ 6 : 0 ]  o p  s t a l l  i n c  ; 
o u t p u t [ 1 : 0 ]  o p  h i t  ; 
o u t p u t [ 6 : 0 ]  s t a l l ; 

r e g  f s m s t a t e ; 

58 

r e g  [ 1 : 0 ]  s t a t e  ; 
r e g  b u s y ; 
n e x t  l  h a n d  x  ,  n e x t  r  h a n d  x  ,  n e x t  h e a d  x  ; 
r e g  [ 9 : 0 ] 
n e x t  l  h a n d  y  ,  n e x t  r  h a n d  y  ; 
r e g 
n e x t  l 
h a n d  p u n c h  ,  n e x t  r  h a n d  p u n c h  ; 
r e g [ 1 : 0 ] 
o p  l i f e  ,  n e x t  e n e r g y ; 
r e g [ 4 : 0 ]  p i c t u r e  ,  n e x t 

r e g [ 1 : 0 ] 
l r p u n c h ; 
r e g [ 9 : 0 ]  p u n c h  x ; 
r e g 
p u n c h  y ; 
r e g [ 1 : 0 ]  p u n c h  s t r  ; 
r e g [ 6 : 0 ]  s t a l l ; 
r e g [ 6 : 0 ]  c o m b o s t a l l ; 
r e g [ 6 : 0 ]  o p  s t a l l  i n c  ; 
r e g [ 1 : 0 ]  o p  h i t  ; 
r e g  i m p a c t ; 

p a r a m e t e r  IDLE  =  1 ’ b0 ; 
p a r a m e t e r  ACTIVE=  1 ’ b1 ; 

p a r a m e t e r  STAND  = 2 ’ d0 ; 
p a r a m e t e r  BLOCK  = 2 ’ d1 ; 
p a r a m e t e r  PUNCH  = 2 ’ d2 ; 
p a r a m e t e r  RECOIL 

p a r a m e t e r  STANDING00 
p a r a m e t e r  STANDING01 
p a r a m e t e r  STANDING10 
p a r a m e t e r  STANDING11 
p a r a m e t e r  BLOCKING0 
p a r a m e t e r  BLOCKING1 
p a r a m e t e r  LJAB 
p a r a m e t e r  RJAB 
p a r a m e t e r  LBODY 
p a r a m e t e r  RBODY 
p a r a m e t e r  LHOOK 
p a r a m e t e r  RHOOK 
p a r a m e t e r  LHOOKLOW 
p a r a m e t e r  RHOOKLOW 
p a r a m e t e r  LCROSS 
p a r a m e t e r  RCROSS 
p a r a m e t e r  LUPPER 
p a r a m e t e r  RUPPER 
p a r a m e t e r  BOTHLOW 
p a r a m e t e r  BOTHHIGH 
p a r a m e t e r  LRECOIL 
p a r a m e t e r  RRECOIL 
p a r a m e t e r  BOTHRECOIL 
p a r a m e t e r  HITLEFT 
p a r a m e t e r  HITRIGHT 
p a r a m e t e r  HITLOW 

= 2 ’ d3 ; 

=  0 ; 
=  1 ; 
=  2 ; 
=  3 ; 
=  4 ; 
=  5 ; 

=  8 ; 
=  9 ; 
=  1 0 ; 
=  1 1 ; 
=  1 2 ; 
=  1 3 ; 

=  1 9 ; 

=  2 2 ; 

=  2 4 ; 

=  6 ; 
=  7 ; 

=  1 4 ; 
=  1 5 ; 
=  1 6 ; 
=  1 7 ; 
=  1 8 ; 

=  2 0 ; 
=  2 1 ; 

=  2 3 ; 

=  2 5 ; 

59 

a l w a y s  @  ( p o s e d g e  c l k  )  b e g i n 
i f  ( r e s e t  )  b e g i n

s t a t e  <=  STAND ;

l r p u n c h <=0;

s t a l l  <=  0 ;

o p  s t a l l  i n c  <=0;

i m p a c t  <=  0 ;

b u s y <=0;

n e x t
 e n e r g y  <=  e n e r g y ;

n e x t
 o p  l i f e  <=  o p  l i f e  ; 
n e x t  o p  l i f e  <=  3 1 ; 
n e x t  l  h a n d  x  < =  3 0 0 ; 
n e x t  r  h a n d  x  < =  3 4 0 ; 
n e x t  l  h a n d  y  <=  0 ; 
n e x t  r  h a n d  y  <=  0 ; 
n e x t  l  h a n d  p u n c h  <=  0 ; 
n e x t  r  h a n d  p u n c h  <=  0 ; 
n e x t  h e a d  x  < =  3 2 0 ; 
o p  h i t  <= 0 ; 
e n d  e l s e  b e g i n

c a s e ( f s m s t a t e )

IDLE :  b e g i n

i f  ( s t a r t  )  b e g i n 
b u s y <=1; 
f s m s t a t e<=ACTIVE ; 
e n d  e l s e  b e g i n 
b u s y <=0; 
f s m s t a t e<=IDLE ; 

e n d


e n d

ACTIVE :  b e g i n

s t a l l  <=  s t a l l  +  s t a l l  i n c  ; 
c a s e  ( h i t ) 
2 ’ b 0 0 : b e g i n  p i c t u r e <=p i c t u r e  ; e n d 
2 ’ b 0 1 : b e g i n  p i c t u r e <=HITRIGHT ; e n d 
2 ’ b 1 0 : b e g i n  p i c t u r e <=HITLEFT ; e n d 
2 ’ b 1 1 : b e g i n  p i c t u r e <=HITLOW ; e n d 
e n d c a s e 

c a s e  (  s t a t e ) 
STAND :  b e g i n 
n e x t  e n e r g y  <=  e n e r g y ; 
n e x t  o p  l i f e  <=  o p  l i f e  ; 
o p  h i t  <= 0 ; 
n e x t  l  h a n d  x  <= l  h a n d  x ; 
n e x t  r  h a n d  x  <= r  h a n d  x ; 
n e x t  l  h a n d  y  <= l  h a n d  y ; 
n e x t  r  h a n d  y  <= r  h a n d  y ; 
n e x t  l  h a n d  p u n c h  <=  l  h a n d  p u n c h ; 
n e x t  r  h a n d  p u n c h  <= r  h a n d  p u n c h ; 

60 

n e x t  h e a d  x  <=  ( ( l  h a n d  x > > 1 ) + ( r  h a n d  x > > 1 ) ) ;

/ / s t a l l  <=  0 ;

i f  ( s t a l l  >0 ) b e g i n  / / m i g h t  wan t  t o  move  b e f o r e  d a t a  u p d a t e s

s t a l l  <=  s t a l l  −  1 ;

s t a t e  <= STAND ;

/ / i f  p u n c h 
i n i t i a t e d

i f  ( ( l  h a n d  p u n c h  >  0  &&  e n e r g y  >= l  h a n d  p u n c h ) 
e n d  e l s e 
(  r  h a n d  p u n c h  >  0  &&  e n e r g y  >= r  h a n d  p u n c h ) 
| | 
( l  h a n d  p u n c h  >  0 &&  r  h a n d  p u n c h  >  0 
| | 
&&  e n e r g y  >= l  h a n d  p u n c h  +  r  h a n d  p u n c h ) ) 

b e g i n

s t a t e  <= PUNCH ;

s t a l l  <=  7 ’ d 2 0 ;

i f ( r  h a n d  p u n c h  = =  0 )  b e g i n  / / l e f t  p u n c h

l r p u n c h <=2 ’ b 1 0 ;

p u n c h
 x  <= l  h a n d  x ;

p u n c h  y  <= l
 h a n d  y ;

p u n c h
 s t r <=l  h a n d  p u n c h ;

c a s e ( l
 h a n d  p u n c h )

/ / 2 ’ b 0 0 :  n o t  p o s s i b l e

2 ’ b 0 1 :  b e g i n  p i c t u r e  <= l
 h a n d  y  ?  LJAB :LBODY ; e n d 
2 ’ b 1 0 :  b e g i n  p i c t u r e  <= l  h a n d  y  ?  LHOOK :LHOOKLOW; e n d 
2 ’ b 1 1 :  b e g i n  p i c t u r e  <= l  h a n d  y  ?  LCROSS : LUPPER ; e n d 
e n d c a s e 
i f ( l  h a n d  p u n c h  == 0 )  b e g i n 
e n d  e l s e 
l r p u n c h <=2 ’ b 0 1 ; 
p u n c h  x  <= r  h a n d  x ;

p u n c h  y  <= r
 h a n d  y ;

p u n c h
 s t r <=r  h a n d  p u n c h ;

c a s e ( r
 h a n d  p u n c h )

/ / 2 ’ b 0 0 :  n o t  p o s s i b l e

2 ’ b 0 1 :  b e g i n  p i c t u r e  <= r
 h a n d  y  ?  RJAB :RBODY; e n d 
2 ’ b 1 0 :  b e g i n  p i c t u r e  <= r  h a n d  y  ?  RHOOK:RHOOKLOW; e n d 
2 ’ b 1 1 :  b e g i n  p i c t u r e  <= r  h a n d  y  ?  RCROSS :RUPPER ; e n d 
e n d c a s e 
e n d  e l s e  b e g i n 
/ / s om e o n e  t h i n k s  y ou  p u n c h  w i t h  b o t h  h a n d s 
l r p u n c h <=2 ’ b 1 1 ; 
p u n c h  x  <=  ( ( r  h a n d  x > > 1 ) + ( l  h a n d  x > > 1 ) ) ;

p u n c h  y  <= r
 h a n d  y ;

p u n c h
 s t r <=(( r  h a n d  p u n c h > > 1 )  +  ( l  h a n d  p u n c h > > 1 ) ) ; 
p i c t u r e  <= r  h a n d  y  ?  BOTHHIGH :BOTHLOW;


/ / r i g h t  p u n c h 

e n d


/ / i f  b l o c k 
i n i t i a t e d 
i f  ( l  h a n d  x  >  r  h a n d  x  −  1 2 8

e n d  e l s e 
&&  ˜ ( l
 h a n d  y ˆ r  h a n d  y  ) )  b e g i n

s t a t e  <= BLOCK ;

s t a l l  <=  7 ’ d0 ;

p i c t u r e  <= r
 h a n d  y ?  BLOCKING1 : BLOCKING0 ; 
e n d  e l s e  b e g i n 
s t a t e  <= STAND ; 

61 

c a s e ( { l  h a n d  y , r  h a n d  y } )

2 ’ b 0 0 :  b e g i n  p i c t u r e  <=  STANDING00 ;  e n d

2 ’ b 0 1 :  b e g i n  p i c t u r e  <=  STANDING01 ;  e n d

2 ’ b 1 0 :  b e g i n  p i c t u r e  <=  STANDING10 ;  e n d

2 ’ b 1 1 :  b e g i n  p i c t u r e  <=  STANDING11 ;  e n d

e n d c a s e 
e n d 
e n d  / /STAND 
BLOCK :  b e g i n 
n e x t  e n e r g y  <=  e n e r g y ;

n e x t
 o p  l i f e  <=  o p  l i f e  ;

n e x t

l  h a n d  x  <= l  h a n d  x ;

n e x t
 r  h a n d  x  <= r  h a n d  x ;

l  h a n d  y  <= l  h a n d  y ;

n e x t

n e x t
 r  h a n d  y  <= r  h a n d  y ;

l  h a n d  p u n c h  <=  l  h a n d  p u n c h ;

n e x t

n e x t  r
 h a n d  p u n c h  <= r  h a n d  p u n c h ;

n e x t
 h e a d  x  <=  ( ( l  h a n d  x > > 1 ) + ( r  h a n d  x > > 1 ) ) ;

p i c t u r e  <= r
 h a n d  y ?  BLOCKING1 : BLOCKING0 ; 

i f  ( s t a l l  >0 ) b e g i n

s t a l l  <=  s t a l l  −  1 ;

s t a t e  <=BLOCK;

i f ( l  h a n d  x  >  r  h a n d  x  −  1 2 8 
e n d  e l s e 
&&  ˜ ( l  h a n d  y ˆ r  h a n d  y ) 
&&  l  h a n d  p u n c h ==0 &&  r  h a n d  p u n c h ==0 )  b e g i n 
s t a t e  <= BLOCK ; 
e n d  e l s e  b e g i n

c a s e ( { l
 h a n d  y , r  h a n d  y } ) 
2 ’ b 0 0 :  b e g i n  p i c t u r e  <=  STANDING00 ;  e n d 
2 ’ b 0 1 :  b e g i n  p i c t u r e  <=  STANDING01 ;  e n d 
2 ’ b 1 0 :  b e g i n  p i c t u r e  <=  STANDING10 ;  e n d 
2 ’ b 1 1 :  b e g i n  p i c t u r e  <=  STANDING11 ;  e n d 
e n d c a s e 
s t a t e  <= STAND ; 

e n d

e n d  / /BLOCK

PUNCH :  b e g i n

n e x t  e n e r g y  <=  e n e r g y ;

n e x t
 o p  l i f e  <=  o p  l i f e  ; 
o p	 h i t  <=  0 ; 
i f  ( ˜ i m p a c t )	 b e g i n

i f  ( o p
 h e a d  x  >  p u n c h  x  −  5 0 &&  o p  h e a d  x  <  p u n c h  x  + 5 0 && 
˜ ( o p  s t a t e==BLOCK &&  o p  h a n d  y  ==  p u n c h  y ) )  b e g i n 
n e x t  o p  l i f e  <=  o p  l i f e  −  p u n c h  s t r ; 
c a s e ( p u n c h  s t r ) 
2 ’ b 0 1 :  b e g i n  o p  s t a l l  i n c  <=  7 ’ d 1 5 ;  e n d 
2 ’ b 1 0 :  b e g i n  o p  s t a l l  i n c  <=  7 ’ d 2 5 ;  e n d 
2 ’ b 1 1 :  b e g i n  o p  s t a l l  i n c  <=  7 ’ d 3 5 ;  e n d 
e n d c a s e 
o p	 h i t  <=  ( p u n c h  y  = =  0 )  ?  2 ’ b 1 1 

l r p u n c h ; 

: 

62 

e n d

n e x t
 e n e r g y  <=  e n e r g y  −  p u n c h  s t r  ;

i m p a c t  <=  1 ;

e n d  e l s e  b e g i n

i f  ( s t a l l  >0 ) b e g i n

s t a l l  <=  s t a l l  −  1 ;

s t a t e  <=PUNCH ;

e n d  e l s e  b e g i n

i m p a c t  <=  0 ;

c a s e ( p u n c h  s t r )

/ / 2 ’ b 0 0 :  b e g i n  s t a l l  <=  ; c o m b o s t a l l  < =  ;  e n d 
2 ’ b 0 1 :  b e g i n  s t a l l  <=  7 ’ d 2 0 ;  c o m b o s t a l l  <=  7 ’ d 1 0 ;  e n d 
2 ’ b 1 0 :  b e g i n  s t a l l  <=  7 ’ d 4 0 ;  c o m b o s t a l l  <=  7 ’ d 2 0 ;  e n d 
2 ’ b 1 1 :  b e g i n  s t a l l  <=  7 ’ d 6 0 ;  c o m b o s t a l l  <=  7 ’ d 3 0 ;  e n d 
e n d c a s e 
c a s e ( l r p u n c h ) 
/ / 2 ’ b 0 0 :  n o t  p o s s i b l e 
2 ’ b 0 1 :  b e g i n  p i c t u r e  <=  RRECOIL ;  e n d 
2 ’ b 1 0 :  b e g i n  p i c t u r e  <=  LRECOIL ;  e n d 
2 ’ b 1 1 :  b e g i n  p i c t u r e  <= BOTHRECOIL ;  e n d 
e n d c a s e

s t a t e  <=  RECOIL ;


e n d

e n d 
e n d 
RECOIL : b e g i n 
n e x t  e n e r g y  <=  e n e r g y ;

n e x t
 o p  l i f e  <=  o p  l i f e  ; 
i f  ( s t a l l  >0 ) b e g i n

s t a l l  <=  s t a l l  −  1 ;

/ / i f  h a l f w a y  t h r o u g h  r e c o i l  c h e c k  f o r  combo

i f  ( c o m b o s t a l l  >=  s t a l l  &&

/ / j a b / body−>o p p o s i t e  a n y t h i n g

(	
( p u n c h
 s t r ==1 && 
( 
( l r p u n c h ==2 ’b 1 0  &&  l  h a n d  p u n c h==0 
&&  r  h a n d  p u n c h >0 ) 
| | 
( l r p u n c h ==2 ’b 0 1  &&  l  h a n d  p u n c h >0 
&&  r  h a n d  p u n c h ==0) 

)


)


| | 

/ / c r o s s −>o p p o s i t e  h o o k 
/ / ho o k−>o p p o s i t e  h o o k 
( 
( p u n c h  s t r = = 2  | |  ( p u n c h  s t r ==3 &&  p u n c h  y  = =  0 ) ) 
&&  ( 
( l r p u n c h ==2 ’b 1 0  &&  l  h a n d  p u n c h==0 

63 

&&  r  h a n d  p u n c h ==2) 
| | 
( l r p u n c h ==2 ’b 0 1  &&  l  h a n d  p u n c h==2 
&&  r  h a n d  p u n c h ==0) 
) 

) 

| | 

/ / ho o k−>o p p o s i t e  u p p e r 
( 
( p u n c h  s t r ==2 &&  p u n c h  y==1) && 
( 
( l r p u n c h ==2 ’b 1 0  &&  l  h a n d  p u n c h==0 && 
r  h a n d  p u n c h ==3 &&  r  h a n d  y ==0) 
| | 
( l r p u n c h ==2 ’b 0 1  &&  l  h a n d  p u n c h==3 && 
r  h a n d  p u n c h ==0 &&  l  h a n d  y ==0) 
) 
) 

) 
)  b e g i n 
s t a l l <=7 ’d0 ; 
c o m b o s t a l l <=7 ’d0 ; 
c a s e ( { l  h a n d  y , r  h a n d  y } ) 
2 ’ b 0 0 :  b e g i n  p i c t u r e  <=  STANDING00 ;  e n d 
2 ’ b 0 1 :  b e g i n  p i c t u r e  <=  STANDING01 ;  e n d 
2 ’ b 1 0 :  b e g i n  p i c t u r e  <=  STANDING10 ;  e n d 
2 ’ b 1 1 :  b e g i n  p i c t u r e  <=  STANDING11 ;  e n d 
e n d c a s e

s t a t e  <= STAND ;

e n d  e l s e

s t a t e  <=RECOIL ;

e n d  e l s e  b e g i n

c a s e ( { l
 h a n d  y  , r  h a n d  y } ) 
2 ’ b 0 0 :  b e g i n  p i c t u r e  <=  STANDING00 ;  e n d 
2 ’ b 0 1 :  b e g i n  p i c t u r e  <=  STANDING01 ;  e n d 
2 ’ b 1 0 :  b e g i n  p i c t u r e  <=  STANDING10 ;  e n d 
2 ’ b 1 1 :  b e g i n  p i c t u r e  <=  STANDING11 ;  e n d 
e n d c a s e

s t a t e  <=  STAND ;


e n d


e n d

d e f a u l t  :  s t a t e  <=  STAND ;

e n d c a s e  / / s t a t e


b u s y <=0; 
f s m s t a t e<=IDLE ; 
e n d 
d e f a u l t  :  f s m s t a t e<=IDLE ; 

64 

e n d c a s e  / / f s m s t a t e 

e n d 

e n d 

e n dm o d u l e 

65 

a i


2 2 : 5 8 : 2 6  0 5 / 0 1 / 0 6


‘ t i m e s c a l e  1 n s  /  1 p s

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  Company :

/ /  E n g i n e e r :

/ /

/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name :

/ /  Modu l e  Name : 
/ /  P r o j e c t  Name :

/ /  T a r g e t  D e v i c e  :

/ /  T o o l  v e r s i o n s  :

/ /  D e s c r i p t i o n  :

/ /

/ /  D e p e n d e n c i e s  :

/ /

/ /  R e v i s i o n :

/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d

/ /  A d d i t i o n a l  Comments :

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

m o d u l e  a i ( c l k  ,  r e s e t  ,  s t a r t  ,  b u s y ,

f i g h t e r  s t a l l  ,  p l  h e a d  x ,  p l  l  x ,  p l  r  x , 
l p p ,  r p p ) ; 
l p y ,  r p y , 
l p x ,  r p x , 

i n p u t  c l k  ,  r e s e t  ,  s t a r t  ; 
i n p u t  [ 9 : 0 ]  p l  h e a d  x ,  p l  l  x ,  p l  r  x ; 
f i g h t e r  s t a l l  ; 
i n p u t  [ 6 : 0 ] 

o u t p u t  b u s y ;

o u t p u t [ 9 : 0 ] 
o u t p u t 
o u t p u t [ 1 : 0 ] 

l p x  ,  r p x ;

l p y  ,  r p y ;

l p p ,  r p p ;


/ / o u t p u t [ 9 : 0 ]  x ;


r e g  b u s y ; 
r e g  [ 9 : 0 ] 
r e g 
r e g  [ 1 : 0 ] 

l p x  ,  r p x ; 
l p y  ,  r p y ; 
l p p  ,  r p p ; 

r e g [ 9 : 0 ]  x ,  x d s t ; 

r e g [ 1 : 0 ]  s t a t e ; 
r e g [ 7 : 0 ]  c o u n t e r ; 
r e g [ 1 : 0 ]  m o v e d e l a y ; 

r e g [ 5 : 0 ] 

l o f f s e t  ,  r o f f s e t ; 

w i r e [ 1 5 : 0 ]  d e c i s i o n ; 
w i r e [ 1 5 : 0 ]  m o v e d i s t ; 
w i r e [ 1 5 : 0 ]  p u n c h s t r ; 

66 

w i r e [ 1 5 : 0 ]  h a n d s ;


r e g  e n a b l e  d e c i s i o n  ,  e n a b l e  m o v e d i s t  , 

e n a b l e  p u n c h s t r  ,  e n a b l e  h a n d s ;


,  e n a b l e  d e c i s i o n  ,  d e c i s i o n  ) ; 
l f s r  d e c i s i o n  p r n g ( c l k  ,  r e s e t  ,  1 6  ’ d 1 0 9 2 
l f s r  m o v e d i s t  p r n g ( c l k  ,  r e s e t  ,  1 6  ’ d 3 0 5 4 1  ,  e n a b l e  m o v e d i s t  ,  m o v e d i s t ) ; 
,  e n a b l e  p u n c h s t r  ,  p u n c h s t r ) ; 
l f s r  p u n c h s t r  p r n g ( c l k  ,  r e s e t  ,  1 6  ’ d 2 1 4 1 
l f s r 
h a n d s  p r n g ( c l k  ,  r e s e t  ,  1 6  ’ d 1 1 2 
, 
e n a b l e  h a n d s  , 
h a n d s ) ; 

p a r a m e t e r  DECISIONRATE  =  6 4 ;


p a r a m e t e r  IDLE 
=  2 ’ d0 ;

p a r a m e t e r  DECISION  =  2 ’ d1 ;

p a r a m e t e r  MOVE  =  2 ’ d2 ;

p a r a m e t e r  PUNCH  =  2 ’ d3 ;


/ / d e c i s i o n −m a k i n g 
0 − 6 5 5 3 5

p a r a m e t e r  MOVETHRESH  =  4 0 0 0 0 ;

p a r a m e t e r  PUNCHTHRESH  =  0 ;

/ / p a r a m e t e r  DONOTHING


/ /movement

p a r a m e t e r  MOVELEFT 
p a r a m e t e r  MOVERIGHT 
p a r a m e t e r  MOVECLOSER 
p a r a m e t e r  MOVEAWAY 

/ / p u n c h e s

p a r a m e t e r  WEAK 
p a r a m e t e r  MEDIUM 
/ / p a r a m e t e r  STRONG 

/ / h a n d s

p a r a m e t e r  FACEBLOCK 
p a r a m e t e r  BODYBLOCK 
p a r a m e t e r  FACEOPEN 
p a r a m e t e r  BODYOPEN 
p a r a m e t e r  LUPRDOWN 
p a r a m e t e r  RUPLDOWN 

=  5 5 5 3 5 ;

=  4 5 5 3 5 ;

=  2 0 0 0 0 ;

=  1 5 0 0 0 ;


=  3 0 0 0 0 ;

=  2 0 0 0 0 ;

=


=  5 0 0 0 0 ;

=  4 0 0 0 0 ;

=  3 0 0 0 0 ;

=  2 0 0 0 0 ;

=  1 5 0 0 0 ;

=  1 0 0 0 0 ;


a l w a y s  @( p o s e d g e  c l k )  b e g i n 
e n a b l e  d e c i s i o n <=0; 
e n a b l e  m o v e d i s t <=0; 
e n a b l e  p u n c h s t r <=0; 
e n a b l e  h a n d s <=0; 
l p p <=0; 
r p p <=0; 
i f  ( r e s e t  )  b e g i n 
l p x  <= 1 0 ’ d 2 2 0 ; 
r p x  <= 1 0 ’ d 4 2 0 ; 

67 

l p y  <=1 ’ d1 ;

r p y  <=1 ’ d1 ;

l p p  <=2 ’ d0 ;

r p p  <=2 ’ d0 ;

b u s y <=0;

s t a t e <=0;

c o u n t e r <=0;

m o v e d e l a y <=0;

x <=320 ;

x d s t  < =  3 2 0 ;

l o f f s e t  <=50 ;

r o f f s e t <=50 ;

e n d  e l s e  b e g i n 

c a s e ( s t a t e )

IDLE : b e g i n

i f  ( s t a r t  )  b e g i n

i f  (  f i g h t e r
 s t a l l ==0 )  b e g i n 
c o u n t e r  <=  c o u n t e r  +  1 ; 
m o v e d e l a y  <=  m o v e d e l a y  +  1 ; 

e n d

b u s y  <=  1 ;

s t a t e <=DECISION ;

e n d  e l s e  b e g i n 
b u s y <=0; 
s t a t e <=IDLE ; 

e n d


e n d

DECISION :  b e g i n


i f (& ( m o v e d e l a y ) )  b e g i n 
i f  ( x d s t  >  x )  x  <= x  +  1 ; 
e l s e 
i f ( x d s t  <  x )  x  <= x  −  1 ; 

e n d 

l p x  <= x  − 
l o f f s e t  ; 
r p x  <=  x  +  r o f f s e t  ; 
( x> p l  l  x&&x− p l  l  x  < 5 0  | | 
i f 
x< p l  l  x&&p l  l  x −x < 5 0  | | 
x> p l  r  x&&x−p l  r  x  < 5 0  | | 
x< p l  r  x&&p l  r  x −x < 5 0  )  b e g i n 
i f  ( h a n d s  >  2 0 0 0 0 )  b e g i n 
l o f f s e t  <=  5 0 ; 
r o f f s e t  <=  5 0 ; 
l p y  <=  1 ; 
r p y  <=  1 ; 
e n d  e l s e  b e g i n 
l o f f s e t  <=  5 0 ; 
r o f f s e t  <=  5 0 ; 
l p y  <=  0 ; 
r p y  <=  0 ; 

68 

e n d  e l s e 

e n d  e l s e 

e n d  e l s e 

e n d 
i f ( h a n d s  >  FACEBLOCK)  b e g i n 
l o f f s e t  <=  5 0 ; 
r o f f s e t  <=  5 0 ; 
l p y  <=  1 ; 
r p y  <=  1 ; 
i f ( h a n d s  >  BODYBLOCK)  b e g i n 
l o f f s e t  <=  5 0 ; 
r o f f s e t  <=  5 0 ; 
l p y  <=  0 ; 
r p y  <=  0 ; 
i f ( h a n d s  >  FACEOPEN)  b e g i n 
l o f f s e t  < =  1 0 0 ; 
r o f f s e t  < =  1 0 0 ; 
l p y  <=  1 ; 
r p y  <=  1 ; 
i f ( h a n d s  >  BODYOPEN)  b e g i n 
l o f f s e t  < =  1 0 0 ; 
r o f f s e t  < =  1 0 0 ; 
l p y  <=  0 ; 
r p y  <=  0 ; 
i f ( h a n d s  >  LUPRDOWN)  b e g i n 
l o f f s e t  <=  5 0 ; 
r o f f s e t  <=  5 0 ; 
l p y  <=  1 ; 
r p y  <=  0 ; 
i f ( h a n d s  >  RUPLDOWN)  b e g i n 
l o f f s e t  <=  5 0 ; 
r o f f s e t  <=  5 0 ; 
l p y  <=  0 ; 
r p y  <=  1 ; 
e n d  e l s e  b e g i n 

e n d  e l s e 

e n d  e l s e 

e n d  e l s e 

e n d 

i f  ( c o u n t e r==DECISIONRATE )  b e g i n 
c o u n t e r  <=  0 ; 
e n a b l e  h a n d s  <=  1 ;

e n a b l e  d e c i s i o n  <=  1 ;

b u s y <=1;

i f  ( d e c i s i o n  >  MOVETHRESH )  b e g i n

e n a b l e  d e c i s i o n  <=  1 ; 
e n a b l e  m o v e d i s t <=1; 
s t a t e  <= MOVE; 
i f ( d e c i s i o n  >  PUNCHTHRESH  /∗&& 
( x>p l  h e a d  x &&(x−p l  h e a d  x < 6 4 ) ) 
| | ( x<p l  h e a d  x &&( p l  h e a d  x −x < 6 4 ) ) ∗ / )  b e g i n 
e n a b l e  p u n c h s t r <=1; 
s t a t e  <= PUNCH ; 
e n d  e l s e  b e g i n

b u s y <=0;


e n d  e l s e 

69 

s t a t e  <=  IDLE ; 

e n d 

e n d  e l s e  b e g i n

b u s y <=0;

s t a t e  <=  IDLE ;


e n d 

e n d  e l s e 

e n d 
MOVE :  b e g i n 
b u s y <=0; 
m o v e d e l a y  <= 0 ; 
s t a t e  <=  IDLE ; 
e n a b l e  d e c i s i o n  < =  1 ; / / f o r  n e x t  d e c i s i o n 
i f  ( d e c i s i o n  >  MOVELEFT)  b e g i n 
( x  >  1 2 8  +  m o v e d i s t [ 5 : 0 ] ) 
i f 
x d s t  <= x  −  m o v e d i s t  [ 5 : 0 ] ; 
e l s e  x d s t  < =  1 2 8 ; 
i f ( d e c i s i o n  >  MOVERIGHT )  b e g i n 
( x  <  5 1 2  −  m o v e d i s t  [ 5 : 0 ] ) 
i f 
x d s t  <=  x  +  m o v e d i s t [ 5 : 0 ] ; 
e l s e  x d s t  < =  5 1 2 ; 
i f ( d e c i s i o n  >  MOVECLOSER)  b e g i n 
i f  ( x  >  p l  h e a d  x )  b e g i n 
i f  ( x  >  p l  h e a d  x  +  6 4 ) 
x d s t  <= x  −  m o v e d i s t  [ 5 : 0 ] ; 
e l s e  x d s t  <=  p l  h e a d  x ; 
e n d  e l s e  b e g i n 
i f  ( x  <  p l  h e a d  x  −  6 4 ) 
x d s t  <=  x  +  m o v e d i s t [ 5 : 0 ] ; 
e l s e  x d s t  <=  p l  h e a d  x ; 

e n d  e l s e 

e n d 
i f ( d e c i s i o n  > MOVEAWAY)  b e g i n 
e n d  e l s e 
i f  ( x  >  p l  h e a d  x )  b e g i n 
i f 
( x  <  5 1 2  −  m o v e d i s t  [ 5 : 0 ] ) 
x d s t  <=  x  +  m o v e d i s t [ 5 : 0 ] ; 
e l s e  x d s t  < =  5 1 2 ; 
e n d  e l s e  b e g i n 
i f 

( x  >  1 2 8  +  m o v e d i s t [ 5 : 0 ] ) 
x d s t  <= x  −  m o v e d i s t  [ 5 : 0 ] ; 
e l s e  x d s t  < =  1 2 8 ; 

e n d 
e n d  e l s e  b e g i n 
x d s t<=x ; 

e n d 

e n d 
PUNCH :  b e g i n 
x d s t<=x ;

b u s y <=0;

s t a t e  <=  IDLE ;

i f  ( p u n c h s t r  > WEAK)  b e g i n

i f  ( p u n c h s t r  [ 0 ] )  b e g i n 

70 

l p y  <=  p u n c h s t r [ 1 0 ] ; 
l p p  <=  1 ; 
e n d  e l s e  b e g i n 
r p y  <=  p u n c h s t r [ 1 0 ] ; 
r p p  <=  1 ; 

e n d 
i f ( p u n c h s t r  >  MEDIUM)  b e g i n 
e n d  e l s e 
i f  ( p u n c h s t r  [ 0 ] )  b e g i n 
l p y  <=  p u n c h s t r [ 1 0 ] ; 
l p p  <=  2 ; 
e n d  e l s e  b e g i n 
r p y  <=  p u n c h s t r [ 1 0 ] ; 
r p p  <=  2 ; 

e n d 
e n d  e l s e  b e g i n 
i f  ( p u n c h s t r  [ 0 ] )  b e g i n 
l p y  <=  p u n c h s t r [ 1 0 ] ; 
l p p  <=  3 ; 
e n d  e l s e  b e g i n 
r p y  <=  p u n c h s t r [ 1 0 ] ; 
r p p  <=  3 ; 

e n d 

e n d 

e n d 
d e f a u l t  :  s t a t e <=IDLE ; 
e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

71 

c o mm u n i c a t i o n 

1 3 : 5 4 : 0 1  0 5 / 0 3 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e  c o mm u n i c a t i o n ( b u s  ,  g am e  t y p e  , 
g e t  i n d e x  , 
g e t  e n a b l e  , 
g e t  d a t a  , 
g e t  a c k  , 
s e n d  i n d e x  ,  s e n d  d a t a  ,  s e n d  a c k  ,  s e n d  e n a b l e  ) ; 

/ / i n p u t  c l k  ,  r e s e t  ; 
i n p u t [ 1 : 0 ]  g a m e  t y p e ; 

i n o u t [ 1 5 : 0 ]  b u s ; 

o u t p u t [ 2 : 0 ]  g e t  i n d e x  ; 
o u t p u t [ 9 : 0 ]  g e t  d a t a ; 
g e t  a c k  ; 
i n p u t 
o u t p u t  g e t  e n a b l e ; 

i n p u t  [ 2 : 0 ]  s e n d  i n d e x  ; 
i n p u t  [ 9 : 0 ]  s e n d  d a t a ; 
o u t p u t 
s e n d  a c k ; 
i n p u t  s e n d  e n a b l e  ; 

/ / game  t y p e s

p a r a m e t e r  ONEPLAYER 
p a r a m e t e r  TWOPLAYERM 
p a r a m e t e r  TWOPLAYERS 

=  2 ’ d0 ;

=  2 ’ d1 ;

=  2 ’ d2 ;


/ / d a t a  p i n s 
/ / b u s  a d d r e s s 

i n d e x 
1 5 : 1 3 

d a t a 
1 2 : 3 

a c k 
2 

m  e n a b l e 
1 

s  e n a b l e 
0 

w i r e  g e t  a c k  o v e r r i d e  ;

a s s i g n  g e t  a c k  o v e r r i d e  =  ˜ s e n d  e n a b l e  &&  ˜ g e t  e n a b l e  ?  1 ’ hZ  :  g e t  a c k ;


72 

w i r e  s l a v e  b a c k o u t ;

a s s i g n  s l a v e  b a c k o u t  =  ( g a m e  t y p e==TWOPLAYERM  | | 

( g a m e  t y p e==TWOPLAYERS &&  ˜ g e t  e n a b l e ) ) ;


a s s i g n  b u s [ 1 5 : 2 ]  =  ( / / g a m e  t y p e !=TWOPLAYERM &&  g a m e  t y p e !=TWOPLAYERS )  ?  1 4 ’ hZ  : ( 
( s e n d  e n a b l e  &&  s l a v e  b a c k o u t )


i n d e x [ 2 : 0 ] , s e n d  d a t a [ 9 : 0 ] , 1  ’ hZ 
?  { s e n d

:  { 3  ’ hZ ,  1 0  ’ hZ , 
g e t  a c k } / /  o v e r r i d e } 

} 

) ; 

a s s i g n  b u s [ 1 : 0 ]  =  ( / / g a m e  t y p e !=TWOPLAYERM &&  g a m e  t y p e !=TWOPLAYERS )  ?  2 ’ hZ  : ( 
( g a m e  t y p e==TWOPLAYERM )  ?  (

/ ∗ m a s t e r ∗ /

{ s e n d
 e n a b l e  , 1  ’ hZ } 

) : (


) 

) ; 

/ ∗  s l a v e ∗ /

{ 1 ’ hZ , s e n d
 e n a b l e } 

a s s i g n  { g e t  i n d e x [ 2 : 0 ] , g e t  d a t a [ 9 : 0 ] , s e n d  a c k }  =  b u s [ 1 5 : 2 ] ; 
a s s i g n  g e t  e n a b l e  =  ( g a m e  t y p e==TWOPLAYERM )  ?  b u s [ 0 ]  :  b u s [ 1 ] ; 

e n dm o d u l e 

73 

g e t u s e r d a t a 

1 8 : 2 1 : 0 1  0 4 / 3 0 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d

/ /  A d d i t i o n a l  Comments :

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

m o d u l e  g e t d i s p d a t a ( c l k ,  r e s e t ,  s t a r t  ,  b u s y , 
i n d e x ,  d a t a ,  e n a b l e ,  a c k ,

p l x ,  p r x ,  p l y ,  p r y ,  ohx ,  o p i c ,  t i m e  l e f t  ,  p l b ,  o l b ,  p eb ,  o e b ,  p l p , 
p r p  ,  e n d r o u n d  ,  v a l i d  ) ; 
i n p u t  c l k  ,  r e s e t  ,  s t a r t  ,  e n a b l e ; 
i n p u t [ 2 : 0 ] 
i n d e x ; 
o u t p u t  b u s y ; 
o u t p u t [ 2 : 0 ]  a c k ; 
o u t p u t  v a l i d  ; 

i n p u t  [ 9 : 0 ]  d a t a ;

o u t p u t [ 9 : 0 ]  p l x ,  p r x ,  ohx ;

o u t p u t  p l y  ,  p r y ;

o u t p u t [ 4 : 0 ]  o p i c ,  p l b ,  o l b ,  p eb ,  o e b ;

l e f t  ; 
o u t p u t [ 7 : 0 ] 
t i m e

o u t p u t [ 1 : 0 ]  p l p ,  p r p ; 
o u t p u t  e n d r o u n d ; 

r e g  b u s y ;

r e g [ 2 : 0 ]  a c k ;

r e g [ 9 : 0 ]  p l x ,  p r x ,  ohx ;

r e g  p l y  ,  p r y ;

r e g [ 4 : 0 ]  o p i c ,  p l b ,  o l b ,  p eb ,  o e b ;

r e g [ 7 : 0 ] 
t i m e

l e f t  ; 
r e g [ 1 : 0 ]  p l p ,  p r p ; 
r e g  e n d r o u n d ; 
r e g  v a l i d  ; 

r e g  s t a t e  ; 

r e g  e n a b l e  s y n c 1  ,  e n a b l e  s y n c  ; 
r e g [ 9 : 0 ]  d a t a  s y n c 1  ,  d a t a  s y n c ; 

74 

r e g [ 2 : 0 ] 

i n d e x  s y n c 2  , 

i n d e x  s y n c 1  , 

i n d e x  s y n c  ; 

p a r a m e t e r  IDLE  =  0 ; 
p a r a m e t e r  GET  =  1 ; 

=  3 ’ d0 ; 
p a r a m e t e r  DONE 
=  3 ’ d1 ;  / / 1 0 
p a r a m e t e r  PLX 
p a r a m e t e r  PRX 
=  3 ’ d2 ;  / / 1 0 
p a r a m e t e r  PLRY TL  =  3 ’ d3 ;  / / 1 , 1 , 8 
p a r a m e t e r  OHX 
=  3 ’ d4 ;  / / 1 0 
p a r a m e t e r  OPIC ENDROUND PLRP=  3 ’ d5 ;  / / 5 , o , 2 , 2 
p a r a m e t e r  LIFEBAR  =  3 ’ d6 ;  / / 5 , 5 
p a r a m e t e r  ENERBAR  =  3 ’ d7 ;  / / 5 , 5 

a l w a y s  @  ( p o s e d g e  c l k  )  b e g i n 
e n a b l e  s y n c 1  <=  e n a b l e ; 
e n a b l e  s y n c  <=  e n a b l e  s y n c 1  ; 
d a t a  s y n c 1  <=  d a t a ;

d a t a
 s y n c  <=  d a t a  s y n c 1 ; 
i n d e x  s y n c 2  <=  i n d e x ;

i n d e x
 s y n c 1  <=  i n d e x  s y n c 2  ; 
i n d e x  s y n c  <=  i n d e x  s y n c 1  ; 

i f  ( r e s e t  )  b e g i n

s t a t e  <=IDLE ;

b u s y <=0;

a c k <=2 ’d0 ;

p l x <=300 ;

p r x <=340 ;

ohx <=300 ;

p l y <=1;

p r y <=1;

o p i c <=0;

p l b <=31 ;

o l b <=31 ;

p eb <=31 ;

o e b <=31 ;

l e f t  <=180 ; 
t i m e

e n d r o u n d <=0; 
v a l i d <=0; 
i f ( s t a r t )  b e g i n 
s t a t e  <=GET ; 
a c k <=2 ’d0 ; 
b u s y <=1; 
v a l i d <=0; 
e n d  e l s e  b e g i n

c a s e ( s t a t e )

IDLE :  b e g i n

s t a t e  <=IDLE ; 
b u s y <=0; 

e n d  e l s e 

75 

e n d 
GET :  b e g i n 
b u s y  <= 1 ; 
s t a t e <=GET ; 
i f ( i n d e x  s y n c != a c k ) b e g i n 
a c k  <=  i n d e x  s y n c  ; 

c a s e ( i n d e x  s y n c ) 
DONE : b e g i n 
s t a t e  <=  IDLE ; 
b u s y  <= 0 ; 
v a l i d <=1; 

e n d 
PLX : b e g i n 
p l x  <=  d a t a ; 

e n d 
PRX : b e g i n 
p r x  <=  d a t a ; 

e n d 
PLRY TL : b e g i n 
p l y  <=  d a t a [ 9 ] ; 
p r y  <=  d a t a [ 8 ] ; 
t i m e  l e f t  <=  d a t a [ 7 : 0 ] ; 

e n d 
OHX : b e g i n 
ohx  <=  d a t a ; 

e n d 
OPIC ENDROUND PLRP : b e g i n 
o p i c  <=  d a t a [ 9 : 5 ] ; 
e n d r o u n d  <= d a t a  [ 4 ] ; 
p l p <=  d a t a [ 3 : 2 ] ; 
p r p  <=  d a t a [ 1 : 0 ] ; 

e n d 
LIFEBAR : b e g i n 
p l b  <=  d a t a [ 9 : 5 ] ; 
o l b  <=  d a t a [ 4 : 0 ] ; 

e n d 
ENERBAR : b e g i n 
p e b  <=  d a t a [ 9 : 5 ] ; 
o e b  <=  d a t a [ 4 : 0 ] ; 
/ / s t a t e  <=  IDLE ; 
/ / b u s y  <= 0 ; 
v a l i d <=1; 

e n d 
d e f a u l t  :  b e g i n 
s t a t e  <=  IDLE ; 
b u s y  <= 0 ; 

e n d 
e n d c a s e 

e n d 

76 

e n d 
e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

77 

g e t u s e r d a t a 

1 8 : 2 1 : 0 1  0 4 / 3 0 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e  g e t u s e r d a t a ( c l k ,  r e s e t ,  s t a r t  ,  b u s y , 
i n d e x ,  d a t a ,  e n a b l e ,  a c k , 
l p x ,  r p x , 
l p y ,  r p y , 
l p p ,  r p p ,  v a l i d ) ; 
i n p u t  c l k  ,  r e s e t  ,  s t a r t  ,  e n a b l e ; 
i n p u t [ 2 : 0 ] 
i n d e x ; 
o u t p u t  b u s y ; 
o u t p u t [ 2 : 0 ]  a c k ; 
o u t p u t [ 9 : 0 ] 
l p x  ,  r p x ; 
o u t p u t  l p y  ,  r p y ; 
o u t p u t [ 1 : 0 ] 
l p p ,  r p p ; 
i n p u t  [ 9 : 0 ]  d a t a ; 
o u t p u t  v a l i d  ; 

r e g  b u s y ; 
r e g [ 2 : 0 ]  a c k ; 
r e g [ 9 : 0 ] 
l p x ,  r p x ; 
r e g  l p y  ,  r p y ; 
r e g [ 1 : 0 ] 
l p p ,  r p p ; 
r e g  v a l i d  ; 
r e g  s t a t e  ; 

r e g  e n a b l e  s y n c 1  ,  e n a b l e  s y n c  ; 
r e g [ 9 : 0 ]  d a t a  s y n c 1  ,  d a t a  s y n c ; 
i n d e x  s y n c 2  , 
i n d e x  s y n c 1  , 
r e g [ 2 : 0 ] 

i n d e x  s y n c  ; 

/ / r e g  d e b o u n c e r e s e t ; 

/ / d e b o u n c e  d b i 0 ( d e b o u n c e r e s e t  ,  c l k  , 
/ / d e b o u n c e  d b i 1 ( d e b o u n c e r e s e t  ,  c l k  , 
/ / d e b o u n c e  d b i 2 ( d e b o u n c e r e s e t  ,  c l k  , 

i n d e x [ 0 ]  , 
i n d e x [ 1 ]  , 
i n d e x [ 2 ]  , 

i n d e x  s y n c  [ 0 ] ) ; 
i n d e x  s y n c  [ 1 ] ) ; 
i n d e x  s y n c  [ 2 ] ) ; 

p a r a m e t e r  IDLE  =  0 ; 

78 

p a r a m e t e r  GET  =  1 ; 

p a r a m e t e r  DONE  =  3 ’ d0 ; 
p a r a m e t e r  LPX  =  3 ’ d1 ; 
p a r a m e t e r  RPX  =  3 ’ d2 ; 
p a r a m e t e r  LPYP  =  3 ’ d3 ; 
p a r a m e t e r  RPYP  =  3 ’ d4 ; 

a l w a y s  @  ( p o s e d g e  c l k  )  b e g i n 
e n a b l e  s y n c 1  <=  e n a b l e ;

e n a b l e
 s y n c  <=  e n a b l e  s y n c 1  ;

d a t a
 s y n c 1  <=  d a t a ;

d a t a
 s y n c  <=  d a t a  s y n c 1 ;

i n d e x
 s y n c 2  <=  i n d e x ;

i n d e x
 s y n c 1  <=  i n d e x  s y n c 2  ;

i n d e x
 s y n c  <=  i n d e x  s y n c 1  ;

/ / d e b o u n c e r e s e t  <= 0 ;

i f  ( r e s e t  )  b e g i n

s t a t e  <=IDLE ;

b u s y <=0;

a c k <=2 ’d0 ;

l p x <=0;

r p x <=0;

l p y <=0;

r p y <=0;

l p p <=0;

r p p <=0;

v a l i d <=0;

/ / d e b o u n c e r e s e t <=1;

i f ( s t a r t )  b e g i n

e n d  e l s e 
s t a t e  <=GET ;

i n d e x <=0; 
/ / l a s t

a c k <=2 ’d0 ; 
b u s y <=1; 
v a l i d <=0; 
e n d  e l s e  b e g i n

c a s e ( s t a t e )

IDLE :  b e g i n

s t a t e  <=IDLE ; 
b u s y <=0; 

e n d 
GET :  b e g i n 
b u s y  <= 1 ; 
s t a t e <=GET ; 

i f  ( / ∗  e n a b l e  &&  ∗ / i n d e x  s y n c != a c k )  b e g i n 
a c k  <=  i n d e x  s y n c  ; 
/ / i f  ( e n a b l e ) 
c a s e ( i n d e x  s y n c ) 
DONE : b e g i n 

79 

s t a t e  <=  IDLE ; 
b u s y  <= 0 ; 
v a l i d <=1; 

e n d 
LPX : b e g i n 
l p x  <=  d a t a ; / /  s y n c ; 

e n d 
RPX : b e g i n 
r p x  <=  d a t a ; / /  s y n c ; 

e n d 
LPYP : b e g i n 
l p y  <=  d a t a [ 9 ] ; / /  s y n c  [ 9 ] ; 
l p p  <=  d a t a [ 0 ] ; / /  s y n c  [ 1 : 0 ] ; 

e n d 
RPYP : b e g i n 
r p y  <=  d a t a [ 9 ] ; / /  s y n c  [ 9 ] ; 
r p p  <=  d a t a [ 0 ] ; / /  s y n c  [ 1 : 0 ] ; 
/ / s t a t e  <=  IDLE ; 
/ / b u s y  <= 0 ; 
v a l i d <=1; 

e n d 
d e f a u l t  :  b e g i n 
s t a t e  <=  IDLE ; 
b u s y  <= 0 ; 

e n d 
e n d c a s e 

e n d 

e n d 

e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

80 

s e n d d i s p d a t a 

1 9 : 3 9 : 4 9  0 4 / 3 0 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d

/ /  A d d i t i o n a l  Comments :

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

m o d u l e  s e n d d i s p d a t a ( c l k ,  r e s e t  ,  s t a r t ,  b u s y , 
i n d e x ,  d a t a ,  e n a b l e ,  a c k ,

p l x ,  p r x ,  p l y ,  p r y ,  ohx ,  o p i c ,  t i m e  l e f t  ,  p l b ,  o l b ,  p eb ,  o e b ,  p l p ,  p r p ,  e n d r o u n d ) ;

i n p u t  c l k  ,  r e s e t  ,  s t a r t  ;

o u t p u t  b u s y  ,  e n a b l e ;


i n p u t  [ 9 : 0 ]  p l x  ,  p r x  ,  ohx ;

i n p u t  p l y  ,  p r y ;

i n p u t [ 4 : 0 ]  o p i c ,  p l b ,  o l b ,  p eb ,  o e b ;

l e f t  ; 
[ 7 : 0 ]  t i m e

i n p u t 
i n p u t 
[ 1 : 0 ]  p l p  ,  p r p ; 
i n p u t  e n d r o u n d ; 

o u t p u t [ 2 : 0 ] 
i n d e x ; 
i n p u t 
[ 2 : 0 ]  a c k ; 
o u t p u t [ 9 : 0 ]  d a t a ; 

r e g [ 2 : 0 ]  a c k  s y n c 1 ; 
r e g [ 2 : 0 ]  a c k  s y n c ; 
r e g [ 2 : 0 ] 
i n d e x ; 
r e g  b u s y ; 
r e g  s t a t e  ; 
r e g [ 9 : 0 ]  d a t a ; 

p a r a m e t e r  IDLE  =  0 ; 
p a r a m e t e r  SEND  =  1 ; 

=  3 ’ d0 ; 
p a r a m e t e r  DONE 
=  3 ’ d1 ;  / / 1 1 
p a r a m e t e r  PLX 
p a r a m e t e r  PRX 
=  3 ’ d2 ;  / / 1 1 
p a r a m e t e r  PLRY TL  =  3 ’ d3 ;  / / 1 , 1 , 8 
p a r a m e t e r  OHX 
=  3 ’ d4 ;  / / 1 1 

81 

p a r a m e t e r  OPIC ENDROUND PLRP=  3 ’ d5 ;  / / 5 , 1 , 2 , 2 
p a r a m e t e r  LIFEBAR  =  3 ’ d6 ;  / / 5 , 5 
p a r a m e t e r  ENERBAR  =  3 ’ d7 ;  / / 5 , 5 

a s s i g n  e n a b l e  =  b u s y ; 

a l w a y s  @( p o s e d g e  c l k )  b e g i n 
a c k  s y n c 1  <=  a c k ;

a c k
 s y n c  <=  a c k  s y n c 1 ; 
i f  ( r e s e t  )  b e g i n

a c k  s y n c 1  <=  2 ’ b 0 0 ;

a c k
 s y n c  <=  2 ’ b 0 0 ;

b u s y  <= 0 ;

s t a t e  <=  IDLE ;

d a t a  <= 0 ;

i n d e x  <=DONE ;

i f ( s t a r t )  b e g i n

s t a t e  <=SEND ;

i n d e x<=PLX ;

b u s y  <= 1 ;

d a t a  <= p l x  ;

e n d  e l s e  b e g i n

c a s e ( s t a t e )

IDLE :  b e g i n

s t a t e  <=IDLE ; 
i n d e x<=DONE ; 
b u s y  <= 0 ; 
d a t a  <= 0 ; 

e n d  e l s e 

e n d 
SEND :  b e g i n 
b u s y  <=  1 ; 
i f  ( a c k  s y n c==i n d e x )  b e g i n 
c a s e ( i n d e x ) 
DONE :  b e g i n 
b u s y  <= 0 ; 
s t a t e  <=  IDLE ; 
i n d e x  <= DONE ; 
d a t a  <= 0 ; 

e n d 
PLX :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <= PRX ; 
d a t a  <=  p r x ; 

e n d 
PRX :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <=  PLRY TL ; 
d a t a  <=  { p l y  , p r y ,  t i m e  l e f t  } ; 

e n d 
PLRY TL :  b e g i n 

82 

s t a t e  <=  SEND ; 
i n d e x  <= OHX ; 
d a t a  <=  ohx ; 

e n d 
OHX :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <=  OPIC ENDROUND PLRP ; 
d a t a  <=  { o p i c  , e n d r o u n d , p l p  , p r p } ; 

e n d 
OPIC ENDROUND PLRP :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <=  LIFEBAR ; 
d a t a  <=  { p l b  , o l b } ; 

e n d 
LIFEBAR :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <= ENERBAR ; 
d a t a  <=  {p eb , o e b } ; 

e n d 
ENERBAR :  b e g i n 
b u s y  <= 0 ; 
s t a t e  <=  IDLE ; 
i n d e x  <= DONE ; 
d a t a  <= 0 ; 

e n d 
e n d c a s e 

e n d 

e n d 
d e f a u l t  :  s t a t e  <=IDLE ; 
e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

83 

s e n d u s e r d a t a 

1 8 : 2 0 : 5 0  0 4 / 3 0 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e  s e n d u s e r d a t a ( c l k  ,  r e s e t  ,  s t a r t  ,  b u s y  , 
i n d e x  ,  d a t a  ,  e n a b l e  ,  a c k  , 
l p x  ,  r p x  , 
l p y  ,  r p y  , 
l p p  ,  r p p ) ; 
i n p u t  c l k  ,  r e s e t  ,  s t a r t  ; 
i n p u t  [ 9 : 0 ] 
l p x  ,  r p x ; 
i n p u t 
l p y  ,  r p y ; 
o u t p u t  b u s y  ,  e n a b l e ; 
l p p  ,  r p p ; 
i n p u t  [ 1 : 0 ] 
o u t p u t  [ 2 : 0 ] 
i n d e x ; 
i n p u t 
[ 2 : 0 ]  a c k ; 
o u t p u t  [ 9 : 0 ]  d a t a ; 

r e g [ 2 : 0 ]  a c k  s y n c 1 ; 
r e g [ 2 : 0 ]  a c k  s y n c ; 
r e g [ 2 : 0 ] 
i n d e x ; 
r e g  b u s y ; 
r e g  s t a t e  ; 
r e g [ 9 : 0 ]  d a t a ; 

p a r a m e t e r  IDLE  =  0 ; 
p a r a m e t e r  SEND  =  1 ; 

p a r a m e t e r  DONE  =  3 ’ d0 ; 
p a r a m e t e r  LPX  =  3 ’ d1 ; 
p a r a m e t e r  RPX  =  3 ’ d2 ; 
p a r a m e t e r  LPYP  =  3 ’ d3 ; 
p a r a m e t e r  RPYP  =  3 ’ d4 ; 

a s s i g n  e n a b l e  =  b u s y ; 

a l w a y s  @( p o s e d g e  c l k )  b e g i n 
a c k  s y n c 1  <=  a c k ; 

84 

e n d  e l s e 

a c k  s y n c  <=	 a c k  s y n c 1 ; 
i f  ( r e s e t  )  b e g i n 
a c k  s y n c 1  <=  2 ’ d0 ; 
a c k  s y n c  <=  2 ’ d0 ;

b u s y  <= 0 ;

s t a t e  <=  IDLE ;

d a t a  <= 0 ;

i n d e x  <=DONE ;

i f ( s t a r t )  b e g i n 
s t a t e  <=SEND ; 
i n d e x<=LPX ; 
b u s y  <= 1 ; 
d a t a  <= l p x  ; 
e n d  e l s e  b e g i n 
c a s e ( s t a t e ) 
IDLE :  b e g i n 
s t a t e  <=IDLE ; 
i n d e x<=DONE ; 
b u s y  <= 0 ; 
d a t a  <= 0 ; 

e n d 
SEND :  b e g i n 
b u s y  <=  1 ; 
i f  ( a c k  s y n c==i n d e x )  b e g i n 
c a s e ( i n d e x ) 
DONE :	
b e g i n 
s t a t e  <=  IDLE ; 
i n d e x<=DONE ; 
b u s y  <= 0 ; 
d a t a  <= 0 ; 

e n d 
LPX :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <= RPX ; 
d a t a  <=  r p x ; 

e n d 
RPX :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <=  LPYP ; 
d a t a  <=  { l p y  , 7 ’ d0 , l p p } ; 

e n d 
LPYP :  b e g i n 
s t a t e  <=  SEND ; 
i n d e x  <= RPYP ; 
d a t a  <=  { r p y  , 7  ’ d0 , r p p } ; 

e n d 
RPYP :  b e g i n 
/ / s t a t e  <=  IDLE ; 
s t a t e  <=  SEND ; 
i n d e x  <= DONE ; 
/ / b u s y  <= 0 ; 

85 

d a t a  <= 0 ; 

e n d 
d e f a u l t  : 

b e g i n 
s t a t e  <=  IDLE ; 
i n d e x<=DONE ; 
b u s y  <= 0 ; 
d a t a  <= 0 ; 

e n d 
e n d c a s e 

e n d 

e n d 
d e f a u l t  :  s t a t e  <=IDLE ; 
e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

86 

/ /  S w i t c h  D e b o u n c e  Modu l e 
/ /  u s e  y o u r  s y s t e m  c l o c k 
i n p u t 
f o r  t h e  c l o c k 
/ /  t o  p r o d u c e  a  s y n c h r o n o u s  ,  d e b o u n c e d  o u t p u t 
m o d u l e  d e b o u n c e  (  r e s e t  ,  c l o c k  ,  n o i s y  ,  c l e a n ) ; 
p a r a m e t e r  DELAY  =  2 7 0 0 0 0 ; 
/ /  . 0 1  s e c  w i t h  a  2 7Mhz  c l o c k

i n p u t  r e s e t  ,  c l o c k  ,  n o i s y  ;

o u t p u t  c l e a n ;


[ 1 8 : 0 ]  c o u n t ;

r e g 
r e g  new ,  c l e a n ;


a l w a y s  @( p o s e d g e  c l o c k )

i f  ( r e s e t )

b e g i n

c o u n t  <=  0 ;

new  <=  n o i s y  ;

c l e a n  <=  n o i s y  ;


e n d

e l s e 
i f  ( n o i s y  ! =  new )

b e g i n

new  <=  n o i s y  ;

c o u n t  <=  0 ;


e n d

e l s e 
i f  ( c o u n t  == DELAY)

c l e a n  <=  new ;

e l s e

c o u n t  <=  c o u n t + 1 ;


e n dm o d u l e 

87 

d e l a y 

1 6 : 2 5 : 5 4  0 3 / 1 2 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e  d e l a y ( c l k  , 
i n  ,  o u t ) ; 
i n p u t  c l k  , 
i n  ; 

o u t p u t  o u t ; 

r e g  d e l 1  ,  d e l 2  ,  o u t ; 

a l w a y s  @  ( p o s e d g e  c l k  )  b e g i n 
d e l 1  <=  i n ; 
d e l 2  <=  d e l 1  ; 
o u t  <=  d e l 2  ; 

e n d 

e n dm o d u l e 

88 

d i s p l a y
 1 6 h e x . v 
24−S ep −05 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  6 . 1 1 1  FPGA  L a b k i t  −−  Hex  d i s p l a y  d r i v e r

/ /

/ /

/ /  F i l e  : 
/ /  D a t e : 
/ / 
/ /  C r e a t e d :  A p r i l  2 7 ,  2 0 0 4 
/ /  A u t h o r  :  Na than  I c k e s 
/ / 
/ /  T h i s  m o d u l e  d r i v e s  t h e 
l a b k i t  h e x  d i s p l a y s  and  s h o w s  t h e  v a l u e  o f 
/ /  8  b y t e s  ( 1 6  h e x  d i g i t s  )  on  t h e  d i s p l a y s  . 
/ / 
/ /  2 4 − S ep − 0 5  I k e  :  u p d a t e d  t o  u s e  new  r e s e t −o n c e  s t a t e  m a c h i n e  ,  r em o v e  c l e a r 
/ /  0 2 −Nov− 0 5  I k e  :  u p d a t e d  t o  make  i t  c o m p l e t e l y  s y n c h r o n o u s 
/ / 
/ /  I n p u t s  : 
/ / 
/ / 
/ / 
/ / 
/ / 
/ /  O u t p u t s : 
/ / 
/ / 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 

r e s e t 
−  a c t i v e  h i g h 
c l o c k  2 7 m h z  −  t h e  s y n c h r o n o u s  c l o c k 
−  6 4  b i t s  ;  e a c h  4  b i t s  g i v e s  a  h e x  d i g i t 
d a t a 

d i s p  ∗

−  d i s p l a y 

l i n e s  u s e d 

i n  t h e  6 . 1 1 1  l a b k i t  ( r e v  0 0 3  &  0 0 4 ) 

m o d u l e  d i s p l a y  1 6 h e x  (  r e s e t  ,  c l o c k  2 7 m h z  ,  d a t a  i n  , 
d i s p  b l a n k  ,  d i s p  c l o c k  ,  d i s p  r s  ,  d i s p  c e  b , 
d i s p  r e s e t  b  ,  d i s p  d a t a  o u t  ) ; 

i n p u t  r e s e t  ,  c l o c k  2 7 m h z  ; 
i n  ; 
[ 6 3 : 0 ]  d a t a

i n p u t 

/ /  c l o c k  and  r e s e t  ( a c t i v e  h i g h  r e s e t )

/ /  1 6  h e x  n i b b l e s  t o  d i s p l a y 

o u t p u t  d i s p  b l a n k  ,  d i s p  c l o c k  ,  d i s p  d a t a  o u t  ,  d i s p  r s  ,  d i s p  c e  b , 
d i s p  r e s e t  b ; 

r e g  d i s p  d a t a  o u t  ,  d i s p  r s  ,  d i s p  c e  b  ,  d i s p  r e s e t  b ; 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  D i s p l a y  C l o c k

/ /

/ /  G e n e r a t e  a  5 0 0 kHz  c l o c k 
/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


f o r  d r i v i n g  t h e  d i s p l a y s  .


r e g 

[ 5 : 0 ]  c o u n t ;


89 

/ / 

[ 7 : 0 ]  r e s e t  c o u n t ; 
r e g 
o l d  c l o c k  ; 
r e g 
w i r e 
w i r e 

d r e s e t ; 
c l o c k  =  ( c o u n t < 2 7 )  ?  0  :  1 ; 

a l w a y s  @( p o s e d g e  c l o c k  2 7 m h z ) 
b e g i n 
c o u n t  <=  r e s e t  ?  0  :  ( c o u n t = = 5 3  ?  0  :  c o u n t + 1 ) ; 
r e s e t  c o u n t  <=  r e s e t  ?  1 0 0  :  ( ( r e s e t  c o u n t = = 0 )  ?  0  :  r e s e t  c o u n t  − 1 ) ; 
o l d  c l o c k  <=  c l o c k  ; 
e n d 

/ / 

a s s i g n  d r e s e t  =  ( r e s e t  c o u n t  ! =  0 ) ;

a s s i g n  d i s p  c l o c k  =  ˜ c l o c k ;

c l o c k  t i c k  =  ( ( c o u n t = = 2 7 )  ?  1  :  0 ) ;

w i r e 
c l o c k  t i c k  =  c l o c k  &  ˜ o l d  c l o c k ; 
w i r e 

/ / 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  D i s p l a y  S t a t e  M a c h i n e

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


r e g 
r e g 
r e g 
r e g 
r e g 
r e g 
r e g 

[ 7 : 0 ]  s t a t e  ; 
[ 9 : 0 ]  d o t  i n d e x  ; 
[ 3 1 : 0 ]  c o n t r o l ; 
[ 3 : 0 ]  c h a r  i n d e x  ; 
[ 3 9 : 0 ]  d o t s  ; 
[ 3 : 0 ]  n i b b l e  ; 
[ 6 3 : 0 ]  d a t a ; 

/ /  FSM  s t a t e 
/ /  i n d e x  t o  c u r r e n t  d o t  b e i n g  c l o c k e d  o u t 
/ /  c o n t r o l  r e g i s t e r 
/ /  i n d e x  o f  c u r r e n t  c h a r a c t e r 
/ /  d o t s 
f o r  a  s i n g l e  d i g i t 
/ /  h e x  n i b b l e  o f  c u r r e n t  c h a r a c t e r 

a s s i g n  d i s p  b l a n k  =  1 ’ b0 ;  / /  l o w  <=  n o t  b l a n k e d 

a l w a y s  @( p o s e d g e  c l o c k  2 7 m h z ) 
i f  (  c l o c k  t i c k ) 
b e g i n 
i f  ( d r e s e t ) 
b e g i n 
s t a t e  <=  0 ; 
d o t  i n d e x  <=  0 ; 
c o n t r o l  <=  3 2 ’ h7F7F7F7F ; 
e n d 
e l s e 
c a s e x  (  s t a t e ) 
8 ’ h 0 0 : 
b e g i n 
/ /  R e s e t  d i s p l a y s 
d i s p  d a t a  o u t  <=  1 ’ b0 ; 
d i s p  r s  <=  1 ’ b0 ;  / /  d o t  r e g i s t e r 
d i s p  c e  b  <=  1 ’ b1 ; 
d i s p  r e s e t  b  <=  1 ’ b0 ; 

90 

d o t  i n d e x  <=  0 ;

s t a t e  <=  s t a t e + 1 ;


e n d


8 ’ h 0 1 : 
b e g i n

/ /  End  r e s e t

d i s p  r e s e t  b  <=  1 ’ b1 ;

s t a t e  <=  s t a t e + 1 ;

e n d 

8 ’ h 0 2 : 
b e g i n

/ /  I n i t i a l i z e  d o t  r e g i s t e r  ( s e t  a l l  d o t s  t o  z e r o )

d i s p  c e  b  <=  1 ’ b0 ;

d i s p
 d a t a  o u t  <=  1 ’ b0 ;  / /  d o t  i n d e x  [ 0 ] ;

i f  ( d o t  i n d e x  ==  6 3 9 )

s t a t e  <=  s t a t e + 1 ;

e l s e

d o t


i n d e x  <=  d o t  i n d e x + 1 ;


e n d


8 ’ h 0 3 : 
b e g i n 
/ /  L a t c h  d o t  d a t a 
d i s p  c e  b  <=  1 ’ b1 ; 
d o t  i n d e x  <=  3 1 ; 
s t a t e  <=  s t a t e + 1 ; 
e n d 

/ /  r e −p u r p o s e  t o 

i n i t  c t r l  r e g 

8 ’ h 0 4 : 
b e g i n

/ /  S e t u p  t h e  c o n t r o l  r e g i s t e r

d i s p  r s  <=  1 ’ b1 ;  / /  S e l e c t  t h e  c o n t r o l  r e g i s t e r

d i s p
 c e  b  <=  1 ’ b0 ;

d i s p
 d a t a  o u t  <=  c o n t r o l [ 3 1 ] ;

c o n t r o l  <=  { c o n t r o l [ 3 0 : 0 ] ,  1 ’ b0 } ; 
i f  ( d o t  i n d e x  ==  0 )

s t a t e  <=  s t a t e + 1 ;

e l s e

d o t


i n d e x  <=  d o t  i n d e x − 1 ;


/ /  s h i f t 

l e f t


e n d


8 ’ h 0 5 : 
b e g i n

/ /  L a t c h  t h e  c o n t r o l  r e g i s t e r  d a t a  /  d o t  d a t a

d i s p  c e  b  <=  1 ’ b1 ;

d o t  i n d e x  <=  3 9 ; 
c h a r  i n d e x  <=  1 5 ; 
d a t a  <=  d a t a

i n  ;

s t a t e  <=  s t a t e + 1 ;


/ /  i n i t 
f o r  s i n g l e  c h a r

/ /  s t a r t  w i t h  MS  c h a r


91 

e n d 

8 ’ h 0 6 : 
b e g i n 
/ /  Lo ad  t h e  u s e r  ’ s  d o t  d a t a  i n t o  t h e  d o t  r e g  ,  c h a r  by  c h a r 
d i s p  r s  <=  1 ’ b0 ; 
/ /  S e l e c t  t h e  d o t  r e g i s t e r 
d i s p  c e  b  <=  1 ’ b0 ;

d i s p
 d a t a  o u t  <=  d o t s  [ d o t  i n d e x  ] ;  / /  d o t  d a t a  f r om  msb 
i f  ( d o t  i n d e x  ==  0 ) 
i f  ( c h a r  i n d e x  ==  0 ) 
s t a t e  <=  5 ; 
e l s e 
b e g i n

i n d e x  <=  c h a r  i n d e x  −  1 ;  / /  g o t o  n e x t  c h a r 
c h a r

d a t a  <=  d a t a  i n  ;

d o t  i n d e x  <=  3 9 ;


/ /  a l l  d o n e , 

l a t c h  d a t a 

e n d


e l s e

d o t


e n d 

i n d e x  <=  d o t  i n d e x − 1 ; 

/ /  e l s e 

l o o p  t h r u  a l l  d o t s 

e n d c a s e  / /  c a s e x ( s t a t e )


e n d


a l w a y s  @  ( d a t a  o r  c h a r  i n d e x ) 
c a s e  ( c h a r  i n d e x )

4 ’ h0 : 
4 ’ h1 : 
4 ’ h2 : 
4 ’ h3 : 
4 ’ h4 : 
4 ’ h5 : 
4 ’ h6 : 
4 ’ h7 : 
4 ’ h8 : 
4 ’ h9 : 
4 ’ hA : 
4 ’ hB : 
4 ’ hC : 
4 ’ hD : 
4 ’ hE : 
4 ’ hF : 
e n d c a s e 

n i b b l e  <=  d a t a [ 3 : 0 ] ;

n i b b l e  <=  d a t a [ 7 : 4 ] ;

n i b b l e  <=  d a t a [ 1 1 : 8 ] ;

n i b b l e  <=  d a t a [ 1 5 : 1 2 ] ;

n i b b l e  <=  d a t a [ 1 9 : 1 6 ] ;

n i b b l e  <=  d a t a [ 2 3 : 2 0 ] ;

n i b b l e  <=  d a t a [ 2 7 : 2 4 ] ;

n i b b l e  <=  d a t a [ 3 1 : 2 8 ] ;

n i b b l e  <=  d a t a [ 3 5 : 3 2 ] ;

n i b b l e  <=  d a t a [ 3 9 : 3 6 ] ;

n i b b l e  <=  d a t a [ 4 3 : 4 0 ] ;

n i b b l e  <=  d a t a [ 4 7 : 4 4 ] ;

n i b b l e  <=  d a t a [ 5 1 : 4 8 ] ;

n i b b l e  <=  d a t a [ 5 5 : 5 2 ] ;

n i b b l e  <=  d a t a [ 5 9 : 5 6 ] ;

n i b b l e  <=  d a t a [ 6 3 : 6 0 ] ;


a l w a y s  @( n i b b l e ) 
c a s e  ( n i b b l e )

4 ’ h0 :  d o t s  <=  4 0 ’ b 0 0 1 1 1 1 1 0  0 1 0 1 0 0 0 1  0 1 0 0 1 0 0 1  0 1 0 0 0 1 0 1  0 0 1 1 1 1 1 0 ;

4 ’ h1 :  d o t s  <=  4 0 ’ b 0 0 0 0 0 0 0 0  0 1 0 0 0 0 1 0  0 1 1 1 1 1 1 1
 0 1 0 0 0 0 0 0  0 0 0 0 0 0 0 0 ;

4 ’ h2 :  d o t s  <=  4 0 ’ b 0 1 1 0 0 0 1 0  0 1 0 1 0 0 0 1  0 1 0 0 1 0 0 1
 0 1 0 0 1 0 0 1  0 1 0 0 0 1 1 0 ;

4 ’ h3 :  d o t s  <=  4 0 ’ b 0 0 1 0 0 0 1 0  0 1 0 0 0 0 0 1  0 1 0 0 1 0 0 1
 0 1 0 0 1 0 0 1  0 0 1 1 0 1 1 0 ;

4 ’ h4 :  d o t s  <=  4 0 ’ b 0 0 0 1 1 0 0 0  0 0 0 1 0 1 0 0  0 0 0 1 0 0 1 0
 0 1 1 1 1 1 1 1  0 0 0 1 0 0 0 0 ; 

92 

4 ’ h5 :  d o t s 
4 ’ h6 :  d o t s 
4 ’ h7 :  d o t s 
4 ’ h8 :  d o t s 
4 ’ h9 :  d o t s 
4 ’ hA :  d o t s 
4 ’ hB :  d o t s 
4 ’ hC :  d o t s 
4 ’ hD :  d o t s 
4 ’ hE :  d o t s 
4 ’ hF :  d o t s 
e n d c a s e 

<=  4 0 ’ b 0 0 1 0 0 1 1 1  0 1 0 0 0 1 0 1  0 1 0 0 0 1 0 1 
<=  4 0 ’ b 0 0 1 1 1 1 0 0  0 1 0 0 1 0 1 0  0 1 0 0 1 0 0 1 
<=  4 0 ’ b 0 0 0 0 0 0 0 1  0 1 1 1 0 0 0 1  0 0 0 0 1 0 0 1 
<=  4 0 ’ b 0 0 1 1 0 1 1 0  0 1 0 0 1 0 0 1  0 1 0 0 1 0 0 1 
<=  4 0 ’ b 0 0 0 0 0 1 1 0  0 1 0 0 1 0 0 1  0 1 0 0 1 0 0 1 
<=  4 0 ’ b 0 1 1 1 1 1 1 0  0 0 0 0 1 0 0 1  0 0 0 0 1 0 0 1 
<=  4 0 ’ b 0 1 1 1 1 1 1 1  0 1 0 0 1 0 0 1  0 1 0 0 1 0 0 1 
<=  4 0 ’ b 0 0 1 1 1 1 1 0  0 1 0 0 0 0 0 1  0 1 0 0 0 0 0 1 
<=  4 0 ’ b 0 1 1 1 1 1 1 1  0 1 0 0 0 0 0 1  0 1 0 0 0 0 0 1 
<=  4 0 ’ b 0 1 1 1 1 1 1 1  0 1 0 0 1 0 0 1  0 1 0 0 1 0 0 1 
<=  4 0 ’ b 0 1 1 1 1 1 1 1  0 0 0 0 1 0 0 1  0 0 0 0 1 0 0 1 

0 1 0 0 0 1 0 1  0 0 1 1 1 0 0 1 ; 
0 1 0 0 1 0 0 1  0 0 1 1 0 0 0 0 ; 
0 0 0 0 0 1 0 1  0 0 0 0 0 0 1 1 ; 
0 1 0 0 1 0 0 1  0 0 1 1 0 1 1 0 ; 
0 0 1 0 1 0 0 1  0 0 0 1 1 1 1 0 ; 
0 0 0 0 1 0 0 1  0 1 1 1 1 1 1 0 ; 
0 1 0 0 1 0 0 1  0 0 1 1 0 1 1 0 ; 
0 1 0 0 0 0 0 1  0 0 1 0 0 0 1 0 ; 
0 1 0 0 0 0 0 1  0 0 1 1 1 1 1 0 ; 
0 1 0 0 1 0 0 1  0 1 0 0 0 0 0 1 ; 
0 0 0 0 1 0 0 1  0 0 0 0 0 0 0 1 ; 

e n dm o d u l e 

93 

l s f r 

2 0 : 5 0 : 5 2  0 4 / 0 3 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  :  G e n e r a t e s  p s e u d o r a n d om  n um b e r s  f r om  t h e  s e e d  v a l u e 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e 
l f s r ( c l k ,  r e s e t ,  s e e d ,  e n a b l e ,  o u t ) ; 
i n p u t  c l k  ; 
i n p u t  e n a b l e ; 
i n p u t  r e s e t  ; 
[ 1 5 : 0 ]  s e e d ; 
i n p u t 
o u t p u t 
[ 1 5 : 0 ]  o u t ; 

r e g [ 1 5 : 0 ]  o u t ;

w i r e  f e e d b a c k  ,  x 1 5 1 3  ,  x x 1 2 ;


a s s i g n  x 1 5 1 3  =  ( o u t [ 1 5 ]  ˆ  o u t [ 1 3 ] ) ;

a s s i g n  x x 1 2  =  ( o u t [ 1 2 ]  ˆ  x 1 5 1 3 ) ;

a s s i g n  f e e d b a c k  =  ( o u t [ 1 0 ]  ˆ  x x 1 2 ) ;


a l w a y s  @( p o s e d g e  c l k )  b e g i n 
i f  (  r e s e t  )  b e g i n 
o u t [ 1 5 : 0 ]  < =  s e e d ; 
i f  ( e n a b l e )  b e g i n 
o u t [ 1 5 : 0 ]  < =  { o u t [ 1 4 : 0 ] ,  f e e d b a c k } ; 

e n d  e l s e 

e n d 

e n d 

e n dm o d u l e 

94 

m o d u l e  t i m e r ( p i x e l  c l o c k  ,  r e s e t  ,  t i m e  i n  ,  mode ,  m i n u t e s  ,  s e c o n d s  ,  e n a b l e ) ; 
i n p u t  p i x e l  c l o c k  ; 
i n p u t  r e s e t  ; 
[ 1 : 0 ]  mode ; 
i n p u t 
[ 7 : 0 ]  t i m e  i n  ; 
i n p u t 
[ 1 : 0 ]  m i n u t e s ; 
o u t p u t 
o u t p u t 
[ 5 : 0 ]  s e c o n d s  ; 
o u t p u t  e n a b l e ; 

r e g 
r e g 
r e g 

[ 1 : 0 ]  m i n u t e s ; 
[ 5 : 0 ]  s e c o n d s ; 
[ 7 : 0 ]  c o u n t e r ; 

w i r e  e n a b l e ; 
w i r e  t i m e  r e s e t  ; 
a s s i g n  t i m e  r e s e t  =  ( t i m e  i n == 1 8 0 ) ; 

c o u n t e r  c t ( . c l k ( p i x e l  c l o c k ) , . r e s e t ( R e s e t  S y n c ) , . e n a b l e ( e n a b l e ) ) ; 

/ ∗ 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
i f  ( ( !  r e s e t  ) | | t i m e  r e s e t  | | ( mode ! = 1 ) )  b e g i n 
/ / t i m e  i n <=180 ; 
/ / l a s t  t i m e  i n <=0; 

e n d 
e l s e 
e l s e 

e n d ∗ / 

i f  ( t i m e  i n ==0 )  c o u n t e r <=0; 
i f  ( e n a b l e  &&  ( l a s t  t i m e  i n != c o u n t e r ) )  b e g i n 
l a s t  t i m e  i n  <=  t i m e  i n  ; 
c o u n t e r <=( c o u n t e r  − 1 ) ; 

/ ∗  i f  ( ( !  r e s e t  ) | | t i m e  r e s e t  )  m i n u t e s <=3; 
i f  ( t i m e  i n > 1 2 0 )  m i n u t e s <=2; 
e l s e 
e l s e 
i f  ( t i m e  i n > 6 0 )  m i n u t e s <=1; 
e l s e  m i n u t e s <=0; 

i f  ( ( !  r e s e t  ) | | t i m e  r e s e t  )  s e c o n d s <=0; 
i f  ( ( s e c o n d s ==0 )  &&  ( m i n u t e s ! = 0 ) )  s e c o n d s <=59 ; 
e l s e 
i f  ( s e c o n d s ==0 )  s e c o n d s <=0; 
e l s e 
i f  ( m i n u t e s ==2 )  s e c o n d s <=t i m e  i n − 1 2 0 ; 
e l s e 
i f  ( m i n u t e s ==1 )  s e c o n d s <=t i m e  i n − 6 0 ; 
e l s e 

∗ / 

i f  ( !  r e s e t  | | t i m e  r e s e t  )  b e g i n 
m i n u t e s <=3; 
s e c o n d s <=0; 
i f ( t i m e  i n > 1 2 0 )  b e g i n 
e n d  e l s e 
m i n u t e s <=2; 
s e c o n d s <=t i m e  i n  −  1 2 0 ; 
e n d  e l s e 
i f ( t i m e  i n > 6 0 )  b e g i n 
m i n u t e s <=1; 
s e c o n d s <=t i m e  i n  −  6 0 ; 
e n d  e l s e  b e g i n 

95 

m i n u t e s <=0; 
s e c o n d s <=t i m e  i n  ; 

e n d 

e n d 

e n dm o d u l e 

96 

t i m e l e f t f s m


1 5 : 4 5 : 3 3  0 4 / 2 3 / 0 6


‘ t i m e s c a l e  1 n s  /  1 p s

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  Company :

/ /  E n g i n e e r :

/ /

/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name :

/ /  Modu l e  Name : 
/ /  P r o j e c t  Name :

/ /  T a r g e t  D e v i c e  :

/ /  T o o l  v e r s i o n s  :

/ /  D e s c r i p t i o n  :

/ /

/ /  D e p e n d e n c i e s  :

/ /

/ /  R e v i s i o n :

/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d

/ /  A d d i t i o n a l  Comments :

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

l e f t  ,  n e x t  t i m e  l e f t  ) ;

m o d u l e  t i m e l e f t f s m ( c l k  ,  r e s e t  ,  s t a r t  ,  b u s y ,  t i m e

i n p u t 
c l k  ,  r e s e t  ,  s t a r t  ;

o u t p u t  b u s y ;

i n p u t  [ 7 : 0 ]  t i m e

l e f t  ;

o u t p u t [ 7 : 0 ]  n e x t
 t i m e  l e f t  ; 

r e g [ 6 : 0 ]  c o u n t e r ; 
r e g [ 7 : 0 ]  n e x t  t i m e  l e f t  ;

r e g  s t a t e  ;

r e g  b u s y ;


/ / p a r a m e t e r  FRAMERATE  =  6 0 ;

p a r a m e t e r  FRAMERATE  =  3 0 ; / / t w i c e  a s 

f a s t


p a r a m e t e r  IDLE  =  1 ’ b0 ;

p a r a m e t e r  START  =  1 ’ b1 ;


a l w a y s  @  ( p o s e d g e  c l k  )  b e g i n 
n e x t  t i m e  l e f t  <=  t i m e  l e f t  ; 
i f  ( r e s e t  )  b e g i n

c o u n t e r  <= FRAMERATE ;

b u s y  <=  0 ;

e n d  e l s e  b e g i n

c a s e ( s t a t e )

IDLE :  b e g i n

i f  ( s t a r t  )  b e g i n 
s t a t e  <=  START ; 
b u s y  <=  1 ; 
e n d  e l s e  b e g i n 
s t a t e  <=  IDLE ; 
b u s y  <=  0 ; 

97 

e n d 

e n d 
START :  b e g i n 
i f  ( c o u n t e r  = =  0 )  b e g i n 
n e x t  t i m e  l e f t  <=  t i m e  l e f t  −  1 ; 
c o u n t e r  <= FRAMERATE ; 
e n d  e l s e  b e g i n 
c o u n t e r  <=  c o u n t e r  −  1 ; 

e n d 
b u s y  <= 0 ; 
s t a t e  <=IDLE ; 

e n d 
d e f a u l t  :  s t a t e  <=IDLE ; 

e n d c a s e 

e n d 

e n d 

e n dm o d u l e 

98 

t i t l e


f s m


2 1 : 5 0 : 1 6  0 4 / 2 6 / 0 6


‘ t i m e s c a l e  1 n s  /  1 p s

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /  Company :

/ /  E n g i n e e r :

/ /

/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name :

/ /  Modu l e  Name : 
/ /  P r o j e c t  Name :

/ /  T a r g e t  D e v i c e  :

/ /  T o o l  v e r s i o n s  :

/ /  D e s c r i p t i o n  :

/ /

/ /  D e p e n d e n c i e s  :

/ /

/ /  R e v i s i o n :

/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d

/ /  A d d i t i o n a l  Comments :

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

m o d u l e  t i t l e f s m ( c l k  ,  r e s e t  ,  s t a r t  ,  b u s y  , 
l  h a n d  p u n c h  ,  r  h a n d  p u n c h  , 
l  h a n d  x  ,  r  h a n d  x  , 
l  h a n d  y  ,  r  h a n d  y  , 
n e x t  l  h a n d  x  ,  n e x t  r  h a n d  x  , 
n e x t  l  h a n d  y  ,  n e x t  r  h a n d  y  , 
n e x t  m o d e  ,  g a m e  t y p e ) ; 

i n p u t  c l k  ,  r e s e t  ,  s t a r t  ; 
l  h a n d  x ,  r  h a n d  x ; 
i n p u t  [ 9 : 0 ] 
l  h a n d  y ,  r  h a n d  y ; 
i n p u t 
i n p u t  [ 1 : 0 ] 
l  h a n d  p u n c h  ,  r  h a n d  p u n c h ; 

o u t p u t  b u s y ; 
n e x t  l  h a n d  x  ,  n e x t  r  h a n d  x ; 
o u t p u t [ 9 : 0 ] 
o u t p u t 
n e x t  l  h a n d  y  ,  n e x t  r  h a n d  y ; 
o u t p u t [ 1 : 0 ]  n e x t  m o d e  ,  g a m e  t y p e ; 

r e g  b u s y ;

n e x t

r e g [ 9 : 0 ] 
l  h a n d  x  ,  n e x t  r  h a n d  x ; 
n e x t  l  h a n d  y  ,  n e x t  r  h a n d  y ; 
r e g 
r e g [ 1 : 0 ]  n e x t  m o d e  ,  g a m e  t y p e ; 

r e g [ 1 : 0 ]  s t a t e ; 

p a r a m e t e r  IDLE  =  1 ’ b0 ; 
p a r a m e t e r  ACTIVE=  1 ’ b1 ; 

a l w a y s  @  ( p o s e d g e  c l k  )  b e g i n 
i f  ( r e s e t  )  b e g i n 
b u s y 
n e x t  l  h a n d  x 
n e x t  r  h a n d  x 
n e x t  l  h a n d  y 

<= 

0 ; 

<=  3 0 0 ; 
<=  3 4 0 ; 
<=  0 ; 

99 

<=  2 ’ b 0 0 ; 
<=  0 ; 

<=  0 ; 

n e x t  r  h a n d  y 
n e x t  m o d e 
g a m e  t y p e 
e n d  e l s e  b e g i n 
c a s e ( s t a t e ) 
IDLE :  b e g i n 
i f  ( s t a r t  )  b e g i n 
b u s y <=1; 
s t a t e <=ACTIVE ; 
e n d  e l s e  b e g i n 
b u s y <=0; 
s t a t e <=IDLE ; 

e n d 

e n d 
ACTIVE :  b e g i n 
n e x t  l  h a n d  x 
n e x t  r  h a n d  x 
n e x t  l  h a n d  y 
n e x t  r  h a n d  y 
n e x t  m o d e 
g a m e  t y p e 

<=  l  h a n d  x  ; 
<=  r  h a n d  x ; 
<=  l  h a n d  y  ; 
<=  r  h a n d  y ; 
<=  2 ’ b 0 0 ; 
<=  0 ; 

i f  ( l  h a n d  p u n c h  >  0  | |  r  h a n d  p u n c h  >  0 )  b e g i n 
n e x t  m o d e  <=  2 ’ b 0 1 ; 
g am e  t y p e <=  2 ’ b 0 0 ; 
i f  ( r  h a n d  p u n c h  >  0  &&  r  h a n d  x  <  2 1 3  | | 
l  h a n d  p u n c h  >  0  &&  l  h a n d  x  <  2 1 3 ) 
g am e  t y p e <=  2 ’ b 0 0 ; 
i f  ( r  h a n d  p u n c h  >  0  &&  r  h a n d  x  >  4 1 4  | | 
e l s e 
l  h a n d  p u n c h  >  0  &&  l  h a n d  x  >  4 1 4 ) 
g am e  t y p e <=  2 ’ b 1 0 ; 
e l s e 
g am e  t y p e <=  2 ’ b 0 1 ; 

e n d 
b u s y <=0; 
s t a t e <=IDLE ; 

e n d 
d e f a u l t  :  s t a t e <=IDLE ; 
e n d c a s e  / / m s t a t e 

e n d 

e n d 

e n dm o d u l e 

100 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  6 . 1 1 1  FPGA  L a b k i t  −−  T em p l a t e  T o p l e v e l  Modu l e  f o r  Lab  4  ( S p r i n g  2 0 0 6 )

/ /

/ /

/ /  C r e a t e d :  Ma rch  1 3 ,  2 0 0 6

/ /  A u t h o r  :  Na than  I c k e s

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


m o d u l e 

l a b k i t  ( b e e p ,  a u d i o  r e s e t  b  ,  a c 9 7  s d a t a  o u t  ,  a c 9 7  s d a t a  i n  ,  a c 9 7  s y n c h  , 
a c 9 7  b i t  c l o c k  , 

v g a  o u t  r e d  ,  v g a  o u t  g r e e n  ,  v g a  o u t  b l u e  ,  v g a  o u t  s y n c  b , 
v g a  o u t  b l a n k  b  ,  v g a  o u t  p i x e l  c l o c k  ,  v g a  o u t  h s y n c  , 
v g a  o u t  v s y n c  , 

t v  o u t  y c r c b  ,  t v  o u t  r e s e t  b ,  t v  o u t  c l o c k  ,  t v  o u t  i 2 c  c l o c k  , 
t v  o u t  i 2 c  d a t a  ,  t v  o u t  p a l  n t s c  ,  t v  o u t  h s y n c  b  , 
t v  o u t  v s y n c  b ,  t v  o u t  b l a n k  b ,  t v  o u t  s u b c a r  r e s e t  , 

t v  i n  y c r c b  ,  t v  i n  d a t a  v a l i d  ,  t v  i n  l i n e  c l o c k 1  , 
t v  i n  l i n e  c l o c k 2  ,  t v  i n  a e f  ,  t v  i n  h f f  ,  t v  i n  a f f  , 
t v  i n  i 2 c  c l o c k  ,  t v  i n  i 2 c  d a t a  ,  t v  i n  f i f o  r e a d  , 
t v  i n  f i f o  c l o c k  ,  t v  i n  i s o  ,  t v  i n  r e s e t  b ,  t v  i n  c l o c k  , 

r a m 0  d a t a  ,  r a m 0  a d d r e s s  ,  r a m 0  a d v  l d  ,  r a m 0  c l k  ,  r a m 0  c e n  b , 
r a m 0  c e  b  ,  r a m 0  o e  b  ,  r am 0  w e  b ,  r am 0  bw e  b , 

r a m 1  d a t a  ,  r a m 1  a d d r e s s  ,  r a m 1  a d v  l d  ,  r a m 1  c l k  ,  r a m 1  c e n  b , 
r a m 1  c e  b  ,  r a m 1  o e  b  ,  r am 1  w e  b ,  r am 1  bw e  b , 

c l o c k  f e e d b a c k  o u t  ,  c l o c k  f e e d b a c k  i n  , 

f l a s h  d a t a  , 
f l a s h  a d d r e s s  , 
f l a s h  s t s  , 
f l a s h  r e s e t  b  , 

f l a s h  c e  b  , 
f l a s h  b y t e  b , 

f l a s h  o e  b  ,  f l a s h  w e  b , 

r s 2 3 2  t x d  ,  r s 2 3 2  r x d  ,  r s 2 3 2  r t s  ,  r s 2 3 2  c t s  , 

m o u s e  c l o c k  ,  m o u s e  d a t a  ,  k e y b o a r d  c l o c k  ,  k e y b o a r d  d a t a  , 

c l o c k  2 7 m h z  ,  c l o c k 1  ,  c l o c k 2  , 

d i s p  b l a n k  ,  d i s p  d a t a  o u t  ,  d i s p  c l o c k  ,  d i s p  r s  ,  d i s p  c e  b , 
d i s p  r e s e t  b  ,  d i s p  d a t a  i n  , 

b u t t o n 0  ,  b u t t o n 1  ,  b u t t o n 2  ,  b u t t o n 3  ,  b u t t o n  e n t e r  ,  b u t t o n  r i g h t  , 
b u t t o n  l e f t  ,  b u t t o n  d o w n  ,  b u t t o n  u p  , 

s w i t c h  , 

101 

l e d  ,


u s e r 1  ,  u s e r 2  ,  u s e r 3  ,  u s e r 4  ,


d a u g h t e r c a r d  , 

s y s t e m a c e  d a t a  , 
s y s t e m a c e  w e  b , 

s y s t e m a c e  a d d r e s s  ,  s y s t e m a c e  c e 
s y s t e m a c e  o e  b  ,  s y s t e m a c e  i r q  , 

b ,

s y s t e m a c e  m p b r d y  ,


a n a l y z e r 1  d a t a  , 
a n a l y z e r 2  d a t a  , 
a n a l y z e r 3  d a t a  , 
a n a l y z e r 4  d a t a  , 

a n a l y z e r 1  c l o c k  , 
a n a l y z e r 2  c l o c k  , 
a n a l y z e r 3  c l o c k  , 
a n a l y z e r 4  c l o c k  ) ; 

o u t p u t  b e e p  ,  a u d i o  r e s e t  b , 
a c 9 7  b i t  c l o c k  ,  a c 9 7 
i n p u t 

a c 9 7  s y n c h  ,  a c 9 7  s d a t a  o u t  ; 
s d a t a  i n  ; 

o u t p u t 
[ 7 : 0 ]  v g a  o u t  r e d  ,  v g a  o u t  g r e e n  ,  v g a  o u t  b l u e  ; 
o u t p u t  v g a  o u t  s y n c  b  ,  v g a  o u t  b l a n k  b  ,  v g a  o u t  p i x e l  c l o c k  , 
v g a  o u t  h s y n c  ,  v g a  o u t  v s y n c ; 

[ 9 : 0 ]  t v  o u t  y c r c b  ; 
o u t p u t 
o u t p u t  t v  o u t  r e s e t  b ,  t v  o u t  c l o c k  ,  t v  o u t  i 2 c  c l o c k  ,  t v  o u t  i 2 c  d a t a  , 
t v  o u t  p a l  n t s c  ,  t v  o u t  h s y n c  b ,  t v  o u t  v s y n c  b ,  t v  o u t  b l a n k  b , 
t v  o u t  s u b c a r  r e s e t  ; 

i n p u t 
i n p u t 

[ 1 9 : 0 ]  t v  i n  y c r c b  ; 
t v  i n  d a t a  v a l i d  ,  t v  i n  l i n e  c l o c k 1  ,  t v  i n  l i n e  c l o c k 2  ,  t v  i n  a e f  , 
t v  i n  h f f  ,  t v  i n  a f f  ; 
o u t p u t  t v  i n  i 2 c  c l o c k  ,  t v  i n  f i f o  r e a d  ,  t v  i n  f i f o  c l o c k  ,  t v  i n  i s o  , 
t v  i n  r e s e t  b ,  t v  i n  c l o c k  ; 
t v  i n  i 2 c  d a t a  ; 

i n o u t 

i n o u t 
[ 3 5 : 0 ]  r a m 0  d a t a ; 
o u t p u t 
[ 1 8 : 0 ]  r a m 0  a d d r e s s ; 
o u t p u t  r a m 0  a d v  l d  ,  r a m 0  c l k  , 
o u t p u t 
[ 3 : 0 ]  r am 0  bw e  b ; 

[ 3 5 : 0 ]  r a m 1  d a t a ; 
i n o u t 
[ 1 8 : 0 ]  r a m 1  a d d r e s s ; 
o u t p u t 
o u t p u t  r a m 1  a d v  l d  ,  r a m 1  c l k  , 
o u t p u t 
[ 3 : 0 ]  r am 1  bw e  b ; 

c l o c k  f e e d b a c k  i n  ; 
i n p u t 
o u t p u t  c l o c k  f e e d b a c k  o u t  ; 

r a m 0  c e n  b  ,  r a m 0  c e  b  ,  r a m 0  o e  b  ,  r am 0  w e  b ; 

r a m 1  c e n  b  ,  r a m 1  c e  b  ,  r a m 1  o e  b  ,  r am 1  w e  b ; 

f l a s h  d a t a  ; 
[ 1 5 : 0 ] 
i n o u t 
f l a s h  a d d r e s s  ; 
o u t p u t 
[ 2 3 : 0 ] 
o u t p u t  f l a s h  c e  b  , 
f l a s h  o e  b , 
i n p u t 
f l a s h  s t s  ; 

f l a s h  w e  b  , 

f l a s h  r e s e t  b  , 

f l a s h  b y t e  b ; 

102 

o u t p u t  r s 2 3 2  t x d  ,  r s 2 3 2  r t s  ; 
r s 2 3 2  r x d  ,  r s 2 3 2  c t s  ; 
i n p u t 

i n p u t  m o u s e  c l o c k  ,  m o u s e  d a t a  ,  k e y b o a r d  c l o c k  ,  k e y b o a r d  d a t a ; 

i n p u t 

c l o c k  2 7 m h z  ,  c l o c k 1  ,  c l o c k 2 ; 

o u t p u t  d i s p  b l a n k  ,  d i s p  c l o c k  ,  d i s p  r s  ,  d i s p  c e  b  ,  d i s p  r e s e t  b  ; 
i n p u t 
d i s p  d a t a  i n  ; 
d i s p  d a t a  o u t  ; 
o u t p u t 

i n p u t 

i n p u t 
o u t p u t 

b u t t o n 0  ,  b u t t o n 1  ,  b u t t o n 2  ,  b u t t o n 3  ,  b u t t o n  e n t e r  ,  b u t t o n  r i g h t  , 
b u t t o n  l e f t  ,  b u t t o n  d o w n  ,  b u t t o n  u p ;

[ 7 : 0 ]  s w i t c h ;

l e d ;

[ 7 : 0 ] 

i n o u t 

[ 3 1 : 0 ]  u s e r 1  ,  u s e r 2  ,  u s e r 3  ,  u s e r 4 ; 

i n o u t 

[ 4 3 : 0 ]  d a u g h t e r c a r d ; 

[ 1 5 : 0 ]  s y s t e m a c e  d a t a ; 
i n o u t 
[ 6 : 0 ] 
s y s t e m a c e  a d d r e s s  ; 
o u t p u t 
o u t p u t  s y s t e m a c e  c e  b  ,  s y s t e m a c e  w e  b  ,  s y s t e m a c e  o e  b ;

i r q  ,  s y s t e m a c e  m p b r d y ;

i n p u t 
s y s t e m a c e


o u t p u t 

[ 1 5 : 0 ]  a n a l y z e r 1  d a t a  ,  a n a l y z e r 2  d a t a  ,  a n a l y z e r 3  d a t a  , 
a n a l y z e r 4  d a t a  ; 
o u t p u t  a n a l y z e r 1  c l o c k  ,  a n a l y z e r 2  c l o c k  ,  a n a l y z e r 3  c l o c k  ,  a n a l y z e r 4  c l o c k  ; 

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  I /O  A s s i g n m e n t s

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


/ /  A u d i o  I n p u t  and  Ou tpu t

a s s i g n  b e e p =  1 ’ b0 ;

a s s i g n  a u d i o
 r e s e t  b  =  1 ’ b0 ;

a s s i g n  a c 9 7  s y n c h  =  1 ’ b0 ;

a s s i g n  a c 9 7
 s d a t a  o u t  =  1 ’ b0 ;


/ /  V i d e o  Ou tpu t 
a s s i g n  t v  o u t  y c r c b  =  1 0 ’ h0 ; 
a s s i g n  t v  o u t  r e s e t  b  =  1 ’ b0 ; 
a s s i g n  t v  o u t  c l o c k  =  1 ’ b0 ; 
a s s i g n  t v  o u t  i 2 c  c l o c k  =  1 ’ b0 ; 
a s s i g n  t v  o u t  i 2 c  d a t a  =  1 ’ b0 ; 
a s s i g n  t v  o u t  p a l  n t s c  =  1 ’ b0 ; 
a s s i g n  t v  o u t  h s y n c  b  =  1 ’ b1 ; 
a s s i g n  t v  o u t  v s y n c  b  =  1 ’ b1 ; 
a s s i g n  t v  o u t  b l a n k  b  =  1 ’ b1 ; 

103 

a s s i g n  t v  o u t  s u b c a r  r e s e t  =  1 ’ b0 ; 

/ /  V i d e o  I n p u t

i n  i 2 c  c l o c k  =  1 ’ b0 ;

/ / a s s i g n  t v

a s s i g n  t v

i n  f i f o  r e a d  =  1 ’ b1 ;

i n  f i f o  c l o c k  =  1 ’ b0 ;

a s s i g n  t v

i n  i s o  =  1 ’ b1 ;

a s s i g n  t v

/ / a s s i g n  t v

i n  r e s e t  b  =  1 ’ b0 ;

a s s i g n  t v  i n  c l o c k  =  c l o c k
 2 7 m h z ; / / 1 ’ b0 ;

/ / a s s i g n  t v

i n  i 2 c  d a t a  =  1 ’ bZ ;

i n  y c r c b  ,  t v  i n  d a t a  v a l i d  ,  t v  i n  l i n e  c l o c k 1  ,  t v  i n  l i n e  c l o c k 2  , 
/ /  t v

/ /  t v  i n  a e f  ,  t v  i n  h f f  ,  and  t v  i n  a f f  a r e 
i n p u t s 

/ /  SRAMs 
/ ∗  c h a n g e 
l i n e s  b e l o w  t o  e n a b l e  ZBT  RAM  b a n k 0  ∗ / 

/ ∗ 

∗ / 

a s s i g n  r a m 0  d a t a  =  3 6 ’ hZ ; 
a s s i g n  r a m 0  a d d r e s s  =  1 9 ’ h0 ; 
a s s i g n  r a m 0  c l k  =  1 ’ b0 ;

a s s i g n  r am 0
 w e  b  = 1 ’ b1 ; 
a s s i g n  r a m 0  c e n  b  =  1 ’ b0 ; 

/ ∗  e n a b l e  RAM  p i n s  ∗ / 

a s s i g n  r a m 0  c e  b  = 1 ’ b0 ;

a s s i g n  r a m 0
 o e  b  =  1 ’ b0 ;

a s s i g n  r a m 0  a d v  l d  =  1 ’ b0 ;

a s s i g n  r am 0  bw e  b  =  4 ’ h0 ;


/ /  c l o c k  e n a b l e 

/ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ ∗ / 
a s s i g n  r a m 1  d a t a  =  3 6 ’ hZ ; 
a s s i g n  r a m 1  a d d r e s s  =  1 9 ’ h0 ; 
a s s i g n  r a m 1  a d v  l d  =  1 ’ b0 ; 
a s s i g n  r a m 1  c l k  =  1 ’ b0 ; 
a s s i g n  r a m 1  c e n  b  =  1 ’ b1 ;

a s s i g n  r a m 1
 c e  b  = 1 ’ b1 ;

a s s i g n  r a m 1
 o e  b  =  1 ’ b1 ;

a s s i g n  r am 1
 w e  b  =  1 ’ b1 ;

a s s i g n  r am 1  bw e  b  =  4 ’ hF ;

a s s i g n  c l o c k

f e e d b a c k  o u t  =  1 ’ b0 ; 

/ /  F l a s h  ROM

a s s i g n  f l a s h  d a t a  =  1 6 ’ hZ ;

a s s i g n  f l a s h
 a d d r e s s  =  2 4 ’ h0 ;

a s s i g n 
f l a s h
 c e  b  = 1 ’ b1 ;

a s s i g n  f l a s h
 o e  b  =  1 ’ b1 ;

a s s i g n  f l a s h
 w e  b  =  1 ’ b1 ;

a s s i g n 
f l a s h
 r e s e t  b  =  1 ’ b0 ;

a s s i g n  f l a s h
 b y t e  b  =  1 ’ b1 ; 

104 

/ /  RS− 2 3 2  I n t e r f a c e 
a s s i g n  r s 2 3 2  t x d  =  1 ’ b1 ; 
a s s i g n  r s 2 3 2  r t s  =  1 ’ b1 ; 

/ /  LED  D i s p l a y s 
=  1 ’ b1 ; 
a s s i g n  d i s p  b l a n k 
=  1 ’ b0 ; 
a s s i g n  d i s p  c l o c k 
1 ’ b0 ; 
a s s i g n  d i s p  r s  = 
a s s i g n  d i s p  c e  b  = 1 ’ b1 ; 
a s s i g n  d i s p  r e s e t  b  =  1 ’ b0 ; 
a s s i g n  d i s p  d a t a  o u t  =  1 ’ b0 ; 

/ /  B u t t o n s  ,  S w i t c h e s  ,  and  I n d i v i d u a l  LEDs

l e d  =  8 ’ hFF ;

a s s i g n 

/ /  U s e r  I /Os

a s s i g n  u s e r 1  =  3 2 ’ hZ ;

a s s i g n  u s e r 2  =  3 2 ’ hZ ;

/ / a s s i g n  u s e r 3  =  3 2 ’ hZ ;

a s s i g n  u s e r 4 [ 3 1 : 1 8 ]  =  1 6  ’ hZ ;


/ /  D a u g h t e r c a r d  C o n n e c t o r s

a s s i g n  d a u g h t e r c a r d  =  4 4 ’ hZ ;


/ /  SystemACE  M i c r o p r o c e s s o r  P o r t

a s s i g n  s y s t e m a c e  d a t a  =  1 6 ’ hZ ;

a s s i g n  s y s t e m a c e  a d d r e s s  =  7 ’ h0 ;

a s s i g n  s y s t e m a c e
 c e  b  = 1 ’ b1 ; 
a s s i g n  s y s t e m a c e  w e  b  =  1 ’ b1 ; 
a s s i g n  s y s t e m a c e  o e  b  =  1 ’ b1 ; 

/ /  L o g i c  A n a l y z e r

a s s i g n  a n a l y z e r 1  d a t a  =  1 6 ’ h0 ;

a s s i g n  a n a l y z e r 1  c l o c k  =  1 ’ b1 ;

a s s i g n  a n a l y z e r 2  d a t a  =  1 6 ’ h0 ;

a s s i g n  a n a l y z e r 2  c l o c k  =  1 ’ b1 ;

a s s i g n  a n a l y z e r 3  d a t a  =  1 6 ’ h0 ;

a s s i g n  a n a l y z e r 3  c l o c k  =  1 ’ b1 ;

a s s i g n  a n a l y z e r 4  d a t a  =  1 6 ’ h0 ;

a s s i g n  a n a l y z e r 4  c l o c k  =  1 ’ b1 ;


/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /

/ /

/ /  Lab  4  Compon en t s

/ /

/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /


/ /

/ /  G e n e r a t e  a  3 1 . 5MHz  p i x e l  c l o c k  f r om  c l o c k
 2 7 m h z 
/ / 

105 

w i r e	 p c l k  ,  p i x e l  c l o c k  ;

DCM  p i x e l
 c l o c k  d c m  ( . CLKIN ( c l o c k  2 7 m h z ) ,  . CLKFX( p c l k ) ) ;

i s  1 5

/ /  s y n t h e s i s  a t t r i b u t e  CLKFX DIVIDE  o f  p i x e l
 c l o c k  d c m 
/ /  s y n t h e s i s  a t t r i b u t e  CLKFX MULTIPLY  o f  p i x e l
 c l o c k  d c m 
i s  1 4 
/ /  s y n t h e s i s  a t t r i b u t e  CLKIN PERIOD  o f  p i x e l  c l o c k  d c m 
i s  3 7

/ /  s y n t h e s i s  a t t r i b u t e  CLK FEEDBACK  o f  p i x e l
 c l o c k  d c m 
i s  ”NONE”

BUFG  p i x e l
 c l o c k  b u f  ( . I ( p c l k ) ,  . O( p i x e l  c l o c k  ) ) ; 

/ /

/ /  VGA  o u t p u t  s i g n a l s

/ /


/ /  I n v e r t i n g  t h e  c l o c k  t o  t h e  DAC  p r o v i d e s  h a l f  a  c l o c k  p e r i o d 
/ /  t o  p r o p a g a t e  f r om  t h e  FPGA  t o  t h e  DAC . 
a s s i g n  v g a  o u t  p i x e l  c l o c k  =  ˜ p i x e l  c l o c k  ; 

f o r  s i g n a l s 

w i r e	
r e s e t  s y n c  ;

d e b o u n c e  d e b o u n c e R e s e t ( 1 ’ b0 ,  p i x e l
 c l o c k  ,  b u t t o n  e n t e r  ,  r e s e t  s y n c  ) ; 

w i r e  [ 9 : 0 ] 
w i r e 
w i r e  [ 1 : 0 ] 

l p x  ,  r p x ;

l p y  ,  r p y ;

l p p  ,  r p p ;


/ / a s s i g n 

l e d  =  8 ’ b 1 1 1 1 1 1 1 1 ; 

/ / d i s p l a y  1 6 h e x  a l p h a d i s p ( ˜ r e s e t  s y n c	 ,  p i x e l  c l o c k  ,  h e x , 
d i s p  b l a n k  ,  d i s p  c l o c k  ,  d i s p  r s  ,  d i s p  c e  b ,

/ / 
/ / 
d i s p
 r e s e t  b  ,  d i s p  d a t a  o u t  ) ; 

/ / /START  oF  UZOMA’ s  CODE 
w i r e  c l k  ; 
a s s i g n  c l k  =  p i x e l  c l o c k  ;

w i r e 
[ 9 : 0 ]  h c o u n t ;

[ 9 : 0 ] 
v c o u n t ;

w i r e  s t a r t  ;


w i r e	

/ / v g a c o n t r o l l e r  v g a ( c l k  ,  ˜ r e s e t  s y n c	 ,  h s y n c  b  ,  v s y n c  b  ,  v g a  o u t  s y n c  b , 
/ / v g a  o u t  b l a n k  b  ,  h c o u n t  ,  v c o u n t  ,  s t a r t  ) ; 

/ / d e l a y  d h s y n c ( c l k , h s y n c  b , v g a  o u t  h s y n c ) ;

/ / d e l a y  d v s y n c ( c l k , v s y n c  b , v g a
 o u t  v s y n c  ) ; 

/ / v g a  v g a 1 ( c l k , h c o u n t , v c o u n t , h s y n c , v s y n c , b l a n k ) ;

/ /  w i r e  up  t o  ZBT  ram


w i r e	
w i r e 

[ 3 5 : 0 ]  v r a m  w r i t e  d a t a ;

[ 3 5 : 0 ]  v r a m
 r e a d  d a t a ; 

106 

w i r e 
w i r e 

[ 1 8 : 0 ]  v r a m  a d d r ; 
v r am  w e ; 

z b t  6 1 1 1  z b t 1 ( c l k ,  1 ’ b1 ,  v r am  w e ,  v r am  a d d r  ,

v r a m
 w r i t e  d a t a  ,  v r a m  r e a d  d a t a  , 
r a m 0  c l k  ,  r am 0  w e  b  ,  r a m 0  a d d r e s s  ,  r a m 0  d a t a  ,  r a m 0  c e n  b ) ; 

/ /  g e n e r a t e  p i x e l  v a l u e  f r om  r e a d i n g  ZBT  memory 
w i r e 
[ 1 7 : 0 ] 
v r  p i x e l  ; 
v r a m  a d d r 1 ; 
[ 1 8 : 0 ] 
w i r e 

v r a m  d i s p l a y  vd1 ( ˜ r e s e t  s y n c  , c l k , h c o u n t , v c o u n t , v r  p i x e l  , 
v r am  a d d r 1  , v r a m  r e a d  d a t a ) ; 

/ /  ADV7185  NTSC  d e c o d e r 
i n t e r f a c e  c o d e 
/ /  a d v 7 1 8 5 
i n i t i a l i z a t i o n  m o d u l e 
a d v 7 1 8 5 i n i t  a d v 7 1 8 5 ( .  r e s e t ( ˜ r e s e t  s y n c  )  ,  . c l o c k  2 7 m h z ( c l o c k  2 7 m h z ) , 
. s o u r c e ( 1 ’ b0 ) ,  . t v  i n  r e s e t  b ( t v  i n  r e s e t  b ) , 
.  t v  i n  i 2 c  c l o c k ( t v  i n  i 2 c  c l o c k  ) , 
.  t v  i n  i 2 c  d a t a ( t v  i n  i 2 c  d a t a  ) ) ; 

w i r e 
w i r e 
w i r e 

[ 2 9 : 0 ]  y c r c b ; 
f v h ; 
[ 2 : 0 ] 
dv ; 

/ /  v i d e o  d a t a  ( l um i n a n c e  ,  c h r o m i n a n c e ) 
/ /  s y n c  f o r 
f i e l d  ,  v e r t i c a l  ,  h o r i z o n t a l 
/ /  d a t a  v a l i d 

n t s c  d e c o d e  d e c o d e  ( . c l k ( t v  i n  l i n e  c l o c k 1  )  ,  .  r e s e t ( ˜ r e s e t  s y n c  ) , 
.  t v  i n  y c r c b ( t v  i n  y c r c b  [ 1 9 : 1 0 ] )  , 
. y c r c b ( y c r c b ) ,  . f ( f v h [ 2 ] ) , 
. v ( f v h [ 1 ] ) ,  . h ( f v h [ 0 ] ) ,  . d a t a  v a l i d ( dv ) ) ; 

/ /  c o d e  t o  w r i t e  NTSC  d a t a  t o  v i d e o  memory 

w i r e 
w i r e 
w i r e 

[ 1 8 : 0 ]  n t s c  a d d r  ; 
[ 3 5 : 0 ]  n t s c  d a t a  ; 
n t s c  w e ; 

n t s c  t o  z b t  n 2 z  ( c l k  ,  t v  i n  l i n e  c l o c k 1  ,  f v h  ,  dv ,  y c r c b  , 
n t s c  a d d r  ,  n t s c  d a t a  ,  n t s c  w e  ) ; 

my  we  =  h c o u n t [ 1 : 0 ]  = =  2 ’ d2 ; 
w i r e 
/ / w i r e  my  we  =  n t s c  w e  ;

v r a m  a d d r  =  my  we  ?  n t s c  a d d r 
a s s i g n 
v r am  w e  =  my  we ;

a s s i g n 
v r a m  w r i t e  d a t a  =  n t s c
 d a t a  ; 
a s s i g n 

:  v r a m
 a d d r 1 ;


/ / w i r e 
b l , h s , v s ; 
/ / d e l a yN  dn1 ( c l k  , h s y n c , h s ) ; 
/ / d e l a yN  dn2 ( c l k  , v s y n c , v s ) ; 
/ / d e l a yN  dn3 ( c l k , b l a n k , b l ) ; 

/ /  d e l a y  by  3  c y c l e s  t o  s y n c  w i t h  ZBT  r e a d 

w i r e  v a l i d  p i x e l  =  ( ( h c o u n t > 9 )  &  ( h c o u n t < 6 2 8 ) ) ;  / / 6 3 9 − 1 1 

107 

/ / w i r e  v a l i d  p i x e l  =  1 ;

r e g [ 9 : 0 ]  Y , Cr , Cb ;


a l w a y s  @( p o s e d g e  c l k )

b e g i n


Y  <=  { v r
 p i x e l  [ 1 7 : 1 0 ]  , 2  ’ b0 } ;

Cr  <={ v r
 p i x e l  [ 9 : 5 ]  , 5  ’ b0 } ;

Cb <={ v r
 p i x e l  [ 4 : 0 ]  , 5  ’ b0 } ;


e n d


w i r e  [ 7 : 0 ]  tR , tG , tB ;

YCrCb2RGB  c o n v c o l o r ( tR , tG , tB ,  c l k  ,  ˜ r e s e t
 s y n c  ,  Y ,  Cr ,  Cb ) ; 

/ ∗ 

/ / r e g [ 7 : 0 ]  L  t h r e s  ,  R  t h r e s  ,  G  t h r e s  ,  B  t h r e s  ; 
d e b o u n c e  up1 ( r e s e t  ,  c l k  ,  ˜ b u t t o n  u p  ,  u p l e v e l ) ;

d e b o u n c e  down1 ( r e s e t ,  c l k ,  ˜ b u t t o n  d o w n ,  d o w n l e v e l ) ;


r e g  u p o l d  ,  d o w n o l d ;

a l w a y s  @  ( p o s e d g e  c l k )

b e g i n


u p o l d  <=  u p l e v e l ;

d o w n o l d  <=  d o w n l e v e l ;


e n d 

w i r e  up  =  u p l e v e l  &  ! u p o l d ;

w i r e  down  =  d o w n l e v e l  &  ! d o w n o l d ;


w i r e  sw0 , sw1 , sw3 , sw7 ;

d e b o u n c e  s 0 ( r e s e t  ,  c l k  ,  s w i t c h [ 0 ]  ,  sw0 ) ;

d e b o u n c e  s 1 ( r e s e t  ,  c l k  ,  s w i t c h [ 1 ]  ,  sw1 ) ;

d e b o u n c e  s 3 ( r e s e t  ,  c l k  ,  s w i t c h [ 3 ]  ,  sw3 ) ;

d e b o u n c e  s 7 ( r e s e t  ,  c l k  ,  s w i t c h [ 7 ]  ,  sw7 ) ; 

∗ /


p a r a m e t e r  L  t h r e s  =  8 ’ b 1 0 0 0 0 1 1 1 ;

p a r a m e t e r  R
 t h r e s  =  8 ’ b 1 1 1 1 1 0 1 1 ;

p a r a m e t e r  G
 t h r e s  =  8 ’ b 0 1 1 1 1 1 1 1 ;

p a r a m e t e r  B
 t h r e s  =  8 ’ b 1 1 1 1 1 1 1 1 ; 

/ / w i r e [ 9 : 0 ]  v c e n ,  h c e n ;

w i r e  v a l i d c o l o r  ;

/ / f i n d
 c e n t e r 
f c ( c l k ,  r e s e t ,  v c o u n t ,  h c o u n t ,  v a l i d c o l o r  ,  v c e n ,  h c e n ) ; 

w i r e [ 9 : 0 ]  v c e n l ,  h c e n l ,  v c e n r ,  h c e n r ;

f l ( c l k  ,  ˜ r e s e t
 s y n c  ,  v c o u n t  ,  h c o u n t  ,  v a l i d c o l o r  ,  v c e n l  ,  h c e n l  , 
f i n d l i g h t s 
v c e n r  ,  h c e n r  ) ; 

[ 2 3 : 0 ]  c o l o r  ,  c o l o r 2  ,  c o l o r l e f t  ,  c o l o r r i g h t  ;

w i r e 
i n r e c t a n g l e 
l e f t g l o v e ( v c o u n t ,  h c o u n t ,  h c e n l ,  v c e n l ,  c o l o r l e f t ) ;

i n r e c t a n g l e  r i g h t g l o v e ( v c o u n t ,  h c o u n t ,  h c e n r ,  v c e n r ,  c o l o r r i g h t ) ;


/ / i n r e c t a n g l e 

l e f t g l o v e ( v c o u n t ,  h c o u n t ,  9 ’ d 2 0 0 ,  9 ’ d 1 5 0 ,  c o l o r l e f t ) ;


108 

/ / i n r e c t a n g l e  r i g h t g l o v e ( v c o u n t ,  h c o u n t ,  9 ’ d 3 0 0 ,  9 ’ d 3 0 0 ,  c o l o r r i g h t ) ; 

d e f p a r a m  r i g h t g l o v e  . TRUE COLOR  =  2 4 ’ h0 0FF0 0 ; 

a s s i g n  c o l o r 2  =  ( c o l o r l e f t  | c o l o r r i g h t  ) ; 

a s s i g n  c o l o r  =  ( c o l o r 2 ==24 ’d0 )  ?  { tR , tG , tB } 

:  c o l o r 2 ; 

a s s i g n  v a l i d c o l o r  =  (Y [ 9 : 2 ] > = 8 ’ b 1 0 0 0 0 1 1 1 )  & 

( c o l o r [ 2 3 : 1 6 ] > = R  t h r e s )  & 
( c o l o r [ 1 5 : 8 ] > = G  t h r e s )  & 
( c o l o r [ 7 : 0 ] < B  t h r e s  ) ; 

w i r e  s c l k  ,  CONVST ;

a s s i g n  u s e r 3 
=  { 2 ’ hZ ,  s c l k  ,  CONVST,  2 6 ’ hZ ,  s c l k  ,  CONVST} ;

w i r e  d a t a i n r  =  u s e r 3 [ 2 ] ;

w i r e  RFSr  =  u s e r 3 [ 3 ] ;

w i r e  d a t a i n l  =  u s e r 3 [ 3 0 ] ;

w i r e  RFS l  =  u s e r 3 [ 3 1 ] ;


w i r e [ 1 : 0 ]  p u n c h l e v e l l ,  p u n c h l e v e l r ; 

w i r e 
[ 7 : 0 ]  d a t a o u t l ;

w i r e  v a l i d l  ;


w i r e 
[ 9 : 0 ]  g l o  x  ,  g r o  x ;

w i r e  g l o
 y  ,  g r o  y ; 

p u n c h d e t e c t o r  pd ( c l o c k  2 7 m h z ,  c l k ,  s c l k ,  ˜ r e s e t  s y n c  ,  CONVST ,  d a t a i n l  ,  RFSl ,

d a t a i n r  ,  RFSr ,

h c e n l  ,  v c e n l  ,  h c e n r  ,  v c e n r  ,

g l o
 x  ,  g l o  y  ,  g r o  x  ,  g r o  y  ,  p u n c h l e v e l l  ,  p u n c h l e v e l r  ) ; 
/ / e n d  OF  UZOMA’ S  CODE 

w i r e  [ 2 : 0 ] 
i n d e x  i n  ; 
w i r e  [ 9 : 0 ]  d a t a  i n  ; 
w i r e  e n a b l e  i n  ; 
w i r e  [ 2 : 0 ] 
i n d e x  o u t  ; 
w i r e  [ 9 : 0 ]  d a t a  o u t ; 
w i r e  e n a b l e  o u t ; 

109 

w i r e  [ 9 : 0 ]  p l a y e r  l  h a n d  x  ,  p l a y e r  r  h a n d  x ; 
p l a y e r  l  h a n d  y  ,  p l a y e r  r  h a n d  y ; 
w i r e 
w i r e  [ 1 : 0 ]  p l a y e r  l  h a n d  p u n c h  ,  p l a y e r  r  h a n d  p u n c h  ; 
w i r e  [ 9 : 0 ]  o p p o n e n t  h e a d  x ; 
w i r e  [ 4 : 0 ]  o p p o n e n t  p i c t u r e  , 
p l a y e r  l i f e  ,  o p p o n e n t  l i f e  ,  p l a y e r  e n e r g y  ,  o p p o n e n t  e n e r g y ; 
w i r e  [ 7 : 0 ]  t i m e  l e f t  ; 
w i r e [ 1 : 0 ]  mode ,  r o u n d ,  g a m e  t y p e ; 
w i r e [ 2 : 0 ]  s t a t e ; 

a s s i g n  s t a r t  =  ( h c o u n t ==10 ’ d 6 3 9  &&  v c o u n t ==10 ’ d 4 7 9 ) ; 

/ / game  t y p e s 
p a r a m e t e r  ONEPLAYER 
p a r a m e t e r  TWOPLAYERM 
p a r a m e t e r  TWOPLAYERS 

=  2 ’ d0 ; 
=  2 ’ d1 ; 
=  2 ’ d2 ; 

/ / w i r e  m  i n d e x  s  i n d e x  d a t a 
/ / p i n s 
1 7 : 1 5 
1 4 : 1 2 

m  e n a b l e 
1 1 : 2 

s  e n a b l e 
1 

0 

w i r e  s b o ; / / s l a v e  b a c k  o u t  on  c o l l i s i o n

a s s i g n  s b o  =  ( g a m e  t y p e==TWOPLAYERM  | | 

( g a m e  t y p e==TWOPLAYERS &&  ˜ e n a b l e  i n  ) ) ;


a s s i g n  e n a b l e  i n 
a s s i g n 
i n d e x  i n 

=  ( g a m e  t y p e==TWOPLAYERM )  ?  u s e r 4 [ 0 ]  :  u s e r 4 [ 1 ] ;

=  ( g a m e  t y p e==TWOPLAYERM )  ?  u s e r 4 [ 1 4 : 1 2 ]  :  u s e r 4 [ 1 7 : 1 5 ] ;


a s s i g n  u s e r 4 [ 1 7 : 1 5 ] 
a s s i g n  u s e r 4 [ 1 4 : 1 2 ] 
a s s i g n  u s e r 4 [ 1 ] 
a s s i g n  u s e r 4 [ 0 ] 

= ( g a m e  t y p e==TWOPLAYERM )  ? i n d e x  o u t [ 2 : 0 ]  : 3 ’ hZ ;

i n d e x  o u t [ 2 : 0 ] ;

=  ( g a m e  t y p e==TWOPLAYERM )  ?  3 ’ hZ  : 
=  ( g a m e  t y p e==TWOPLAYERM )  ?  e n a b l e  o u t 
:  1 ’ hZ ;

=  ( g a m e  t y p e==TWOPLAYERM )  ?  1 ’ hZ  :  e n a b l e  o u t ;


/ / a s s i g n  d a t a  i n [ 9 : 0 ] 
a s s i g n  d a t a

i n [ 9 : 0 ] 
a s s i g n  u s e r 4 [ 1 1 : 2 ] 

=  u s e r 4 [ 1 1 : 2 ] ; / /  :  1 0  ’ b0 ;

=  e n a b l e  i n  ?  u s e r 4 [ 1 1 : 2 ]  :  1 0  ’ b0 ; 
=  e n a b l e  o u t  &&  s b o  ?  d a t a  o u t [ 9 : 0 ]  :  1 0  ’ hZ ; 

c o n t r o l u n i t  c u ( c l k  ,  ˜ r e s e t  s y n c  ,  s t a r t  , 
1 0 ’ d 6 4 0−g r o  x  ,  g r o  y  ,  p u n c h l e v e l r  , 
1 0 ’ d 6 4 0−g l o  x  ,  g l o  y  ,  p u n c h l e v e l l  , 

p l a y e r  l  h a n d  x  ,  p l a y e r  l  h a n d  y  ,  p l a y e r  l  h a n d  p u n c h  , 
p l a y e r  r  h a n d  x  ,  p l a y e r  r  h a n d  y  ,  p l a y e r  r  h a n d  p u n c h  , 

o p p o n e n t  h e a d  x , 
o p p o n e n t  p i c t u r e  , 

p l a y e r  l i f e  ,  o p p o n e n t  l i f e  , 
p l a y e r  e n e r g y  ,  o p p o n e n t  e n e r g y  , 
t i m e  l e f t  ,  mode ,  r o u n d  ,  g am e  t y p e  ,  s t a t e  , 

i n d e x  i n  , 

d a t a  i n  , 

e n a b l e  i n  , 

110 

i n d e x  o u t  ,  d a t a  o u t  ,  e n a b l e  o u t 
) ; 

w i r e  h s y n c  ,  v s y n c  , 
l h s t a t u s  ,  r h s t a t u s  ; 
r e g  h s y n c  b  ,  v s y n c  b ; 

p u n c h  ) ; 
l 
h a n d 
a s s i g n 
l h s t a t u s  =  | ( p l a y e r 
a s s i g n  r h s t a t u s  =  | ( p l a y e r  r  h a n d  p u n c h  ) ; 

t o p  t o p 1 (

.  p i x e l
 c l o c k ( p i x e l  c l o c k ) , 
.  r e s e t  s y n c ( r e s e t  s y n c  ) , 
.  f 1  l h a n d  x ( p l a y e r  l  h a n d  x ) , 
.  f 1  r h a n d  x ( p l a y e r  r  h a n d  x ) , 
.  f 1  l h a n d  y ( p l a y e r  l  h a n d  y ) , 
.  f 1  r h a n d  y ( p l a y e r  r  h a n d  y ) , 
.  f 1  l h  s t a t u s ( l h s t a t u s  ) , 
.  f 1  r h  s t a t u s  ( r h s t a t u s  ) , 
.  f 2  p i c  x ( o p p o n e n t  h e a d  x ) , 
.  f 2  p i c  y ( 1 0 ’ d 2 5 0 ) , 
.  f 2  s t a t u s ( o p p o n e n t  p i c t u r e ) , 
. h s y n c ( h s y n c ) , 
. v s y n c ( v s y n c ) , 
. s y n c  b ( v g a  o u t  s y n c  b ) , 
. b l a n k  b ( v g a  o u t  b l a n k  b ) , 
. r e d ( v g a  o u t  r e d ) , 
. g r e e n ( v g a  o u t  g r e e n ) , 
. b l u e ( v g a  o u t  b l u e ) , 
.  f 1  l i f e b a r  ( p l a y e r  l i f e  ) , 
.  f 1  e n e r g y b a r ( p l a y e r  e n e r g y ) , 
.  f 2  l i f e b a r  ( o p p o n e n t  l i f e  ) , 
.  f 2  e n e r g y b a r ( o p p o n e n t  e n e r g y ) ,

. mode ( mode ) ,

. r o u n d ( r o u n d ) ,

. p i x e l  c o u n t ( h c o u n t ) ,

.  l i n e
 c o u n t ( v c o u n t ) , 
.  t i m e  i n ( t i m e  l e f t  ) ) ; 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n

h s y n c
 b  <=  ˜ h s y n c ; 
v s y n c  b  <=  ˜ v s y n c ; 

e n d 

a s s i g n  v g a  o u t  v s y n c  =  v s y n c  b ; 
a s s i g n  v g a  o u t  h s y n c  =  h s y n c  b ; 

e n dm o d u l e 

111 

C 

Imaging  Source  Codes 

m o d u l e  b o x i n g  r i n g ( p i x e l  c l o c k  ,  x ,  y ,  r e d ,  g r e e n ,  b l u e ) ;

i n p u t  p i x e l
 c l o c k  ;

i n p u t 
[ 9 : 0 ]  x ,  y ;

[ 7 : 0 ]  r e d ,  g r e e n ,  b l u e ;

o u t p u t 

p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

PIXELS  =  8 0 0 ; 
LINES  =  5 2 5 ; 
FLOOR TOP LX  =  1 0 ’ d 1 0 0 ; 
FLOOR TOP RX  =  1 0 ’ d 5 4 0 ; 
MAX X  =  1 0 ’ d 6 4 0 ; 
FLOOR TOP Y  =  1 0 ’ d 3 2 0 ; 
MAX Y  =  1 0 ’ d 4 2 0 ; 
SPACE  =  1 0 ’ d 2 5 ; 
WIDTH  =  1 0 ’ d5 ; 
POLE WIDTH  =  1 0 ’ d 1 0 ; 
POLE TOP Y  =  FLOOR TOP Y−3∗SPACE−5∗WIDTH ; 
POLE BOTTOM Y =  FLOOR TOP Y+WIDTH ; 
POLE LX  =  FLOOR TOP LX− 1 0 ’ d5 ; 
POLE RX  =  FLOOR TOP RX− 1 0 ’ d5 ; 
FLOOR COLOR  =  2 4 ’  h f f f f f f  ; 
ROPE1 COLOR  =  2 4 ’ h 0 0 0 0 f f ; 
ROPE2 COLOR  =  2 4 ’ h f f 0 0 0 0 ; 
ROPE3 COLOR  =  2 4 ’  h f f f f f f  ; 
POLE COLOR  =  2 4 ’ h f f 0 0 0 0 ; 
BLACK  =  2 4 ’ h 0 0 0 0 0 0 ; 

[ 2 3 : 0 ] 
[ 9 : 0 ] 

w i r e 
w i r e 
w i r e 

w i r e 

[ 7 : 0 ] 

next  RGB ; 
n e x t  x  ,  n e x t  y ;

o u t
 o f  b o u n d s  ,  h o r i z o n t a l  r o p e 1  ,  h o r i z o n t a l  r o p e 2  ,  h o r i z o n t a l  r o p e 3  ,

d i a g o n a l  r o p e 1  ,  d i a g o n a l  r o p e 2  ,

d i a g o n a l  r o p e 3  ,  p o l e  ;

r e d ,  g r e e n ,  b l u e ; 

r e g 

[ 2 3 : 0 ] 

RGB ; 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
/ / a s s i g n s  n e x t  s t a t e 
RGB<=next  RGB ; 
e n d 

/ / c om p u t e s  w h e t h e r  n e x t  p i x e l  p o s i t i o n 
i s  w i t h i n  b o u n d a r i e s  o f  b o x i n g  r i n g 
a s s i g n  o u t  o f  b o u n d s  =  ( ( ( n e x t  x >=0)&&(n e x t  x<=FLOOR TOP LX)&& 
( n e x t  y <(MAX Y−n e x t  x  ) ) ) | | 
( ( n e x t  x >=FLOOR TOP RX)&&( n e x t  x<=MAX X)&& 
( n e x t  y <(FLOOR TOP Y+n e x t  x −FLOOR TOP RX ) ) ) | | 
( ( n e x t  x >=FLOOR TOP LX)&&( n e x t  x<=FLOOR TOP RX)&& 
( n e x t  y <FLOOR TOP Y ) ) ) ;

a s s i g n  h o r i z o n t a l
 r o p e 1  =  ( ( ( n e x t  y >=(FLOOR TOP Y−SPACE−WIDTH))&& 
( n e x t  y <=(FLOOR TOP Y−SPACE) ) )&& 

112 

( n e x t  x>=FLOOR TOP LX)&&( n e x t  x <=FLOOR TOP RX ) ) ;

a s s i g n  h o r i z o n t a l
 r o p e 2  =  ( ( ( n e x t  y >=(FLOOR TOP Y−2∗SPACE−2∗WIDTH))&& 
( n e x t  y <=(FLOOR TOP Y−2∗SPACE−WIDTH) ) )&&

( n e x t  x>=FLOOR TOP LX)&&( n e x t  x <=FLOOR TOP RX ) ) ;

a s s i g n  h o r i z o n t a l
 r o p e 3  =  ( ( ( n e x t  y >=(FLOOR TOP Y−3∗SPACE−3∗WIDTH))&& 
( n e x t  y <=(FLOOR TOP Y−3∗SPACE−2∗WIDTH) ) )&&

( n e x t  x>=FLOOR TOP LX)&&( n e x t  x <=FLOOR TOP RX ) ) ;

a s s i g n  d i a g o n a l  r o p e 1  =  ( ( ( n e x t  x >=0)&&( n e x t  x<=FLOOR TOP LX)&&

( n e x t  y >=(MAX Y−n e x t
 x −SPACE−WIDTH))&& 
( n e x t  y <=(MAX Y−n e x t  x −SPACE ) ) ) | | 
( ( n e x t  x>=FLOOR TOP RX)&&( n e x t  x <=MAX X)&& 
( n e x t  y >=(FLOOR TOP Y+n e x t  x −FLOOR TOP RX−SPACE−WIDTH ) ) 
&&(n e x t  y <=(FLOOR TOP Y+n e x t  x −FLOOR TOP RX−SPACE ) ) ) ) ; 
a s s i g n  d i a g o n a l  r o p e 2  =  ( ( ( n e x t  x >=0)&&( n e x t  x<=FLOOR TOP LX)&&

( n e x t  y >=(MAX Y−n e x t
 x −2∗SPACE−2∗WIDTH))&& 
( n e x t  y <=(MAX Y−n e x t  x −2∗SPACE−WIDTH ) ) ) | | 
( ( n e x t  x>=FLOOR TOP RX)&&( n e x t  x <=MAX X)&& 
( n e x t  y >=(FLOOR TOP Y+n e x t  x −FLOOR TOP RX−2∗SPACE−2∗WIDTH ) ) 
&&( n e x t  y <=(FLOOR TOP Y+n e x t  x −FLOOR TOP RX−2∗SPACE−WIDTH ) ) ) ) ; 
a s s i g n  d i a g o n a l  r o p e 3  =  ( ( ( n e x t  x >=0)&&( n e x t  x<=FLOOR TOP LX)&&

( n e x t  y >=(MAX Y−n e x t
 x −3∗SPACE−3∗WIDTH))&& 
( n e x t  y <=(MAX Y−n e x t  x −3∗SPACE−2∗WIDTH ) ) ) | | 
( ( n e x t  x>=FLOOR TOP RX)&&( n e x t  x <=MAX X)&& 
( n e x t  y >=(FLOOR TOP Y+n e x t  x −FLOOR TOP RX−3∗SPACE−3∗WIDTH ) ) 
&&(n e x t  y <=(FLOOR TOP Y+n e x t  x −FLOOR TOP RX−3∗SPACE−2∗WIDTH ) ) ) ) ; 
a s s i g n  p o l e  =  ( ( ( n e x t  y<=POLE BOTTOM Y)&&( n e x t  y >=POLE TOP Y))&&

( ( ( n e x t  x>=POLE LX)  && ( n e x t
 x <=(POLE LX+POLE WIDTH ) ) ) | | 
( ( n e x t  x>=POLE RX)&&( n e x t  x <=(POLE RX+POLE WIDTH ) ) ) ) ) ; 

/ / c om p u t e s  n e x t  p i x e l  p o s i t i o n

a s s i g n  n e x t  x  =  ( x  ==  ( PIXELS − 1 ) )  ?  1 0 ’ d0 
:  x  +  1 ’ b1 ;

a s s i g n  n e x t
 y  =  ( x  ==  ( PIXELS − 1 ) )  ?  ( y  ==  LINES − 1 )  ? 1 0 ’ d0 

:  y + 1 ’ b1 

:  y ; 

/ / c om p u t e s  n e x t  s t a t e 
a s s i g n  next  RGB  =	 ( p o l e )  ?  POLE COLOR  :

( h o r i z o n t a l  r o p e 1  | | d i a g o n a l  r o p e 1 )  ?  ROPE1 COLOR  :

( h o r i z o n t a l  r o p e 2  | | d i a g o n a l  r o p e 2 )  ?  ROPE2 COLOR  :

( h o r i z o n t a l  r o p e 3  | | d i a g o n a l  r o p e 3 )  ?  ROPE3 COLOR  :

( !  o u t
 o f  b o u n d s  )  ?  FLOOR COLOR  :  BLACK ; 

a s s i g n  r e d  =  RGB [ 2 3 : 1 6 ] ;

a s s i g n  g r e e n  =  RGB [ 1 5 : 8 ] ;

a s s i g n  b l u e  =  RGB [ 7 : 0 ] ;


e n dm o d u l e 

113 

/ /  T h i s  m o d u l e  p r o v i d e s  c o n t r o l  s i g n a l s  t o  t h e  ADV7125 .

/ /  The  r e s o l u t i o n 
i s  6 4 0 x 4 8 0  and  t h e  p i x e l  f r e q u e n c y

/ /  i s  a b o u t  2 5MHz

l o w :  h i g h 
/ /  h s y n c 
f o r  6 4 0  p i x e l s  o f  a c t i v e  v i d e o  ,

i s  a c t i v e 
f r o n t  p o r c h  ,

f o r  1 6  p i x e l s  o f 
/ /  h i g h 
/ /  l o w  f o r  9 6  p i x e l s  o f  h s y n c  ,

f o r  4 8  p i x e l s  o f  b a c k  p o r c h

/ /  h i g h 
l o w :  h i g h 
/ /  v s y n c 
i s  a c t i v e 
f o r  4 8 0  l i n e s  o f  a c t i v e  v i d e o  ,

/ /  h i g h 
f o r  1 1  l i n e s  o f 
f r o n t  p o r c h  ,

/ /  l o w  f o r  2 
l i n e s  o f  v s y n c  ,

/ /  h i g h 
f o r  3 1  l i n e s  o f  b a c k  p o r c h

m o d u l e  v g a  (  p i x e l
 c l o c k  ,  r e s e t  ,  h s y n c  ,  v s y n c  ,  s y n c  b  , 
b l a n k  b  ,  p i x e l  c o u n t  , 
l i n e  c o u n t  ,  f r a m e  p u l s e  ) ;

i n p u t  p i x e l
 c l o c k  ;  / /  2 5 . 1 7 5  MHz  p i x e l  c l o c k

i n p u t  r e s e t  ;  / /  s y s t e m  r e s e t

o u t p u t  h s y n c  ;  / /  h o r i z o n t a l  s y n c

o u t p u t  v s y n c ;  / /  v e r t i c a l  s y n c

o u t p u t  s y n c
 b  ;  / /  h a r d w i r e d  t o  Vdd

o u t p u t  b l a n k
 b ;  / /  c o m p o s i t e  b l a n k

[ 9 : 0 ]  p i x e l
 c o u n t  ;  / /  number  o f  t h e  c u r r e n t  p i x e l 
o u t p u t 
o u t p u t 
[ 9 : 0 ] 
l i n e  c o u n t  ;  / /  number  o f  t h e  c u r r e n t 
l i n e 
o u t p u t  f r a m e  p u l s e  ; 

/ /  6 4 0 x 4 8 0  6 0 Hz  p a r a m e t e r s

p a r a m e t e r  PIXELS  =  8 0 0 ;

p a r a m e t e r  LINES  =  5 2 5 ;

p a r a m e t e r  HACTIVE VIDEO  =  6 4 0 ;

p a r a m e t e r  HFRONT PORCH  =  1 6 ;

p a r a m e t e r  HSYNC PERIOD  =  9 6 ;

p a r a m e t e r  HBACK PORCH  =  4 8 ;

p a r a m e t e r  VACTIVE VIDEO  =  4 8 0 ;

p a r a m e t e r  VFRONT PORCH  =  1 1 ;

p a r a m e t e r  VSYNC PERIOD  =  2 ;

p a r a m e t e r  VBACK PORCH  =  3 1 ;


/ /  c u r r e n t  p i x e l  c o u n t

[ 9 : 0 ]  p i x e l  c o u n t  =  1 0 ’ b0 ;

r e g 
l i n e  c o u n t  =  1 0 ’ b0 ;

r e g 
[ 9 : 0 ] 

/ /  r e g i s t e r e d  o u t p u t s

/ / r e g  h s y n c  =  1 ’ b1 ;

/ / r e g  v s y n c  =  1 ’ b1 ;

/ / r e g  b l a n k  b  =  1 ’ b1 ;

w i r e  s y n c  b  ;  / /  c o n n e c t e d  t o  Vdd

w i r e  f r a m e  p u l s e  ;

w i r e  p i x e l
 c l o c k  ;

w i r e 
[ 9 : 0 ]  n e x t
 p i x e l  c o u n t  ;

[ 9 : 0 ]  n e x t

w i r e 
l i n e  c o u n t  ; 

r e g  h s y n c  =  1 ’ b1 ;

r e g  v s y n c  =  1 ’ b1 ;


114 

r e g  b l a n k  b  =  1 ’ b1 ; 

i f	

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
( ! r e s e t )  b e g i n 
p i x e l  c o u n t  <=  1 0 ’ b0 ; 
l i n e  c o u n t  <=  1 0 ’ b0 ; 
h s y n c  <=  1 ’ b1 ; 
v s y n c  <=  1 ’ b1 ; 
b l a n k  b  <=  1 ’ b1 ; 
e n d 
e l s e  b e g i n 
p i x e l  c o u n t  <=  n e x t  p i x e l  c o u n t  ; 
l i n e  c o u n t  <=  n e x t  l i n e  c o u n t  ; 
h s y n c  <= 
( n e x t  p i x e l  c o u n t  <  HACTIVE VIDEO  +  HFRONT PORCH )  | 
( n e x t  p i x e l  c o u n t  >=  HACTIVE VIDEO+HFRONT PORCH+ 
HSYNC PERIOD ) ; 
v s y n c  <= 
( n e x t  l i n e  c o u n t  <  VACTIVE VIDEO+VFRONT PORCH )  | 
( n e x t  l i n e  c o u n t  >=  VACTIVE VIDEO+VFRONT PORCH+ 
VSYNC PERIOD ) ; 
/ /  t h i s 
i s  t h e  and  o f  h b l a n k  and  v b l a n k 
b l a n k  b  <= 
( n e x t  p i x e l  c o u n t  <  HACTIVE VIDEO )  & 
( n e x t  l i n e  c o u n t  <  VACTIVE VIDEO ) ; 

e n d 
e n d 

/ /  n e x t  s t a t e 
l o g i c 
i s  c om p u t e d  w i t h  c o m b i n a t i o n a l 
a s s i g n  n e x t  p i x e l  c o u n t  =  ( p i x e l  c o u n t  ==  PIXELS − 1 )  ? 
:  p i x e l  c o u n t  +  1 ’ b1 ; 
1 0 ’ h 0 0 0 
a s s i g n  n e x t  l i n e  c o u n t  =  ( p i x e l  c o u n t  ==  PIXELS − 1 )  ? 
( l i n e  c o u n t  ==  LINES − 1 )  ?  1 0 ’ h 0 0 0  : 
l i n e  c o u n t  +  1 ’ b1 
: 
l i n e  c o u n t  ; 
a s s i g n  f r a m e  p u l s e  =  ( ( p i x e l  c o u n t  ==  HACTIVE VIDEO−1) && 
( l i n e  c o u n t  ==  VACTIVE VIDEO− 1 ) ) ; 

/ /  s i n c e  we  a r e  p r o v i d i n g  h s y n c  and  v s y n c  t o  t h e  d i s p l a y  ,  we 
/ /  c a n  h a r d w i r e  c o m p o s i t e  s y n c  t o  Vdd . 
a s s i g n  s y n c  b  =  1 ’ b1 ; 

e n dm o d u l e 

115 

f 1  l i f e b a r  , 
l i n e  c o u n t  , 
m o d u l e  D i s p l a y  F i e l d ( p i x e l  c l o c k  ,  r e s e t  s y n c  ,  p i x e l  c o u n t  , 
f 1  r h a n d  x ,  f 1  l h a n d  y ,  f 1  r h a n d  y , 
f 1  e n e r g y b a r  ,  f 1  l h a n d  x , 
f 1  l h  s t a t u s  , 
f 2  l h  s t a t u s  , 
f 2  l i f e b a r  ,  f 2  e n e r g y b a r  , 
f 2  s t a t u s  , 
r e d  ,  g r e e n  ,  b l u e  ,  f r a m e  p u l s e  ,  mode ,  r o u n d  ,  t i m e  i n  ) ; 

i n p u t  p i x e l  c l o c k  ,  r e s e t  s y n c  ,  f r a m e  p u l s e  ;

[ 1 : 0 ]  mode ;

i n p u t 
[ 3 : 0 ]  r o u n d ;

i n p u t 
i n p u t 
[ 9 : 0 ] 
l i n e
 c o u n t  ,  p i x e l  c o u n t  ;

f 2  l i f e b a r  ,  f 1  e n e r g y b a r  ,  f 2  e n e r g y b a r ;

l i f e b a r  , 
f 1

[ 4 : 0 ] 
i n p u t 
l h a n d  x ,  f 1  r h a n d  x , 
f 2  p i c  x , 
f 2  p i c  y ;

f 1

[ 9 : 0 ] 
i n p u t 
f 2
 s t a t u s  ;

i n p u t 
[ 4 : 0 ] 
l h a n d  y ,  f 1  r h a n d  y ;

f 1

i n p u t 
l h  s t a t u s  , 
f 1  r h  s t a t u s  ;

i n p u t 
f 1

[ 7 : 0 ]  t i m e

i n p u t 
i n  ;

[ 7 : 0 ]  r e d ;

o u t p u t 
[ 7 : 0 ]  g r e e n ;

o u t p u t 
o u t p u t 
[ 7 : 0 ]  b l u e ;


/ / c o l o r  p a r a m e t e r s  f o r  RGB

WHITE  =  2 4 ’  h f f f f f f  ;

p a r a m e t e r 
p a r a m e t e r 
BLUE  =  2 4 ’ h 0 0 0 0 f f ;

LT BLUE  =  2 4 ’ h 0 0 0 0 7 f ;

p a r a m e t e r 
RED  =  2 4 ’ h f f 0 0 0 0 ;

p a r a m e t e r 
LT RED  =  2 4 ’ h 7 f 0 0 0 0 ;

p a r a m e t e r 

/ / p a r a m e t e r s  f o r  w i d t h s  ,  h e i g h t s  ,  and  s t a r t i n g  p o i n t s

PLAYER2 PIXEL  =  1 0 ’ d 3 8 0 ;

p a r a m e t e r 
PLAYER1 PIXEL  =  1 0 ’ d4 ;

p a r a m e t e r 
TIME  PIXEL  =  1 0 ’ d 2 7 7 ;

p a r a m e t e r 
COLON  =  1 0 ’ d5 ;

p a r a m e t e r 
BAR HEIGHT  =  1 0 ’ d 1 0 ;

p a r a m e t e r 
TOP  =  1 0 ’ d 1 5 ;

p a r a m e t e r 
ONE PLAYER  =  1 0 ’ d0 ;

p a r a m e t e r 
p a r a m e t e r 
TWO PLAYER  =  1 0 ’ d 4 2 7 ;

SCREEN HEIGHT  =  1 0 ’ d 4 8 0 ;

p a r a m e t e r 
SCREEN WIDTH  =  1 0 ’ d 6 4 0 ;

p a r a m e t e r 
MODE WIDTH  =  1 0 ’ d 2 1 3 ;

p a r a m e t e r 

/ / d e f i n i n g  c o l o r s  o f 
i n s t a n c e s  o f  t h e  r e c t a n g l e  m o d u l e

f 1 e  .COLOR  =  BLUE ;

d e f p a r a m 
f 2 e  .COLOR  =  BLUE ;

d e f p a r a m 
d e f p a r a m 
f 1 l  .COLOR  =  RED ;

f 2 l  .COLOR  =  RED ;

d e f p a r a m 
f 2 l  f a d e  .COLOR  =  LT RED ;

d e f p a r a m 
f a d e  .COLOR  =  LT RED ;

f 1 l

d e f p a r a m 
d e f p a r a m 
f 2 e

f a d e  .COLOR  =  LT BLUE ;

f 1 e

d e f p a r a m 
f a d e  .COLOR  =  LT BLUE ;

t o p  c o l o n .COLOR  =  WHITE ;

d e f p a r a m 
b o t t o m  c o l o n .COLOR  =  WHITE ;

d e f p a r a m 
o n e  p l a y e r .COLOR  =  2 4 ’ h 0 f 8 2 0 d ;

d e f p a r a m 

116 

d e f p a r a m 
d e f p a r a m 

t w o  p l a y e r .COLOR  =  2 4 ’ h 4 0 d 0 4 0 ;

c a r d .COLOR  =  WHITE ;


/ / d e f i n i n g  c o l o r s  ,  w i d t h s  ,  and  h e i g h t s  o f 
i n s t a n c e s  o f  t h e  number  m o d u l e

1 0 ’ d 5 9 ;

r ound  num . HDIM  = 
d e f p a r a m 
r ound  num . VDIM  = 
1 0 ’ d 7 9 ;

d e f p a r a m 
r ound  num .WIDTH  =  1 0 ’ d 1 0 ;

d e f p a r a m 
r ound  num . SPACE  =  1 0 ’ d 2 4 ;

d e f p a r a m 
d e f p a r a m 
r ound  num .COLOR  =  2 4 ’ h 0 0 0 0 0 0 ;

r ound  num .BACKGROUND =  WHITE ;

d e f p a r a m 
1 0 ’ d 3 9 ;

o n e . HDIM  = 
d e f p a r a m 
o n e . VDIM  = 
d e f p a r a m 
1 0 ’ d 5 9 ;

o n e .WIDTH  =  1 0 ’ d6 ;

d e f p a r a m 
d e f p a r a m 
o n e . SPACE  =  1 0 ’ d 2 0 ;

1 0 ’ d 3 9 ;

two . HDIM  = 
d e f p a r a m 
two . VDIM  = 
d e f p a r a m 
1 0 ’ d 5 9 ;

two .WIDTH  =  1 0 ’ d6 ;

d e f p a r a m 
d e f p a r a m 
two . SPACE  =  1 0 ’ d 2 0 ;


r e g 

[ 7 : 0 ] 

f 1 l
 p i x e l s  , 

f 2 l  p i x e l s  , 

f 1 e  p i x e l s  , 

f 2 e  p i x e l s  ; 

w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 

[ 1 : 0 ] 
[ 5 : 0 ] 
[ 3 : 0 ] 
[ 7 : 0 ] 
[ 7 : 0 ] 

w i r e 
w i r e 

[ 7 : 0 ] 
[ 7 : 0 ] 

e n a b l e ; 
m i n u t e s ; 
s e c o n d s ; 
s e c  o n e s  ,  s e c  t e n s  ; 
f 1 e  w i d t h  ,  f 2 e  w i d t h  ; 
n e x t  f 1 l  p i x e l s  ,  n e x t  f 2 l  p i x e l s  ,  n e x t  f 1 e  p i x e l s  , 
n e x t  f 2 e  p i x e l s  ; 
r e d ,  b l u e ,  g r e e n ; 
r e d  f 1 l  ,  r e d  f 1 e  ,  r e d  f 2 l  ,  r e d  f 2 e  ,  r e d  f 1 l  f a d e  ,  r e d  f 1 e  f a d e  , 
r e d  f 2 l  f a d e  ,  r e d  f 2 e  f a d e  ,

r e d  m i n  ,  r e d
 s e c  t e n s  ,  r e d  s e c  o n e s  ,  r e d  t o p  c o l o n  ,  r e d  b o t t o m  c o l o n  , 
r e d  b x r  ,  r e d  o n e  p l a y e r  ,

r e d
 t w o  p l a y e r  ,  r e d  r o u n d  ,  r e d  c a r d  ,  r e d  o n e  ,  r e d  t w o  ,  g r e e n  f 1 l  , 
g r e e n  f 1 e  ,  g r e e n  f 2 l  ,  g r e e n  f 2 e  ,

f 1 l  f a d e  ,  g r e e n  f 1 e  f a d e  ,  g r e e n  f 2 l  f a d e  ,  g r e e n  f 2 e  f a d e  , 
g r e e n

g r e e n  m i n  ,  g r e e n  s e c  t e n s  ,

g r e e n
 s e c  o n e s  ,  g r e e n  t o p  c o l o n  ,  g r e e n  b o t t o m  c o l o n  ,  g r e e n  b x r  , 
g r e e n  o n e  p l a y e r  ,  g r e e n  t w o  p l a y e r  ,

g r e e n  r o u n d  ,  g r e e n
 c a r d  ,  g r e e n  o n e  ,  g r e e n  t w o  ,  b l u e  f 1 l  ,  b l u e  f 1 e  , 
b l u e  f 2 l  ,  b l u e  f 2 e  ,  b l u e  f 1 l  f a d e  ,

b l u e

f 1 e  f a d e  ,  b l u e  f 2 l  f a d e  ,  b l u e  f 2 e  f a d e  ,  b l u e  m i n  ,  b l u e  s e c  t e n s  , 
b l u e  s e c  o n e s  ,  b l u e  t o p  c o l o n  ,

b l u e
 b o t t o m  c o l o n  ,  b l u e  b x r  ,  b l u e  o n e  p l a y e r  ,  b l u e  t w o  p l a y e r  , 
b l u e  r o u n d  ,  b l u e  c a r d  ,  b l u e  o n e  ,  b l u e  t w o  ; 

w i r e 

[ 2 3 : 0 ] 

f1  RGB ,  f2  RGB ; 

/ / p l a y e r  ’ s 

l i f e  b a r 

117 

r e c t a n g l e 

f 1 l  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
. c o r n e r  x ( PLAYER1 PIXEL+ ( 1 0 ’ d 2 6 0− n e x t  f 1 l  p i x e l s  ) )  , 
.  c o r n e r  y (TOP )  , . h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 ,  n e x t  f 1 l  p i x e l s  } ) , 
. r e d ( r e d  f 1 l  )  , . g r e e n ( g r e e n  f 1 l  ) ,

. b l u e ( b l u e

f 1 l  )  , . b l i n k ( 1 ’ b0 ) ) ; 
/ / o p p o n e n t ’ s 
l i f e  b a r 
f 2 l  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
r e c t a n g l e 
.  c o r n e r  x ( PLAYER2 PIXEL ) , . c o r n e r  y (TOP ) ,

. h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 ,  n e x t

f 2 l  p i x e l s  } )  , . r e d ( r e d  f 2 l  ) , 
. g r e e n ( g r e e n  f 2 l  )  , . b l u e ( b l u e  f 2 l ) ,  . b l i n k ( 1 ’ b0 ) ) ; 
/ / p l a y e r  ’ s  e n e r g y  b a r 
f 1 e  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
r e c t a n g l e 
. c o r n e r  x ( PLAYER1 PIXEL+ ( 1 0 ’ d 2 6 0− f 1 e  w i d t h ) )  , 
.  c o r n e r  y (TOP+ 1 0 ’ d 1 5 )  , . h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 , f 1 e  w i d t h } ) , 
. r e d ( r e d  f 1 e ) , . g r e e n ( g r e e n  f 1 e ) , 
. b l u e ( b l u e  f 1 e ) , . b l i n k ( 1 ’ b0 ) ) ; 
/ / o p p o n e n t  ’ s  e n e r g y  b a r 
r e c t a n g l e 
f 2 e  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
.  c o r n e r  x ( PLAYER2 PIXEL ) , . c o r n e r  y (TOP+ 1 0 ’ d 1 5 ) , 
. h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 ,  f 2 e  w i d t h } ) , . r e d ( r e d  f 2 e ) , 
. g r e e n ( g r e e n  f 2 e ) , . b l u e ( b l u e  f 2 e ) ,  . b l i n k ( 1 ’ b0 ) ) ; 
/ / r e c t a n g l e  m o d u l e  t h a t  c a u s e s  f a d e  e f f e c t  o f  p l a y e r  ’ s  e n e r g y  b a r 
f 1 e  f a d e  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
r e c t a n g l e 
. c o r n e r  x ( PLAYER1 PIXEL+ ( 1 0 ’ d 2 6 0− f 1 e  p i x e l s  ) )  , 
.  c o r n e r  y (TOP+ 1 0 ’ d 1 5 )  , . h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 ,  f 1 e  p i x e l s } ) , 
. r e d ( r e d  f 1 e  f a d e  ) ,

. g r e e n ( g r e e n

f 1 e  f a d e )  , . b l u e ( b l u e  f 1 e  f a d e  )  , . b l i n k ( 1 ’ b0 ) ) ; 
/ / r e c t a n g l e  m o d u l e  t h a t  c a u s e s  f a d e  e f f e c t  o f  o p p o n e n t ’ s  e n e r g y  b a r 
f 2 e  f a d e  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
r e c t a n g l e 
.  c o r n e r  x ( PLAYER2 PIXEL ) , . c o r n e r  y (TOP+ 1 0 ’ d 1 5 ) , 
. h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 ,  f 2 e  p i x e l s  } )  , . r e d ( r e d  f 2 e  f a d e  ) , 
. g r e e n ( g r e e n  f 2 e  f a d e ) ,

. b l u e ( b l u e

f 2 e  f a d e  )  , . b l i n k ( 1 ’ b0 ) ) ; 
/ / r e c t a n g l e  m o d u l e  t h a t  c a u s e s  f a d e  e f f e c t  o f  o p p o n e n t ’ s 
l i f e  b a r 
f 2 l  f a d e  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
r e c t a n g l e 
.  c o r n e r  x ( PLAYER2 PIXEL ) , . c o r n e r  y (TOP ) , 
. h e i g h t (BAR HEIGHT )  , . w i d t h ( { 2 ’ b0 ,  f 2 l  p i x e l s  } )  , . r e d ( r e d  f 2 l  f a d e  ) , 
. g r e e n ( g r e e n  f 2 l  f a d e ) ,

. b l u e ( b l u e

f 2 l  f a d e  )  , . b l i n k ( 1 ’ b0 ) ) ; 
/ / r e c t a n g l e  m o d u l e  t h a t  c a u s e s  f a d e  e f f e c t  o f  p l a y e r  ’ s 
l i f e  b a r 
f 1 l  f a d e  ( .  p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) , 
r e c t a n g l e 
. c o r n e r  x ( PLAYER1 PIXEL+ ( 1 0 ’ d 2 6 0− f 1 l  p i x e l s  ) ) , 
.  c o r n e r  y (TOP ) , . h e i g h t (BAR HEIGHT ) , 
. w i d t h ( { 2 ’ b0 ,  f 1 l  p i x e l s  } ) , 
. r e d ( r e d  f 1 l  f a d e  ) ,

. g r e e n ( g r e e n

f 1 l  f a d e )  , . b l u e ( b l u e  f 1 l  f a d e  )  , . b l i n k ( 1 ’ b0 ) ) ; 

/ / r e c t a n g l e  m o d u l e  f o r  o n e  p l a y e r  o p t i o n  on  s t a r t  s c r e e n 
r e c t a n g l e  o n e  p l a y e r ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , 
. c o r n e r  x (ONE PLAYER ) , . c o r n e r  y ( 1 0 ’ d0 ) , 
. h e i g h t ( SCREEN HEIGHT ) , 
. w i d t h (MODE WIDTH) , . r e d ( r e d  o n e  p l a y e r ) , 
. g r e e n ( g r e e n  o n e  p l a y e r ) , 

118 

. b l u e ( b l u e  o n e  p l a y e r )  , . b l i n k ( 1 ’ b0 ) ) ; 
/ / r e c t a n g l e  m o d u l e  f o r  two  p l a y e r  o p t i o n  on  s t a r t  s c r e e n 
r e c t a n g l e  t w o  p l a y e r ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , 
. c o r n e r  x (TWO PLAYER)  , .  c o r n e r  y ( 1 0 ’ d0 ) , 
. h e i g h t ( SCREEN HEIGHT ) , 
. w i d t h (MODE WIDTH) , . r e d ( r e d  t w o  p l a y e r ) , 
. g r e e n ( g r e e n  t w o  p l a y e r ) , 
. b l u e ( b l u e  t w o  p l a y e r )  , . b l i n k ( 1 ’ b0 ) ) ; 
/ / number  m o d u l e  f o r  number  o n e  d i s p l a y e d  o v e r  t h e  o n e  p l a y e r  o p t i o n  on  s t a r t  s c r e e n 
number  o n e ( . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . c o r n e r  x (ONE PLAYER+ 1 0 ’ d 8 6 ) , 
. c o r n e r  y ( 1 0 ’ d 2 2 0 ) , 
. number ( 4 ’ d1 ) , . r e d ( r e d  o n e ) , . g r e e n ( g r e e n  o n e ) , . b l u e ( b l u e  o n e ) ) ; 
/ / number  m o d u l e  f o r  number  two  d i s p l a y e d  o v e r  t h e  o n e  p l a y e r  o p t i o n  on  s t a r t  s c r e e n 
number  two ( . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . c o r n e r  x (TWO PLAYER+ 1 0 ’ d 8 6 ) ,

. c o r n e r
 y ( 1 0 ’ d 2 2 0 ) ,

. number ( 4 ’ d2 ) , . r e d ( r e d  t w o ) , . g r e e n ( g r e e n  t w o ) , . b l u e ( b l u e  t w o ) ) ;


/ / t i m e r  m o d u l e  t o  d e t e r m i n e  t h e  t i m e 
i n  m i n u t e s  and  s e c o n d s 
l e f t 
t i m e r  tm ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . r e s e t ( r e s e t  s y n c  )  , . m i n u t e s ( m i n u t e s ) , 
. s e c o n d s ( s e c o n d s ) , . t i m e  i n ( t i m e  i n ) ) ; 
/ / number  m o d u l e  f o r  m i n u t e s 
i n  t h e  t i m e 
l e f t  d i s p l a y e d 
number  dm in ( . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . c o r n e r  x ( TIME  PIXEL ) , . c o r n e r  y (TOP) , 
. number ( { 2 ’ b0 , m i n u t e s } ) , . r e d ( r e d  m i n ) , . g r e e n ( g r e e n  m i n ) , . b l u e ( b l u e  m i n ) ) ; 
/ / number  m o d u l e  f o r  t e n s  o f  t h e  s e c o n d s 
l e f t  d i s p l a y e d 
i n  t h e  t i m e 
number  d s e c  t e n s ( . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . c o r n e r  x ( TIME  PIXEL+ 1 0 ’ d 4 5 ) , 
. c o r n e r  y (TOP) ,

. number ( s e c  t e n s ) , . r e d ( r e d
 s e c  t e n s  )  , . g r e e n ( g r e e n  s e c  t e n s ) , 
. b l u e ( b l u e  s e c  t e n s  ) ) ; 
/ / number  m o d u l e  f o r  o n e s  o f  t h e  s e c o n d s 
l e f t  d i s p l a y e d 
i n  t h e  t i m e 
number  d s e c  o n e s ( . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . c o r n e r  x ( TIME  PIXEL+ 1 0 ’ d 7 5 ) , 
. c o r n e r  y (TOP) ,

. number ( s e c  o n e s ) , . r e d ( r e d
 s e c  o n e s )  , . g r e e n ( g r e e n  s e c  o n e s ) , 
. b l u e ( b l u e  s e c  o n e s  ) ) ;

/ / r e c t a n g l e  m o d u l e  f o r  t o p  c o l o n 
i n  t h e  t i m e 
/ /  ( b l i n k i n g  b e c a u s e  b l i n k 
i s  s e t  h i g h )

r e c t a n g l e  t o p  c o l o n ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e
 c o u n t  ) , 
. c o r n e r  x ( TIME  PIXEL+ 1 0 ’ d 3 0 ) , . c o r n e r  y (TOP+ 1 0 ’ d5 ) , . h e i g h t (COLON) , 
. w i d t h (COLON )  , . r e d ( r e d  t o p  c o l o n ) , 
. g r e e n ( g r e e n  t o p  c o l o n )  , . b l u e ( b l u e  t o p  c o l o n ) , 
.  r e s e t  s y n c ( r e s e t  s y n c ) ,  . b l i n k ( 1 ’ b1 ) ) ;

/ / r e c t a n g l e  m o d u l e  f o r  b o t t om  c o l o n 
l e f t  d i s p l a y e d

i n  t h e  t i m e 
/ /  ( b l i n k i n g  b e c a u s e  b l i n k 
i s  s e t  h i g h )

r e c t a n g l e  b o t t o m
 c o l o n ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t  ) ,

. c o r n e r  x ( TIME  PIXEL+ 1 0 ’ d 3 0 ) , . c o r n e r  y (TOP+ 1 0 ’ d 1 5 ) ,

. h e i g h t (COLON) ,

. w i d t h (COLON )  , . r e d ( r e d
 b o t t o m  c o l o n ) , 
. g r e e n ( g r e e n  b o t t o m  c o l o n )  , . b l u e ( b l u e  b o t t o m  c o l o n ) , 
.  r e s e t  s y n c ( r e s e t  s y n c  )  , . b l i n k ( 1 ’ b1 ) ) ; 

l e f t  d i s p l a y e d


/ / b o x i n g  r i n g  m o d u l e  t o  d i s p l a y  b o x i n g  r i n g 
b o x i n g  r i n g  b x r ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . r e d ( r e d  b x r ) , 
. g r e e n ( g r e e n  b x r ) , . b l u e ( b l u e  b x r ) ) ; 

119 

/ / number  m o d u l e  f o r  r o u n d  number  d i s p l a y e d 
number  r ound  num ( . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , . c o r n e r  x ( 1 0 ’ d 2 9 0 ) , . c o r n e r  y ( 1 0 ’ d 2 0 0 ) , 
. number ( r o u n d ) , . r e d ( r e d  r o u n d ) , . g r e e n ( g r e e n  r o u n d ) , . b l u e ( b l u e  r o u n d ) ) ; 
/ / r e c t a n g l e  m o d u l e  f o r  r o u n d  number  c a r d  d i s p l a y e d 
r e c t a n g l e  c a r d ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . x ( p i x e l  c o u n t ) , . y ( l i n e  c o u n t ) , 
. c o r n e r  x ( 1 0 ’ d 1 2 8 ) ,

. c o r n e r
 y ( 1 0 ’ d 8 0 )  , . h e i g h t ( 1 0 ’ d 3 2 0 ) , 
. w i d t h ( 1 0 ’ d 3 8 4 ) , . r e d ( r e d  c a r d ) , . g r e e n ( g r e e n  c a r d ) , . b l u e ( b l u e  c a r d ) , 
. b l i n k ( 1 ’ b0 ) ) ; 

/ / F i g h t e r 1  C o n t r o l  m o d u l e  f o r  p l a y e r  g l o v e s  d i s p l a y e d 
F i g h t e r 1  C o n t r o l  f 1 c ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . r e s e t ( r e s e t  s y n c  ) , 
.  l i n e  c o u n t ( l i n e  c o u n t  ) , 
. p i x e l  c o u n t ( p i x e l  c o u n t ) , . f 1  l h a n d  x ( f 1  l h a n d  x ) , 
.  f 1  r h a n d  x ( f 1  r h a n d  x ) , 
.  f 1  l h a n d  y ( f 1  l h a n d  y ) , 
.  l h  s t a t u s (  f 1  l h  s t a t u s  )  , .  r h  s t a t u s ( f 1  r h  s t a t u s  ) , 
.  f 1  r h a n d  y ( f 1  r h a n d  y ) , 
.RGB( f1  RGB )  , . mode ( mode ) ) ; 
/ / F i g h t e r 2  C o n t r o l  m o d u l e  f o r  o p p o n e n t  d i s p l a y e d 
F i g h t e r 2  C o n t r o l  f 2 c ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . r e s e t ( r e s e t  s y n c  ) , 
.  l i n e  c o u n t ( l i n e  c o u n t  ) , 
. p i x e l  c o u n t ( p i x e l  c o u n t ) , . p i c  x ( f 2  p i c  x ) , . p i c  y ( f 2  p i c  y ) , 
.  f 2  s t a t u s ( f 2  s t a t u s  )  , .RGB( f2  RGB )  , . mode ( mode ) ) ; 

l i f e  and  e n e r g y  b a r s  by  o n e  u n t i l 

i t 

i t  r e a c h e s 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
/ / D e c r e m e n t s  and  i n c r e m e n t s  t h e  f a d e 
/ /  r e a c h e s  t h e  a c t u a l 
/ / e n e r g y  and 
l i f e 
l e f t  .  I n c r e m e n t s  t h e  a c t u a l  e n e r g y  b a r s  u n t i l 
/ /  t h e  a c t u a l  e n e r g y 
l e f t  . 
/ / C r e a t e s  f a d e  e f f e c t  and  ma k e s  t r a n s i t i o n s  s m o o t h e r . 
i f  ( !  r e s e t  s y n c  )  f 1 l  p i x e l s <=n e x t  f 1 l  p i x e l s  ;

e l s e 
i f  ( (  f 1 l
 p i x e l s > n e x t  f 1 l  p i x e l s )&&  f r a m e  p u l s e )

f 1 l
 p i x e l s  <=  f 1 l  p i x e l s  − 1 ;

i f  ( !  r e s e t
 s y n c  )  f 1 e  p i x e l s <=n e x t  f 1 e  p i x e l s  ;

e l s e 
i f  ( (  f 1 e
 p i x e l s > n e x t  f 1 e  p i x e l s )&&  f r a m e  p u l s e )

f 1 e
 p i x e l s  <=  f 1 e  p i x e l s  − 1 ;

e l s e 
i f  ( (  f 1 e
 p i x e l s < n e x t  f 1 e  p i x e l s )&&  f r a m e  p u l s e ) 
f 1 e  p i x e l s  <=  f 1 e  p i x e l s + 1 ;

i f  ( !  r e s e t
 s y n c )  f 2 l  p i x e l s  <=  n e x t  f 2 l  p i x e l s  ;

e l s e 
i f  ( (  f 2 l
 p i x e l s > n e x t  f 2 l  p i x e l s )&&  f r a m e  p u l s e )

f 2 l
 p i x e l s  <=  f 2 l  p i x e l s  − 1 ;

i f  ( !  r e s e t
 s y n c  )  f 2 e  p i x e l s  <=  n e x t  f 2 e  p i x e l s  ;

e l s e 
i f  ( (  f 2 e
 p i x e l s > n e x t  f 2 e  p i x e l s )  &&  f r a m e  p u l s e )

f 2 e
 p i x e l s  <=  f 2 e  p i x e l s  − 1 ;

e l s e 
i f  ( (  f 2 e
 p i x e l s < n e x t  f 2 e  p i x e l s )  &&  f r a m e  p u l s e )

f 2 e
 p i x e l s  <=  f 2 e  p i x e l s + 1 ; 

e n d 

/ / c o n v e r t s  e n e r g y  and 

l i f e 

l e f t 

f r om  5  t o  8  b i t s 

120 

a s s i g n  n e x t  f 1 l  p i x e l s  =  { f 1  l i f e b a r  ,  3  ’ b0 } ; 
a s s i g n  n e x t  f 2 l  p i x e l s  =  { f 2  l i f e b a r  ,  3  ’ b0 } ; 
a s s i g n  n e x t  f 1 e  p i x e l s  =  { f 1  e n e r g y b a r  ,  3  ’ b0 } ;

a s s i g n  n e x t

f 2 e  p i x e l s  =  { f 2  e n e r g y b a r  ,  3  ’ b0 } ;

/ / c a l c u l a t e s  t h e  e n e r g y  b a r  w i d t h s

f 1 e  w i d t h  =  ( f 1 e  p i x e l s >=n e x t  f 1 e  p i x e l s  )  ?  n e x t  f 1 e  p i x e l s 
a s s i g n 
f 1 e
 p i x e l s  ; 
f 2 e  w i d t h  =  ( f 2 e  p i x e l s >=n e x t  f 2 e  p i x e l s  )  ?  n e x t  f 2 e  p i x e l s 
f 2 e  p i x e l s  ; 

a s s i g n 

:


: 

/ / c om p u t e s  r e d  ,  g r e e n  ,  and  b l u e  s i g n a l s  b a s e d  on  t h e  mode 
r e d  =	 ( ( mode==0 )  &&  ( f1  RGB ! = 2 4 ’ d0 ) )  ?  ( f1  RGB [ 2 3 : 1 6 ] )  : 
a s s i g n 
( mode = = 0 )  ?  ( r e d  o n e  p l a y e r | r e d  t w o  p l a y e r  | r e d  o n e | r e d  t w o )  : 
( ( mode==2)&&(( r e d  r o u n d ==8 ’d0 ) | | (  r e d  c a r d ==8 ’d0 ) ) )  ?  8  ’ d0  :

( mode = = 2 )  ?  ( r e d  r o u n d | r e d  c a r d )  :

( f1  RGB ! = 2 4 ’ d0 )  ?  ( f1  RGB [ 2 3 : 1 6 ] )  :

( f2  RGB ! = 2 4 ’ d0 )  ?  ( f2  RGB [ 2 3 : 1 6 ] )  :

( r e d

f 1 l  | r e d  f 1 e  | r e d  f 2 l  | r e d  f 2 e  | r e d  f 1 l  f a d e  | r e d  f 1 e  f a d e  | r e d  f 2 l  f a d 
r e d  f 2 e  f a d e  | r e d  m i n | r e d  s e c  t e n s  | r e d  s e c  o n e s  | r e d  t o p  c o l o n | 
r e d  b o t t o m  c o l o n | r e d  b x r  ) ; 

a s s i g n 

a s s i g n 

g r e e n  =	 ( ( mode==0 )  &&  ( f1  RGB ! = 2 4 ’ d0 ) )  ?  ( f1  RGB [ 1 5 : 8 ] )  : 
( mode = = 0 )  ?  ( g r e e n  o n e  p l a y e r  | g r e e n  t w o  p l a y e r  | g r e e n  o n e  | g r e e n  t w o  ) 
( ( mode==2)&&(( g r e e n  r o u n d ==8 ’d0 ) | | (  g r e e n  c a r d ==8 ’d0 ) ) )  ?  8  ’ d0  : 
( mode = = 2 )  ?  ( g r e e n  r o u n d | g r e e n  c a r d  )  : 
( f1  RGB ! = 2 4 ’ d0 )  ?  ( f1  RGB [ 1 5 : 8 ] )  : 
( f2  RGB ! = 2 4 ’ d0 )  ?  ( f2  RGB [ 1 5 : 8 ] )  : 
( g r e e n  f 1 l  | g r e e n  f 1 e  | g r e e n  f 2 l  | g r e e n  f 2 e  | g r e e n  f 1 l  f a d e  | g r e e n  f 1 e  f a 
g r e e n  f 2 l  f a d e  | g r e e n  f 2 e  f a d e  | g r e e n  m i n | g r e e n  s e c  t e n s  | g r e e n  s e c  o n 
g r e e n  t o p  c o l o n |

g r e e n
 b o t t o m  c o l o n | g r e e n  b x r  ) ; 

b l u e  =	 ( ( mode==0 )  &&  ( f1  RGB ! = 2 4 ’ d0 ) )  ?  ( f1  RGB [ 7 : 0 ] )  : 
( mode = = 0 )  ?  ( b l u e  o n e  p l a y e r | b l u e  t w o  p l a y e r  | b l u e  o n e  | b l u e  t w o )  : 
( ( mode==2)&&(( b l u e  r o u n d ==8 ’d0 ) | | (  b l u e  c a r d ==8 ’d0 ) ) )  ?  8  ’ d0  :

( mode = = 2 )  ?  ( b l u e  r o u n d  | b l u e  c a r d  )  :

( f1  RGB ! = 2 4 ’ d0 )  ?  ( f1  RGB [ 7 : 0 ] )  :

( f2  RGB ! = 2 4 ’ d0 )  ?  ( f2  RGB [ 7 : 0 ] )  : 
( b l u e  f 1 l  | b l u e  f 1 e  | b l u e  f 2 l  | b l u e  f 2 e  | b l u e  f 1 l  f a d e  | b l u e  f 1 e  f a d e  | 
b l u e  f 2 l  f a d e  |

b l u e

f 2 e  f a d e  | b l u e  m i n | b l u e  s e c  t e n s  | b l u e  s e c  o n e s  | b l u e  t o p  c o l o n | 
b l u e  b o t t o m  c o l o n  |  b l u e  b x r  ) ; 

/ / c om p u t e s  t e n s  o f  t h e  s e c o n d s 
s e c  t e n s  =  ( ( s e c o n d s >=0)&&( s e c o n d s  < 1 0 ) )  ? 0  : 
a s s i g n 
( ( s e c o n d s >=10)&&( s e c o n d s  < 2 0 ) )  ?  1  : 
( ( s e c o n d s >=20)&&( s e c o n d s  < 3 0 ) )  ?  2  : 
( ( s e c o n d s >=30)&&( s e c o n d s  < 4 0 ) )  ?  3  : 
( ( s e c o n d s >=40)&&( s e c o n d s  < 5 0 ) )  ?  4  : 
( ( s e c o n d s >=50)&&( s e c o n d s  < 6 0 ) )  ?  5  :  0 ; 
t h e  s e c o n d s 

/ / c om p u t e s  o n e s  o f	

121 

a s s i g n 

s e c  o n e s  =  ( s e c o n d s − ( 1 0 ∗  s e c  t e n s  ) ) ; 

e n dm o d u l e 

122


l i n e  c o u n t  ,  p i x e l  c o u n t  ,  f 1  l h a n d  x , 
m o d u l e  F i g h t e r 1  C o n t r o l ( p i x e l  c l o c k  ,  r e s e t  , 
f 1  r h a n d  x ,  f 1  l h a n d  y ,  f 1  r h a n d  y , 
l h  s t a t u s  ,  r h  s t a t u s  , 
mode ,  RGB ) ; 

l i n e  c o u n t  ;

[ 9 : 0 ] 
i n p u t 
[ 9 : 0 ]  p i x e l
 c o u n t  ;

i n p u t 
p i x e l
 c l o c k  ,  r e s e t  ;

i n p u t 
f 1

i n p u t 
l h a n d  x ,  f 1  r h a n d  x ;

f 1

l h a n d  y ,  f 1  r h a n d  y ;

i n p u t 
l h
 s t a t u s  ,  r h  s t a t u s  ;

i n p u t 
[ 1 : 0 ]  mode ;

i n p u t 
o u t p u t 
[ 2 3 : 0 ]  RGB ;


[ 9 : 0 ] 

w i r e 
w i r e 

[ 2 3 : 0 ] 
[ 9 : 0 ] 

w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 
w i r e 

r e g 

r e g 
r e g 
r e g 
r e g 

[ 1 1 : 0 ] 
[ 3 : 0 ] 

[ 1 1 : 0 ] 
[ 1 1 : 0 ] 
[ 1 3 : 0 ] 
[ 2 3 : 0 ] 

l  e n d  l i n e  ,  r  e n d  l i n e  ,  n e x t  x  ,  n e x t  y , 

RGB ; 
r  e n d  p i x e l  , 
l  e n d  p i x e l  , 
l h a n d  y  ,  r h a n d  y ;

r i g h t h a n d  ;

l e f t h a n d  ;

r i g h t h a n d
 n e x t  ;

l e f t h a n d
 n e x t  ;

gm  d a t a  ,  g a m e  o v e r  ,  g a m e
 o v e r  n e x t ;

a d d r e s s ;

g l o v e  d a t a  ,  g l o v e 0  d a t a  ,  g l o v e 1  d a t a  ,  g l o v e 2  d a t a  ,  g l o v e 3  d a t a ;


l  e n a b l e  x , 

l  e n a b l e  y ,  g  e n a b l e  x , 

r  e n a b l e  x ,  r  e n a b l e  y , 
g  e n a b l e  y ;

l h a n d
 a d d r e s s  ;

r h a n d
 a d d r e s s ;

g
 a d d r e s s ;

d a t a ;


/ /ROMS  c o n t a i n i n g 
i m a g e s  o f  t h e  p l a y e r  ’ s  g l o v e s

g l o v e 0
 r o m  g 0 r ( . a d d r ( l h a n d  a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( g l o v e 0  d a t a ) ) ; 
g l o v e 1  r o m  g 1 r ( . a d d r ( l h a n d  a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( g l o v e 1  d a t a ) ) ; 
g l o v e 2  r o m  g 2 r ( . a d d r ( r h a n d  a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( g l o v e 2  d a t a ) ) ; 
g l o v e 3  r o m  g 3 r ( . a d d r ( r h a n d  a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( g l o v e 3  d a t a ) ) ; 
g am e o v e r  r om  gm1 ( . a d d r ( g  a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( gm  d a t a ) ) ; 

/ / d i m e n s i o n s  o f  t h e  p i c t u r e s  (  a f t e r  b e i n g  s c a l e d  by  2 )

PIC  DIMENSION  X  =  1 0 0 ;

p a r a m e t e r 
p a r a m e t e r 
PIC  DIMENSION  Y  =  1 0 0 ;


/ / l a s t  p i x e l  c o u n t  and  l i n e  c o u n t  i n  a  f r a m e

PIXELS  =  6 3 9 ;

p a r a m e t e r 
p a r a m e t e r 
LINES  =  4 7 9 ;


/ / c o l o r  p a r a m e t e r s  f o r  RGB

BLACK  =  2 4 ’ b 0 0 0 0 
p a r a m e t e r 
0 0 0 0 ;

0 0 0 0 
0 0 0 0 
0 0 0 0

0 0 0 0 
0 0 0 1

0 0 0 1 
DK GRAY  = 2 4 ’ b 0 0 0 1 
0 1 0 0 
0 1 0 0 
p a r a m e t e r 
0 1 0 0 ;

0 0 1 0 ;

1 0 0 1

1 0 0 1 
GRAY= 2 4 ’ b 1 0 0 1 
p a r a m e t e r 
0 0 1 0 
0 0 1 0 
1 1 1 1 
1 1 1 1 
1 1 1 1 
1 1 1 1

1 1 1 1 ; 
p a r a m e t e r 
WHITE= 2 4 ’ b 1 1 1 1 

123 

p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

0 0 0 0 ; 
0 0 0 0 
0 0 0 0 
0 0 0 0 
DKR RED  =  2 4 ’ b 0 1 0 0 
0 0 0 0 
0 0 0 0 
0 0 0 0 
DK RED= 2 4 ’ b 0 1 1 0 
0 0 0 0 
0 0 0 0 ; 
1 1 0 1 
0 0 0 0 ; 
0 0 0 0 
0 0 0 0 
0 1 1 0 
0 0 0 0 
RED= 2 4 ’ b 1 0 1 1 
0 0 0 0 ; 
0 0 0 0 
0 0 0 0 
0 0 0 0 
LT RED= 2 4 ’ b 1 1 0 1 
1 0 1 1 
LT BLUE= 2 4 ’ b 0 0 0 0 
0 0 0 0 
0 0 0 0 
1 0 1 1 
0 0 0 0 
0 1 1 0 ; 

/ / s t a r t i n g  and  e n d i n g 
l i n e  and  p i x e l  o f  t h e  game  o v e r  im a g e 
/ /  ( a f t e r  b e i n g  s c a l e d  by  2 ) 
p a r a m e t e r 
G  START  LINE  =  1 9 5 ; 
G  START  PIXEL  =  8 0 ; 
p a r a m e t e r 
G  END  LINE  =  2 8 5 ; 
p a r a m e t e r 
p a r a m e t e r 
G  END PIXEL  =  5 6 0 ; 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
/ / Compu t e s  e n a b l e  x 
l e f t  g l o v e  ROM  w h i c h  g o e s  h i g h  e v e r y  o t h e r

f o r  t h e 
/ /  c y c l e  w h i c h  e n a b l e s  t h e

/ / a d d r e s s  t o  i n c r e m e n t  t o  t h e  n e x t  a d d r e s s  .  T h i s  s c a l e s  t h e  im a g e  i n  t h e

/ /  ROM  h o r i z o n t a l l y  by  two

i f  ( ( n e x t
 x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  l  e n a b l e  x <=1;

e l s e 
i f  ( l e f t h a n d  n e x t )  l
 e n a b l e  x <=˜ l  e n a b l e  x ; 

f o r  t h e 

l e f t  g l o v e  ROM  w h i c h  g o e s  h i g h  e v e r y  o t h e r 

/ / Compu t e s  e n a b l e  y 
/ /  w h i c h  e n a b l e s  t h e 
/ / a d d r e s s  t o  i n c r e m e n t  t o  t h e  n e x t  a d d r e s s  on  t h e  n e x t 
/ /  i t  t o  d e c r e m e n t  t h e 
/ / a d d r e s s  by  t h e  number  o f  h o r i z o n t a l  p i x e l s  t h a t  c o r r e s p o n d  t o  t h e  im a g e ’ s  w i d t h . 
/ /  T h i s  s c a l e s  t h e 
/ / im a g e  i n  t h e  ROM  v e r t i c a l l y  by  two 
i f  ( ( n e x t  x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  l  e n a b l e  y <=1;

i f  ( n e x t
 x== l  e n d  p i x e l  )  l  e n a b l e  y <=˜ l  e n a b l e  y ; 
e l s e 

l i n e 

l i n e 

i n s t e a d  o f 

f o r c i n g 

/ / Compu t e s  t h e  a d d r e s s  f o r  t h e 
l e f t  g l o v e  im a g e 
i f  ( ( n e x t  x==( f 1  l h a n d  x −50 ))&& ( l i n e  c o u n t==l h a n d  y ) )  l h a n d  a d d r e s s <=12 ’d0 ;

e l s e 
i f  ( ( n e x t
 y>=l h a n d  y )  & &  ( n e x t  x==( f 1  l h a n d  x − 5 0 ) )  &&  l  e n a b l e  y )

l h a n d
 a d d r e s s <=( l h a n d  a d d r e s s − 1 2 ’ d 4 9 ) ;

i f  ( l e f t h a n d
 n e x t  &&  l  e n a b l e  x  )  l h a n d  a d d r e s s <=l h a n d  a d d r e s s + 1 ; 
e l s e 

/ / Compu t e s  e n a b l e  x 
f o r  t h e  r i g h t  g l o v e  ROM . . .

i f  ( ( n e x t
 x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  r  e n a b l e  x <=1;

i f  ( r i g h t h a n d  n e x t )  r
 e n a b l e  x <=˜ r  e n a b l e  x ; 
e l s e 

/ / Compu t e s  e n a b l e  y 
f o r  t h e  r i g h t  g l o v e  ROM . . .

i f  ( ( n e x t
 x==(PIXELS− 2 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  r  e n a b l e  y <=1;

i f  ( n e x t
 x== r  e n d  p i x e l  )  r  e n a b l e  y <=˜ r  e n a b l e  y ; 
e l s e 

/ / Compu t e s  t h e  a d d r e s s  f o r  t h e  r i g h t  g l o v e  ROM

i f  ( ( n e x t
 x==( f 1  r h a n d  x −50 ))&& ( l i n e  c o u n t==r h a n d  y ) )  r h a n d  a d d r e s s <=12 ’d0 ;

e l s e 
i f  ( ( n e x t
 y>=r h a n d  y )  & &  ( n e x t  x==( f 1  r h a n d  x − 5 0 ) )  &&  r  e n a b l e  y )

r h a n d
 a d d r e s s <=( r h a n d  a d d r e s s − 1 2 ’ d 4 9 ) ;

e l s e 
i f  ( r i g h t h a n d
 n e x t  &&  r  e n a b l e  x  )  r h a n d  a d d r e s s <=r h a n d  a d d r e s s + 1 ; 

124 

f o r  t h e  game  o v e r  ROM . . .

/ / Compu t e s  e n a b l e  x 
i f  ( ( n e x t
 x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  g  e n a b l e  x <=1;

i f  ( g a m e
 o v e r  n e x t )  g  e n a b l e  x <=˜ g  e n a b l e  x ; 
e l s e 

f o r  t h e  game  o v e r  ROM . . .

/ / Compu t e s  e n a b l e  y 
i f  ( ( n e x t
 x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  g  e n a b l e  y <=1;

e l s e 
i f  ( n e x t  x==G END PIXEL )  g  e n a b l e  y <=˜ g  e n a b l e
 y ; 

/ / Compu t e s  t h e  a d d r e s s  f o r  t h e  game  o v e r  ROM

i f  ( ( n e x t  x==G  START  PIXEL)&&( l i n e  c o u n t==G  START  LINE ) )  g  a d d r e s s <=14 ’d0 ;

i f  ( ( n e x t  y>=G START  LINE )  & &  ( n e x t  x==G START  PIXEL )  &&  g  e n a b l e  y )

e l s e 
g  a d d r e s s <=( g  a d d r e s s − 1 4 ’ d 2 3 9 ) ;

e l s e 
i f  ( g a m e
 o v e r  n e x t  &&  g  e n a b l e  x )  g  a d d r e s s <=g  a d d r e s s + 1 ; 

/ / Compu t e s  t h e  c o l o r  b a s e d  on  t h e  4− b i t  number  o u t p u t t e d  f r om  t h e  ROM

( g l o v e  d a t a == 8 )  ?  LT BLUE :

d a t a  <= 
( g l o v e
 d a t a == 0 )  ?  BLACK  :

( g l o v e
 d a t a == 1 )  ?  DK GRAY :

( g l o v e
 d a t a == 2 )  ?  GRAY:

( g l o v e
 d a t a == 3 )  ?  WHITE :

( g l o v e
 d a t a == 4 )  ?  DKR RED :

( g l o v e
 d a t a == 5 )  ?  DK RED :

( g l o v e
 d a t a == 6 )  ?  RED :  LT RED ; 

e n d 

/ / Compu t e s  w h e t h e r  t h e  c u r r e n t  p o s i t i o n 
l e f t  g l o v e 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e 
l e f t h a n d  =  ( ( p i x e l  c o u n t < l  e n d  p i x e l )&&( p i x e l  c o u n t >=( f 1  l h a n d  x −50))&& 
a s s i g n 
( l i n e  c o u n t < l  e n d  l i n e )&&( l i n e  c o u n t >=l h a n d  y  ) ) ; 

/ / Compu t e s  w h e t h e r  t h e  c u r r e n t  p o s i t i o n 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  r i g h t  g l o v e 
a s s i g n  r i g h t h a n d  =  ( ( p i x e l  c o u n t < r  e n d  p i x e l )&&( p i x e l  c o u n t >=( f 1  r h a n d  x −50))&& 
( l i n e  c o u n t < r  e n d  l i n e )&&( l i n e  c o u n t >=r h a n d  y ) ) ; 

/ / Compu t e s  w h e t h e r  t h e  n e x t  p o s i t i o n 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e 
l e f t  g l o v e 
l e f t h a n d  n e x t  =  ( ( n e x t  x < l  e n d  p i x e l )&&( n e x t  x >=( f 1  l h a n d  x −50))&& 
a s s i g n 
( n e x t  y < l  e n d  l i n e )&&( n e x t  y >=l h a n d  y  ) ) ; 

/ / Compu t e s  w h e t h e r  t h e  n e x t  p o s i t i o n 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  r i g h t  g l o v e 
a s s i g n  r i g h t h a n d  n e x t  =  ( ( n e x t  x < r  e n d  p i x e l )&&( n e x t  x >=( f 1  r h a n d  x −50))&& 
( n e x t  y < r  e n d  l i n e )&&( n e x t  y >=r h a n d  y ) ) ; 

/ / Compu t e s  w h e t h e r  t h e  c u r r e n t  p o s i t i o n 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  game  o v e r  im a g e 
a s s i g n  g a m e  o v e r  =  ( n e x t  x >=G  START  PIXEL)&&( n e x t  x <G  END PIXEL)&& 
( n e x t  y >=G  START  LINE)  && ( n e x t  y <G  END  LINE ) ; 
a s s i g n  g a m e  o v e r	 n e x t  =  ( p i x e l  c o u n t >=G  START  PIXEL)&&( p i x e l  c o u n t <G  END  PIXEL)&& 
( l i n e  c o u n t >=G  START  LINE)&&( l i n e  c o u n t <G  END  LINE ) ; 

i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  game  o v e r  im a g e 
/ / Compu t e s  w h e t h e r  t h e  n e x t  p o s i t i o n 
a s s i g n  n e x t  x  =  ( p i x e l  c o u n t  ==  (PIXELS − 3 ) )  ?  1 0 ’ d0 
:  ( p i x e l  c o u n t ==(PIXELS − 2 ) )  ? 
1 0 ’ d1  : 

125 

:  p i x e l  c o u n t  +  3 ; 
( p i x e l  c o u n t ==(PIXELS − 1 ) )  ?  1 0 ’ d2 
a s s i g n  n e x t  y  =  ( ( p i x e l  c o u n t  >=  (PIXELS−3))&&( p i x e l  c o u n t <=(PIXELS − 1 ) ) )  ? 
( l i n e  c o u n t  ==  ( LINES − 1 ) )  ?  1 0 ’ d0 
: 
l i n e  c o u n t  +  1 ’ b1 
: 
l i n e  c o u n t ; 

/ / D e t e r m i n e s  w h i c h  ROM  t o  r e a d  f r om  b a s e d  on  t h e  s t a t u s 
a s s i g n  g l o v e  d a t a  = ( g a m e  o v e r  && (mode==3) && gm  d a t a ) ?  4 ’ d8  : 
( l e f t h a n d  &&  l h  s t a t u s  )  ?  g l o v e 1  d a t a 
: 
( l e f t h a n d  ?  g l o v e 0  d a t a  : 
( r i g h t h a n d  &&  r h  s t a t u s  )  ?  g l o v e 3  d a t a 
( r i g h t h a n d  )  ?  g l o v e 2  d a t a 
:  4  ’ b0 ; 

: 

/ / Compu t e s  t h e 
l e f t  g l o v e 
l i n e  o f  t h e 
l a s t  p i x e l  o f  t h e 
l  e n d  p i x e l  =  ( f 1  l h a n d  x −50)+PIC  DIMENSION  X ; 
a s s i g n 

im a g e 

/ / Compu t e s  t h e 
l i n e  o f  t h e  r i g h t  g l o v e 
l a s t  p i x e l  o f  t h e 
a s s i g n  r  e n d  p i x e l  =  ( f 1  r h a n d  x −50)+PIC  DIMENSION  X ; 

im a g e 

/ / Compu t e s  t h e 
l e f t  g l o v e  im a g e 
l i n e  o f  t h e 
l a s t 
l  e n d  l i n e  =  l h a n d  y+PIC  DIMENSION  Y ; 
a s s i g n 

l i n e  o f  t h e  r i g h t  g l o v e  im a g e 
l a s t 
/ / Compu t e s  t h e 
a s s i g n  r  e n d  l i n e  =  r h a n d  y+PIC  DIMENSION  Y ; 

/ / A s s i g n s  RGB  t h e  d a t a 
i t s  c u r r e n t  p o s i t i o n 
i f 
/ /  g l o v e  o r  t h e  game  o v e r  im a g e  , 
/ / o t h e r w i s e 
i t  b l a c k 
i t  a s s i g n s 
a s s i g n  RGB  =  ( r i g h t h a n d  | | l e f t h a n d  | | g a m e  o v e r ) ?  d a t a  :  2 4  ’ h0 ; 

i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  e i t h e r 

/ / A s s i g n s  t h e  g l o v e s  ’  y  p o s i t i o n  b a s e d  on  a  1− b i t  number 
a s s i g n  l h a n d  y =( f 1  l h a n d  y )  ?  1 0 ’ d 1 2 5  :  1 0  ’ d 2 3 5 ; 
a s s i g n  r h a n d  y =( f 1  r h a n d  y )  ?  1 0 ’ d 1 2 5  :  1 0  ’ d 2 3 5 ; 
e n dm o d u l e 

126 

l i n e  c o u n t  ,  p i x e l  c o u n t  , 
m o d u l e  F i g h t e r 2  C o n t r o l ( p i x e l  c l o c k  ,  r e s e t  , 
f 2  s t a t u s  ,  mode ,  RGB ) ; 
p i c  x  ,  p i c  y , 

i n p u t  p i x e l  c l o c k  ; 
i n p u t  r e s e t  ; 
i n p u t 
[ 1 : 0 ]  mode ; 
l i n e  c o u n t  ; 
[ 9 : 0 ] 
i n p u t 
[ 9 : 0 ]  p i x e l  c o u n t  ; 
i n p u t 
[ 9 : 0 ]  p i c  x  ,  p i c  y ; 
i n p u t 
i n p u t 
[ 4 : 0 ] 
f 2  s t a t u s  ; 
[ 2 3 : 0 ]  RGB ; 
o u t p u t 

[ 2 3 : 0 ] 
[ 9 : 0 ] 

w i r e 
w i r e 
w i r e 
w i r e 

RGB ; 
e n d  p i x e l  ,  e n d  l i n e  ,  n e x t  x  ,  n e x t  y  ; 
f i g h t e r  ; 
f i g h t e r  n e x t  ; 

w i r e 

[ 3 : 0 ] 

f i g h t e r 1  d a t a  , 

f i g h t e r 3  d a t a  , 

f i g h t e r 0  d a t a  , 
f i g h t e r  d a t a  , 
f i g h t e r 5  d a t a  , 
f i g h t e r 4  d a t a  , 
f i g h t e r 6  d a t a  , 
f i g h t e r 9  d a t a  , 
f i g h t e r 8  d a t a  , 
f i g h t e r 7  d a t a  , 
f i g h t e r 1 2  d a t a  ,  f i g h t e r 1 3  d a t a  ,  f i g h t e r 1 6  d a t a  ,  f i g h t e r 1 7  d a t a  , 
f i g h t e r 1 8  d a t a  ,  f i g h t e r 1 9  d a t a  ,  f i g h t e r 2 0  d a t a  ,  f i g h t e r 2 1  d a t a  , 
f i g h t e r 2 5  d a t a  ; 
f i g h t e r 2 3  d a t a  ,  f i g h t e r 2 4  d a t a  , 

f i g h t e r 2  d a t a  , 

r e g 
r e g 
r e g 

[ 1 4 : 0 ] 

[ 2 3 : 0 ] 

a d d r e s s ; 
e n a b l e  x  ,  e n a b l e  y ; 
d a t a ; 

/ /ROMs  t h a t  c o n t a i n  t h e  b i tm a p s  o f  t h e  o p p o n e n t 
f i g h t e r 0  r o m 
f 0 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 0  d a t a ) ) ; 
f 1 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 1  d a t a ) ) ; 
f i g h t e r 1  r o m 
f 2 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 2  d a t a ) ) ; 
f i g h t e r 2  r o m 
f 3 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 3  d a t a ) ) ; 
f i g h t e r 3  r o m 
f 4 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 4  d a t a ) ) ; 
f i g h t e r 4  r o m 
f i g h t e r 5  r o m 
f 5 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 5  d a t a ) ) ; 
f 6 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 6  d a t a ) ) ; 
f i g h t e r 6  r o m 
f 7 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 7  d a t a ) ) ; 
f i g h t e r 7  r o m 
f 8 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 8  d a t a ) ) ; 
f i g h t e r 8  r o m 
f i g h t e r 9  r o m 
f 9 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 9  d a t a ) ) ; 
f 1 6 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 1 6  d a t a ) ) ; 
f i g h t e r 1 6  r o m 
f 1 7 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 1 7  d a t a ) ) ; 
f i g h t e r 1 7  r o m 
f 1 8 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 1 8  d a t a ) ) ; 
f i g h t e r 1 8  r o m 
f i g h t e r 1 9  r o m 
f 1 9 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 1 9  d a t a ) ) ; 
f 2 0 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 2 0  d a t a ) ) ; 
f i g h t e r 2 0  r o m 
f 2 1 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 2 1  d a t a ) ) ; 
f i g h t e r 2 1  r o m 
f 2 3 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 2 3  d a t a ) ) ; 
f i g h t e r 2 3  r o m 
f i g h t e r 2 4  r o m 
f 2 4 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 2 4  d a t a ) ) ; 
f i g h t e r 2 5  r o m 
f 2 5 r ( . a d d r ( a d d r e s s ) , . c l k ( p i x e l  c l o c k ) , . d o u t ( f i g h t e r 2 5  d a t a ) ) ; 

/ / d i m e n s i o n s  o f  t h e  p i c t u r e s  (  a f t e r  b e i n g  s c a l e d  by  2 ) 

127 

p a r a m e t e r 
p a r a m e t e r 

PIC  DIMENSION  X  =  2 0 0 ;

PIC  DIMENSION  Y  =  5 0 0 ;


/ / l a s t  p i x e l  c o u n t  and  l i n e  c o u n t  i n  a  f r a m e

p a r a m e t e r 
PIXELS  =  6 3 9 ;

LINES  =  4 7 9 ;

p a r a m e t e r 

/ / c o l o r  p a r a m e t e r s  f o r  RGB

p a r a m e t e r 
BLACK  =  2 4 ’ b 0 0 0 0 
0 0 0 0 ; 
0 0 0 0 
0 0 0 0 
0 0 0 0 
0 0 0 0

0 0 0 1 
0 0 0 1 
DK GRAY  = 2 4 ’ b 0 0 0 1 
0 1 0 0 
0 1 0 0 
p a r a m e t e r 
0 1 0 0 ; 
0 0 1 0 ; 
1 0 0 1 
1 0 0 1 
0 0 1 0 
0 0 1 0 
GRAY= 2 4 ’ b 1 0 0 1 
p a r a m e t e r 
1 1 1 1 ; 
1 1 1 1 
1 1 1 1 
1 1 1 1 
WHITE= 2 4 ’ b 1 1 1 1 
p a r a m e t e r 
1 1 1 1 
0 0 0 0 
0 0 0 0 
DKR RED  =  2 4 ’ b 0 1 0 0 
p a r a m e t e r 
0 0 0 0 
0 0 0 0 
0 0 0 0 ; 
DK RED= 2 4 ’ b 0 1 1 0 
1 1 0 1 
0 0 0 0 
0 0 0 0 
0 0 0 0 
0 0 0 0 ; 
p a r a m e t e r 
0 0 0 0 ; 
0 0 0 0 
0 0 0 0 
RED= 2 4 ’ b 1 0 1 1 
p a r a m e t e r 
0 0 0 0 
0 1 1 0 
0 0 0 0 ; 
0 0 0 0 
0 0 0 0 
0 0 0 0 
LT RED= 2 4 ’ b 1 1 0 1 
1 0 1 1 
p a r a m e t e r 
DK BLUE= 2 4 ’ b 0 0 0 0 
p a r a m e t e r 
0 0 0 0 
0 0 0 0 
0 1 1 0 
0 0 0 0 
1 1 0 1 ; 
p a r a m e t e r 
LT BLUE= 2 4 ’ b 0 0 0 0  0 0 0 0  0 0 0 0  0 0 0 0  1 0 1 1  0 1 1 0 ; 
0 0 0 0 
0 0 1 0 
DKR BROWN= 2 4 ’ b 0 1 0 1 
0 0 0 0 ; 
1 0 0 0 
0 0 0 0 
p a r a m e t e r 
DK BROWN= 2 4 ’ b 0 1 1 0 
p a r a m e t e r 
0 1 0 0 
0 0 1 1 
0 0 1 0 
0 0 0 0 
0 0 0 0 ; 
LT BROWN= 2 4 ’ b 1 0 0 0  0 0 0 0  0 1 0 0  0 0 0 0  0 0 0 0  0 0 0 0 ; 
p a r a m e t e r 
p a r a m e t e r 
DK YELLOW= 2 4 ’ b 0 1 1 1 
0 1 1 0 
0 1 0 1 
0 1 0 1 
0 0 0 0 
1 0 1 0 ; 
LT YELLOW= 2 4 ’ b 1 0 1 0  1 1 0 0  0 1 1 1  1 1 0 1  0 0 0 0  1 1 1 1 ; 
p a r a m e t e r 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
/ / Compu t e s  e n a b l e  x  w h i c h  g o e s  h i g h  e v e r y  o t h e r  c y c l e  w h i c h  e n a b l e s  t h e

/ /  a d d r e s s  t o 
i n c r e m e n t  t o  t h e  n e x t  a d d r e s s

/ / T h i s  s c a l e s  t h e  im a g e  i n  t h e  ROM  h o r i z o n t a l l y  by  two

i f  ( ( n e x t
 x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  e n a b l e  x <=1;

i f  ( f i g h t e r
 n e x t  )  e n a b l e  x <=˜e n a b l e  x ; 
e l s e 

/ / Compu t e s  e n a b l e  y  w h i c h  g o e s  h i g h  e v e r y  o t h e r 
i n c r e m e n t  t o  t h e  n e x t  a d d r e s s  on 
/ /  t o 
/ / t h e  n e x t 
l i n e 
i n s t e a d  o f 
f o r c i n g 
i t  t o  d e c r e m e n t  t h e  a d d r e s s  by  t h e  number  o f 
/ /  h o r i z o n t a l  p i x e l s  t h a t  c o r r e s p o n d 
/ / t o  t h e  im a g e  ’ s  w i d t h .  T h i s  s c a l e s  t h e  im a g e  i n  t h e  ROM  v e r t i c a l l y  by  two 
i f  ( ( n e x t  x==(PIXELS− 3 ) )  &&  ( n e x t  y==(LINES − 1 ) ) )  e n a b l e  y <=1;

i f  ( n e x t
 x==e n d  p i x e l )  e n a b l e  y <=˜e n a b l e  y ; 
e l s e 

l i n e  w h i c h  e n a b l e s  t h e  a d d r e s s 

/ / Compu t e s  t h e  a d d r e s s

i f  ( ( n e x t
 x==( p i c  x −100 ))&& ( l i n e  c o u n t ==( p i c  y  − 2 5 0 ) ) )  a d d r e s s <=15 ’ d0 ;

e l s e 
i f  ( ( n e x t
 y >=( p i c  y − 2 5 0 ) )  &&  ( n e x t  x==( p i c  x − 1 0 0 ) )  &&  e n a b l e  y ) 
a d d r e s s <=( a d d r e s s − 1 5 ’ d 9 9 ) ;

i f  ( f i g h t e r
 n e x t  &&  e n a b l e  x  )  a d d r e s s<=a d d r e s s + 1 ; 
e l s e 

/ / Compu t e s  t h e  c o l o r  b a s e d  on  t h e  4− b i t  number  o u t p u t t e d  f r om  t h e  ROM

d a t a  <=  ( f i g h t e r  d a t a == 0 )  ?  BLACK  :

( f i g h t e r
 d a t a == 1 )  ?  GRAY :

( f i g h t e r
 d a t a == 2 )  ?  WHITE :

( f i g h t e r
 d a t a == 3 )  ?  DK RED :

( f i g h t e r
 d a t a == 4 )  ?  RED : 

128 

( f i g h t e r  d a t a == 5 )  ?  LT RED :

( f i g h t e r
 d a t a == 6 )  ?  DK BLUE :

( f i g h t e r
 d a t a == 7 )  ?  LT BLUE :

( f i g h t e r
 d a t a == 8 )  ?  DK BROWN:

( f i g h t e r
 d a t a == 9 )  ?  LT BROWN :

( f i g h t e r
 d a t a = = 1 0 )  ?  DK YELLOW :

( f i g h t e r
 d a t a = = 1 2 )  ?  DKR BROWN:

( f i g h t e r
 d a t a = = 1 3 )  ?  DKR RED  :

( f i g h t e r
 d a t a = = 1 4 )  ?  DKR BROWN :  LT YELLOW ; 

e n d 

/ / Compu t e s  w h e t h e r  t h e  n e x t  p o s i t i o n 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  o p p o n e n t 
a s s i g n  f i g h t e r  n e x t  =  ( n e x t  x >=( p i c  x −100 ))&& ( n e x t  x < e n d  p i x e l )&&( n e x t  y >=( p i c  y − 2 5 0 ) ) 
&&( n e x t  y < e n d  l i n e  ) ; 

/ / Compu t e s  w h e t h e r  t h e  c u r r e n t  p o s i t i o n 
i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  o p p o n e n t 
f i g h t e r  =  ( p i x e l  c o u n t >=( p i c  x −100 ))&& ( p i x e l  c o u n t < e n d  p i x e l )&& 
a s s i g n 
( l i n e  c o u n t >=( p i c  y −250 ))&& ( l i n e  c o u n t < e n d  l i n e  ) ; 

/ / Compu t e s  t h e  n e x t  p o s i t i o n 
a s s i g n  n e x t  x  =  ( p i x e l  c o u n t  ==  (PIXELS − 3 ) )  ?  1 0 ’ d0 
1 0 ’ d1  :

( p i x e l
 c o u n t ==(PIXELS − 1 ) )  ?  1 0 ’ d2 
:  p i x e l  c o u n t  +  3 ; 
a s s i g n  n e x t  y  =  ( ( p i x e l  c o u n t  >=  (PIXELS−3))&&( p i x e l  c o u n t <=(PIXELS − 1 ) ) )  ? 
( l i n e  c o u n t  ==  ( LINES − 1 ) )  ?  1 0 ’ d0 
: 
l i n e  c o u n t  +  1 ’ b1 
: 
l i n e  c o u n t ; 

:  ( p i x e l  c o u n t ==(PIXELS − 2 ) )  ?


/ / Compu t e s  t h e 
l i n e  o f  t h e  im a g e 
l a s t 
a s s i g n  e n d  l i n e  =  p i c  y+PIC  DIMENSION  Y− 2 5 0 ; 

l i n e  o f  t h e  im a g e 
l a s t  p i x e l  o f  t h e 
/ / Compu t e s  t h e 
a s s i g n  e n d  p i x e l  =  p i c  x+PIC  DIMENSION  X− 1 0 0 ; 

i f 
i t s  c u r r e n t  p o s i t i o n 
/ / A s s i g n s  RGB  t h e  d a t a 
/ /  o t h e r w i s e 
i t  b l a c k

i t  a s s i g n s 
a s s i g n  RGB  =  ( f i g h t e r ) ?  d a t a  :  2 4 ’ h0 ;


i s  w i t h i n  t h e  b o u n d a r y  o f  t h e  o p p o n e n t  ,


/ / D e t e r m i n e s  w h i c h  ROM  t o  r e a d  f r om  b a s e d  on  t h e  s t a t u s

a s s i g n  f i g h t e r  d a t a  =	 ( (  f 2  s t a t u s = = 0 ) | | ( f 2  s t a t u s = = 2 2 ) )  ?  f i g h t e r 0  d a t a 
( f 2  s t a t u s == 1 )  ?  f i g h t e r 1  d a t a 
: 
( f 2  s t a t u s == 2 )  ?  f i g h t e r 2  d a t a 
: 
( f 2  s t a t u s == 3 )  ?  f i g h t e r 3  d a t a 
: 
( f 2  s t a t u s == 4 )  ?  f i g h t e r 4  d a t a 
: 
( f 2  s t a t u s == 5 )  ?  f i g h t e r 5  d a t a 
: 
( (  f 2  s t a t u s = = 6 ) | | ( f 2  s t a t u s = = 1 0 ) | | ( f 2  s t a t u s == 1 4 ) )  ? 
f i g h t e r 6  d a t a 
: 
( (  f 2  s t a t u s = = 7 ) | | ( f 2  s t a t u s = = 1 1 ) | | ( f 2  s t a t u s == 1 5 ) )  ? 
f i g h t e r 7  d a t a 
: 
( (  f 2  s t a t u s = = 8 ) | | ( f 2  s t a t u s = = 1 2 ) )  ?  f i g h t e r 8  d a t a 
( (  f 2  s t a t u s = = 9 ) | | ( f 2  s t a t u s = = 1 3 ) )  ?  f i g h t e r 9  d a t a 
( f 2  s t a t u s = = 1 6 )  ?  f i g h t e r 1 6  d a t a 
: 
( f 2  s t a t u s = = 1 7 )  ?  f i g h t e r 1 7  d a t a 
: 

: 
: 

: 

129 

( f 2  s t a t u s = = 1 8 )  ?  f i g h t e r 1 8  d a t a 
( f 2  s t a t u s = = 1 9 )  ?  f i g h t e r 1 9  d a t a 
( f 2  s t a t u s = = 2 0 )  ?  f i g h t e r 2 0  d a t a 
( f 2  s t a t u s = = 2 1 )  ?  f i g h t e r 2 1  d a t a 
( f 2  s t a t u s = = 2 3 )  ?  f i g h t e r 2 3  d a t a 
( f 2  s t a t u s = = 2 4 )  ?  f i g h t e r 2 4  d a t a 

: 
: 
: 
: 
: 
: 

f i g h t e r 2 5  d a t a  ; 

e n dm o d u l e 

130 

f 

e 

| 
| 

| 
|  b 

a 
/ / 
/ / 
−−−− 
/ / 
|
|  g 
/ / 
/ / 
−−−− 
/ / 
|
/ / 
|
/ / 
−−−− 
d 
/ / 
m o d u l e  number ( x ,  y ,  c o r n e r  x  ,  c o r n e r  y  ,  num ,  r e d  ,  g r e e n  ,  b l u e  ) ;

[ 9 : 0 ]  x ,  y ,  c o r n e r
 x  ,  c o r n e r  y ;

i n p u t 
[ 3 : 0 ] 
i n p u t 
num ;

[ 7 : 0 ]  r e d ;

o u t p u t 
o u t p u t 
[ 7 : 0 ] 
g r e e n ;

b l u e ;

[ 7 : 0 ] 
o u t p u t 

c 

r e g 

[ 2 3 : 0 ] 

RGB ; 

p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 
p a r a m e t e r 

ZERO  =  0 ;

ONE  =  1 ;

TWO  =  2 ;

THREE  =  3 ;

FOUR  =  4 ;

FIVE  =  5 ;

SIX  =  6 ;

SEVEN  =  7 ;

EIGHT  =  8 ;

NINE  =  9 ;

HDIM  =  1 4 ;

VDIM  =  2 4 ;

WIDTH  =  3 ;

SPACE  =  6 ;

COLOR  =  2 4 ’  h f f f f f f  ;

BACKGROUND  =  2 4 ’ d0 ;


w i r e 

a , b , c , d , e , f , g ; / / s e g m e n t s  a s  d e f i n e d  a b o v e 

a l w a y s  @ ( num  o r  a o r  b o r  c o r  d o r  e o r  f  o r  g )  b e g i n 
c a s e  ( num ) 
RGB  =  ( a | | b | | c  | | d | | e  | | f  )  ?  COLOR  :  BACKGROUND; 
ZERO : 
RGB  =  ( b | | c )  ?  COLOR  : 
BACKGROUND; 
ONE : 
TWO: 
RGB  =  ( a | | b | | d | | e  | | g )  ?  COLOR  :  BACKGROUND; 
THREE :  RGB  =  ( a | | b | | c  | | d | | g )  ?  COLOR  :  BACKGROUND; 
RGB  =  ( b | | c  | | f  | | g )  ?  COLOR  :  BACKGROUND; 
FOUR : 
RGB  =  ( a | | c  | | d | | f  | | g )  ?  COLOR  :  BACKGROUND; 
FIVE : 
SIX : 
RGB  =  ( a | | c  | | d | | e  | | f  | | g )  ?  COLOR  :  BACKGROUND; 
SEVEN :  RGB  =  ( a | | b | | c )  ?  COLOR  :  BACKGROUND; 
EIGHT :  RGB  =  ( a | | b | | c  | | d | | e  | | f  | | g )  ?  COLOR  :  BACKGROUND; 
NINE : 
RGB  =  ( a | | b | | c  | | d | | f  | | g )  ?  COLOR  :  BACKGROUND; 
d e f a u l t  :  RGB  =  BACKGROUND;

e n d c a s e


131 

e n d 

a s s i g n  a  =  ( ( x>=( c o r n e r  x+WIDTH) )&& ( x<=( c o r n e r  x+HDIM−WIDTH) )&& ( y>=c o r n e r  y ) 
&&(y<=( c o r n e r  y+WIDTH ) ) ) ; 
a s s i g n  b  =  ( ( x>=( c o r n e r  x+HDIM−WIDTH) )&& ( x<=( c o r n e r  x+HDIM))&& 
( y>=( c o r n e r  y+WIDTH) )&& ( y<=( c o r n e r  y+WIDTH+SPACE ) ) ) ;

a s s i g n  c  =  ( ( x>=( c o r n e r
 x+HDIM−WIDTH) )&& ( x<=( c o r n e r  x+HDIM))&& 
( y>=( c o r n e r  y +2∗WIDTH+SPACE) )&& ( y<=( c o r n e r  y+VDIM−WIDTH ) ) ) ;

a s s i g n  d  =  ( ( x>=( c o r n e r  x+WIDTH) )&& ( x<=( c o r n e r
 x+HDIM−WIDTH))&& 
( y>=( c o r n e r  y+VDIM−WIDTH) )&& ( y<=( c o r n e r  y+VDIM ) ) ) ;

a s s i g n  e  =  ( ( x>=c o r n e r
 x )&&(x<=( c o r n e r  x+WIDTH) )&& ( y>=( c o r n e r  y +2∗WIDTH+SPACE ) ) 
&&(y<=( c o r n e r  y+VDIM−WIDTH ) ) ) ;

a s s i g n  f  =  ( ( x>=c o r n e r
 x )&&(x<=( c o r n e r  x+WIDTH) )&& ( y>=( c o r n e r  y+WIDTH))&& 
( y<=( c o r n e r  y+WIDTH+SPACE ) ) ) ;

a s s i g n  g  =  ( ( x>=( c o r n e r  x+WIDTH) )&& ( x<=( c o r n e r
 x+HDIM−WIDTH))&& 
( y>=( c o r n e r  y+WIDTH+SPACE) )&& ( y<=( c o r n e r  y +2∗WIDTH+SPACE ) ) ) ; 

a s s i g n  r e d  =  RGB [ 2 3 : 1 6 ] ;

a s s i g n  g r e e n  =  RGB [ 1 5 : 8 ] ;

a s s i g n  b l u e  =  RGB [ 7 : 0 ] ;


e n dm o d u l e 

132 

m o d u l e  r e c t a n g l e ( p i x e l  c l o c k  ,  r e s e t  ,  x ,  y ,  c o r n e r  x  ,  c o r n e r  y  ,  h e i g h t  ,  w i d t h  ,  r e d  ,  g r e e n  , 
b l u e  ,  b l i n k  ) ;

i n p u t  p i x e l
 c l o c k  ,  r e s e t  ,  b l i n k  ;

[ 9 : 0 ]  x ,  y ,  c o r n e r
 x  ,  c o r n e r  y  ,  h e i g h t  ,  w i d t h ;

i n p u t 
o u t p u t 
[ 7 : 0 ]  r e d ,  g r e e n ,  b l u e ;


w i r e 
w i r e 

[ 7 : 0 ] 
r e d ,  g r e e n ,  b l u e ; 
[ 2 3 : 0 ]  RGB ; 

p a r a m e t e r 
d e f p a r a m 

COLOR= 2 4 ’ b 0 1 0 1 
1 1 1 1 
0 0 0 1 
c t  . e n d c o u n t  =  2 5 1 7 4 9 9 9 ;


1 1 1 1 

0 0 0 1 

1 1 1 1 ;


c o u n t e r  c t ( . c l k ( p i x e l  c l o c k ) , . R e s e t  S y n c ( r e s e t ) , . e n a b l e ( e n a b l e ) ) ; 

a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n

i f  ( !  r e s e t
 s y n c  )  c o u n t e r <=0;

i f  ( e n a b l e  &&  ( c o u n t e r ==2) &&  b l i n k )  c o u n t e r <=0;

e l s e 
e l s e 
i f  ( e n a b l e  &&  b l i n k )  c o u n t e r <=( c o u n t e r + 1 ) ;

e n d 

a s s i g n  RGB  =  ( ( x>=c o r n e r  x )  & &  ( y>=c o r n e r  y )  & &  ( x<( c o r n e r  x+w i d t h ) )  &&

( y<( c o r n e r  y+h e i g h t ) )  & &  ( c o u n t e r ! = 2 ) )  ?  COLOR  :  2 4 ’ h0 ;

a s s i g n  RGB  =  ( ( x>=c o r n e r  x )  & &  ( y>=c o r n e r  y )  & &  ( x<( c o r n e r  x+w i d t h ) )  &&

( y<( c o r n e r  y+h e i g h t  ) ) )  ?  COLOR  :  2 4  ’ h0 ;


a s s i g n  r e d  =  RGB [ 2 3 : 1 6 ] ;

a s s i g n  g r e e n  =  RGB [ 1 5 : 8 ] ;

a s s i g n  b l u e  =  RGB [ 7 : 0 ] ;


e n dm o d u l e 

133 

m o d u l e  t i m e r ( p i x e l  c l o c k  ,  r e s e t  ,  mode ,  m i n u t e s  ,  s e c o n d s  ) ;

i n p u t  p i x e l
 c l o c k  ;

i n p u t  r e s e t  ;

i n p u t  mode ;

o u t p u t 
[ 1 : 0 ]  m i n u t e s ;

[ 5 : 0 ]  s e c o n d s ;

o u t p u t 

r e g  e n a b l e ;

r e g 
[ 7 : 0 ]  c o u n t e r ;


a l w a y s  @  ( p o s e d g e  p i x e l  c l o c k  )  b e g i n 
i f  ( ! r e s e t )  c o u n t e r <=180 ; 
i f  ( e n a b l e  &&  ( c o u n t e r == 0 ) )  c o u n t e r <=0; 
e l s e 
e l s e 
i f  ( e n a b l e )  c o u n t e r <=c o u n t e r − 1 ; 

i f  ( ! r e s e t )  m i n u t e s <=3;

i f  ( ( c o u n t e r ==180 ) &&  e n a b l e )  m i n u t e s <=2;

e l s e 
e l s e 
i f  ( ( c o u n t e r ==121 ) &&  e n a b l e )  m i n u t e s <=1;

i f  ( ( c o u n t e r ==61) &&  e n a b l e )  m i n u t e s <=0;

e l s e 

i f  ( ! r e s e t )  s e c o n d s <=0;

e l s e 
i f  ( ( s e c o n d s ==0) &&  e n a b l e  &&  ( m i n u t e s ! = 0 ) )  s e c o n d s <=59 ;

i f  ( ( s e c o n d s ==0) &&  e n a b l e )  s e c o n d s <=0;

e l s e 
e l s e 
i f  ( e n a b l e )  s e c o n d s <=s e c o n d s − 1 ;


e n d 

e n dm o d u l e 

134 

t o p 

1 4 : 1 8 : 0 6  0 4 / 2 3 / 0 6 

‘ t i m e s c a l e  1 n s  /  1 p s 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
/ /  Company : 
/ /  E n g i n e e r : 
/ / 
/ /  C r e a t e  D a t e : 
/ /  D e s i g n  Name : 
/ /  Modu l e  Name : 
/ /  P r o j e c t  Name : 
/ /  T a r g e t  D e v i c e  : 
/ /  T o o l  v e r s i o n s  : 
/ /  D e s c r i p t i o n  : 
/ / 
/ /  D e p e n d e n c i e s  : 
/ / 
/ /  R e v i s i o n : 
/ /  R e v i s i o n  0 . 0 1  −  F i l e  C r e a t e d 
/ /  A d d i t i o n a l  Comments : 
/ / 
/ / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
m o d u l e  t o p ( p i x e l  c l o c k  ,  r e s e t  s y n c  ,  r o u n d  ,  mode ,  f 1  l h a n d  x ,  f 1  r h a n d  x ,  f 1  l h a n d  y , 
f 1  r h a n d  y  , f 1  l h  s t a t u s  , 
f 1  r h  s t a t u s  , 
f 1  l i f e b a r  ,  f 1  e n e r g y b a r  , 
f 2  p i c  x , 
f 2  l i f e b a r  ,  f 2  e n e r g y b a r  ,  h s y n c  ,  v s y n c  , 
f 2  p i c  y , 
f 2  s t a t u s  , 
s y n c  b  ,  b l a n k  b  ,  r e d  ,  g r e e n  ,  b l u e  ,  p i x e l  c o u n t  , 
l i n e  c o u n t  ,  t i m e  i n  , 
f r a m e  p u l s e  ) ; 

i n p u t  p i x e l  c l o c k  ;

i n p u t  r e s e t
 s y n c  ;

[ 1 : 0 ]  mode ;

i n p u t 
i n p u t 
[ 3 : 0 ]  r o u n d ;

f 2  l i f e b a r  ,  f 2  e n e r g y b a r ;

l i f e b a r  ,  f 1  e n e r g y b a r  , 
f 1

[ 4 : 0 ] 
i n p u t 
f 2  p i c  x , 
l h a n d  x ,  f 1  r h a n d  x , 
f 2  p i c  y ;

f 1

[ 9 : 0 ] 
i n p u t 
f 2
 s t a t u s  ;

i n p u t 
[ 4 : 0 ] 
l h a n d  y ,  f 1  r h a n d  y ;

f 1

i n p u t 
i n p u t 
f 1

l h  s t a t u s  , 
f 1  r h  s t a t u s  ;

[ 7 : 0 ]  t i m e

i n p u t 
i n  ;

o u t p u t 
h s y n c  ,  v s y n c  ,  s y n c  b  ,  b l a n k
 b  ,  f r a m e  p u l s e  ;

[ 7 : 0 ]  r e d ,  g r e e n ,  b l u e ;

o u t p u t 
[ 9 : 0 ]  p i x e l
 c o u n t  , 
l i n e  c o u n t  ; 
o u t p u t 

[ 9 : 0 ] 
[ 2 3 : 0 ] 

w i r e 
w i r e 
w i r e 

p i x e l  c o u n t  , 
l i n e  c o u n t  ;

f1  RGB ,  f2  RGB ;

r e s e t
 s y n c  ,  f r a m e  p u l s e ; 

D i s p l a y  F i e l d  d f ( . p i x e l  c l o c k ( p i x e l  c l o c k  )  , .  r e s e t  s y n c ( r e s e t  s y n c  ) , 
. p i x e l  c o u n t ( p i x e l  c o u n t ) , . l i n e  c o u n t ( l i n e  c o u n t  ) , 
.  f 1  l i f e b a r  (  f 1  l i f e b a r ) , . f 1  e n e r g y b a r ( f 1  e n e r g y b a r ) , 
.  f 2  l i f e b a r  (  f 2  l i f e b a r ) ,  . f 2  e n e r g y b a r ( f 2  e n e r g y b a r ) , 
.  f 1  l h a n d  x ( f 1  l h a n d  x )  , . f 1  r h a n d  x ( f 1  r h a n d  x ) , 
.  f 1  l h a n d  y ( f 1  l h a n d  y ) ,  . l h  s t a t u s ( f 1  l h  s t a t u s  ) , 
.  r h  s t a t u s ( f 1  r h  s t a t u s  )  , .  f 1  r h a n d  y ( f 1  r h a n d  y ) , 

135 

.  f 2  p i c  x ( f 2  p i c  x  )  , .  f 2  p i c  y ( f 2  p i c  y  )  , .  f 2  s t a t u s  ( f 2  s t a t u s  ) , 
. r e d ( r e d ) , . g r e e n ( g r e e n ) , . b l u e ( b l u e ) , . f r a m e  p u l s e ( f r a m e  p u l s e ) , 
. mode ( mode ) , . r o u n d ( r o u n d ) , . t i m e  i n ( t i m e  i n ) ) ; 

v g a  v g a 1 ( . p i x e l  c l o c k ( p i x e l  c l o c k ) , . r e s e t ( r e s e t  s y n c  )  , . h s y n c ( h s y n c )  , . v s y n c ( v s y n c ) , 
. s y n c  b ( s y n c  b ) ,  . b l a n k  b ( b l a n k  b ) , . p i x e l  c o u n t ( p i x e l  c o u n t ) , 
.  l i n e  c o u n t ( l i n e  c o u n t ) , . f r a m e  p u l s e ( f r a m e  p u l s e ) ) ; 

e n dm o d u l e 

136 

i m p o r t  j a v a  . aw t . im a g e . B u f f e r e d I m a g e ;

i m p o r t  j a v a . i o . B u f f e r e d W r i t e r ;

i m p o r t  j a v a  .  i o  . F i l e  ;

i m p o r t  j a v a  .  i o  . F i l e W r i t e r ;

i m p o r t  j a v a  .  i o  . I O E x c e p t i o n ;

i m p o r t  j a v a  .  u t i l  . ∗  ;

i m p o r t  j a v a . u t i l . A r r a y L i s t ;


i m p o r t  j a v a x . i m a g e i o . Ima g e IO ;


/ ∗ ∗ 
∗ 
∗ / 

/ ∗ ∗ 
∗  @ a u t h o r  D a v i d  B l a u

∗

∗ /

p u b l i c  c l a s s  N ew Im a g eC o n v e r t  { 

/ ∗ ∗ 
∗  @param  a r g s

∗ /

p u b l i c  s t a t i c  v o i d  ma in ( S t r i n g [ ]  a r g s )  {

i  = 0 ;  i < 4 ;  i ++){

( i n t 
f o r	
S t r i n g 
i m a g e f i l e n a m e  ,  c o e f i l e n a m e ;

i f  ( i < 1 0 ) {

i m a g e f i l e n a m e  =  ” g l o v e 0 0 0”+ i + ” .bmp ” ; 
c o e f i l e n a m e  =  ” n e w c o e / g l o v e ”+ i + ” . c o e ” ; 

} 
e l s e { 
i m a g e f i l e n a m e  =  ” f i g h t e r 0 0 ”+ i + ” .bmp ” ; 
c o e f i l e n a m e  =  ” n e w c o e / f i g h t e r ”+ i + ” . c o e ” ; 

} 
/ / L i s t <S t r i n g >  e l e m e n t s  =  new  A r r a y L i s t<S t r i n g  > ( ) ; 
i f  ( a r g s  .  l e n g t h ! = 0 )  { 
i m a g e f i l e n a m e  =  a r g s  [ 0 ] ; 
c o e f i l e n a m e  =  a r g s  [ 1 ] ; 

} 

F i l e 

i m a g e F i l e  =  new  F i l e ( i m a g e f i l e n a m e ) ; 

B u f f e r e d I m a g e  im a g e  =  n u l l  ;

t r y {


im a g e  =  Ima g e IO . r e a d ( i m a g e F i l e ) ;

}  c a t c h  ( I O E x c e p t i o n  i o e ) { 
S y s t em . e r r . p r i n t l n ( ” E r r o r  r e a d i n g  im a g e :  ” + i m a g e f i l e n a m e ) ; 
r e t u r n  ; 

} 

i n t	 h e i g h t  =  im a g e . g e t H e i g h t ( ) ; 

137 

i n t  w i d t h  =  im a g e . g e tW i d t h ( ) ;

i n t  r g b = 0 ;

S t r i n g  r g b S t r i n g ;

i n t  r e d ;

i n t  g r e e n ;

i n t  b l u e  ;

S t r i n g  o u t p u t S t r i n g  ;


i f  ( ! c o e f i l e n a m e . e n d sW i t h ( ” . c o e ” ) )  c o e f i l e n a m e +=”. c o e ” ;

t r y  { 
B u f f e r e d W r i t e r  o u t  =  new  B u f f e r e d W r i t e r ( new  F i l e W r i t e r ( c o e f i l e n a m e ) ) ; 
o u t . w r i t e ( ” m e m o r y  i n i t i a l i z a t i o n  r a d i x = 2 ; \ n”+ 
” m e m o r y  i n i t i a l i z a t i o n  v e c t o r =\n \ n ” ) ; 

f o r ( i n t  y = 0 ; y<h e i g h t  ; y++){

f o r ( i n t  x = 0 ; x<w i d t h ; x++){

r g b  =  im a g e . getRGB ( x , y ) ;


r g b S t r i n g  =  I n t e g e r . t o B i n a r y S t r i n g ( r g b ) ;

/ / S y s t em . o u t .  p r i n t l n ( r g b S t r i n g ) ;

r e d  =  I n t e g e r . p a r s e I n t ( r g b S t r i n g . s u b s t r i n g ( 8 , 1 1 ) , 2 ) ;

g r e e n  =  I n t e g e r . p a r s e I n t ( r g b S t r i n g . s u b s t r i n g ( 1 6 , 1 9 ) , 2 ) ;

b l u e  =  I n t e g e r . p a r s e I n t ( r g b S t r i n g . s u b s t r i n g ( 2 4 , 2 7 ) , 2 ) ;

S y s t em . o u t .  p r i n t l n ( r e d ) ;

i f  ( ( r e d==g r e e n )  & &  ( g r e e n==b l u e ) )  {

i f  ( r e d ==0 )  o u t p u t S t r i n g = ” 0 0 0 0 ” ; 
i f  ( r e d < 3 )  o u t p u t S t r i n g  =  ” 1 1 0 0 ” ; 
e l s e 
e l s e 
i f  ( r e d < 6 )  o u t p u t S t r i n g = ” 0 0 0 1 ” ; 
e l s e  o u t p u t S t r i n g = ” 0 0 1 0 ” ; 

} 
e l s e 

} 
e l s e 

} 
e l s e 

} 
e l s e 

i f  ( ( g r e e n ==0)&&( b l u e ==0 )){ 
i f  ( r e d ==1 )  o u t p u t S t r i n g = ” 1 1 0 1 ” ; 
i f  ( r e d < 4 )  o u t p u t S t r i n g = ” 0 0 1 1 ” ; 
e l s e 
e l s e 
i f  ( r e d < 6 )  o u t p u t S t r i n g = ” 0 1 0 0 ” ; 
e l s e  o u t p u t S t r i n g  =  ” 0 1 0 1 ” ; 

i f  ( ( r e d ==0)&&( g r e e n ==0 )){ 
i f  ( b l u e < 2 )  o u t p u t S t r i n g = ” 1 1 0 0 ” ; 
e l s e 
i f  ( b l u e < 5 )  o u t p u t S t r i n g = ” 0 1 1 0 ” ; 
e l s e  o u t p u t S t r i n g = ” 0 1 1 1 ” ; 

i f  ( ( ( r e d −1)== g r e e n )&& ( ( g r e e n −1)== b l u e ) ) { 
i f  ( r e d < 3 )  o u t p u t S t r i n g  = ” 1 1 1 0 ” ; 
e l s e 
i f  ( r e d < 5 )  o u t p u t S t r i n g = ” 1 0 0 0 ” ; 
e l s e  o u t p u t S t r i n g = ” 1 0 0 1 ” ; 

i f  ( ( r e d==g r e e n )  & &  ( b l u e <r e d ) ) { 
i f  ( r e d < 3 )  o u t p u t S t r i n g = ” 1 1 0 0 ” ; 
i f  ( ( r e d < 5 )  &&  ( r e d−b l u e > 1 ) )  o u t p u t S t r i n g = ” 1 0 1 0 ” ; 
e l s e 
i f  ( r e d−b l u e > 1 )  o u t p u t S t r i n g = ” 1 0 1 1 ” ; 
e l s e 
e l s e 
i f  ( r e d < 6 )  o u t p u t S t r i n g = ” 0 0 0 1 ” ; 

138 

} 
e l s e 

} 
e l s e 

} 
e l s e 

} 
e l s e 

e l s e  o u t p u t S t r i n g = ” 0 0 1 0 ” ; 

i f  ( ( r e d>g r e e n )  & &  ( r e d>b l u e )  & &  ( g r e e n != b l u e ) ) { 
i f  ( r e d < 3 )  o u t p u t S t r i n g = ” 1 1 1 0 ” ; 
e l s e 
i f  ( r e d < 5 )  o u t p u t S t r i n g = ” 1 0 0 0 ” ; 
e l s e  o u t p u t S t r i n g = ” 1 0 0 1 ” ; 

i f  ( ( r e d>g r e e n )&&( r e d>b l u e ) ) { 
i f  ( r e d ==1 )  o u t p u t S t r i n g = ” 1 1 0 1 ” ; 
i f  ( r e d < 4 )  o u t p u t S t r i n g = ” 0 0 1 1 ” ; 
e l s e 
e l s e 
i f  ( r e d < 6 )  o u t p u t S t r i n g = ” 0 1 0 0 ” ; 
e l s e  o u t p u t S t r i n g  =  ” 0 1 0 1 ” ; 

i f  ( ( g r e e n>r e d )  & &  ( g r e e n >b l u e ) ) { 
i f  ( g r e e n < 3 )  o u t p u t S t r i n g = ” 1 1 1 0 ” ; 
i f  ( ( g r e e n < 5 )  &&  ( ( g r e e n −b l u e ) > 1 ) )  o u t p u t S t r i n g = ” 1 0 1 0 ” ; 
e l s e 
e l s e 
i f  ( ( g r e e n −b l u e ) > 1 )  o u t p u t S t r i n g = ” 1 0 1 1 ” ; 
e l s e 
i f  ( g r e e n < 6 )  o u t p u t S t r i n g = ” 0 0 0 1 ” ; 
e l s e  o u t p u t S t r i n g = ” 0 0 1 0 ” ; 

i f  ( ( b l u e >r e d )  & &  ( b l u e >g r e e n ) ) { 
i f  ( b l u e < 2 )  o u t p u t S t r i n g = ” 1 1 0 0 ” ; 
e l s e 
i f  ( b l u e < 5 )  o u t p u t S t r i n g = ” 0 1 1 0 ” ; 
e l s e  o u t p u t S t r i n g = ” 0 1 1 1 ” ; 

} 
e l s e  { 
i f  ( b l u e < 3 )  o u t p u t S t r i n g = ” 1 1 0 0 ” ; 
e l s e 
i f  ( b l u e < 6 )  o u t p u t S t r i n g = ” 0 0 0 1 ” ; 
e l s e  o u t p u t S t r i n g = ” 0 0 1 0 ” ; 

} 

w h i l e ( r g b S t r i n g .  l e n g t h ( ) < 8 ) 
r g b S t r i n g  =  ” 0 ”+ r g b S t r i n g ; 

/ / i f  ( ! e l e m e n t s . c o n t a i n s ( o u t p u t S t r i n g ) ) {

/ / e l e m e n t s  . add ( o u t p u t S t r i n g  ) ;

i f  ( x==w i d t h −1  &&  y==h e i g h t −1 )

o u t . w r i t e ( o u t p u t S t r i n g + ” ; \ n ” ) ; 

e l s e 

/ / } 

} 

o u t . w r i t e ( o u t p u t S t r i n g + ” , \ n ” ) ; 

} 
o u t . c l o s e  ( ) ; 
}  c a t c h  ( I O E x c e p t i o n  e )  { 
S y s t em . e r r . p r i n t l n ( ” E r r o r  w r i t i n g  c o e :  ” + c o e f i l e n a m e ) ; 

}


}

}


} 

139 


“mcs-ftl” — 2010/9/8 — 0:40 — page 313 — #319

11

Cardinality Rules

11.1 Counting One Thing by Counting Another

How do you count the number of people in a crowded room? You could count
heads, since for each person there is exactly one head. Alternatively, you could
count ears and divide by two. Of course, you might have to adjust the calculation
if someone lost an ear in a pirate raid or someone was born with three ears. The
point here is that you can often count one thing by counting another, though some
fudge factors may be required. This is a central theme of counting, from the easiest
problems to the hardest.
In more formal terms, every counting problem comes down to determining the
size of some set. The size or cardinality of a ﬁnite set S is the number of elements
in S and it is denoted by jS j. In these terms, we’re claiming that we can often ﬁnd
the size of one set by ﬁnding the size of a related set. We’ve already seen a general
statement of this idea in the Mapping Rule of Theorem 7.2.1. Of particular interest
here is part 3 of Theorem 7.2.1, where we state that if there is a bijection between
two sets, then the sets have the same size. This important fact is commonly known
as the Bijection Rule.

11.1.1 The Bijection Rule
Rule 11.1.1 (Bijection Rule). If there is a bijection f W A ! B between A and B ,
then jAj D jB j.
The Bijection Rule acts as a magniﬁer of counting ability; if you ﬁgure out the
size of one set, then you can immediately determine the sizes of many other sets
via bijections. For example, consider the two sets mentioned at the beginning of
Part III:
A D all ways to select a dozen doughnuts when ﬁve varieties are available
B D all 16-bit sequences with exactly 4 ones
„ ƒ‚ …
„ƒ‚…
0 0„ƒ‚…
0 0„ƒ‚…
0 0„ƒ‚…
Let’s consider a particular element of set A:
0 0 0 0 0 0
sugar
chocolate
lemon-ﬁlled
glazed
plain
We’ve depicted each doughnut with a 0 and left a gap between the different vari-
eties. Thus, the selection above contains two chocolate doughnuts, no lemon-ﬁlled,

1“mcs-ftl” — 2010/9/8 — 0:40 — page 314 — #320

Chapter 11 Cardinality Rules
six sugar, two glazed, and two plain. Now let’s put a 1 into each of the four gaps:
0 0„ƒ‚…
0 0„ƒ‚…
„ ƒ‚ …
„ƒ‚…
0 0„ƒ‚…
0 0 0 0 0 0
sugar
glazed
plain
chocolate
lemon-ﬁlled
We’ve just formed a 16-bit number with exactly 4 ones—an element of B !
This example suggests a bijection from set A to set B : map a dozen doughnuts
consisting of:

1

1

1

1

1

1

1

1

c chocolate, l lemon-ﬁlled, s sugar, g glazed, and p plain
to the sequence:
„ ƒ‚ …
„ ƒ‚ …
„ ƒ‚ …
„ ƒ‚ …
„ ƒ‚ …
0 : : : 0
0 : : : 0
0 : : : 0
0 : : : 0
0 : : : 0
p
s
c
g
l
The resulting sequence always has 16 bits and exactly 4 ones, and thus is an
element of B . Moreover, the mapping is a bijection; every such bit sequence is
mapped to by exactly one order of a dozen doughnuts. Therefore, jAj D jB j by the
Bijection Rule!
This example demonstrates the magnifying power of the bijection rule. We man-
aged to prove that two very different sets are actually the same size—even though
we don’t know exactly how big either one is. But as soon as we ﬁgure out the size
of one set, we’ll immediately know the size of the other.
This particular bijection might seem frighteningly ingenious if you’ve not seen
it before. But you’ll use essentially this same argument over and over, and soon
you’ll consider it routine.

11.2 Counting Sequences

The Bijection Rule lets us count one thing by counting another. This suggests a
general strategy: get really good at counting just a few things and then use bijections
to count everything else. This is the strategy we’ll follow. In particular, we’ll get
really good at counting sequences. When we want to determine the size of some
other set T , we’ll ﬁnd a bijection from T to a set of sequences S . Then we’ll
use our super-ninja sequence-counting skills to determine jS j, which immediately
gives us jT j. We’ll need to hone this idea somewhat as we go along, but that’s
pretty much the plan!

2“mcs-ftl” — 2010/9/8 — 0:40 — page 315 — #321

11.2. Counting Sequences

11.2.1 The Product Rule
The Product Rule gives the size of a product of sets. Recall that if P1 ; P2 ; : : : ; Pn
are sets, then
P1 (cid:2) P2 (cid:2) : : : (cid:2) Pn
is the set of all sequences whose ﬁrst term is drawn from P1 , second term is drawn
from P2 and so forth.
Rule 11.2.1 (Product Rule). If P1 ; P2 ; : : : Pn are sets, then:
jP1 (cid:2) P2 (cid:2) : : : (cid:2) Pn j D jP1 j (cid:1) jP2 j (cid:1) (cid:1) (cid:1) jPn j
For example, suppose a daily diet consists of a breakfast selected from set B , a
lunch from set L, and a dinner from set D where:
B D fpancakes; bacon and eggs; bagel; Doritosg
L D fburger and fries; garden salad; Doritosg
D D fmacaroni; pizza; frozen burrito; pasta; Doritosg
Then B (cid:2)L(cid:2)D is the set of all possible daily diets. Here are some sample elements:

.pancakes; burger and fries; pizza/
.bacon and eggs; garden salad; pasta/
.Doritos; Doritos; frozen burrito/

The Product Rule tells us how many different daily diets are possible:
jB (cid:2) L (cid:2) D j D jB j (cid:1) jLj (cid:1) jD j
D 4 (cid:1) 3 (cid:1) 5
D 60:
11.2.2 Subsets of an n-element Set
How many different subsets of an n-element set X are there? For example, the set
X D fx1 ; x2 ; x3 g has eight different subsets:
fx1 ; x2 g
fx2 g
fx1 g
;
fx1 ; x2 ; x3 g:
fx3 g
fx1 ; x3 g
fx2 ; x3 g
There is a natural bijection from subsets of X to n-bit sequences. Let x1 ; x2 ; : : : ; xn
be the elements of X . Then a particular subset of X maps to the sequence .b1 ; : : : ; bn /

3“mcs-ftl” — 2010/9/8 — 0:40 — page 316 — #322

Chapter 11 Cardinality Rules
where bi D 1 if and only if xi is in that subset. For example, if n D 10, then the
subset fx2 ; x3 ; x5 ; x7 ; x10 g maps to a 10-bit sequence as follows:
g
f
subset:
x10
x7 ;
x5 ;
x2 ; x3 ;
sequence:
. 0;
1;
1; 0;
1; 0;
1; 0; 0;
1 /
We just used a bijection to transform the original problem into a question about
sequences—exactly according to plan! Now if we answer the sequence question,
then we’ve solved our original problem as well.
But how many different n-bit sequences are there? For example, there are 8
different 3-bit sequences:

.0; 0; 0/
.0; 0; 1/
.0; 1; 0/
.0; 1; 1/
.1; 0; 0/
.1; 0; 1/
.1; 1; 0/
.1; 1; 1/
Well, we can write the set of all n-bit sequences as a product of sets:
„
ƒ‚
…
f0; 1g (cid:2) f0; 1g (cid:2) : : : (cid:2) f0; 1g
D f0; 1gn
n terms
Then Product Rule gives the answer:
jf0; 1gn j D jf0; 1gjn
D 2n
This means that the number of subsets of an n-element set X is also 2n . We’ll
put this answer to use shortly.

11.2.3 The Sum Rule
Linus allocates his big sister Lucy a quota of 20 crabby days, 40 irritable days,
and 60 generally surly days. On how many days can Lucy be out-of-sorts one way
or another? Let set C be her crabby days, I be her irritable days, and S be the
generally surly. In these terms, the answer to the question is jC [ I [ S j. Now
assuming that she is permitted at most one bad quality each day, the size of this
union of sets is given by the Sum Rule:
Rule 11.2.2 (Sum Rule). If A1 ; A2 ; : : : ; An are disjoint sets, then:
jA1 [ A2 [ : : : [ An j D jA1 j C jA2 j C : : : C jAn j
Thus, according to Linus’ budget, Lucy can be out-of-sorts for:
jC [ I [ S j D jC j C jI j C jS j
D 20 C 40 C 60
D 120 days

4“mcs-ftl” — 2010/9/8 — 0:40 — page 317 — #323

11.3. The Generalized Product Rule

Notice that the Sum Rule holds only for a union of disjoint sets. Finding the size
of a union of intersecting sets is a more complicated problem that we’ll take up
later.

11.2.4 Counting Passwords
Few counting problems can be solved with a single rule. More often, a solution
is a ﬂurry of sums, products, bijections, and other methods. For example, the sum
and product rules together are useful for solving problems involving passwords,
telephone numbers, and license plates. For example, on a certain computer system,
a valid password is a sequence of between six and eight symbols. The ﬁrst symbol
must be a letter (which can be lowercase or uppercase), and the remaining symbols
must be either letters or digits. How many different passwords are possible?
Let’s deﬁne two sets, corresponding to valid symbols in the ﬁrst and subsequent
positions in the password.
F D fa; b; : : : ; z ; A; B ; : : : ; Z g
S D fa; b; : : : ; z ; A; B ; : : : ; Z ; 0; 1; : : : ; 9g
In these terms, the set of all possible passwords is:1
.F (cid:2) S 5 / [ .F (cid:2) S 6 / [ .F (cid:2) S 7 /
Thus, the length-six passwords are in the set F (cid:2) S 5 , the length-seven passwords
are in F (cid:2) S 6 , and the length-eight passwords are in F (cid:2) S 7 . Since these sets
are disjoint, we can apply the Sum Rule and count the total number of possible
passwords as follows:
j.F (cid:2) S 5 / [ .F (cid:2) S 6 / [ .F (cid:2) S 7 /j
D jF (cid:2) S 5 j C jF (cid:2) S 6 j C jF (cid:2) S 7 j
D jF j (cid:1) jS j5 C jF j (cid:1) jS j6 C jF j (cid:1) jS j7
D 52 (cid:1) 625 C 52 (cid:1) 626 C 52 (cid:1) 627
(cid:25) 1:8 (cid:1) 1014 different passwords:

Sum Rule
Product Rule

11.3 The Generalized Product Rule

We realize everyone has been working pretty hard this term, and we’re considering
awarding some prizes for truly exceptional coursework. Here are some possible
1The notation S 5 means S (cid:2) S (cid:2) S (cid:2) S (cid:2) S .

5“mcs-ftl” — 2010/9/8 — 0:40 — page 318 — #324

Chapter 11 Cardinality Rules

categories:

Best Administrative Critique We asserted that the quiz was closed-book. On the
cover page, one strong candidate for this award wrote, “There is no book.”

Awkward Question Award “Okay, the left sock, right sock, and pants are in an
antichain, but how—even with assistance—could I put on all three at once?”

Best Collaboration Statement Inspired by a student who wrote “I worked alone”
on Quiz 1.

In how many ways can, say, three different prizes be awarded to n people? This
is easy to answer using our strategy of translating the problem about awards into
a problem about sequences. Let P be the set of n people taking the course. Then
there is a bijection from ways of awarding the three prizes to the set P 3 WWD P (cid:2)
P (cid:2) P . In particular, the assignment:
“person x wins prize #1, y wins prize #2, and z wins prize #3”
maps to the sequence .x ; y ; z /. By the Product Rule, we have jP 3 j D jP j3 D n3 ,
so there are n3 ways to award the prizes to a class of n people.
But what if the three prizes must be awarded to different students? As before, we
could map the assignment

“person x wins prize #1, y wins prize #2, and z wins prize #3”
to the triple .x ; y ; z / 2 P 3 . But this function is no longer a bijection. For example,
no valid assignment maps to the triple (Dave, Dave, Becky) because Dave is not
allowed to receive two awards. However, there is a bijection from prize assignments
to the set:

S D f.x ; y ; z / 2 P 3 j x , y , and z are different peopleg
This reduces the original problem to a problem of counting sequences. Unfortu-
nately, the Product Rule is of no help in counting sequences of this type because
the entries depend on one another; in particular, they must all be different. How-
ever, a slightly sharper tool does the trick.

Rule 11.3.1 (Generalized Product Rule). Let S be a set of length-k sequences. If
there are:
(cid:15) n1 possible ﬁrst entries,
(cid:15) n2 possible second entries for each ﬁrst entry,

6“mcs-ftl” — 2010/9/8 — 0:40 — page 319 — #325

11.3. The Generalized Product Rule
(cid:15) n3 possible third entries for each combination of ﬁrst and second entries, etc.
then:

jS j D n1 (cid:1) n2 (cid:1) n3 (cid:1) (cid:1) (cid:1) nk
In the awards example, S consists of sequences .x ; y ; z /. There are n ways to
choose x , the recipient of prize #1. For each of these, there are n (cid:0) 1 ways to choose
y , the recipient of prize #2, since everyone except for person x is eligible. For each
combination of x and y , there are n (cid:0) 2 ways to choose z , the recipient of prize #3,
because everyone except for x and y is eligible. Thus, according to the Generalized
Product Rule, there are
jS j D n (cid:1) .n (cid:0) 1/ (cid:1) .n (cid:0) 2/
ways to award the 3 prizes to different people.

11.3.1 Defective Dollar Bills
A dollar bill is defective if some digit appears more than once in the 8-digit serial
number. If you check your wallet, you’ll be sad to discover that defective bills
are all-too-common. In fact, how common are nondefective bills? Assuming that
the digit portions of serial numbers all occur equally often, we could answer this
question by computing
fraction of nondefective bills D jfserial #’s with all digits differentgj
jfserial numbersgj
Let’s ﬁrst consider the denominator. Here there are no restrictions; there are are 10
possible ﬁrst digits, 10 possible second digits, 10 third digits, and so on. Thus, the
total number of 8-digit serial numbers is 108 by the Product Rule.
Next, let’s turn to the numerator. Now we’re not permitted to use any digit twice.
So there are still 10 possible ﬁrst digits, but only 9 possible second digits, 8 possible
third digits, and so forth. Thus, by the Generalized Product Rule, there are
D 1;814;400
10 (cid:1) 9 (cid:1) 8 (cid:1) 7 (cid:1) 6 (cid:1) 5 (cid:1) 4 (cid:1) 3 D 10Š
2
serial numbers with all digits different. Plugging these results into Equation 11.1,
we ﬁnd:

(11.1)

:

fraction of nondefective bills D 1;814;400
100;000;000

D 1:8144%

7“mcs-ftl” — 2010/9/8 — 0:40 — page 320 — #326

Chapter 11 Cardinality Rules

8 0Z0Z0Z0Z
7 Z0Z0m0Z0
6 0Z0Z0Z0Z
5 Z0Z0Z0Z0
4 0a0Z0Z0Z
3 Z0Z0Z0Z0
2 0Z0Z0o0Z
1 Z0Z0Z0Z0
a
b
c
d
e
f
g
h

8 0Z0Z0Z0Z
7 Z0Z0Z0Z0
6 0Z0ZpZ0Z
5 Z0Z0Z0Z0
4 0Z0Z0Z0Z
3 Z0a0ZnZ0
2 0Z0Z0Z0Z
1 Z0Z0Z0Z0
a
b
c
d
e
f
g
h

(a) valid

(b) invalid

Figure 11.1 Two ways of placing a pawn (p), a knight (N), and a bishop (B) on
a chessboard. The conﬁguration shown in (b) is invalid because the bishop and the
knight are in the same row.

11.3.2 A Chess Problem
In how many different ways can we place a pawn (P ), a knight (N ), and a bishop
(B ) on a chessboard so that no two pieces share a row or a column? A valid con-
ﬁguration is shown in Figure 11.1(a), and an invalid conﬁguration is shown in Fig-
ure 11.1(b).
First, we map this problem about chess pieces to a question about sequences.
There is a bijection from conﬁgurations to sequences

.rP ; cP ; rN ; cN ; rB ; cB /

where rP , rN , and rB are distinct rows and cP , cN , and cB are distinct columns.
In particular, rP is the pawn’s row, cP is the pawn’s column, rN is the knight’s
row, etc. Now we can count the number of such sequences using the Generalized
Product Rule:
(cid:15) rP is one of 8 rows
(cid:15) cP is one of 8 columns
(cid:15) rN is one of 7 rows (any one but rP )
(cid:15) cN is one of 7 columns (any one but cP )
(cid:15) rB is one of 6 rows (any one but rP or rN )
(cid:15) cB is one of 6 columns (any one but cP or cN )
Thus, the total number of conﬁgurations is .8 (cid:1) 7 (cid:1) 6/2 .

8“mcs-ftl” — 2010/9/8 — 0:40 — page 321 — #327

11.4. The Division Rule

11.3.3 Permutations
A permutation of a set S is a sequence that contains every element of S exactly
once. For example, here are all the permutations of the set fa; b; c g:

.a; b; c /
.b; c ; a/

.a; c ; b /
.c ; a; b /

.b; a; c /
.c ; b; a/

How many permutations of an n-element set are there? Well, there are n choices
for the ﬁrst element. For each of these, there are n (cid:0) 1 remaining choices for the
second element. For every combination of the ﬁrst two elements, there are n (cid:0) 2
ways to choose the third element, and so forth. Thus, there are a total of
n (cid:1) .n (cid:0) 1/ (cid:1) .n (cid:0) 2/ (cid:1) (cid:1) (cid:1) 3 (cid:1) 2 (cid:1) 1 D nŠ
permutations of an n-element set. In particular, this formula says that there are
3Š D 6 permutations of the 3-element set fa; b; c g, which is the number we found
above.
Permutations will come up again in this course approximately 1.6 bazillion times.
In fact, permutations are the reason why factorial comes up so often and why we
n
(cid:16) n
taught you Stirling’s approximation:
nŠ (cid:24) p
e

2(cid:25) n

:

11.4 The Division Rule

Counting ears and dividing by two is a silly way to count the number of people in
a room, but this approach is representative of a powerful counting principle.
A k -to-1 function maps exactly k elements of the domain to every element of
the codomain. For example, the function mapping each ear to its owner is 2-to-1.
Similarly, the function mapping each ﬁnger to its owner is 10-to-1, and the function
mapping each ﬁnger and toe to its owner is 20-to-1. The general rule is:
Rule 11.4.1 (Division Rule). If f W A ! B is k -to-1, then jAj D k (cid:1) jB j.
For example, suppose A is the set of ears in the room and B is the set of people.
There is a 2-to-1 mapping from ears to people, so by the Division Rule, jAj D
2 (cid:1) jB j. Equivalently, jB j D jAj=2, expressing what we knew all along: the number
of people is half the number of ears. Unlikely as it may seem, many counting
problems are made much easier by initially counting every item multiple times and
then correcting the answer using the Division Rule. Let’s look at some examples.

9“mcs-ftl” — 2010/9/8 — 0:40 — page 322 — #328

Chapter 11 Cardinality Rules

8 0Z0Z0Z0s
7 Z0Z0Z0Z0
6 0Z0Z0Z0Z
5 Z0Z0Z0Z0
4 0Z0Z0Z0Z
3 Z0Z0Z0Z0
2 0Z0Z0Z0Z
1 s0Z0Z0Z0
a
b
c
d
e
f
g
h

8 0Z0Z0Z0Z
7 Z0Z0Z0Z0
6 0Z0s0Z0Z
5 Z0Z0Z0Z0
4 0Z0Z0Z0Z
3 Z0Z0Z0Z0
2 0Z0Z0Z0Z
1 Z0ZrZ0Z0
a
b
c
d
e
f
g
h

(a) valid

(b) invalid

Figure 11.2 Two ways to place 2 rooks (R) on a chessboard. The conﬁguration
in (b) is invalid because the rooks are in the same column.

11.4.1 Another Chess Problem
In how many different ways can you place two identical rooks on a chessboard
so that they do not share a row or column? A valid conﬁguration is shown in
Figure 11.2(a), and an invalid conﬁguration is shown in Figure 11.2(b).
Let A be the set of all sequences

.r1 ; c1 ; r2 ; c2 /

where r1 and r2 are distinct rows and c1 and c2 are distinct columns. Let B be the
set of all valid rook conﬁgurations. There is a natural function f from set A to set
B ; in particular, f maps the sequence .r1 ; c1 ; r2 ; c2 / to a conﬁguration with one
rook in row r1 , column c1 and the other rook in row r2 , column c2 .
But now there’s a snag. Consider the sequences:

.1; 1; 8; 8/

and

.8; 8; 1; 1/

The ﬁrst sequence maps to a conﬁguration with a rook in the lower-left corner and
a rook in the upper-right corner. The second sequence maps to a conﬁguration with
a rook in the upper-right corner and a rook in the lower-left corner. The problem is
that those are two different ways of describing the same conﬁguration! In fact, this
arrangement is shown in Figure 11.2(a).
More generally, the function f maps exactly two sequences to every board con-
ﬁguration; that is f is a 2-to-1 function. Thus, by the quotient rule, jAj D 2 (cid:1) jB j.

10“mcs-ftl” — 2010/9/8 — 0:40 — page 323 — #329

11.4. The Division Rule

Rearranging terms gives:

D .8 (cid:1) 7/2
jB j D jAj
2
2
On the second line, we’ve computed the size of A using the General Product Rule
just as in the earlier chess problem.

:

11.4.2 Knights of the Round Table
In how many ways can King Arthur seat n different knights at his round table? Two
seatings are considered equivalent if one can be obtained from the other by rotation.
For example, the following two arrangements are equivalent:
# k1
# k3
"!
"!
k2
k4
k3
k1

k4

k2

Let A be all the permutations of the knights, and let B be the set of all possible
seating arrangements at the round table. We can map each permutation in set A to a
circular seating arrangement in set B by seating the ﬁrst knight in the permutation
anywhere, putting the second knight to his left, the third knight to the left of the
second, and so forth all the way around the table. For example:
# k2
(cid:0)! "!
k4
k3
k1

.k2 ; k4 ; k1 ; k3 /

This mapping is actually an n-to-1 function from A to B , since all n cyclic shifts of
the original sequence map to the same seating arrangement. In the example, n D 4
different sequences map to the same seating arrangement:
# k2
(cid:0)! "!
k3
k4
k1

.k2 ; k4 ; k1 ; k3 /
.k4 ; k1 ; k3 ; k2 /
.k1 ; k3 ; k2 ; k4 /
.k3 ; k2 ; k4 ; k1 /

11“mcs-ftl” — 2010/9/8 — 0:40 — page 324 — #330

Chapter 11 Cardinality Rules

Therefore, by the division rule, the number of circular seating arrangements is:
jB j D jAj
D .n (cid:0) 1/Š
D nŠ
n
n
Note that jAj D nŠ since there are nŠ permutations of n knights.

11.5 Counting Subsets

How many k -element subsets of an n-element set are there? This question arises
all the time in various guises:
(cid:15) In how many ways can I select 5 books from my collection of 100 to bring
on vacation?
(cid:15) How many different 13-card Bridge hands can be dealt from a 52-card deck?
(cid:15) In how many ways can I select 5 toppings for my pizza if there are 14 avail-
able toppings?
 
!
This number comes up so often that there is a special notation for it:
WWD the number of k -element subsets of an n-element set.
 
!

n

k

different 5-topping pizzas, if 14 toppings are available.

is read “n choose k .” Now we can immediately express the
!
 
100

ways.

5

different Bridge hands.

The expression

n

k
answers to all three questions above:
(cid:15) I can select 5 books from 100 in
 
!
52
 
!
13

(cid:15) There are

(cid:15) There are

14

5

12“mcs-ftl” — 2010/9/8 — 0:40 — page 325 — #331

11.5. Counting Subsets

11.5.1 The Subset Rule
We can derive a simple formula for the n-choose-k number using the Division Rule.
We do this by mapping any permutation of an n-element set fa1 ; : : : ; an g into a k -
element subset simply by taking the ﬁrst k elements of the permutation. That is,
the permutation a1a2 : : : an will map to the set fa1 ; a2 ; : : : ; ak g.
Notice that any other permutation with the same ﬁrst k elements a1 ; : : : ; ak in
any order and the same remaining elements n (cid:0) k elements in any order will also
map to this set. What’s more, a permutation can only map to fa1 ; a2 ; : : : ; ak g
if its ﬁrst k elements are the elements a1 ; : : : ; ak in some order. Since there are
k Š possible permutations of the ﬁrst k elements and .n (cid:0) k /Š permutations of the
remaining elements, we conclude from the Product Rule that exactly k Š.n (cid:0) k /Š
permutations of the n-element set map to the the particular subset, S .
In other
words, the mapping from permutations to k -element subsets is k Š.n (cid:0) k /Š-to-1.
!
 
But we know there are nŠ permutations of an n-element set, so by the Division
Rule, we conclude that

nŠ D k Š.n (cid:0) k /Š

n

k

which proves:

 
!
Rule 11.5.1 (Subset Rule). The number of k -element subsets of an n-element set is

nŠ
k Š .n (cid:0) k /Š
k
Notice that this works even for 0-element subsets: nŠ=0ŠnŠ D 1. Here we use the
fact that 0Š is a product of 0 terms, which by convention2 equals 1.

D

n

:

11.5.2 Bit Sequences
How many n-bit sequences contain exactly k ones? We’ve already seen the straight-
forward bijection between subsets of an n-element set and n-bit sequences. For
example, here is a 3-element subset of fx1 ; x2 ; : : : ; x8 g and the associated 8-bit
sequence:
f x1 ;
g
x4 ; x5
.
0; 0; 0 /
1;
0; 0;
1;
1;
Notice that this sequence has exactly 3 ones, each corresponding to an element
of the 3-element subset. More generally, the n-bit sequences corresponding to a
k -element subset will have exactly k ones. So by the Bijection Rule,

2We don’t use it here, but a sum of zero terms equals 0.

13“mcs-ftl” — 2010/9/8 — 0:40 — page 326 — #332

Chapter 11 Cardinality Rules

The number of n-bit sequences with exactly k ones is

 

!

.

n

k

11.6 Sequences with Repetitions

11.6.1 Sequences of Subsets
Choosing a k -element subset of an n-element set is the same as splitting the set
into a pair of subsets: the ﬁrst subset of size k and the second subset consisting of
the remaining n (cid:0) k elements. So the Subset Rule can be understood as a rule for
counting the number of such splits into pairs of subsets.
We can generalize this to splits into more than two subsets. Namely, let A be
an n-element set and k1 ; k2 ; : : : ; km be nonnegative integers whose sum is n. A
.k1 ; k2 ; : : : ; km /-split of A is a sequence

.A1 ; A2 ; : : : ; Am /
where the Ai are disjoint subsets of A and jAi j D ki for i D 1; : : : ; m.
 
!
Rule 11.6.1 (Subset Split Rule). The number of .k1 ; k2 ; : : : ; km /-splits of an n-
element set is

WWD

n
k1 ; : : : ; km

nŠ
k1 Š k2 Š (cid:1) (cid:1) (cid:1) km Š
The proof of this Rule is essentially the same as for the Subset Rule. Namely, we
map any permutation a1a2 : : : an of an n-element set A into a .k1 ; k2 ; : : : ; km /-split
by letting the 1st subset in the split be the ﬁrst k1 elements of the permutation, the
2nd subset of the split be the next k2 elements, . . . , and the mth subset of the split be
the ﬁnal km elements of the permutation. This map is a k1 Š k2 Š (cid:1) (cid:1) (cid:1) km Š-to-1 func-
tion from the nŠ permutations to the .k1 ; k2 ; : : : ; km /-splits of A, and the Subset
Split Rule now follows from the Division Rule.

11.6.2 The Bookkeeper Rule
We can also generalize our count of n-bit sequences with k ones to counting se-
quences of n letters over an alphabet with more than two letters. For example,
how many sequences can be formed by permuting the letters in the 10-letter word
BOOKKEEPER?
Notice that there are 1 B, 2 O’s, 2 K’s, 3 E’s, 1 P, and 1 R in BOOKKEEPER. This
leads to a straightforward bijection between permutations of BOOKKEEPER and

14“mcs-ftl” — 2010/9/8 — 0:40 — page 327 — #333

11.6. Sequences with Repetitions
(1,2,2,3,1,1)-splits of f1; 2 ; : : : ; 10g. Namely, map a permutation to the sequence
of sets of positions where each of the different letters occur.
For example, in the permutation BOOKKEEPER itself, the B is in the 1st posi-
tion, the O’s occur in the 2nd and 3rd positions, K’s in 4th and 5th, the E’s in the
6th, 7th and 9th, P in the 8th, and R is in the 10th position. So BOOKKEEPER
maps to
.f1g; f2 ; 3g; f4 ; 5g; f6; 7; 9g; f8g; f10g/:
From this bijection and the Subset Split Rule, we conclude that the number of ways
‚…„ƒ
to rearrange the letters in the word BOOKKEEPER is:
total letters
1Š„ƒ‚…
1Š„ƒ‚…
3Š„ƒ‚…
2Š„ƒ‚…
2Š„ƒ‚…
1Š„ƒ‚…
10Š
R’s
P’s
O’s
B’s
K’s
E’s
This example generalizes directly to an exceptionally useful counting principle
which we will call the
Rule 11.6.2 (Bookkeeper Rule). Let l1 ; : : : ; lm be distinct elements. The number
of sequences with k1 occurrences of l1 , and k2 occurrences of l2 , . . . , and km
occurrences of lm is
.k1 C k2 C : : : C km /Š
k1 Š k2 Š : : : km Š
For example, suppose you are planning a 20-mile walk, which should include 5
northward miles, 5 eastward miles, 5 southward miles, and 5 westward miles. How
many different walks are possible?
There is a bijection between such walks and sequences with 5 N’s, 5 E’s, 5 S’s,
and 5 W’s. By the Bookkeeper Rule, the number of such sequences is:

20Š
5Š4 :

11.6.3 The Binomial Theorem
Counting gives insight into one of the basic theorems of algebra. A binomial is a
sum of two terms, such as a C b . Now consider its 4th power, .a C b /4 .
If we multiply out this 4th power expression completely, we get
.a C b /4 D
aaaa C aaab C aaba C aabb
C abaa C abab C abba C abbb
C baaa C baab C baba C babb
C bbaa C bbab C bbba C bbbb

15“mcs-ftl” — 2010/9/8 — 0:40 — page 328 — #334

Chapter 11 Cardinality Rules

 
!
Notice that there is one term for every sequence of a’s and b ’s. So there are 24
terms, and the number of terms with k copies of b and n (cid:0) k copies of a is:
D
n
nŠ
by the Bookkeeper Rule. Hence, the coefﬁcient of an(cid:0)k b k is (cid:0)n
(cid:1). So for n D 4,
k Š .n (cid:0) k /Š
k
 
!
 
 
 
!
!
!
 
!
k
this means:
.a C b /4 D
(cid:1) a3b 1 C
(cid:1) a4b 0 C
(cid:1) a1b 3 C
(cid:1) a2b 2 C
(cid:1) a0b 4
4
4
4
4
4
1
2
3
In general, this reasoning gives the Binomial Theorem:
 
!
Theorem 11.6.3 (Binomial Theorem). For all n 2 N and a; b 2 R:
.a C b /n D nX
an(cid:0)k b k
!
 
kD0

n

k

0

4

The expression

is often called a “binomial coefﬁcient” in honor of its ap-

n

k

pearance here.
This reasoning about binomials extends nicely to multinomials, which are sums
of two or more terms. For example, suppose we wanted the coefﬁcient of

bo2k 2 e3p r
in the expansion of .b C o C k C e C p C r /10 . Each term in this expansion is a
product of 10 variables where each variable is one of b , o, k , e , p , or r . Now, the
coefﬁcient of bo2k 2 e3p r is the number of those terms with exactly 1 b , 2 o’s, 2
 
!
k ’s, 3 e ’s, 1 p , and 1 r . And the number of such terms is precisely the number of
rearrangements of the word BOOKKEEPER:
D

10Š

10

:

1; 2 ; 2 ; 3; 1; 1

1Š 2Š 2Š 3Š 1Š 1Š

The expression on the left is called a “multinomial coefﬁcient.” This reasoning
extends to a general theorem.
Deﬁnition 11.6.4. For n; k1 ; : : : ; km 2 N, such that k1 C k2 C (cid:1) (cid:1) (cid:1) C km D n, deﬁne
the multinomial coefﬁcient 
!
n
k1 ; k2 ; : : : ; km

nŠ
k1 Š k2 Š : : : km Š

WWD

:

16“mcs-ftl” — 2010/9/8 — 0:40 — page 329 — #335

11.7. Counting Practice: Poker Hands
 
Theorem 11.6.5 (Multinomial Theorem). For all n 2 N,
.z1 C z2 C (cid:1) (cid:1) (cid:1) C zm /n D X
k1 ;:::;km2N
k1C(cid:1)(cid:1)(cid:1)CkmDn
You’ll be better off remembering the reasoning behind the Multinomial Theorem
rather than this ugly formal statement.

n
k1 ; k2 ; : : : ; km

!

1 z k2
z k1
2

(cid:1) (cid:1) (cid:1) z km
m :

11.6.4 A Word about Words
Someday you might refer to the Subset Split Rule or the Bookkeeper Rule in front
of a roomful of colleagues and discover that they’re all staring back at you blankly.
This is not because they’re dumb, but rather because we made up the name “Book-
keeper Rule”. However, the rule is excellent and the name is apt, so we suggest
that you play through: “You know? The Bookkeeper Rule? Don’t you guys know
anything???”
The Bookkeeper Rule is sometimes called the “formula for permutations with
indistinguishable objects.” The size k subsets of an n-element set are sometimes
called k -combinations. Other similar-sounding descriptions are “combinations with
repetition, permutations with repetition, r -permutations, permutations with indis-
tinguishable objects,” and so on. However, the counting rules we’ve taught you are
sufﬁcient to solve all these sorts of problems without knowing this jargon, so we
won’t burden you with it.

11.7 Counting Practice: Poker Hands

Five-Card Draw is a card game in which each player is initially dealt a hand con-
sisting of 5 cards from a deck of 52 cards.3 (Then the game gets complicated, but
let’s not worry about that.) The number of different hands in Five-Card Draw is the

3There are 52 cards in a standard deck. Each card has a suit and a rank. There are four suits:
(cid:127) (spades)
~ (hearts)
| (clubs)
} (diamonds)
And there are 13 ranks, listed here from lowest to highest:

Queen
Jack
Ace
Q ;
J ;
A ; 2 ; 3 ; 4 ; 5 ; 6 ; 7 ; 8 ; 9 ;
Thus, for example, 8~ is the 8 of hearts and A(cid:127) is the ace of spades.

King
K :

17“mcs-ftl” — 2010/9/8 — 0:40 — page 330 — #336

Chapter 11 Cardinality Rules

 
!
number of 5-element subsets of a 52-element set, which is
D 2 ; 598; 960:

52

5

Let’s get some counting practice by working out the number of hands with various
special properties.

11.7.1 Hands with a Four-of-a-Kind
A Four-of-a-Kind is a set of four cards with the same rank. How many different
hands contain a Four-of-a-Kind? Here are a couple examples:
f8(cid:127); 8}; Q~; 8~; 8|g
fA|; 2|; 2~; 2}; 2(cid:127)g

As usual, the ﬁrst step is to map this question to a sequence-counting problem. A
hand with a Four-of-a-Kind is completely described by a sequence specifying:

1. The rank of the four cards.

2. The rank of the extra card.

3. The suit of the extra card.

Thus, there is a bijection between hands with a Four-of-a-Kind and sequences con-
sisting of two distinct ranks followed by a suit. For example, the three hands above
are associated with the following sequences:
.8; Q; ~/ $ f 8(cid:127); 8}; 8~; 8|; Q~g
.2 ; A; |/ $ f2|; 2~; 2}; 2(cid:127); A|g

Now we need only count the sequences. There are 13 ways to choose the ﬁrst rank,
12 ways to choose the second rank, and 4 ways to choose the suit. Thus, by the
Generalized Product Rule, there are 13 (cid:1) 12 (cid:1) 4 D 624 hands with a Four-of-a-Kind.
This means that only 1 hand in about 4165 has a Four-of-a-Kind. Not surprisingly,
Four-of-a-Kind is considered to be a very good poker hand!

18“mcs-ftl” — 2010/9/8 — 0:40 — page 331 — #337

11.7. Counting Practice: Poker Hands

11.7.2 Hands with a Full House
A Full House is a hand with three cards of one rank and two cards of another rank.
Here are some examples:

f2(cid:127); 2|; 2}; J |; J }g
f5}; 5|; 5~; 7~; 7|g

Again, we shift to a problem about sequences. There is a bijection between Full
Houses and sequences specifying:
2. The suits of the triple, which can be selected in (cid:0)4
(cid:1) ways.
1. The rank of the triple, which can be chosen in 13 ways.
3
(cid:1) ways.
4. The suits of the pair, which can be selected in (cid:0)4
3. The rank of the pair, which can be chosen in 12 ways.
2
The example hands correspond to sequences as shown below:
.2 ; f(cid:127); |; }g; J ; f|; }g/ $ f2(cid:127); 2|; 2}; J |; J }g
.5; f}; |; ~g; 7; f~; |g/ $ f5}; 5|; 5~; 7~; 7|g
!
 
!
 
By the Generalized Product Rule, the number of Full Houses is:
4
2

(cid:1) 12 (cid:1)

13 (cid:1)

4

3

:

We’re on a roll—but we’re about to hit a speed bump.

11.7.3 Hands with Two Pairs
How many hands have Two Pairs; that is, two cards of one rank, two cards of
another rank, and one card of a third rank? Here are examples:
f3}; 3(cid:127); Q}; Q~; A|g
f9~; 9}; 5~; 5|; K(cid:127)g
Each hand with Two Pairs is described by a sequence consisting of:
2. The suits of the ﬁrst pair, which can be selected (cid:0)4
(cid:1) ways.
1. The rank of the ﬁrst pair, which can be chosen in 13 ways.
2

19“mcs-ftl” — 2010/9/8 — 0:40 — page 332 — #338

Chapter 11 Cardinality Rules
4. The suits of the second pair, which can be selected in (cid:0)4
(cid:1) ways.
3. The rank of the second pair, which can be chosen in 12 ways.
2
6. The suit of the extra card, which can be selected in (cid:0)4
(cid:1) D 4 ways.
5. The rank of the extra card, which can be chosen in 11 ways.
1
 
!
 
!
Thus, it might appear that the number of hands with Two Pairs is:
4
2

(cid:1) 11 (cid:1) 4 :

(cid:1) 12 (cid:1)

13 (cid:1)

4

2

f9~; 9}; 5~; 5|; K(cid:127)g

f3}; 3(cid:127); Q}; Q~; A|g

Wrong answer! The problem is that there is not a bijection from such sequences to
hands with Two Pairs. This is actually a 2-to-1 mapping. For example, here are the
pairs of sequences that map to the hands given above:
.3; f}; (cid:127)g; Q; f}; ~g; A; |/ &
.Q; f}; ~g; 3; f}; (cid:127)g; A; |/ %
.9; f~; }g; 5; f~; |g; K; (cid:127)/ &
.5; f~; |g; 9; f~; }g; K; (cid:127)/ %
The problem is that nothing distinguishes the ﬁrst pair from the second. A pair of
5’s and a pair of 9’s is the same as a pair of 9’s and a pair of 5’s. We avoided this
difﬁculty in counting Full Houses because, for example, a pair of 6’s and a triple of
kings is different from a pair of kings and a triple of 6’s.
We ran into precisely this difﬁculty last time, when we went from counting ar-
rangements of different pieces on a chessboard to counting arrangements of two
identical rooks. The solution then was to apply the Division Rule, and we can do
the same here. In this case, the Division rule says there are twice as many sequences
(cid:1) (cid:1) 12 (cid:1) (cid:0)4
13 (cid:1) (cid:0)4
(cid:1) (cid:1) 11 (cid:1) 4
as hands, so the number of hands with Two Pairs is actually:
2
2
2

:

Another Approach
The preceding example was disturbing! One could easily overlook the fact that the
mapping was 2-to-1 on an exam, fail the course, and turn to a life of crime. You
can make the world a safer place in two ways:

20“mcs-ftl” — 2010/9/8 — 0:40 — page 333 — #339

11.7. Counting Practice: Poker Hands
1. Whenever you use a mapping f W A ! B to translate one counting problem
to another, check that the same number elements in A are mapped to each
element in B . If k elements of A map to each of element of B , then apply
the Division Rule using the constant k .

2. As an extra check, try solving the same problem in a different way. Multiple
approaches are often available—and all had better give the same answer!
(Sometimes different approaches give answers that look different, but turn
out to be the same after some algebra.)
(cid:1) ways.
1. The ranks of the two pairs, which can be chosen in (cid:0)13
We already used the ﬁrst method; let’s try the second. There is a bijection be-
tween hands with two pairs and sequences that specify:
2. The suits of the lower-rank pair, which can be selected in (cid:0)4
(cid:1) ways.
2
(cid:1) ways.
3. The suits of the higher-rank pair, which can be selected in (cid:0)4
2
5. The suit of the extra card, which can be selected in (cid:0)4
(cid:1) D 4 ways.
2
4. The rank of the extra card, which can be chosen in 11 ways.
1
For example, the following sequences and hands correspond:
.f3; Qg; f}; (cid:127)g; f}; ~g; A; |/ $ f3}; 3(cid:127); Q}; Q~; A|g
.f9; 5g; f~; |g; f~; }g; K; (cid:127)/ $ f9~; 9}; 5~; 5|; K(cid:127)g
!
 
!
 
!
 
Thus, the number of hands with two pairs is:
(cid:1)
(cid:1)
4
2

(cid:1) 11 (cid:1) 4 :

13

2

4

2

This is the same answer we got before, though in a slightly different form.

11.7.4 Hands with Every Suit
How many hands contain at least one card from every suit? Here is an example of
such a hand:
f7}; K|; 3}; A~; 2(cid:127)g
Each such hand is described by a sequence that speciﬁes:

1. The ranks of the diamond, the club, the heart, and the spade, which can be
selected in 13 (cid:1) 13 (cid:1) 13 (cid:1) 13 D 134 ways.

21“mcs-ftl” — 2010/9/8 — 0:40 — page 334 — #340

Chapter 11 Cardinality Rules

2. The suit of the extra card, which can be selected in 4 ways.

3. The rank of the extra card, which can be selected in 12 ways.

For example, the hand above is described by the sequence:
.7; K; A; 2 ; }; 3/ $ f7}; K|; A~; 2(cid:127); 3}g:
Are there other sequences that correspond to the same hand? There is one more!
We could equally well regard either the 3} or the 7} as the extra card, so this
is actually a 2-to-1 mapping. Here are the two sequences corresponding to the
example hand:

f7}; K|; A~; 2(cid:127); 3}g

.7; K; A; 2 ; }; 3/ &
.3; K; A; 2 ; }; 7/ %
Therefore, the number of hands with every suit is:
134 (cid:1) 4 (cid:1) 12
2

:

11.8

Inclusion-Exclusion

is

How big is a union of sets? For example, suppose there are 60 math majors, 200
EECS majors, and 40 physics majors. How many students are there in these three
departments? Let M be the set of math majors, E be the set of EECS majors, and
P be the set of physics majors. In these terms, we’re asking for jM [ E [ P j.
The Sum Rule says that if M , E , and P are disjoint, then the sum of their sizes
jM [ E [ P j D jM j C jE j C jP j:
However, the sets M , E , and P might not be disjoint. For example, there might
be a student majoring in both math and physics. Such a student would be counted
twice on the right side of this equation, once as an element of M and once as an
element of P . Worse, there might be a triple-major4 counted three times on the
right side!
Our most-complicated counting rule determines the size of a union of sets that
are not necessarily disjoint. Before we state the rule, let’s build some intuition by
considering some easier special cases: unions of just two or three sets.

4 . . . though not at MIT anymore.

22“mcs-ftl” — 2010/9/8 — 0:40 — page 335 — #341

11.8. Inclusion-Exclusion

11.8.1 Union of Two Sets
For two sets, S1 and S2 , the Inclusion-Exclusion Rule is that the size of their union
is:
jS1 [ S2 j D jS1 j C jS2 j (cid:0) jS1 \ S2 j
(11.2)
Intuitively, each element of S1 is accounted for in the ﬁrst term, and each element
of S2 is accounted for in the second term. Elements in both S1 and S2 are counted
twice—once in the ﬁrst term and once in the second. This double-counting is cor-
rected by the ﬁnal term.

11.8.2 Union of Three Sets
So how many students are there in the math, EECS, and physics departments? In
other words, what is jM [ E [ P j if:
jM j D 60
jE j D 200
jP j D 40:
The size of a union of three sets is given by a more complicated Inclusion-Exclusion
formula:

jS1 [ S2 [ S3 j D jS1 j C jS2 j C jS3 j
(cid:0) jS1 \ S2 j (cid:0) jS1 \ S3 j (cid:0) jS2 \ S3 j
C jS1 \ S2 \ S3 j:
Remarkably, the expression on the right accounts for each element in the union of
S1 , S2 , and S3 exactly once. For example, suppose that x is an element of all three
sets. Then x is counted three times (by the jS1 j, jS2 j, and jS3 j terms), subtracted
off three times (by the jS1 \ S2 j, jS1 \ S3 j, and jS2 \ S3 j terms), and then counted
once more (by the jS1 \ S2 \ S3 j term). The net effect is that x is counted just
once.
If x is in two sets (say, S1 and S2 ), then x is counted twice (by the jS1 j and jS2 j
terms) and subtracted once (by the jS1 \ S2 j term). In this case, x does not factor
into any of the other terms, since x … S3 .
So we can’t answer the original question without knowing the sizes of the various
intersections. Let’s suppose that there are:

4 math - EECS double majors
3 math - physics double majors
11 EECS - physics double majors
2
triple majors

23“mcs-ftl” — 2010/9/8 — 0:40 — page 336 — #342

Chapter 11 Cardinality Rules
Then jM \ E j D 4C 2, jM \ P j D 3C 2, jE \ P j D 11C 2, and jM \ E \ P j D 2.
Plugging all this into the formula gives:
jM [ E [ P j D jM j C jE j C jP j (cid:0) jM \ E j (cid:0) jM \ P j (cid:0) jE \ P j C jM \ E \ P j
D 60 C 200 C 40 (cid:0) 6 (cid:0) 5 (cid:0) 13 C 2
D 278
11.8.3 Sequences with 42, 04, or 60
In how many permutations of the set f0; 1; 2 ; : : : ; 9g do either 4 and 2, 0 and 4, or
6 and 0 appear consecutively? For example, none of these pairs appears in:

.7; 2 ; 9; 5; 4 ; 1; 3; 8; 0; 6/:

The 06 at the end doesn’t count; we need 60. On the other hand, both 04 and 60
appear consecutively in this permutation:

.7; 2 ; 5; 6; 0; 4; 3; 8; 1; 9/:

Let P42 be the set of all permutations in which 42 appears. Deﬁne P60 and P04
similarly. Thus, for example, the permutation above is contained in both P60 and
P04 , but not P42 . In these terms, we’re looking for the size of the set P42 [ P04 [
P60 .
First, we must determine the sizes of the individual sets, such as P60 . We can
use a trick: group the 6 and 0 together as a single symbol. Then there is a natural
bijection between permutations of f0; 1; 2 ; : : : 9g containing 6 and 0 consecutively
and permutations of:
f60; 1; 2 ; 3; 4 ; 5; 7; 8; 9g:
For example, the following two sequences correspond:
.7; 2 ; 5; 6; 0; 4 ; 3; 8; 1; 9/  ! .7; 2 ; 5; 60; 4 ; 3; 8; 1; 9/:
There are 9Š permutations of the set containing 60, so jP60 j D 9Š by the Bijection
Rule. Similarly, jP04 j D jP42 j D 9Š as well.
Next, we must determine the sizes of the two-way intersections, such as P42 \
P60 . Using the grouping trick again, there is a bijection with permutations of the
set:
f42 ; 60; 1; 3; 5; 7; 8; 9g:
Thus, jP42 \ P60 j D 8Š. Similarly, jP60 \ P04 j D 8Š by a bijection with the set:
f604 ; 1; 2 ; 3; 5; 7; 8; 9g:

24“mcs-ftl” — 2010/9/8 — 0:40 — page 337 — #343

11.8. Inclusion-Exclusion
And jP42 \ P04 j D 8Š as well by a similar argument. Finally, note that jP60 \
P04 \ P42 j D 7Š by a bijection with the set:
f6042 ; 1; 3; 5; 7; 8; 9g:
Plugging all this into the formula gives:
jP42 [ P04 [ P60 j D 9Š C 9Š C 9Š (cid:0) 8Š (cid:0) 8Š (cid:0) 8Š C 7Š:
11.8.4 Union of n Sets
The size of a union of n sets is given by the following rule.

Rule 11.8.1 (Inclusion-Exclusion).
jS1 [ S2 [ (cid:1) (cid:1) (cid:1) [ Sn j D
the sum of the sizes of the individual sets
the sizes of all two-way intersections
the sizes of all three-way intersections
the sizes of all four-way intersections
the sizes of all ﬁve-way intersections, etc.

minus
plus
minus
plus

The formulas for unions of two and three sets are special cases of this general
rule.
This way of expressing Inclusion-Exclusion is easy to understand and nearly
as precise as expressing it in mathematical symbols, but we’ll need the symbolic
version below, so let’s work on deciphering it now.
nX
We already have a standard notation for the sum of sizes of the individual sets,
namely,
jSi j:
i D1
A “two-way intersection” is a set of the form Si \ Sj for i ¤ j . We regard Sj \ Si
as the same two-way intersection as Si \ Sj , so we can assume that i < j . Now
X
we can express the sum of the sizes of the two-way intersections as
jSi \ Sj j:
1i <j n
X
Similarly, the sum of the sizes of the three-way intersections is
jSi \ Sj \ Sk j:
1i <j <kn

25“mcs-ftl” — 2010/9/8 — 0:40 — page 338 — #344

Chapter 11 Cardinality Rules

Si j:

These sums have alternating signs in the Inclusion-Exclusion formula, with the
sum of the k -way intersections getting the sign .(cid:0)1/k(cid:0)1 . This ﬁnally leads to a
symbolic version of the rule:
Si j D nX
j n[
Rule (Inclusion-Exclusion).
jSi j
(cid:0) X
i D1
i D1
jSi \ Sj j
C X
1i <j n
jSi \ Sj \ Sk j C (cid:1) (cid:1) (cid:1)
C .(cid:0)1/n(cid:0)1 j n\
1i <j <kn
i D1
11.8.5 Computing Euler’s Function
As an example, let’s use Inclusion-Exclusion to calculate Euler’s function, (cid:30) .n/.
By deﬁnition, (cid:30) .n/ is the number of nonnegative integers less than a positive inte-
ger n that are relatively prime to n. But the set S of nonnegative integers less than n
that are not relatively prime to n will be easier to count.
(cid:1) (cid:1) (cid:1) p em
Suppose the prime factorization of n is p e1
m for distinct primes pi . This
1
means that the integers in S are precisely the nonnegative integers less than n that
are divisible by at least one of the pi ’s. Letting Ci be the set of nonnegative integers
S D m[
less than n that are divisible by pi , we have
i D1
We’ll be able to ﬁnd the size of this union using Inclusion-Exclusion because
the intersections of the Ci ’s are easy to count. For example, C1 \ C2 \ C3 is the
set of nonnegative integers less than n that are divisible by each of p1 , p2 and p3 .
But since the pi ’s are distinct primes, being divisible by each of these primes is the
same as being divisible by their product. Now observe that if r is a positive divisor
of n, then exactly n= r nonnegative integers less than n are divisible by r , namely,
0; r; 2r; : : : ; ..n= r / (cid:0) 1/r . So exactly n=p1p2p3 nonnegative integers less than n
are divisible by all three primes p1 , p2 , p3 . In other words,
jC1 \ C2 \ C3 j D

Ci :

n
p1p2p3

:

26“mcs-ftl” — 2010/9/8 — 0:40 — page 339 — #345

11.9. Combinatorial Proofs

jCi \ Cj \ Ck j (cid:0) (cid:1) (cid:1) (cid:1) C .(cid:0)1/m(cid:0)1 j m\
Ci j
i D1
(cid:0) (cid:1) (cid:1) (cid:1) C .(cid:0)1/m(cid:0)1
1A
n
p1p2 (cid:1) (cid:1) (cid:1) pn

Reasoning this way about all the intersections among the Ci ’s and applying
jS j D j m[
Inclusion-Exclusion, we get
Ci j
jCi \ Cj j C X
jCi j (cid:0) X
D mX
i D1
C X
(cid:0) X
D mX
i D1
1i <j m
1i <j <km
0@ mX
n
n
n
C X
(cid:0) X
1i <j m
i D1
1i <j <km
pi
pi pj
pi pj pk
D n
1
1
1
i D1
1i <j m
1i <j <km
pi
pi pj
pi pj pk
0@1 (cid:0) mX
But (cid:30) .n/ D n (cid:0) jS j by deﬁnition, so
(cid:0) X
C X
1


mY
i D1
1i <j m
1i <j <km
pi
1 (cid:0) 1
i D1
pi
Yikes! That was pretty hairy. Are you getting tired of all that nasty algebra? If
so, then good news is on the way. In the next section, we will show you how to
prove some heavy-duty formulas without using any algebra at all. Just a few words
and you are done. No kidding.

(cid:0) (cid:1) (cid:1) (cid:1) C .(cid:0)1/m(cid:0)1

C (cid:1) (cid:1) (cid:1) C .(cid:0)1/m

1
p1p2 (cid:1) (cid:1) (cid:1) pn

1
p1p2 (cid:1) (cid:1) (cid:1) pn

1
pi pj pk

(cid:30) .n/ D n

D n

1A

1
pi pj

:

(11.3)

11.9 Combinatorial Proofs

Suppose you have n different T-shirts, but only want to keep k . You could equally
well select the k shirts you want to keep or select the complementary set of n (cid:0) k
shirts you want to throw out. Thus, the number of ways to select k shirts from
 
!
 
!
among n must be equal to the number of ways to select n (cid:0) k shirts from among n.
Therefore:

D

n

k

n
n (cid:0) k

:

27“mcs-ftl” — 2010/9/8 — 0:40 — page 340 — #346

Chapter 11 Cardinality Rules

This is easy to prove algebraically, since both sides are equal to:

nŠ
k Š .n (cid:0) k /Š
But we didn’t really have to resort to algebra; we just used counting principles.
Hmmm.. . .

:

11.9.1 Pascal’s Identity
Jay, famed Math for Computer Science Teaching Assistant, has decided to try out
for the US Olympic boxing team. After all, he’s watched all of the Rocky movies
and spent hours in front of a mirror sneering, “Yo, you wanna piece a’ me?!” Jay
ﬁgures that n people (including himself) are competing for spots on the team and
only k will be selected. As part of maneuvering for a spot on the team, he needs to
work out how many different teams are possible. There are two cases to consider:
(cid:15) Jay is selected for the team, and his k (cid:0) 1 teammates are selected from among
 
!
the other n(cid:0)1 competitors. The number of different teams that can be formed
in this way is:
n (cid:0) 1
k (cid:0) 1
:
(cid:15) Jay is not selected for the team, and all k team members are selected from
 
!
among the other n (cid:0) 1 competitors. The number of teams that can be formed
this way is:
n (cid:0) 1
k

:

All teams of the ﬁrst type contain Jay, and no team of the second type does;
 
!
 
!
therefore, the two sets of teams are disjoint. Thus, by the Sum Rule, the total
number of possible Olympic boxing teams is:
n (cid:0) 1
n (cid:0) 1
C
k (cid:0) 1
k
Jeremy, equally-famed Teaching Assistant, thinks Jay isn’t so tough and so he
!
 
might as well also try out. He reasons that n people (including himself) are trying
out for k spots. Thus, the number of ways to select the team is simply:

:

n

k

:

28“mcs-ftl” — 2010/9/8 — 0:40 — page 341 — #347

11.9. Combinatorial Proofs

Jeremy and Jay each correctly counted the number of possible boxing teams.
!
 
!
 
!
 
Thus, their answers must be equal. So we know:
n (cid:0) 1
k (cid:0) 1

n (cid:0) 1
k

D

C

n

k

:

This is called Pascal’s Identity. And we proved it without any algebra! Instead, we
relied purely on counting techniques.

11.9.2 Finding a Combinatorial Proof
A combinatorial proof is an argument that establishes an algebraic fact by relying
on counting principles. Many such proofs follow the same basic outline:

1. Deﬁne a set S .
2. Show that jS j D n by counting one way.
3. Show that jS j D m by counting another way.
4. Conclude that n D m.
 
!
 
!
In the preceding example, S was the set of all possible Olympic boxing teams. Jay
computed
n (cid:0) 1
n (cid:0) 1
C
k (cid:0) 1
k
!
 
by counting one way, and Jeremy computed

jS j D

jS j D

n

k

by counting another way. Equating these two expressions gave Pascal’s Identity.
More typically, the set S is deﬁned in terms of simple sequences or sets rather
than an elaborate story. Here is a less colorful example of a combinatorial argu-
!
 
!
! 
 
ment.
nX
n
rD0

Theorem 11.9.1.

2n
n (cid:0) r

D

3n

n

r

29“mcs-ftl” — 2010/9/8 — 0:40 — page 342 — #348

Chapter 11 Cardinality Rules

3n

n

Proof. We give a combinatorial proof. Let S be all n-card hands that can be dealt
 
!
from a deck containing n red cards (numbered 1; : : : ; n) and 2n black cards (num-
bered 1; : : : ; 2n). First, note that every 3n-element set has
jS j D
!
! 
 
n-element subsets.
From another perspective, the number of hands with exactly r red cards is
2n
n
since there are (cid:0)n
(cid:1) ways to choose the r red cards and (cid:0) 2n
(cid:1) ways to choose the
n (cid:0) r
r
n(cid:0)r
n (cid:0) r black cards. Since the number of red cards can be anywhere from 0 to n, the
r
 
!
! 
jS j D nX
total number of n-card hands is:
n
2n
n (cid:0) r
:
rD0
r
Equating these two expressions for jS j proves the theorem.
Combinatorial proofs are almost magical. Theorem 11.9.1 looks pretty scary, but
we proved it without any algebraic manipulations at all. The key to constructing
the right side of Theorem 11.9.1 is (cid:0)3n
(cid:1), which suggests that it will be helpful to
a combinatorial proof is choosing the set S properly, which can be tricky. Gener-
ally, the simpler side of the equation should provide some guidance. For example,
n
choose S to be all n-element subsets of some 3n-element set.

(cid:4)

11.10 The Pigeonhole Principle

Here is an old puzzle:

A drawer in a dark room contains red socks, green socks, and blue
socks. How many socks must you withdraw to be sure that you have a
matching pair?

For example, picking out three socks is not enough; you might end up with one
red, one green, and one blue. The solution relies on the Pigeonhole Principle,
which is a friendly name for the contrapositive of the injective case of the Mapping
Rule.

30“mcs-ftl” — 2010/9/8 — 0:40 — page 343 — #349

11.10. The Pigeonhole Principle

Figure 11.3 One possible mapping of four socks to three colors.

Rule 11.10.1 (Pigeonhole Principle). If jX j > jY j, then for every total function5
f W X ! Y , there exist two different elements of X that are mapped to the same
element of Y .

What this abstract mathematical statement has to do with selecting footwear un-
der poor lighting conditions is maybe not obvious. However, let A be the set of
socks you pick out, let B be the set of colors available, and let f map each sock
to its color. The Pigeonhole Principle says that if jAj > jB j D 3, then at least two
elements of A (that is, at least two socks) must be mapped to the same element of
B (that is, the same color). Therefore, four socks are enough to ensure a matched
pair. For example, one possible mapping of four socks to three colors is shown in
Figure 11.3.
Not surprisingly, the pigeonhole principle is often described in terms of pigeons:

If there are more pigeons than holes they occupy, then at least two
pigeons must be in the same hole.

In this case, the pigeons form set A, the pigeonholes are set B , and f describes
which hole each pigeon ﬂies into.
Mathematicians have come up with many ingenious applications for the pigeon-
hole principle. If there were a cookbook procedure for generating such arguments,
we’d give it to you. Unfortunately, there isn’t one. One helpful tip, though: when
you try to solve a problem with the pigeonhole principle, the key is to clearly iden-
tify three things:

5This Mapping Rule applies even if f is a total injective relation. Recall that a function is total if
8x 2 X 9y 2 Y : f .x / D y .

1st sockAf2nd sock3rd sock4th sockredBgreenblue31“mcs-ftl” — 2010/9/8 — 0:40 — page 344 — #350

Chapter 11 Cardinality Rules

1. The set A (the pigeons).

2. The set B (the pigeonholes).

3. The function f (the rule for assigning pigeons to pigeonholes).

11.10.1 Hairs on Heads
There are a number of generalizations of the pigeonhole principle. For example:
Rule 11.10.2 (Generalized Pigeonhole Principle). If jX j > k (cid:1) jY j, then every total
function f W X ! Y maps at least k C 1 different elements of X to the same
element of Y .

For example, if you pick two people at random, surely they are extremely un-
likely to have exactly the same number of hairs on their heads. However, in the
remarkable city of Boston, Massachusetts there are actually three people who have
exactly the same number of hairs! Of course, there are many bald people in Boston,
and they all have zero hairs. But we’re talking about non-bald people; say a person
is non-bald if they have at least ten thousand hairs on their head.
Boston has about 500,000 non-bald people, and the number of hairs on a person’s
head is at most 200,000. Let A be the set of non-bald people in Boston, let B D
f10; 000; 10; 001; : : : ; 200; 000g, and let f map a person to the number of hairs on
his or her head. Since jAj > 2jB j, the Generalized Pigeonhole Principle implies
that at least three people have exactly the same number of hairs. We don’t know
who they are, but we know they exist!

11.10.2 Subsets with the Same Sum
For your reading pleasure, we have displayed ninety 25-digit numbers in Fig-
ure 11.4. Are there two different subsets of these 25-digit numbers that have the
same sum? For example, maybe the sum of the last ten numbers in the ﬁrst column
is equal to the sum of the ﬁrst eleven numbers in the second column?
Finding two subsets with the same sum may seem like a silly puzzle, but solving
these sorts of problems turns out to be useful in diverse applications such as ﬁnding
good ways to ﬁt packages into shipping containers and decoding secret messages.
It turns out that it is hard to ﬁnd different subsets with the same sum, which
is why this problem arises in cryptography. But it is easy to prove that two such
subsets exist. That’s where the Pigeonhole Principle comes in.
Let A be the collection of all subsets of the 90 numbers in the list. Now the sum
of any subset of numbers is at most 90 (cid:1) 1025 , since there are only 90 numbers and
every 25-digit number is less than 1025 . So let B be the set of integers f0; 1; : : : ; 90 (cid:1)
1025 g, and let f map each subset of numbers (in A) to its sum (in B ).

32“mcs-ftl” — 2010/9/8 — 0:40 — page 345 — #351

11.10. The Pigeonhole Principle

0020480135385502964448038
5763257331083479647409398
0489445991866915676240992
5800949123548989122628663
1082662032430379651370981
6042900801199280218026001
1178480894769706178994993
6116171789137737896701405
1253127351683239693851327
6144868973001582369723512
1301505129234077811069011
6247314593851169234746152
1311567111143866433882194
6814428944266874963488274
1470029452721203587686214
6870852945543886849147881
1578271047286257499433886
6914955508120950093732397
1638243921852176243192354
6949632451365987152423541
1763580219131985963102365
7128211143613619828415650
1826227795601842231029694
7173920083651862307925394
1843971862675102037201420
7215654874211755676220587
2396951193722134526177237
7256932847164391040233050
2781394568268599801096354
7332822657075235431620317
2796605196713610405408019
7426441829541573444964139
2931016394761975263190347
7632198126531809327186321
2933458058294405155197296
7712154432211912882310511
3075514410490975920315348
7858918664240262356610010
8149436716871371161932035
3111474985252793452860017
7898156786763212963178679
3145621587936120118438701
8147591017037573337848616
3148901255628881103198549
5692168374637019617423712

3171004832173501394113017
8247331000042995311646021
3208234421597368647019265
8496243997123475922766310
3437254656355157864869113
8518399140676002660747477
3574883393058653923711365
8543691283470191452333763
3644909946040480189969149
8675309258374137092461352
3790044132737084094417246
8694321112363996867296665
3870332127437971355322815
8772321203608477245851154
4080505804577801451363100
8791422161722582546341091
4167283461025702348124920
9062628024592126283973285
4235996831123777788211249
9137845566925526349897794
4670939445749439042111220
9153762966803189291934419
4815379351865384279613427
9270880194077636406984249
4837052948212922604442190
9324301480722103490379204
5106389423855018550671530
9436090832146695147140581
5142368192004769218069910
9475308159734538249013238
5181234096130144084041856
9492376623917486974923202
5198267398125617994391348
9511972558779880288252979
5317592940316231219758372
9602413424619187112552264
5384358126771794128356947
9631217114906129219461111
3157693105325111284321993
5439211712248901995423441
9908189853102753335981319
5610379826092838192760458
9913237476341764299813987
5632317555465228677676044
8176063831682536571306791

Figure 11.4 Ninety 25-digit numbers. Can you ﬁnd two different subsets of these
numbers that have the same sum?

33“mcs-ftl” — 2010/9/8 — 0:40 — page 346 — #352

Chapter 11 Cardinality Rules

We proved that an n-element set has 2n different subsets in Section 11.2. There-
fore:
jAj D 290 (cid:21) 1:237 (cid:2) 1027

On the other hand:

jB j D 90 (cid:1) 1025 C 1  0:901 (cid:2) 1027 :
Both quantities are enormous, but jAj is a bit greater than jB j. This means that f
maps at least two elements of A to the same element of B . In other words, by the
Pigeonhole Principle, two different subsets must have the same sum!
Notice that this proof gives no indication which two sets of numbers have the
same sum. This frustrating variety of argument is called a nonconstructive proof.
To see if was possible to actually ﬁnd two different subsets of the ninety 25-digit
numbers with the same sum, we offered a $100 prize to the ﬁrst student who did it.
We didn’t expect to have to pay off this bet, but we underestimated the ingenuity
and initiative of the students. One computer science major wrote a program that
cleverly searched only among a reasonably small set of “plausible” sets, sorted
them by their sums, and actually found a couple with the same sum. He won the
prize. A few days later, a math major ﬁgured out how to reformulate the sum
problem as a “lattice basis reduction” problem; then he found a software package
implementing an efﬁcient basis reduction procedure, and using it, he very quickly
found lots of pairs of subsets with the same sum. He didn’t win the prize, but he
got a standing ovation from the class—staff included.

11.11 A Magic Trick

There is a Magician and an Assistant. The Assistant goes into the audience with a
deck of 52 cards while the Magician looks away.
Five audience members each select one card from the deck. The Assistant then
gathers up the ﬁve cards and holds up four of them so the Magician can see them.
The Magician concentrates for a short time and then correctly names the secret,
ﬁfth card!
Since we don’t really believe the Magician can read minds, we know the As-
sistant has somehow communicated the secret card to the Magician. Since real
Magicians and Assistants are not to be trusted, we can expect that the Assistant
would illegitimately signal the Magician with coded phrases or body language, but
they don’t have to cheat in this way. In fact, the Magician and Assistant could be

34“mcs-ftl” — 2010/9/8 — 0:40 — page 347 — #353

11.11. A Magic Trick

Sets with Distinct Subset Sums
How can we construct a set of n positive integers such that all its subsets have
distinct sums? One way is to use powers of two:
f1; 2 ; 4 ; 8; 16g

This approach is so natural that one suspects all other such sets must involve larger
numbers. (For example, we could safely replace 16 by 17, but not by 15.) Remark-
ably, there are examples involving smaller numbers. Here is one:
f6; 9; 11; 12 ; 13g

One of the top mathematicians of the Twentieth Century, Paul Erd ˝os, conjectured in
1931 that there are no such sets involving signiﬁcantly smaller numbers. More pre-
cisely, he conjectured that the largest number in such a set must be greater than c 2n
for some constant c > 0. He offered $500 to anyone who could prove or disprove
his conjecture, but the problem remains unsolved.

35“mcs-ftl” — 2010/9/8 — 0:40 — page 348 — #354

Chapter 11 Cardinality Rules

kept out of sight of each other while some audience member holds up the 4 cards
designated by the Assistant for the Magician to see.
Of course, without cheating, there is still an obvious way the Assistant can com-
municate to the Magician: he can choose any of the 4Š D 24 permutations of the
4 cards as the order in which to hold up the cards. However, this alone won’t
quite work: there are 48 cards remaining in the deck, so the Assistant doesn’t have
enough choices of orders to indicate exactly what the secret card is (though he
could narrow it down to two cards).

11.11.1 The Secret
The method the Assistant can use to communicate the ﬁfth card exactly is a nice
application of what we know about counting and matching.
The Assistant has a second legitimate way to communicate: he can choose which
of the ﬁve cards to keep hidden. Of course, it’s not clear how the Magician could
determine which of these ﬁve possibilities the Assistant selected by looking at the
four visible cards, but there is a way, as we’ll now explain.
The problem facing the Magician and Assistant is actually a bipartite matching
problem. Put all the sets of 5 cards in a collection X on the left. And put all the
sequences of 4 distinct cards in a collection Y on the right. These are the two sets
of vertices in the bipartite graph. There is an edge between a set of 5 cards and
a sequence of 4 if every card in the sequence is also in the set. In other words, if
the audience selects a set of 5 cards, then the Assistant must reveal a sequence of
4 cards that is adjacent in the bipartite graph. Some edges are shown in the diagram
in Figure 11.5.
For example,

f8~; K(cid:127); Q(cid:127); 2}; 6}g
is an element of X on the left.
If the audience selects this set of 5 cards, then
there are many different 4-card sequences on the right in set Y that the Assis-
tant could choose to reveal, including .8~; K(cid:127); Q(cid:127); 2}/, .K(cid:127); 8~; Q(cid:127); 2}/, and
.K(cid:127); 8~; 6}; Q(cid:127)/.
What the Magician and his Assistant need to perform the trick is a matching for
the X vertices. If they agree in advance on some matching, then when the audience
selects a set of 5 cards, the Assistant reveals the matching sequence of 4 cards. The
Magician uses the matching to ﬁnd the audience’s chosen set of 5 cards, and so he
can name the one not already revealed.
For example, suppose the Assistant and Magician agree on a matching containing
the two bold edges in Figure 11.5. If the audience selects the set
f8~; K(cid:127); Q(cid:127); 9|; 6}g;

(11.4)

(11.5)

36“mcs-ftl” — 2010/9/8 — 0:40 — page 349 — #355

11.11. A Magic Trick

Figure 11.5 The bipartite graph where the nodes on the left correspond to sets
of 5 cards and the nodes on the right correspond to sequences of 4 cards. There is
an edge between a set and a sequence whenever all the cards in the sequence are
contained in the set.

then the Assistant reveals the corresponding sequence
.K(cid:127); 8~; 6}; Q(cid:127)/:

(11.6)

Using the matching, the Magician sees that the hand (11.5) is matched to the se-
quence (11.6), so he can name the one card in the corresponding set not already
revealed, namely, the 9|. Notice that the fact that the sets are matched, that is,
that different sets are paired with distinct sequences, is essential. For example, if
the audience picked the previous hand (11.4), it would be possible for the Assistant
to reveal the same sequence (11.6), but he better not do that; if he did, then the
Magician would have no way to tell if the remaining card was the 9| or the 2}.
So how can we be sure the needed matching can be found? The answer is that
each vertex on the left has degree 5 (cid:1) 4Š D 120, since there are ﬁve ways to select
the card kept secret and there are 4Š permutations of the remaining 4 cards.
In
addition, each vertex on the right has degree 48, since there are 48 possibilities for
the ﬁfth card. So this graph is degree-constrained according to Deﬁnition 5.2.6,
and therefore satisﬁes Hall’s matching condition.
In fact, this reasoning shows that the Magician could still pull off the trick if 120
cards were left instead of 48, that is, the trick would work with a deck as large as
124 different cards—without any magic!

f8~;K;Q;2};6}gf8~;K;Q;9|;6}gfK;8~;6};QgfK;8~;Q;2}gf8~;K;Q;2}gxDallsets of 5 cardsyDallsequences of 4distinct cards37“mcs-ftl” — 2010/9/8 — 0:40 — page 350 — #356

Chapter 11 Cardinality Rules

Figure 11.6 The 13 card ranks arranged in cyclic order.

11.11.2 The Real Secret
with (cid:0)52
(cid:1) D 2 ; 598; 960 edges? For the trick to work in practice, there has to be a
But wait a minute!
It’s all very well in principle to have the Magician and his
Assistant agree on a matching, but how are they supposed to remember a matching
5
way to match hands and card sequences mentally and on the ﬂy.
We’ll describe one approach. As a running example, suppose that the audience
selects:
10~ 9} 3~ Q(cid:127) J }:
(cid:15) The Assistant picks out two cards of the same suit.
In the example, the
assistant might choose the 3~ and 10~. This is always possible because of
the Pigeonhole Principle—there are ﬁve cards and 4 suits so two cards must
be in the same suit.
(cid:15) The Assistant locates the ranks of these two cards on the cycle shown in Fig-
ure 11.6. For any two distinct ranks on this cycle, one is always between 1
and 6 hops clockwise from the other. For example, the 3~ is 6 hops clock-
wise from the 10~.
(cid:15) The more counterclockwise of these two cards is revealed ﬁrst, and the other
becomes the secret card. Thus, in our example, the 10~ would be revealed,
and the 3~ would be the secret card. Therefore:

– The suit of the secret card is the same as the suit of the ﬁrst card re-
vealed.

A2345678910JQK38“mcs-ftl” — 2010/9/8 — 0:40 — page 351 — #357

11.11. A Magic Trick

– The rank of the secret card is between 1 and 6 hops clockwise from the
rank of the ﬁrst card revealed.
(cid:15) All that remains is to communicate a number between 1 and 6. The Magician
and Assistant agree beforehand on an ordering of all the cards in the deck
from smallest to largest such as:
A| A} A~ A(cid:127) 2| 2} 2~ 2(cid:127) : : : K~ K(cid:127)
The order in which the last three cards are revealed communicates the num-
ber according to the following scheme:

large / = 1
. small; medium;
medium / = 2
large;
. small;
large / = 3
small;
. medium;
large;
. medium;
small / = 4
small; medium / = 5
large;
.
small / = 6
medium;
large;
.
In the example, the Assistant wants to send 6 and so reveals the remaining
three cards in large, medium, small order. Here is the complete sequence that
the Magician sees:
10~ Q(cid:127) J } 9}
(cid:15) The Magician starts with the ﬁrst card, 10~, and hops 6 ranks clockwise to
reach 3~, which is the secret card!
So that’s how the trick can work with a standard deck of 52 cards. On the other
hand, Hall’s Theorem implies that the Magician and Assistant can in principle per-
form the trick with a deck of up to 124 cards. It turns out that there is a method
which they could actually learn to use with a reasonable amount of practice for a
124-card deck, but we won’t explain it here.6

11.11.3 The Same Trick with Four Cards?
Suppose that the audience selects only four cards and the Assistant reveals a se-
quence of three to the Magician. Can the Magician determine the fourth card?
Let X be all the sets of four cards that the audience might select, and let Y be all
 
!
the sequences of three cards that the Assistant might reveal. Now, on one hand, we
have

jX j D

D 270; 725

52

4

6See The Best Card Trick by Michael Kleber for more information.

39“mcs-ftl” — 2010/9/8 — 0:40 — page 352 — #358

Chapter 11 Cardinality Rules

by the Subset Rule. On the other hand, we have
jY j D 52 (cid:1) 51 (cid:1) 50 D 132 ; 600
by the Generalized Product Rule. Thus, by the Pigeonhole Principle, the Assistant
(cid:24) 270; 725
(cid:25) D 3
must reveal the same sequence of three cards for at least
132 ; 600
different four-card hands. This is bad news for the Magician: if he sees that se-
quence of three, then there are at least three possibilities for the fourth card which
he cannot distinguish. So there is no legitimate way for the Assistant to communi-
cate exactly what the fourth card is!

11.11.4 Never Say Never
No sooner than we ﬁnished proving that the Magician can’t pull off the trick with
four cards instead of ﬁve, a student showed us a way that it might be doable after
all. The idea is to place the three cards on a table one at a time instead of revealing
them all at once. This provides the Magician with two completely independent
sequences of three cards: one for the temporal order in which the cards are placed
on the table, and one for the spatial order in which they appear once placed.
For example, suppose the audience selects
10~ 9} 3~ Q(cid:127)
and the assistant decides to reveal
10~ 9} Q(cid:127):
The assistant might decide to reveal the Q(cid:127) ﬁrst, the 10~ second, and the 9} third,
thereby production the temporal sequence
.Q(cid:127); 10~; 9}/:
If the Q(cid:127) is placed in the middle position on the table, the 10~ is placed in the
rightmost position on the table, and the 9} is placed in the leftmost position on the
table, the spatial sequence would be
.9}; Q(cid:127); 10~/:
In this version of the card trick, X consists of all sets of 4 cards and Y consists
of all pairs of sequences of the same 3 cards. As before, we can create a bipartite

40“mcs-ftl” — 2010/9/8 — 0:40 — page 353 — #359

11.11. A Magic Trick

graph where an edge connects a set S of 4 cards in X with a pair of sequences in Y
if the 3 cards in the sequences are in S .
The degree of every node in X is then
4 (cid:1) 3Š (cid:1) 3Š D 144

since there are 4 choices for which card is not revealed and 3Š orders for each
sequence in the pair.
The degree of every node in Y is 49 since there are 52 (cid:0) 3 D 49 possible choices
for the 4th card. Since 144 (cid:21) 49, we can use Hall’s Theorem to establish the
existing of a matching for X .
Hence, the magic trick is doable with 4 cards—the assistant just has to convey
more information. Can you ﬁgure out a convenient way to pull off the trick on the
ﬂy?
So what about the 3-card version? Surely that is not doable.. . .

41“mcs-ftl” — 2010/9/8 — 0:40 — page 354 — #360

42MIT OpenCourseWare
http://ocw.mit.edu 

6.042J / 18.062J Mathematics for Computer Science 
Fall 2010 

For information about citing these materials or our Terms of Use, visit: http://ocw.mit.edu/terms . 

